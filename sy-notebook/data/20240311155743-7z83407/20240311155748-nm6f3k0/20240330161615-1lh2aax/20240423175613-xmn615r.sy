{"ID":"20240423175613-xmn615r","Spec":"1","Type":"NodeDocument","Properties":{"icon":"spring.png","id":"20240423175613-xmn615r","title":"SpEL 上下文 EvaluationContext","type":"doc","updated":"20240423191847"},"Children":[{"ID":"20240423175613-n3ql6p5","Type":"NodeParagraph","Properties":{"id":"20240423175613-n3ql6p5","updated":"20240423180232"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EvaluationContext"},{"Type":"NodeText","Data":"​ 在计算 SpEL 表达式时，提供上下文的属性、方法、字段等，也可以实现类型转换。"}]},{"ID":"20240423175947-5l6set1","Type":"NodeParagraph","Properties":{"id":"20240423175947-5l6set1","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240423180232"},"Children":[{"Type":"NodeText","Data":"除此之外，还负责反射、缓存等实现"}]},{"ID":"20240423175916-nsucvz1","Type":"NodeParagraph","Properties":{"id":"20240423175916-nsucvz1","updated":"20240423180232"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"StandardEvaluationContext"},{"Type":"NodeText","Data":"​ 是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EvaluationContext"},{"Type":"NodeText","Data":"​ 的一个实现。"}]},{"ID":"20240423175148-512uzoq","Type":"NodeParagraph","Properties":{"id":"20240423175148-512uzoq","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240423180303"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"StandardEvaluationContext"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 构造成本较高且自带缓存，应尽可能复用上下文"}]},{"ID":"20240423180234-n8w8tmq","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240423180234-n8w8tmq","updated":"20240423180234"},"Children":[{"Type":"NodeText","Data":"上下文"}]},{"ID":"20240423180021-q4ka62n","Type":"NodeList","ListData":{},"Properties":{"id":"20240423180021-q4ka62n","updated":"20240423191847"},"Children":[{"ID":"20240423180050-wod6598","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240423180050-wod6598","updated":"20240423191847"},"Children":[{"ID":"20240423180050-x5th7b7","Type":"NodeParagraph","Properties":{"id":"20240423180050-x5th7b7","updated":"20240423190901"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"setRootObject"},{"Type":"NodeText","Data":"​：设置根对象，根对象可以忽略对象名直接访问成员，也可以通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#root"},{"Type":"NodeText","Data":"​ 访问"}]},{"ID":"20240423174401-ulc5dgq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240423174401-ulc5dgq","updated":"20240423191847"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"// 设置上下文\nCalendar calendar = Calendar.getInstance();\nEvaluationContext context = new StandardEvaluationContext(calendar);\n\nExpression exp = parser.parseExpression(\"time\");\nassertEquals(calendar.getTime(), exp.getValue(context));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240423180022-keu7f6w","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240423180022-keu7f6w","updated":"20240423191742"},"Children":[{"ID":"20240423180022-rxs2jwi","Type":"NodeParagraph","Properties":{"id":"20240423180022-rxs2jwi","updated":"20240423191724"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"setVariable"},{"Type":"NodeText","Data":"​：注册上下文对象，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#对象名"},{"Type":"NodeText","Data":"​ 访问"}]}]},{"ID":"20240423190737-p2hx8gs","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240423190737-p2hx8gs","updated":"20240423191811"},"Children":[{"ID":"20240423190737-81tb0t3","Type":"NodeParagraph","Properties":{"id":"20240423190737-81tb0t3","updated":"20240423190816"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"registerFunction"},{"Type":"NodeText","Data":"​：注册上下文函数，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"#函数名"},{"Type":"NodeText","Data":"​ 访问"}]}]},{"ID":"20240423180122-xgsotfp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240423180122-xgsotfp","updated":"20240423180159"},"Children":[{"ID":"20240423180122-bxmxsvs","Type":"NodeParagraph","Properties":{"id":"20240423180122-bxmxsvs","updated":"20240423180159"},"Children":[{"Type":"NodeText","Data":"自定义 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ConstructorResolver"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MethodResolver"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"PropertyAccessor"},{"Type":"NodeText","Data":"​ 扩展 SpEL 表达式"}]}]}]},{"ID":"20240423180214-omg6w1y","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240423180214-omg6w1y","updated":"20240423180220"},"Children":[{"Type":"NodeText","Data":"类型转换"}]},{"ID":"20240423180327-f3qxzte","Type":"NodeParagraph","Properties":{"id":"20240423180327-f3qxzte","updated":"20240423180421"},"Children":[{"Type":"NodeText","Data":"默认情况下，SpEL 使用 Spring Core 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ConversionService"},{"Type":"NodeText","Data":"​ 服务进行类型转换。"}]},{"ID":"20240423180429-2xnufhq","Type":"NodeList","ListData":{},"Properties":{"id":"20240423180429-2xnufhq","updated":"20240423180430"},"Children":[{"ID":"20240423180430-qifcr6q","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240423180430-qifcr6q","updated":"20240423180430"},"Children":[{"ID":"20240423180430-5m73vxc","Type":"NodeParagraph","Properties":{"id":"20240423180430-5m73vxc","updated":"20240423180521"},"Children":[{"Type":"NodeText","Data":"内置常用转换，同时也保留了可扩展性"}]}]},{"ID":"20240423180522-qa6xjy5","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240423180522-qa6xjy5"},"Children":[{"ID":"20240423180522-zpezxn1","Type":"NodeParagraph","Properties":{"id":"20240423180522-zpezxn1","updated":"20240423180533"},"Children":[{"Type":"NodeText","Data":"支持泛型感知"}]}]}]},{"ID":"20240423180542-w17bbmn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240423180542-w17bbmn","updated":"20240423190422"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"Simple simple = new Simple();\nsimple.booleanList.add(true);\nStandardEvaluationContext simpleContext = new StandardEvaluationContext(simple);\nExpression exp = parser.parseExpression(\"booleanList[0]\");\nexp.setValue(simpleContext, false);\nAssertions.assertFalse(simple.booleanList.get(0));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240423190445-xvoylnb","Type":"NodeParagraph","Properties":{"id":"20240423190445-xvoylnb"}}]}