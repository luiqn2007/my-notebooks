{"ID":"20240403170138-ia2kral","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f4e6","id":"20240403170138-ia2kral","title":"编程式事务管理","type":"doc","updated":"20240404080031"},"Children":[{"ID":"20240403190358-1fcp6vg","Type":"NodeParagraph","Properties":{"id":"20240403190358-1fcp6vg","updated":"20240404080015"},"Children":[{"Type":"NodeText","Data":"Spring 通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"TransactionTemplate"},{"Type":"NodeText","Data":"​ 以编程的形式管理事务，常用属性包括："}]},{"ID":"20240403190726-j09922a","Type":"NodeList","ListData":{},"Properties":{"id":"20240403190726-j09922a","updated":"20240403191222"},"Children":[{"ID":"20240403190817-s8c7b41","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240403190817-s8c7b41","updated":"20240403190817"},"Children":[{"ID":"20240403190817-nifjkkb","Type":"NodeParagraph","Properties":{"id":"20240403190817-nifjkkb","updated":"20240403190829"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"transactionManager"},{"Type":"NodeText","Data":"​：持有一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"PlatformTransactionManager"},{"Type":"NodeText","Data":"​ 实例"}]}]},{"ID":"20240403190830-vjtp3ix","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240403190830-vjtp3ix","updated":"20240403191246"},"Children":[{"ID":"20240403190830-wr6bnbc","Type":"NodeParagraph","Properties":{"id":"20240403190830-wr6bnbc","updated":"20240403191000"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"isolationLevel"},{"Type":"NodeText","Data":"​：事务隔离级别"}]},{"ID":"20240403191017-34x60pk","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;","id":"20240403191017-34x60pk","updated":"20240403191246"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"事务隔离级别"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ISOLATION_READ_UNCOMMITTED"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"事务未提交的更改可以由其他事务读取"}]}]}]}]},{"ID":"20240403190841-2dne99h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240403190841-2dne99h","updated":"20240403191222"},"Children":[{"ID":"20240403190841-ex26g2y","Type":"NodeParagraph","Properties":{"id":"20240403190841-ex26g2y","updated":"20240403191001"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"propagationBehavior"},{"Type":"NodeText","Data":"​：事务传播行为"}]},{"ID":"20240403191146-gd048ga","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;","id":"20240403191146-gd048ga","updated":"20240403191222"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"事务传播行为"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"PROPAGATION_REQUIRED"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"若事务未调用方法，事务管理器启动新事务并执行；否则，事务管理器在同一事务中执行方法"}]}]}]}]}]},{"ID":"20240403185843-x3q7c5q","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240403185843-x3q7c5q","updated":"20240404080031"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003cbean id=\"transactionTemplate\" class=\"org.springframework.transaction.support.TransactionTemplate\"\u003e\n    \u003cproperty name=\"transactionManager\" ref=\"txManager\"/\u003e\n    \u003cproperty name=\"isolationLevelName\" value=\"ISOLATION_READ_UNCOMMITTED\"/\u003e\n    \u003cproperty name=\"propagationBehaviorName\" value=\"PROPAGATION_REQUIRED\"/\u003e\n\u003c/bean\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240403191249-h93fric","Type":"NodeParagraph","Properties":{"id":"20240403191249-h93fric","updated":"20240403192728"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"TransactionTemplate#execute"},{"Type":"NodeText","Data":"​ 方法表示开启并执行一个事务，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"TransactionCallback\u0026lt;T\u0026gt;"},{"Type":"NodeText","Data":"​ 的泛型 T 即返回值类型。当执行失败时 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"TransactionTemplate"},{"Type":"NodeText","Data":"​ 会自动执行 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rollback"},{"Type":"NodeText","Data":"​ 操作（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"TransactionStatus.setRollbackOnly()"},{"Type":"NodeText","Data":"​）。"}]},{"ID":"20240403192721-iodiae3","Type":"NodeList","ListData":{},"Properties":{"id":"20240403192721-iodiae3","updated":"20240403192724"},"Children":[{"ID":"20240403192724-p97a0hf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240403192724-p97a0hf","updated":"20240403192724"},"Children":[{"ID":"20240403192724-lzn98yn","Type":"NodeParagraph","Properties":{"id":"20240403192724-lzn98yn","updated":"20240403192741"},"Children":[{"Type":"NodeText","Data":"若无返回值，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"TransactionCallbackWithoutResult"},{"Type":"NodeText","Data":"​，或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"executeWithoutResult"},{"Type":"NodeText","Data":"​ 方法"}]}]}]},{"ID":"20240403194859-asrms1r","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240403194859-asrms1r","updated":"20240403194929"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"private static final String SQL_INSERT_CUSTOMER_REGISTRATION =\n        \"insert into customer_registration_details(ACCOUNT_NUMBER, ADDRESS, CARD_NUMBER) \" +\n        \"value (:account, :address, :number)\";\n\n@Autowired\nprivate TransactionTemplate transactionTemplate;\n\n@Autowired\nprivate NamedParameterJdbcTemplate jdbcTemplate;\n\n@Override\npublic void registerCustomer(CustomerRegistrationDetails customerRegistrationDetails) {\n    transactionTemplate.executeWithoutResult(status -\u003e {\n        Map\u003cString, Object\u003e arguments = new HashMap\u003c\u003e();\n        arguments.put(\"account\", customerRegistrationDetails.getAccountNumber());\n        arguments.put(\"address\", customerRegistrationDetails.getAddress());\n        arguments.put(\"number\", customerRegistrationDetails.getCardNumber());\n        jdbcTemplate.update(SQL_INSERT_CUSTOMER_REGISTRATION, arguments);\n    });\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240403192250-kg5um57","Type":"NodeParagraph","Properties":{"id":"20240403192250-kg5um57","updated":"20240403192346"},"Children":[{"Type":"NodeText","Data":"当然，也可以直接使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"PlatformTransactionManager"},{"Type":"NodeText","Data":"​ 执行事务，但需要手动提交事务和回滚操作。"}]}]}