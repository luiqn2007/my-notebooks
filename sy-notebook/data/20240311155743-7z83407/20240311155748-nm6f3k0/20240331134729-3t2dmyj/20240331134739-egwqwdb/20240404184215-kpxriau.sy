{"ID":"20240404184215-kpxriau","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f4e6","id":"20240404184215-kpxriau","title":"Spring Data MongoDB","type":"doc","updated":"20240406121214"},"Children":[{"ID":"20240404184228-3jmp62m","Type":"NodeParagraph","Properties":{"id":"20240404184228-3jmp62m","updated":"20240405223850"},"Children":[{"Type":"NodeText","Data":"MongoDB 是一个 NoSQL 数据库，由 字段 - 值 的结构组成，类似 json 对象。"}]},{"ID":"20240405223857-sa1z97o","Type":"NodeParagraph","Properties":{"id":"20240405223857-sa1z97o","updated":"20240405223945"},"Children":[{"Type":"NodeText","Data":"每个文件都有一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"_id"},{"Type":"NodeText","Data":"​ 字段，该字段由 Mongodb 自动生成，作用类似主键。"}]},{"ID":"20240405223952-cyhqzxu","Type":"NodeParagraph","Properties":{"id":"20240405223952-cyhqzxu","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240406112024"},"Children":[{"Type":"NodeText","Data":"依赖（Spring）："},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"org.springframework.boot:spring-boot-starter-data-mongodb"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240406111942-p74kcxf","Type":"NodeParagraph","Properties":{"id":"20240406111942-p74kcxf","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240406112030"},"Children":[{"Type":"NodeText","Data":"依赖（MongoDB）："},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"org.mongodb:mongodb-driver-sync"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"org.mongodb:mongodb-driver-core"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240406121144-hd056b3","Type":"NodeParagraph","Properties":{"id":"20240406121144-hd056b3","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240406121214"},"Children":[{"Type":"NodeText","Data":"依赖（Querydsl）："},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"com.querydsl:querydsl-mongodb"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240405232654-o9asw0r","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240405232654-o9asw0r","updated":"20240406121126"},"Children":[{"ID":"20240405233402-dhkcs2u","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240405233402-dhkcs2u","updated":"20240406121126"},"Children":[{"ID":"20240405233402-jexlwfb","Type":"NodeParagraph","Properties":{"id":"20240405233402-jexlwfb","updated":"20240405233434"},"Children":[{"Type":"NodeText","Data":"创建实体类，即前面 JPA 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Entity"},{"Type":"NodeText","Data":"​ 类"}]},{"ID":"20240405233518-f2a6yxz","Type":"NodeSuperBlock","Properties":{"id":"20240405233518-f2a6yxz"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240405233446-chcd66q","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240405233446-chcd66q","updated":"20240405233503"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"import org.springframework.data.annotation.Id;\nimport org.springframework.data.mongodb.core.mapping.Document;\n\n@Document(collection = \"bank_accounts\")\npublic class BankAccountDetails {\n\n    @Id\n    private String accountId;\n    private int balance;\n    private Date lastTransactionTimestamp;\n    private List\u003cFixedDepositDetails\u003e fixedDeposits;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240405233504-i9j5g8l","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240405233504-i9j5g8l","updated":"20240405233516"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"import org.bson.types.ObjectId;\nimport org.springframework.data.annotation.Id;\n\npublic class FixedDepositDetails {\n    @Id\n    private ObjectId fixedDepositId;\n    private int fdAmount;\n\n    public FixedDepositDetails() {\n        fixedDepositId = ObjectId.get();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240405233508-v25bvif","Type":"NodeList","ListData":{},"Properties":{"id":"20240405233508-v25bvif","updated":"20240405233520"},"Children":[{"ID":"20240405233520-hlincz9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240405233520-hlincz9","updated":"20240405233520"},"Children":[{"ID":"20240405233520-igh78cm","Type":"NodeParagraph","Properties":{"id":"20240405233520-igh78cm","updated":"20240405233650"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Document"},{"Type":"NodeText","Data":"​ 注解表示一个 MongoDB 文档建模域实体，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Id"},{"Type":"NodeText","Data":"​ 表示主键字段"}]}]},{"ID":"20240405233624-e95r4wo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240405233624-e95r4wo"},"Children":[{"ID":"20240405233624-nzzvirb","Type":"NodeParagraph","Properties":{"id":"20240405233624-nzzvirb","updated":"20240405233741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FixedDepositDetails"},{"Type":"NodeText","Data":"​ 类作为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"BankAccountDetails"},{"Type":"NodeText","Data":"​ 的一个嵌入对象，不需要一个单独的文档，故没有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Document"},{"Type":"NodeText","Data":"​ 注解"}]}]},{"ID":"20240405233742-p5v6itk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240405233742-p5v6itk"},"Children":[{"ID":"20240405233742-58fe9oi","Type":"NodeParagraph","Properties":{"id":"20240405233742-58fe9oi","updated":"20240405233850"},"Children":[{"Type":"NodeText","Data":"我们需要 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FixedDepositDetails"},{"Type":"NodeText","Data":"​ 具有唯一标识符识别定期存款，故手动使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ObjectId.get()"},{"Type":"NodeText","Data":"​ 方法要求分配一个 ID（否则 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Id"},{"Type":"NodeText","Data":"​ 也无效）"}]}]}]},{"ID":"20240406121054-1zyweul","Type":"NodeParagraph","Properties":{"id":"20240406121054-1zyweul","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240406121126"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"Querydsl"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​，需要将这两个类也使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"@Entity"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​，用于生成 Q 类"}]}]},{"ID":"20240405233435-ertrmqi","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240405233435-ertrmqi"},"Children":[{"ID":"20240405233435-gecou5h","Type":"NodeParagraph","Properties":{"id":"20240405233435-gecou5h","updated":"20240405233443"},"Children":[{"Type":"NodeText","Data":"配置 MongoDB 连接"}]},{"ID":"20240405233914-dxlf9lt","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240405233914-dxlf9lt","updated":"20240405234128"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Configuration\n@Profile(\"mongodb\")\n@EnableAsync\n@EnableMongoRepositories(basePackages = \"com.example.mybank.mongodb_repository\")\npublic class MongoDBProfileConfig {\n\n    @Bean\n    public Properties mongoProperties() throws IOException {\n        Properties props = new Properties();\n        ClassPathResource resource = new ClassPathResource(\"database/mongodb.properties\");\n        try (InputStream inputStream = resource.getInputStream()) {\n            props.load(inputStream);\n        }\n        return props;\n    }\n\n    @Bean\n    public MongoClient mongoClient(@Qualifier(\"mongoProperties\") Properties properties) {\n        return MongoClients.create(properties.getProperty(\"url\"));\n    }\n\n    @Bean\n    public MongoDatabaseFactory mongoDbFactory(MongoClient mongoClient, @Qualifier(\"mongoProperties\") Properties properties) {\n        return new SimpleMongoClientDatabaseFactory(mongoClient, properties.getProperty(\"database\"));\n    }\n  \n    @Bean\n    public MongoTemplate mongoTemplate(MongoDatabaseFactory mongoDbFactory) {\n        return new MongoTemplate(mongoDbFactory);\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240405234131-gzgwabn","Type":"NodeParagraph","Properties":{"id":"20240405234131-gzgwabn","updated":"20240405234244"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@EnableAsync"},{"Type":"NodeText","Data":"​ 表示允许异步。使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"XML"},{"Type":"NodeText","Data":"​ 配置时使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"mongo"},{"Type":"NodeText","Data":"​ 命名空间"}]},{"ID":"20240405234255-afx6uoi","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240405234255-afx6uoi","updated":"20240405234445"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003cmongo:repositories base-package=\"com.example.mybank.mongodb_repository\" /\u003e\n\u003cmongo:mongo-client host=\"...\" port=\"...\" /\u003e\n\u003cmongo:db-factory dbname=\"...\" mongo-ref=\"mongoClient\"\u003e\n\u003cmongo:template db-factory-ref=\"mongoDbFactory\"\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240405233911-vl3whsr","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240405233911-vl3whsr"},"Children":[{"ID":"20240405233911-gmtz85c","Type":"NodeParagraph","Properties":{"id":"20240405233911-gmtz85c","updated":"20240406013243"},"Children":[{"Type":"NodeText","Data":"创建 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Repository"},{"Type":"NodeText","Data":"​ 接口类型，继承 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MongoRepository"},{"Type":"NodeText","Data":"​。若需要扩展方法，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Repository"},{"Type":"NodeText","Data":"​ 的"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240405102206-ltz52cp","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"扩展方式"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240406013020-o2zmxzo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240406013020-o2zmxzo","updated":"20240406014000"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"public interface BankAccountRepository \n       extends MongoRepository\u003cBankAccountDetails, String\u003e, QuerydslPredicateExecutor\u003cBankAccountDetails\u003e {\n  \n    List\u003cBankAccountDetails\u003e findByFixedDepositsTenureAndFixedDepositsFdAmount(int tenure, int fdAmount);\n  \n    @Async\n    CompletableFuture\u003cList\u003cBankAccountDetails\u003e\u003e findAllByBalanceGreaterThan(int balance);\n\n    @Query(\"{'balance': {$lt: ?0}}\")\n    List\u003cBankAccountDetails\u003e findByCustomQuery(int balance);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240406013009-2ibu46i","Type":"NodeParagraph","Properties":{"id":"20240406013009-2ibu46i","updated":"20240406023645"},"Children":[{"Type":"NodeText","Data":"MongoDB 也支持 Querydsl。处理如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"List\u0026lt;FixedDepositDetails\u0026gt; fixedDeposits"},{"Type":"NodeText","Data":"​ 的数据时，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".any()"},{"Type":"NodeText","Data":"​ 表示遍历，类似 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"filter"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240406023646-19lm9gh","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240406023646-19lm9gh","updated":"20240406024942"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"BankAccountDetails bankDetails = new BankAccountDetails();\nExampleMatcher matcher = ExampleMatcher.withIngore(\"account\", \"balance\", \"lastTransactionTemplate\").any 把\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]}]}