{"ID":"20240406160834-mlolrl6","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f4e6","id":"20240406160834-mlolrl6","title":"发送 JMS 信息","type":"doc","updated":"20240407223333"},"Children":[{"ID":"20240407003222-a26gcrw","Type":"NodeParagraph","Properties":{"id":"20240407003222-a26gcrw","updated":"20240407003250"},"Children":[{"Type":"NodeText","Data":"首先，需要定义 JMS 通道。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"amq:queue"},{"Type":"NodeText","Data":"​ 标签创建一个 JMS 队列，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"physicalName"},{"Type":"NodeText","Data":"​ 表示在 ActiveMQ 中的名称。当然，也可以在运行时"},{"Type":"NodeTextMark","TextMarkType":"text","TextMarkTextContent":"📦"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240406234718-zigm8zx","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"手动创建队列"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240407010343-n5g4i6f","Type":"NodeParagraph","Properties":{"id":"20240407010343-n5g4i6f","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240407010527"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"id"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 参数是队列对应 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"ActiveMQQueue"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ bean 对象的 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"id"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"physicalName"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 才是真正 JMS 队列的名称。后面用到的基本都是 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"physicalName"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240407003223-doodi5g","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240407003223-doodi5g","updated":"20240407003318"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003cbeans ...\n       xmlns:amq=\"http://activemq.apache.org/schema/core\"\n       xsi:schemaLocation=\"...\n                           http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd\"\u003e\n\n    \u003camq:queue id=\"fixedDepositDestination\" physicalName=\"aQueueDestination\" /\u003e\n    \u003camq:queue id=\"emailQueueDestination\" physicalName=\"emailQueueDestination\" /\u003e\n\u003c/beans\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240407223049-zh3b5tj","Type":"NodeBlockquote","Properties":{"id":"20240407223049-zh3b5tj","updated":"20240407223134"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240407223119-bsqaju8","Type":"NodeParagraph","Properties":{"id":"20240407223119-bsqaju8","updated":"20240407223123"},"Children":[{"Type":"NodeText","Data":"Java 配置"}]},{"ID":"20240407223123-b4f1rd6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240407223123-b4f1rd6","updated":"20240407223134"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Bean\npublic ActiveMQQueue fixedDepositDestination() {\n    return new ActiveMQQueue(\"aQueueDestination\");\n}\n@Bean\npublic ActiveMQQueue emailMessageDestination() {\n    return new ActiveMQQueue(\"emailQueueDestination\");\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240407003448-uqvonbw","Type":"NodeParagraph","Properties":{"id":"20240407003448-uqvonbw","updated":"20240407003449"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"JmsTemplate"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"JmsTransactionManager"},{"Type":"NodeText","Data":"​ 是一个用于信息的事务管理器，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"defaultDestination"},{"Type":"NodeText","Data":"​ 为默认的 JMS 队列"}]},{"ID":"20240407003505-apcci01","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240407003505-apcci01","updated":"20240407003518"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003cbeans ...\n       xmlns:amq=\"http://activemq.apache.org/schema/core\"\n       xsi:schemaLocation=\"...\n                           http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd\"\u003e\n\n    \u003cbean id=\"jmsTemplate\" class=\"org.springframework.jms.core.JmsTemplate\"\u003e\n        \u003cproperty name=\"connectionFactory\" ref=\"jmsFactory\" /\u003e\n        \u003cproperty name=\"defaultDestination\" ref=\"fixedDepositDestination\" /\u003e\n    \u003c/bean\u003e\n\n    \u003cbean id=\"jmsTxManager\" class=\"org.springframework.jms.connection.JmsTransactionManager\"\u003e\n        \u003cproperty name=\"connectionFactory\" ref=\"cachingConnectionFactory\"/\u003e\n    \u003c/bean\u003e\n\n\u003c/beans\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240407223215-ad20fs3","Type":"NodeBlockquote","Properties":{"id":"20240407223215-ad20fs3","updated":"20240407223242"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240407223215-g02rm3k","Type":"NodeParagraph","Properties":{"id":"20240407223215-g02rm3k","updated":"20240407223215"},"Children":[{"Type":"NodeText","Data":"Java 配置"}]},{"ID":"20240407223215-dkdliku","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240407223215-dkdliku","updated":"20240407223242"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Bean\npublic JmsTemplate jmsTemplate(ActiveMQConnectionFactory connectionFactory, @Qualifier(\"fixedDepositDestination\") ActiveMQQueue defaultQueue) {\n    JmsTemplate jmsTemplate = new JmsTemplate(connectionFactory);\n    jmsTemplate.setDefaultDestination(defaultQueue);\n    return jmsTemplate;\n}\n@Bean\npublic JmsTransactionManager jmsTxManager(CachingConnectionFactory connectionFactory) {\n    return new JmsTransactionManager(connectionFactory);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240406160834-pd4uxyd","Type":"NodeParagraph","Properties":{"id":"20240406160834-pd4uxyd","updated":"20240407003652"},"Children":[{"Type":"NodeText","Data":"Spring "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"JmsTemplate"},{"Type":"NodeText","Data":"​ 简化同步和发送 JMS 信息的方式，提供一个统一抽象层，不需要处理底层 API"}]},{"ID":"20240407003652-jxyco0o","Type":"NodeList","ListData":{},"Properties":{"id":"20240407003652-jxyco0o","updated":"20240407003813"},"Children":[{"ID":"20240407003653-pn14s2d","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240407003653-pn14s2d","updated":"20240407003653"},"Children":[{"ID":"20240407003653-oxpc80d","Type":"NodeParagraph","Properties":{"id":"20240407003653-oxpc80d","updated":"20240407003706"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"send"},{"Type":"NodeText","Data":"​ 方法手动构建 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Message"},{"Type":"NodeText","Data":"​ 对象"}]}]},{"ID":"20240407003706-q21d7so","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240407003706-q21d7so","updated":"20240407003813"},"Children":[{"ID":"20240407003706-ah0z1dp","Type":"NodeParagraph","Properties":{"id":"20240407003706-ah0z1dp","updated":"20240407003813"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"convertAndSend"},{"Type":"NodeText","Data":"​ 使用"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240407001531-efp1lhu","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"内置消息类型转换"},{"Type":"NodeText","Data":"将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"String"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"byte[]"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Map"},{"Type":"NodeText","Data":"​ 对象转换为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Message"},{"Type":"NodeText","Data":"​ 对象"}]}]}]},{"ID":"20240406164922-e9td1rw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240406164922-e9td1rw","updated":"20240406225207"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class FixedDepositServiceImpl extends ServiceTemplate implements FixedDepositService {\n\n    @Resource(name = \"fixedDepositDao\")\n    private FixedDepositDao fixedDepositDao;\n\n    @Autowired\n    private JmsTemplate jmsTemplate;\n\n    @Transactional(\"jmsTxManager\")\n    public int createFixedDeposit(FixedDepositDetails fixedDepositDetails) {\n        jmsTemplate.send(\"emailQueueDestination\", session -\u003e {\n            TextMessage message = session.createTextMessage();\n            message.setText(fixedDepositDetails.getEmail());\n            return message;\n        });\n\n        int result = fixedDepositDao.createFixedDetail(fixedDepositDetails);\n\n        jmsTemplate.send(\"aQueueDestination\", session -\u003e {\n            ObjectMessage message = session.createObjectMessage();\n            message.setObject(fixedDepositDetails);\n            return message;\n        });\n\n        return result;\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240406225029-chc5wry","Type":"NodeParagraph","Properties":{"id":"20240406225029-chc5wry","updated":"20240406231826"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"createFixedDeposit"},{"Type":"NodeText","Data":"​ 指定事务管理器为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"jmsTxManager"},{"Type":"NodeText","Data":"​。通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"JmsTemplate"},{"Type":"NodeText","Data":"​ 向 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"emailQueueDestination"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"aQueueDestination"},{"Type":"NodeText","Data":"​ 两个队列发送消息，不需要显式创建 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Connection"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Session"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20240406231943-57czakx","Type":"NodeParagraph","Properties":{"id":"20240406231943-57czakx","updated":"20240406232100"},"Children":[{"Type":"NodeText","Data":"如果需要使用编程式事务管理，可以使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"TransactionTemplate"},{"Type":"NodeText","Data":"​，并将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"transactionManager"},{"Type":"NodeText","Data":"​ 属性设置为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"jmsTxManager"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240406232105-5y5ylcn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240406232105-5y5ylcn","updated":"20240406232202"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003cbean id=\"transactionTemplate\" class=\"org.springframework.transaction.support.TransactionTemplate\"\u003e\n    \u003cproperty name=\"transactionManager\" ref=\"jmsTxManager\" /\u003e\n\u003c/bean\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240406232101-c1zizfg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240406232101-c1zizfg","updated":"20240406232726"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Autowired\nprivate TransactionTemplate transactionTemplate;\n\npublic int createFixedDeposit(FixedDepositDetails fixedDepositDetails) {\n    return transactionTemplate.execute(status -\u003e {\n        jmsTemplate.send(\"emailQueueDestination\", session -\u003e {\n            TextMessage message = session.createTextMessage();\n            message.setText(fixedDepositDetails.getEmail());\n            return message;\n        });\n        int result = fixedDepositDao.createFixedDetail(fixedDepositDetails);\n        jmsTemplate.send(\"aQueueDestination\", session -\u003e {\n            ObjectMessage message = session.createObjectMessage();\n            message.setObject(fixedDepositDetails);\n            return message;\n        });\n        return result;\n    });\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}