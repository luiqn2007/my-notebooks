{"ID":"20240407213515-iq7blb2","Spec":"1","Type":"NodeDocument","Properties":{"icon":"spring.png","id":"20240407213515-iq7blb2","title":"发送电子邮件","type":"doc","updated":"20240408032531"},"Children":[{"ID":"20240407213515-b70g8kd","Type":"NodeParagraph","Properties":{"id":"20240407213515-b70g8kd","updated":"20240407234901"},"Children":[{"Type":"NodeText","Data":"Spring 提供 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"JavaMail"},{"Type":"NodeText","Data":"​ 的包装类，简化发送电子邮件的过程。"}]},{"ID":"20240407234902-omd2ah3","Type":"NodeParagraph","Properties":{"id":"20240407234902-omd2ah3","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240408022628"},"Children":[{"Type":"NodeText","Data":"依赖："},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"org.springframework.boot:spring-boot-starter-mail"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"jakarta.mail:jakarta.mail-api"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240408022708-jr98jq8","Type":"NodeParagraph","Properties":{"id":"20240408022708-jr98jq8","updated":"20240408022741"},"Children":[{"Type":"NodeText","Data":"创建一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"JavaMailSenderImpl"},{"Type":"NodeText","Data":"​ 类型的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bean"},{"Type":"NodeText","Data":"​，之后使用该 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bean"},{"Type":"NodeText","Data":"​ 发送邮件即可。"}]},{"ID":"20240408015750-6jv1866","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240408015750-6jv1866","updated":"20240408022700"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003cbean id=\"mailSender\" class=\"org.springframework.mail.javamail.JavaMailSenderImpl\"\u003e\n    \u003cproperty name=\"host\" value=\"${host}\"/\u003e\n    \u003cproperty name=\"protocol\" value=\"${protocol}\"/\u003e\n    \u003cproperty name=\"port\" value=\"${port}\"/\u003e\n    \u003cproperty name=\"username\" value=\"${email}\"/\u003e\n    \u003cproperty name=\"password\" value=\"${password}\"/\u003e\n    \u003cproperty name=\"javaMailProperties\"\u003e\n        \u003cprops\u003e\n            \u003cprop key=\"mail.smtp.auth\"\u003etrue\u003c/prop\u003e\n            \u003cprop key=\"mail.smtp.starttls.enable\"\u003etrue\u003c/prop\u003e\n        \u003c/props\u003e\n    \u003c/property\u003e\n\u003c/bean\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240408023120-7pxuxbn","Type":"NodeBlockquote","Properties":{"id":"20240408023120-7pxuxbn","updated":"20240408024557"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240408023123-vqzrfyj","Type":"NodeParagraph","Properties":{"id":"20240408023123-vqzrfyj","updated":"20240408023127"},"Children":[{"Type":"NodeText","Data":"Java 配置："}]},{"ID":"20240408023127-xehsu4l","Type":"NodeParagraph","Properties":{"id":"20240408023127-xehsu4l","updated":"20240408024557"},"Children":[{"Type":"NodeText","Data":"```"}]}]},{"ID":"20240408022843-13nwx3n","Type":"NodeParagraph","Properties":{"id":"20240408022843-13nwx3n","updated":"20240408023045"},"Children":[{"Type":"NodeText","Data":"这里配合 JMS 发送邮件。"}]},{"ID":"20240408023045-d1l19ux","Type":"NodeParagraph","Properties":{"id":"20240408023045-d1l19ux","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240408023107"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"requestReceivedTemplate"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 为邮件模板，是一个 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"org.springframework.mail.SimpleMailMessage"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 对象。由于每次发送邮件内容相同，使用一个对象即可。"}]},{"ID":"20240408022701-gow3a8o","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240408022701-gow3a8o","updated":"20240408022832"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Autowired\nprivate transient MailSender mallSender;\n\n@Autowired\n@Qualifier(\"requestReceivedTemplate\")\nprivate transient SimpleMailMessage simpleMailMessage;\n\n@JmsListener(id = \"emailMessageListener\", destination = \"emailQueueDestination\")\npublic void onSendEmail(Message message) {\n    TextMessage textMessage = (TextMessage) message;\n    try {\n        simpleMailMessage.setTo(textMessage.getText());\n        mallSender.send(simpleMailMessage);\n        System.out.println(\"Send email \" + simpleMailMessage);\n    } catch (JMSException e) {\n        throw new RuntimeException(e);\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240408023111-omqzusn","Type":"NodeParagraph","Properties":{"id":"20240408023111-omqzusn","updated":"20240408032407"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SimpleMailMessage"},{"Type":"NodeText","Data":"​ 仅用于发送文本信息。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MIME"},{"Type":"NodeText","Data":"​ 消息可以使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MimeMessageHelper"},{"Type":"NodeText","Data":"​ 辅助创建，也可以通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MimeMessagePreparator"},{"Type":"NodeText","Data":"​ 组装。"}]},{"ID":"20240408024859-nuuqkd6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240408024859-nuuqkd6","updated":"20240408032026"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@JmsListener(id = \"emailProcessedMessageListener\", destination = \"emailQueueDestination\")\npublic void onSendProcessedEmail(Message message) {\n    TextMessage textMessage = (TextMessage) message;\n    try {\n        String sendTo = textMessage.getText();\n        MimeMessage mimeMessage = mailSender.createMimeMessage();\n        MimeMessageHelper mimeMessageHelper = new MimeMessageHelper(mimeMessage);\n        mimeMessageHelper.setTo(sendTo);\n        mimeMessageHelper.setSubject(processedMailMessage.getSubject());\n        mimeMessageHelper.setText(processedMailMessage.getText());\n        mailSender.send(mimeMessage);\n        System.out.println(\"Send email \" + mimeMessage);\n    } catch (JMSException | MessagingException e) {\n        throw new RuntimeException(e);\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240408032325-55019cu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240408032325-55019cu","updated":"20240408032530"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"// 使用 MimeMessagePreparator 组装\nmailSender.send(mimeMessage -\u003e {\n    mimeMessage.setFrom(processedMailMessage.getFrom());\n    // ...\n});\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240408032531-lou0sic","Type":"NodeParagraph","Properties":{"id":"20240408032531-lou0sic"}}]}