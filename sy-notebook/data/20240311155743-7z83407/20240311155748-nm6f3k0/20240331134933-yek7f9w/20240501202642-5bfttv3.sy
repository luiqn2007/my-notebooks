{"ID":"20240501202642-5bfttv3","Spec":"1","Type":"NodeDocument","Properties":{"icon":"spring.png","id":"20240501202642-5bfttv3","title":"Web 请求安全配置","type":"doc","updated":"20240503162133"},"Children":[{"ID":"20240501205624-zjg1des","Type":"NodeParagraph","Properties":{"id":"20240501205624-zjg1des","updated":"20240501205736"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DelegatingFilterProxy"},{"Type":"NodeText","Data":"​ 过滤器实现 Web 请求安全，可通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"security"},{"Type":"NodeText","Data":"​ 命名空间或注册 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SecurityFilterChain"},{"Type":"NodeText","Data":"​ 实现"}]},{"ID":"20240501213308-ur5o4bc","Type":"NodeParagraph","Properties":{"id":"20240501213308-ur5o4bc","style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);","updated":"20240501213450"},"Children":[{"Type":"NodeText","Data":"Spring 会自动处理和创建 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"DelegatingFilterProxy"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​ 过滤器，只需要完成安全配置即可，Spring 会自动完成对应的 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"DelegatingFilterProxy"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​ 注册"}]},{"ID":"20240501214505-bbjc47h","Type":"NodeParagraph","Properties":{"id":"20240501214505-bbjc47h","updated":"20240501214512"},"Children":[{"Type":"NodeText","Data":"使用 XML 配置："}]},{"ID":"20240501210214-25ryurw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240501210214-25ryurw","updated":"20240501212306"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003cbeans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:security=\"http://www.springframework.org/schema/security\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xsi:schemaLocation=\"...\n                           http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd\"\u003e\n\n    \u003csecurity:http\u003e\n        \u003csecurity:intercept-url pattern=\"/**\" access=\"hasAnyRole('ROLE_CUSTOMER', 'ROLE_ADMIN')\"/\u003e\n        \u003csecurity:form-login /\u003e\n        \u003csecurity:logout /\u003e\n        \u003csecurity:remember-me /\u003e\n        \u003csecurity:headers\u003e\n            \u003csecurity:cache-control /\u003e\n            \u003csecurity:xss-protection /\u003e\n        \u003c/security:headers\u003e\n    \u003c/security:http\u003e\n\u003c/beans\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240501214515-0iv08d8","Type":"NodeParagraph","Properties":{"id":"20240501214515-0iv08d8","updated":"20240501214518"},"Children":[{"Type":"NodeText","Data":"使用 Java 配置："}]},{"ID":"20240501205626-flk5pwp","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240501205626-flk5pwp","updated":"20240501214226"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {\n        httpSecurity.authorizeHttpRequests(request -\u003e request\n                        .requestMatchers(\"/**\").hasAnyRole(\"ROLE_CUSTOM\", \"ROLE_ADMIN\")\n                        .anyRequest().authenticated())\n                .formLogin(form -\u003e {})\n                .logout(logout -\u003e {})\n                .rememberMe(rememberMe -\u003e {})\n                .headers(headers -\u003e headers\n                        .cacheControl(cache -\u003e {})\n                        .xssProtection(xss -\u003e {}));\n        return httpSecurity.build();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240501204222-ycke971","Type":"NodeList","ListData":{},"Properties":{"id":"20240501204222-ycke971","updated":"20240501231029"},"Children":[{"ID":"20240501214401-soe6wjt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501214401-soe6wjt","updated":"20240501231029"},"Children":[{"ID":"20240501214401-f7mch4s","Type":"NodeParagraph","Properties":{"id":"20240501214401-f7mch4s","updated":"20240501231029"},"Children":[{"Type":"NodeText","Data":"对于匹配 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/**"},{"Type":"NodeText","Data":"​（即所有页面）的访问请求，持有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ROLE_CUSTOM"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ROLE_ADMIN"},{"Type":"NodeText","Data":"​ 身份的用户可以访问"}]}]},{"ID":"20240501214746-2h2ez31","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501214746-2h2ez31"},"Children":[{"ID":"20240501214746-ezify9f","Type":"NodeParagraph","Properties":{"id":"20240501214746-ezify9f","updated":"20240501214914"},"Children":[{"Type":"NodeText","Data":"对于登录页面（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"form login"},{"Type":"NodeText","Data":"​），任何用户都可以访问"}]},{"ID":"20240501215126-j6yz49r","Type":"NodeList","ListData":{},"Properties":{"id":"20240501215126-j6yz49r"},"Children":[{"ID":"20240501215125-c6xvuay","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501215125-c6xvuay"},"Children":[{"ID":"20240501215125-70vd4xr","Type":"NodeParagraph","Properties":{"id":"20240501215125-70vd4xr","updated":"20240501215200"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"login page"},{"Type":"NodeText","Data":"​ 指定访问地址，默认 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/login"},{"Type":"NodeText","Data":"​"}]}]}]}]},{"ID":"20240501214915-pm6cqi5","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501214915-pm6cqi5"},"Children":[{"ID":"20240501214915-pedds6u","Type":"NodeParagraph","Properties":{"id":"20240501214915-pedds6u","updated":"20240501214938"},"Children":[{"Type":"NodeText","Data":"对于登出请求（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"logout"},{"Type":"NodeText","Data":"​），任何用户可以访问"}]},{"ID":"20240501215201-5szlr8o","Type":"NodeList","ListData":{},"Properties":{"id":"20240501215201-5szlr8o"},"Children":[{"ID":"20240501215201-6w0ayv7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501215201-6w0ayv7"},"Children":[{"ID":"20240501215201-crtiwzi","Type":"NodeParagraph","Properties":{"id":"20240501215201-crtiwzi","updated":"20240501215231"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"logout url"},{"Type":"NodeText","Data":"​ 指定访问地址，默认 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/logout"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240501215232-8nnbxf7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501215232-8nnbxf7"},"Children":[{"ID":"20240501215232-cjwm0rx","Type":"NodeParagraph","Properties":{"id":"20240501215232-cjwm0rx","updated":"20240501215314"},"Children":[{"Type":"NodeText","Data":"可以配置 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"delete cookies"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"invalidate session"},{"Type":"NodeText","Data":"​ 等额外功能 "}]}]}]}]},{"ID":"20240501214940-avhip6d","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501214940-avhip6d"},"Children":[{"ID":"20240501214940-vr8xbvt","Type":"NodeParagraph","Properties":{"id":"20240501214940-vr8xbvt","updated":"20240501215338"},"Children":[{"Type":"NodeText","Data":"启用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rememberMe"},{"Type":"NodeText","Data":"​ 身份验证，Spring 为认证的用户产生唯一令牌自动认证，可存于 cookie 等"}]}]},{"ID":"20240501215053-v6ezhfy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501215053-v6ezhfy","updated":"20240501215439"},"Children":[{"ID":"20240501215053-cvqb67o","Type":"NodeParagraph","Properties":{"id":"20240501215053-cvqb67o","updated":"20240501215122"},"Children":[{"Type":"NodeText","Data":"添加 Spring Security 的安全响应头"}]},{"ID":"20240501215340-46s49ae","Type":"NodeList","ListData":{},"Properties":{"id":"20240501215340-46s49ae","updated":"20240501215439"},"Children":[{"ID":"20240501215340-udb8spo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501215340-udb8spo"},"Children":[{"ID":"20240501215340-f4u13lf","Type":"NodeParagraph","Properties":{"id":"20240501215340-f4u13lf","updated":"20240501215418"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"cache control"},{"Type":"NodeText","Data":"​ 添加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Cache-Control"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Pragma"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Expries"},{"Type":"NodeText","Data":"​ 头"}]}]},{"ID":"20240501215418-2psefwl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240501215418-2psefwl","updated":"20240501215439"},"Children":[{"ID":"20240501215418-6flftg5","Type":"NodeParagraph","Properties":{"id":"20240501215418-6flftg5","updated":"20240501215439"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"xss protection"},{"Type":"NodeText","Data":"​ 添加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"X-XSS-Protection"},{"Type":"NodeText","Data":"​ 头"}]}]}]}]}]},{"ID":"20240501215518-652obtp","Type":"NodeParagraph","Properties":{"id":"20240501215518-652obtp","updated":"20240501220016"},"Children":[{"Type":"NodeText","Data":"之后，配置 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AuthenticationManager"},{"Type":"NodeText","Data":"​ 完成用户认证和身份请求。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AuthenticationManager"},{"Type":"NodeText","Data":"​ 通过一个或多个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AuthenticationProvider"},{"Type":"NodeText","Data":"​ 进行身份验证。"}]},{"ID":"20240501220247-t1fpql6","Type":"NodeParagraph","Properties":{"id":"20240501220247-t1fpql6","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240501220311"},"Children":[{"Type":"NodeText","Data":"针对 LDAP 服务器可以使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"LdapAuthenticationProvider"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240501215723-ae8t37v","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240501215723-ae8t37v","updated":"20240501220212"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cbeans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:security=\"http://www.springframework.org/schema/security\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/security https://www.springframework.org/schema/security/spring-security.xsd\"\u003e\n\n    \u003csecurity:authentication-manager\u003e\n        \u003c!-- 这里只注册了一个使用 Bcrypt 加密保存密码的 Provider --\u003e\n        \u003csecurity:authentication-provider\u003e\n            \u003csecurity:password-encoder hash=\"bcrypt\" /\u003e\n            \u003csecurity:user-service\u003e\n                \u003csecurity:user name=\"admin\" authorities=\"ROLE_ADMIN\" password=\"{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzQvVCp5pe5WM2tDA.u\" /\u003e\n                \u003csecurity:user name=\"user1\" authorities=\"ROLE_CUSTOM\" password=\"{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzQvVCp5pe5WM2tDA.u\" /\u003e\n                \u003csecurity:user name=\"user2\" authorities=\"ROLE_CUSTOM\" password=\"{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzQvVCp5pe5WM2tDA.u\" /\u003e\n            \u003c/security:user-service\u003e\n        \u003c/security:authentication-provider\u003e\n    \u003c/security:authentication-manager\u003e\n\u003c/beans\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240501220020-1ogbzbj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240501220020-1ogbzbj","updated":"20240501224711"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Bean\npublic AuthenticationManager authenticationManager() {\n    InMemoryUserDetailsManager userDetailsManager = new InMemoryUserDetailsManager();\n    userDetailsManager.createUser(User\n            .withUsername(\"admin\")\n            .password(\"{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzQvVCp5pe5WM2tDA.u\")\n            .authorities(\"ROLE_ADMIN\")\n            .build());\n    userDetailsManager.createUser(User\n            .withUsername(\"user1\")\n            .password(\"{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzQvVCp5pe5WM2tDA.u\")\n            .authorities(\"ROLE_CUSTOM\")\n            .build());\n    userDetailsManager.createUser(User\n            .withUsername(\"user2\")\n            .password(\"{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzQvVCp5pe5WM2tDA.u\")\n            .authorities(\"ROLE_CUSTOM\")\n            .build());\n    DaoAuthenticationProvider provider = new DaoAuthenticationProvider();\n    provider.setUserDetailsService(userDetailsManager);\n    provider.setPasswordEncoder(new BCryptPasswordEncoder());\n    return new ProviderManager(provider);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240503162133-4s5tp02","Type":"NodeParagraph","Properties":{"id":"20240503162133-4s5tp02"}}]}