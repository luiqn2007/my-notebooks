{"ID":"20240508021646-s92qtqw","Spec":"1","Type":"NodeDocument","Properties":{"icon":"spring.png","id":"20240508021646-s92qtqw","title":"运行时管理 ACL","type":"doc","updated":"20240508022842"},"Children":[{"ID":"20240508021646-j412zh4","Type":"NodeParagraph","Properties":{"id":"20240508021646-j412zh4","updated":"20240508022754"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MutableAclService"},{"Type":"NodeText","Data":"​，可以在运行时修改权限。"}]},{"ID":"20240508021809-upsx2a7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240508021809-upsx2a7","updated":"20240508022419"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Autowired\nprivate MutableAclService mutableAclService;\n\n// 运行时向 admin 角色添加 read，administration，delete 权限\n@Override\npublic void provideAccessToAdmin(int fixedDepositId) {\n    addPermission(fixedDepositId, new PrincipalSid(\"admin\"), BasePermission.READ);\n    addPermission(fixedDepositId, new PrincipalSid(\"admin\"), BasePermission.ADMINISTRATION);\n    addPermission(fixedDepositId, new PrincipalSid(\"admin\"), BasePermission.DELETE);\n}\n\nprivate void addPermission(int fixedDepositId, Sid recipient, Permission permission) {\n    MutableAcl acl;\n    ObjectIdentity old = new ObjectIdentityImpl(FixedDepositDetails.class, fixedDepositId);\n  \n    try {\n        acl = (MutableAcl) mutableAclService.readAclById(old);\n    } catch (NotFoundException e) {\n        acl = mutableAclService.createAcl(old);\n    }\n  \n    acl.insertAce(acl.getEntries().size(), permission, recipient, true);\n    mutableAclService.updateAcl(acl);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240508022800-tfzjzrs","Type":"NodeParagraph","Properties":{"id":"20240508022800-tfzjzrs","updated":"20240508022842"},"Children":[{"Type":"NodeText","Data":"如果要删除某个权限条目，只需要使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MutableAclService"},{"Type":"NodeText","Data":"​ 的删除方法即可。"}]},{"ID":"20240508022454-u4my8d5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240508022454-u4my8d5","updated":"20240508022748"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Override\npublic void closeFixedDeposit(int fixedDepositId) {\n    fixedDepositRepository.closeFixedDeposit(fixedDepositId);\n    ObjectIdentity old = new ObjectIdentityImpl(FixedDepositDetails.class, fixedDepositId);\n    mutableAclService.deleteAcl(old, false);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}