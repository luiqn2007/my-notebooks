{"ID":"20240410012854-a8x4dhe","Spec":"1","Type":"NodeDocument","Properties":{"icon":"spring.png","id":"20240410012854-a8x4dhe","title":"Spring AOP","type":"doc","updated":"20240410022040"},"Children":[{"ID":"20240410012854-1fdtgxk","Type":"NodeParagraph","Properties":{"id":"20240410012854-1fdtgxk","updated":"20240410014449"},"Children":[{"Type":"NodeText","Data":"Spring AOP "},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"若目标对象没有实现任何接口时，使用 GCLIB 代理；否则，使用 JavaSE 代理","TextMarkTextContent":"基于代理"},{"Type":"NodeText","Data":"，将目标对象创建一个代理对象。运行时，对目标对象的调用被代理拦截，由代理执行适用于目标方法的通知。"}]},{"ID":"20240410013552-dknxkay","Type":"NodeWidget","Data":"\u003ciframe src=\"/widgets/widget-excalidraw/\" data-src=\"/widgets/widget-excalidraw/\" data-subtype=\"widget\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"width: 793px; height: 303px;\"\u003e\u003c/iframe\u003e","Properties":{"custom-data-assets":"assets/widget-excalidraw/0-20240410014313-560oncs","custom-options":"\u0026#123;\u0026quot;gridModeEnabled\u0026quot;:true,\u0026quot;exportBackground\u0026quot;:true,\u0026quot;theme\u0026quot;:\u0026quot;light\u0026quot;\u0026#125;","data-assets":"assets/widget-excalidraw/0-20240410014313-560oncs","id":"20240410013552-dknxkay","options":"\u0026#123;\u0026quot;gridModeEnabled\u0026quot;:true,\u0026quot;exportBackground\u0026quot;:true,\u0026quot;theme\u0026quot;:\u0026quot;light\u0026quot;\u0026#125;","updated":"20240410013552"}},{"ID":"20240410014527-i771nnn","Type":"NodeParagraph","Properties":{"id":"20240410014527-i771nnn","updated":"20240410014709"},"Children":[{"Type":"NodeText","Data":"要开启 Spring AOP，需要创建 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;aop:aspectj-autoproxy /\u0026gt;"},{"Type":"NodeText","Data":"​ 元素或存在一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@EnableAspectJAutoProxy"},{"Type":"NodeText","Data":"​ 注解"}]},{"ID":"20240410014710-61dy47a","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;|min-width: 60px;","id":"20240410014710-61dy47a","updated":"20240410015637"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"注解属性"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"XML 属性"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"proxyTargetClass"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"proxy-target-class"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"是否阻止生成目标对象的代理。若为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"true"},{"Type":"NodeText","Data":"​，则不会使用代理替代目标对象，而是通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AopContext"},{"Type":"NodeText","Data":"​ 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"currentProxy"},{"Type":"NodeText","Data":"​ 静态方法访问 AOP 代理。默认 false"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"exposeProxy"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"expose-proxy"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"是否暴露代理对象给程序，确保代理类内部调用也可以触发切片。默认 false"}]}]}]},{"ID":"20240410015649-uzl8ff7","Type":"NodeParagraph","Properties":{"id":"20240410015649-uzl8ff7","updated":"20240410015815"},"Children":[{"Type":"NodeText","Data":"这是一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@EnableAspectJAutoProxy(proxyTargetClass=true, exposeProxy=true)"},{"Type":"NodeText","Data":"​ 的实例。我们通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AopContext"},{"Type":"NodeText","Data":"​ 拿到当前对象的代理，并手动调用代理类的方法确保内部调用时切片正常触发"}]},{"ID":"20240410015638-o4h4n23","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410015638-o4h4n23","updated":"20240410021828"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class BankAccountServiceJpaDataImpl implements BankAccountService {\n\n    @Override\n    @Transactional\n    public void createAccount(BankAccountDetails bankAccountDetails) {\n        boolean isDuplicate =\n                ((BankAccountService) AopContext.currentProxy()).isDuplicateAccount(bankAccountDetails.getAccountId());\n        if (!isDuplicate) {\n            bankAccountRepository.save(bankAccountDetails);\n        }\n    }\n\n    @Override\n    public boolean isDuplicateAccount(int accountId) {\n        return bankAccountRepository.findById(accountId).isPresent();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410021829-oc0r7zu","Type":"NodeList","ListData":{},"Properties":{"id":"20240410021829-oc0r7zu","updated":"20240410022040"},"Children":[{"ID":"20240410021831-yqwk1kl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240410021831-yqwk1kl","updated":"20240410021831"},"Children":[{"ID":"20240410021831-bl4mss0","Type":"NodeParagraph","Properties":{"id":"20240410021831-bl4mss0","updated":"20240410021942"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AopContext.currentProxy()"},{"Type":"NodeText","Data":"​ 获取当前方法的切面代理。代理是线程安全的。"}]}]},{"ID":"20240410021942-5hgzoqf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240410021942-5hgzoqf","updated":"20240410022040"},"Children":[{"ID":"20240410021942-w2egepq","Type":"NodeParagraph","Properties":{"id":"20240410021942-w2egepq","updated":"20240410022040"},"Children":[{"Type":"NodeText","Data":"使用代理调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"isDuplicateAccount"},{"Type":"NodeText","Data":"​ 方法，确保切面正确调用。"}]}]}]}]}