{"ID":"20240330085205-nj25qqd","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f4e6","id":"20240330085205-nj25qqd","title":"注解的自动装配","type":"doc","updated":"20240330121955"},"Children":[{"ID":"20240330085205-8t62nlo","Type":"NodeParagraph","Properties":{"id":"20240330085205-8t62nlo","updated":"20240330111734"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Autowired"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeText","Data":"​ 注解实现的功能是通过类型"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240328022601-hydnyja","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"自动装配"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240330085408-84j2add","Type":"NodeParagraph","Properties":{"id":"20240330085408-84j2add","updated":"20240330111753"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Autowired"},{"Type":"NodeText","Data":"​ 可用于注解类、构造函数、方法和字段，单独使用时相当于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;bean\u0026gt;"},{"Type":"NodeText","Data":"​ 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"autowire=byType"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"autowire=constructor"},{"Type":"NodeText","Data":"​ 属性。"}]},{"ID":"20240330085540-1jg07ih","Type":"NodeList","ListData":{},"Properties":{"id":"20240330085540-1jg07ih","updated":"20240330111847"},"Children":[{"ID":"20240330085541-rbscdrf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240330085541-rbscdrf","updated":"20240330085541"},"Children":[{"ID":"20240330085541-ar7rawb","Type":"NodeParagraph","Properties":{"id":"20240330085541-ar7rawb","updated":"20240330090928"},"Children":[{"Type":"NodeText","Data":"构造函数：相当于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"autowire=constructor"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240330085807-904uuhr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240330085807-904uuhr","updated":"20240330111847"},"Children":[{"ID":"20240330085807-cc7hgse","Type":"NodeParagraph","Properties":{"id":"20240330085807-cc7hgse","updated":"20240330111847"},"Children":[{"Type":"NodeText","Data":"方法：注解一个方法，该方法在对象创建后自动调用，并根据参数类型查找对应的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bean"},{"Type":"NodeText","Data":"​ 传入"}]}]},{"ID":"20240330085834-7ydfe8m","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240330085834-7ydfe8m"},"Children":[{"ID":"20240330085834-s8dwkkf","Type":"NodeParagraph","Properties":{"id":"20240330085834-s8dwkkf","updated":"20240330085909"},"Children":[{"Type":"NodeText","Data":"字段：字段不需要是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"public"},{"Type":"NodeText","Data":"​ 的，也不需要一个公开的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"setter"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240330092425-3n9yh9k","Type":"NodeParagraph","Properties":{"id":"20240330092425-3n9yh9k","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240330092431"},"Children":[{"Type":"NodeText","Data":"不建议使用字段注入"}]},{"ID":"20240330092441-1tfcqck","Type":"NodeParagraph","Properties":{"id":"20240330092441-1tfcqck","updated":"20240330092609"},"Children":[{"Type":"NodeText","Data":"当找不到对应类型的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bean"},{"Type":"NodeText","Data":"​ 时，Spring 会抛出异常。如果要按类型自动装配一个可选依赖，可以将其 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"required"},{"Type":"NodeText","Data":"​ 属性设置为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240330092610-g802z0m","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330092610-g802z0m","updated":"20240330092621"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Autowired(required=false)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240330092621-4l76420","Type":"NodeParagraph","Properties":{"id":"20240330092621-4l76420","style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);","updated":"20240330092841"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"@Autowired"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​ 自动装配实际是由 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"AutowiredAnnotationBeanPostProcessor"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​ 实现的，本质是一个 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"BeanPostProcessor"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240330115303-pgt06ou","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240330115303-pgt06ou","updated":"20240330115305"},"Children":[{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240330111754-qu4jl9m","Type":"NodeParagraph","Properties":{"id":"20240330111754-qu4jl9m","updated":"20240330115305"},"Children":[{"Type":"NodeText","Data":"当 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Autowired"},{"Type":"NodeText","Data":"​ 配合 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeText","Data":"​ 共同使用时，被 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeText","Data":"​ 注解的参数相当于使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"autowire=byName"},{"Type":"NodeText","Data":"​ 进行查找。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeText","Data":"​ 除可用于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Autowired"},{"Type":"NodeText","Data":"​ 注解的元素外，还可以注解函数参数。"}]},{"ID":"20240330112055-xidoa9x","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330112055-xidoa9x","updated":"20240330115305"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Component\npublic class Sample {\n  \n    @Autowired\n    @Qualifier(\"service\")\n    private Set\u003cMyService\u003e services;\n  \n  \n    @Autowired\n    public Sample(@Qualifier(\"aBean\") Object aBean) {\n\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240330111848-27lm4rn","Type":"NodeParagraph","Properties":{"id":"20240330111848-27lm4rn","updated":"20240330115305"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeText","Data":"​ 单独使用，对类进行注解时，表示将该类对应的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bean"},{"Type":"NodeText","Data":"​ 与给定名称关联起来。"}]},{"ID":"20240330115234-v5o1dyx","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240330115234-v5o1dyx","updated":"20240330115320"},"Children":[{"Type":"NodeText","Data":"自定义限定符"}]},{"ID":"20240330115320-p2agbhv","Type":"NodeParagraph","Properties":{"id":"20240330115320-p2agbhv","updated":"20240330120153"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeText","Data":"​ 注解也是一个元注解，通过该注解可以实现自定义的限定符匹配。"}]},{"ID":"20240330121314-pip2txo","Type":"NodeParagraph","Properties":{"id":"20240330121314-pip2txo","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240330121546"},"Children":[{"Type":"NodeText","Data":"使用自定义 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 限定符需要通过 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"CustomAutowireConfigurer"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 显式注册，这是一个 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"BeanFactoryPostProcessor"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240330120157-q6sxh87","Type":"NodeParagraph","Properties":{"id":"20240330120157-q6sxh87","updated":"20240330121918"},"Children":[{"Type":"NodeText","Data":"首先，创建一个注解，该注解应被 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Qualifier"},{"Type":"NodeText","Data":"​ 修饰，并包含用于匹配的成员，并将该注解在 XML 注册"}]},{"ID":"20240330115416-0dxdhan","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330115416-0dxdhan","updated":"20240330121944"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.TYPE, ElementType.ANNOTATION_TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Qualifier\npublic @interface FundTransfer {\n    // 两个用于匹配的枚举\n    TransformMode transformSpeed();\n    BankType bankType();\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240330120520-1eexw82","Type":"NodeSuperBlock","Properties":{"id":"20240330120520-1eexw82","updated":"20240330121944"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240330120126-1q13lid","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330120126-1q13lid","updated":"20240330120521"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public enum TransformMode {\n    IMMEDIATE, NORMAL\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240330120516-dnn5p1n","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330120516-dnn5p1n","updated":"20240330120521"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public enum BankType {\n    SAME, DIFFERENT\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240330121923-jji94li","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330121923-jji94li","updated":"20240330121955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eG1s"},{"Type":"NodeCodeBlockCode","Data":"\u003cbean class=\"org.springframework.beans.factory.annotation.CustomAutowireConfigurer\"\u003e\n    \u003cproperty name=\"customQualifierTypes\"\u003e\n        \u003cset\u003e\n            \u003cvalue\u003ecom.example.mybank.annotation.FundTransfer\u003c/value\u003e\n        \u003c/set\u003e\n    \u003c/property\u003e\n\u003c/bean\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240330120521-5nisrv4","Type":"NodeParagraph","Properties":{"id":"20240330120521-5nisrv4","updated":"20240330120625"},"Children":[{"Type":"NodeText","Data":"之后，在不同的实现类中使用之前定义的注解进行关联："}]},{"ID":"20240330121842-sb6fimh","Type":"NodeSuperBlock","Properties":{"id":"20240330121842-sb6fimh","updated":"20240330121843"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240330120734-g42p0l7","Type":"NodeSuperBlock","Properties":{"id":"20240330120734-g42p0l7","updated":"20240330121843"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240330120627-l6lwlgh","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330120627-l6lwlgh","updated":"20240330120734"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Service\n@FundTransfer(\n  transformSpeed = TransformMode.IMMEDIATE, \n  bankType = BankType.SAME)\npublic class ImmediateSameBank \nimplements FundTransferService {\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240330120724-0qqottz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330120724-0qqottz","updated":"20240330121121"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Service\n@FundTransfer(\n  transformSpeed = TransformMode.IMMEDIATE,\n  bankType = BankType.DIFF)\npublic class ImmediateDiffBank\nimplements FundTransferService {\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240330120744-evnubnq","Type":"NodeSuperBlock","Properties":{"id":"20240330120744-evnubnq","updated":"20240330121843"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240330120742-554nyl7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330120742-554nyl7","updated":"20240330120830"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Service\n@FundTransfer(\n  transformSpeed = TransformMode.NORMAL, \n  bankType = BankType.SAME)\npublic class NormalSameBank \nimplements FundTransferService {\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240330120742-yqviynd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330120742-yqviynd","updated":"20240330121120"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Service\n@FundTransfer(\n  transformSpeed = TransformMode.NORMAL,\n  bankType = BankType.DIFF)\npublic class NormalDiffBank\nimplements FundTransferService {\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240330120834-ehfpq0q","Type":"NodeParagraph","Properties":{"id":"20240330120834-ehfpq0q","updated":"20240330120855"},"Children":[{"Type":"NodeText","Data":"最后，自动注入即可。"}]},{"ID":"20240330120855-1ouyglq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240330120855-1ouyglq","updated":"20240330121150"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@Getter\n@Component\npublic class FundTransferProcessor {\n\n    @Autowired\n    @FundTransfer(transformSpeed = TransformMode.IMMEDIATE, bankType = BankType.SAME)\n    private FundTransferService sameBankImmediateFundTransferService;\n\n    @Autowired\n    @FundTransfer(transformSpeed = TransformMode.IMMEDIATE, bankType = BankType.DIFF)\n    private FundTransferService diffBankImmediateFundTransferService;\n\n    @Autowired\n    @FundTransfer(transformSpeed = TransformMode.NORMAL, bankType = BankType.SAME)\n    private FundTransferService sameBankNormalFundTransferService;\n\n    @Autowired\n    @FundTransfer(transformSpeed = TransformMode.NORMAL, bankType = BankType.DIFF)\n    private FundTransferService diffBankNormalFundTransferService;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240330121823-iubramv","Type":"NodeParagraph","Properties":{"id":"20240330121823-iubramv"}}]}