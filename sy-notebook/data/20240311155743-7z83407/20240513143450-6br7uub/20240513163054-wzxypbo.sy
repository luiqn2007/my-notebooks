{"ID":"20240513163054-wzxypbo","Spec":"1","Type":"NodeDocument","Properties":{"icon":"opengl.png","id":"20240513163054-wzxypbo","title":"深度测试","type":"doc","updated":"20240513163925"},"Children":[{"ID":"20240513163054-kordwam","Type":"NodeParagraph","Properties":{"id":"20240513163054-kordwam","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240513163140"},"Children":[{"Type":"NodeText","Data":"深度测试：OpenGL 将一个片段的深度值与深度缓冲的内容进行对比。测试通过，深度缓冲将会更新为新的深度值。测试失败，片段将会被丢弃。"}]},{"ID":"20240513163147-z8tnfj2","Type":"NodeParagraph","Properties":{"id":"20240513163147-z8tnfj2","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240513163157"},"Children":[{"Type":"NodeText","Data":"深度缓冲：Z-缓冲，由窗口系统自动创建。大部分的系统中，深度缓冲使用24位float储存深度值。（可能是16，24或32位）"}]},{"ID":"20240513163157-cjwzndw","Type":"NodeParagraph","Properties":{"id":"20240513163157-cjwzndw","updated":"20240513163204"},"Children":[{"Type":"NodeText","Data":"深度测试在模板测试之后，视口剪裁之前执行（片元着色器之后）"}]},{"ID":"20240513163206-yxkmzxj","Type":"NodeParagraph","Properties":{"id":"20240513163206-yxkmzxj","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240513163218"},"Children":[{"Type":"NodeText","Data":"提前深度测试：允许深度测试在片元着色器之前执行，提前丢弃无法显示的片段。此时片元着色器无法重新写入深度值"}]},{"ID":"20240513163239-qdclupo","Type":"NodeList","ListData":{},"Properties":{"id":"20240513163239-qdclupo","updated":"20240513163239"},"Children":[{"ID":"20240513163239-ybsfesk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163239-ybsfesk","updated":"20240513163239"},"Children":[{"ID":"20240513163239-6ndgeaz","Type":"NodeParagraph","Properties":{"id":"20240513163239-6ndgeaz","updated":"20240513163239"},"Children":[{"Type":"NodeText","Data":"启用或关闭测试，默认关闭"}]},{"ID":"20240513163239-4fe8t27","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513163239-4fe8t27","updated":"20240513163239"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"// 启用深度测试\nglEnable(GL_DEPTH_TEST);\n// 关闭深度测试\nglDisable(GL_DEPTH_TEST);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240513163242-aqoli93","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163242-aqoli93"},"Children":[{"ID":"20240513163242-b5m1n9b","Type":"NodeParagraph","Properties":{"id":"20240513163242-b5m1n9b","updated":"20240513163246"},"Children":[{"Type":"NodeText","Data":"清空深度缓冲区，每次绘制前调用，否则绘制结果会受上一次渲染影响"}]},{"ID":"20240513163239-mouevln","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513163239-mouevln","updated":"20240513163239"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"glClear(GL_DEPTH_BUFFER_BIT);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240513163251-jif2yc5","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163251-jif2yc5"},"Children":[{"ID":"20240513163251-a5u2opt","Type":"NodeParagraph","Properties":{"id":"20240513163251-a5u2opt","updated":"20240513163254"},"Children":[{"Type":"NodeText","Data":"设置只读深度缓冲区，开启后深度缓冲区的值将无法改变"}]},{"ID":"20240513163239-0exv46m","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513163239-0exv46m","updated":"20240513163239"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"// false 标记为只读, true 标记可写\nglDepthMask(false);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240513163239-35j7lw4","Type":"NodeList","ListData":{},"Properties":{"id":"20240513163239-35j7lw4","updated":"20240513163239"},"Children":[{"ID":"20240513163239-x6idk9h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163239-x6idk9h","updated":"20240513163239"},"Children":[{"ID":"20240513163343-ydfwhzt","Type":"NodeSuperBlock","Properties":{"id":"20240513163343-ydfwhzt"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240513163339-4twdq39","Type":"NodeSuperBlock","Properties":{"id":"20240513163339-4twdq39"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240513163239-cdjs21a","Type":"NodeParagraph","Properties":{"id":"20240513163239-cdjs21a","updated":"20240513163307"},"Children":[{"Type":"NodeText","Data":"深度测试函数，控制 OpenGL 如何比较和丢弃片段，默认即 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"GL_LESS"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240513163239-izivtlg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513163239-izivtlg","updated":"20240513163239"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"glDepthFunc(GL_LESS);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240513163239-fbdej0e","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20240513163239-fbdej0e","updated":"20240513163239"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"深度测试函数"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_ALWAYS, GL_NEVER"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"测试总通过或不通过"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_LESS, GL_GREATER"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"片段深度小于或大于深度值时通过"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_LEQUAL, GL_GEQUAL"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"片段深度小于等于或大于等于深度值时通过"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_EQUAL, GL_NOTEQUAL"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"片段深度与缓冲区值相等或不等时通过"}]}]}]},{"Type":"NodeSuperBlockCloseMarker"}]}]}]},{"ID":"20240513163446-fod5uu0","Type":"NodeBlockquote","Properties":{"id":"20240513163446-fod5uu0","updated":"20240513163919"},"Children":[{"ID":"20240513163918-8uc8ipp","Type":"NodeSuperBlock","Properties":{"id":"20240513163918-8uc8ipp","updated":"20240513163919"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240513163911-mrsc235","Type":"NodeSuperBlock","Properties":{"id":"20240513163911-mrsc235","updated":"20240513163919"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240513163402-00pze5q","Type":"NodeParagraph","Properties":{"id":"20240513163402-00pze5q","updated":"20240513163912"},"Children":[{"Type":"NodeText","Data":"OpenGL 深度值 "},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"F_{depth}"},{"Type":"NodeText","Data":" 计算方法为："}]},{"ID":"20240513163402-8sgbbp2","Type":"NodeMathBlock","Properties":{"id":"20240513163402-8sgbbp2","updated":"20240513163912"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"\\begin{equation} F_{depth} = \\frac{1/z - 1/near}{1/far - 1/near} \\end{equation}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240513163402-n18ibhi","Type":"NodeList","ListData":{},"Properties":{"id":"20240513163402-n18ibhi","updated":"20240513163912"},"Children":[{"ID":"20240513163828-443k92m","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163828-443k92m","updated":"20240513163828"},"Children":[{"ID":"20240513163828-3ggf5ct","Type":"NodeParagraph","Properties":{"id":"20240513163828-3ggf5ct","updated":"20240513163828"},"Children":[{"Type":"NodeText","Data":"near：近平面 z 值"}]}]},{"ID":"20240513163832-a9zhin0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163832-a9zhin0"},"Children":[{"ID":"20240513163832-zf9cims","Type":"NodeParagraph","Properties":{"id":"20240513163832-zf9cims","updated":"20240513163832"},"Children":[{"Type":"NodeText","Data":"far：远平面 z 值"}]}]},{"ID":"20240513163833-humkwkt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163833-humkwkt","updated":"20240513163837"},"Children":[{"ID":"20240513163833-88tsod2","Type":"NodeParagraph","Properties":{"id":"20240513163833-88tsod2","updated":"20240513163837"},"Children":[{"Type":"NodeText","Data":"z：片元 z 坐标"}]}]}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240513163410-px45ucq","Type":"NodeParagraph","Properties":{"id":"20240513163410-px45ucq","updated":"20240513163919"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"width: 565px;","style":"width: 555px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230912173034"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230912173034-20240513163410-ax0onoo.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 555px;\" parent-style=\"width: 565px;\"}"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeBlockquoteMarker","Data":"\u003e"}]},{"ID":"20240513163412-hyd2ez0","Type":"NodeParagraph","Properties":{"id":"20240513163412-hyd2ez0","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240513163712"},"Children":[{"Type":"NodeText","Data":"深度值可以在片元着色器中通过 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"gl_FragCoord.z"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 访问到，因此可以通过此完成深度值的可视化。"}]},{"ID":"20240513163722-rro2aam","Type":"NodeParagraph","Properties":{"id":"20240513163722-rro2aam","style":"color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);","updated":"20240513163739"},"Children":[{"Type":"NodeText","Data":"深度冲突：当两个片段的深度缓冲值相同或没有足够的精度进行区分，会使两个片段的图形不断地切换前后顺序，导致奇怪的闪烁花纹现象出现。"}]},{"ID":"20240513163722-vomum7v","Type":"NodeList","ListData":{},"Properties":{"id":"20240513163722-vomum7v","updated":"20240513163722"},"Children":[{"ID":"20240513163722-onrgvzm","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163722-onrgvzm","updated":"20240513163722"},"Children":[{"ID":"20240513163722-gvvawov","Type":"NodeParagraph","Properties":{"id":"20240513163722-gvvawov","updated":"20240513163722"},"Children":[{"Type":"NodeText","Data":"不要把两个物品靠得太近，尤其是 z 轴太近"}]}]},{"ID":"20240513163722-m2dz7lo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163722-m2dz7lo","updated":"20240513163722"},"Children":[{"ID":"20240513163722-3zzg3uo","Type":"NodeParagraph","Properties":{"id":"20240513163722-3zzg3uo","updated":"20240513163722"},"Children":[{"Type":"NodeText","Data":"根据深度值的计算方法，近平面尽可能远一些"}]}]},{"ID":"20240513163722-r1fu0qc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163722-r1fu0qc","updated":"20240513163722"},"Children":[{"ID":"20240513163722-jwts87g","Type":"NodeParagraph","Properties":{"id":"20240513163722-jwts87g","updated":"20240513163722"},"Children":[{"Type":"NodeText","Data":"使用更高精度的深度缓冲，但会牺牲一些性能"}]}]},{"ID":"20240513163722-1nkhpfb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513163722-1nkhpfb","updated":"20240513163722"},"Children":[{"ID":"20240513163722-cabyy99","Type":"NodeParagraph","Properties":{"id":"20240513163722-cabyy99","updated":"20240513163722"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"glPolygonOffset"},{"Type":"NodeText","Data":"​ 为物品设置额外的 z 轴偏移量"}]}]}]},{"ID":"20240513163925-p671krp","Type":"NodeParagraph","Properties":{"id":"20240513163925-p671krp"}}]}