{"ID":"20240513170429-9kqebfi","Spec":"1","Type":"NodeDocument","Properties":{"icon":"opengl.png","id":"20240513170429-9kqebfi","title":"几何着色器","type":"doc","updated":"20240513170705"},"Children":[{"ID":"20240513170435-zh2458v","Type":"NodeParagraph","Properties":{"id":"20240513170435-zh2458v","updated":"20240513170519"},"Children":[{"Type":"NodeText","Data":"几何着色器作用于顶点着色器和片元着色器之间，可在片元着色器之前对一个图元进行变换，在编译时对应着色器为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"GL_GEOMETRY_SHADER"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240513170435-d2t1d8k","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513170435-d2t1d8k","updated":"20240513170621"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"layout(points) in;\nlayout(points, max_vertices=2) out;\n\nEmitVertex();\nEndPrimitive();\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513170625-w19rd0z","Type":"NodeSuperBlock","Properties":{"id":"20240513170625-w19rd0z","updated":"20240513170626"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240513170513-3va24sc","Type":"NodeSuperBlock","Properties":{"id":"20240513170513-3va24sc","updated":"20240513170626"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240513170435-oq0h62b","Type":"NodeParagraph","Properties":{"id":"20240513170435-oq0h62b","updated":"20240513170513"},"Children":[{"Type":"NodeText","Data":"除版本外，前两行 layout 包括了几何着色器的一些配置"}]},{"ID":"20240513170435-zrvf2an","Type":"NodeList","ListData":{},"Properties":{"id":"20240513170435-zrvf2an","updated":"20240513170538"},"Children":[{"ID":"20240513170435-1jc3amr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-1jc3amr","updated":"20240513170435"},"Children":[{"ID":"20240513170435-r0v1ngs","Type":"NodeParagraph","Properties":{"id":"20240513170435-r0v1ngs","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"in"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"out"},{"Type":"NodeText","Data":"​ 分别表示输入和输出图元类型"}]}]},{"ID":"20240513170435-ghzt3it","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-ghzt3it","updated":"20240513170535"},"Children":[{"ID":"20240513170435-uhkgkj7","Type":"NodeParagraph","Properties":{"id":"20240513170435-uhkgkj7","updated":"20240513170535"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"points"},{"Type":"NodeText","Data":"​ 位置表示修改的图元，与 draw 方法时传入的 mode 参数一一对应"}]}]},{"ID":"20240513170435-fwo4j10","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-fwo4j10","updated":"20240513170538"},"Children":[{"ID":"20240513170435-z7nv0ds","Type":"NodeParagraph","Properties":{"id":"20240513170435-z7nv0ds","updated":"20240513170538"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"max_vertices"},{"Type":"NodeText","Data":"​ 参数表示产生图元的顶点数"}]}]}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240513170435-84xve4g","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20240513170435-84xve4g","updated":"20240513170626"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"图元类型"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"绘制模式"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"包含最小顶点数"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"points"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_POINTS"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"1"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"lines"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_LINES, GL_LINE_STRIP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"2"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"lines_adjacency"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_LINES_ADJACENCY, GL_LINE_STRIP_ADJACENCY"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"4"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"triangles"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_TRIANGLES, GL_TRIANGLE_FAN, GL_TRIANGLE_STRIP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"3"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"triangles_adjacency"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GL_TRIANGLES_ADJACENCY, GL_TRIANGLE_STRIP_ADJACENCY"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"6"}]}]}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240513170435-ptavsf3","Type":"NodeList","ListData":{},"Properties":{"id":"20240513170435-ptavsf3","updated":"20240513170645"},"Children":[{"ID":"20240513170435-fbikp87","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-fbikp87","updated":"20240513170435"},"Children":[{"ID":"20240513170435-mzn5bxy","Type":"NodeParagraph","Properties":{"id":"20240513170435-mzn5bxy","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"EmitVertex() 表示提交顶点"}]}]},{"ID":"20240513170435-puv9o4f","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-puv9o4f","updated":"20240513170435"},"Children":[{"ID":"20240513170435-7kyi0h5","Type":"NodeParagraph","Properties":{"id":"20240513170435-7kyi0h5","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"EndPrimitive() 表示提交图元"}]}]},{"ID":"20240513170435-jsvs24h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-jsvs24h","updated":"20240513170435"},"Children":[{"ID":"20240513170435-eze1bhw","Type":"NodeParagraph","Properties":{"id":"20240513170435-eze1bhw","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"传参规则：允许从顶点着色器传入参数"}]},{"ID":"20240513170435-a5zxpn5","Type":"NodeList","ListData":{},"Properties":{"id":"20240513170435-a5zxpn5","updated":"20240513170435"},"Children":[{"ID":"20240513170435-y3x9szn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-y3x9szn","updated":"20240513170435"},"Children":[{"ID":"20240513170435-imt8xi3","Type":"NodeParagraph","Properties":{"id":"20240513170435-imt8xi3","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"可通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"in"},{"Type":"NodeText","Data":"​ 接受所有从顶点着色器输出的属性，但类型为对应类型的数组，表示一组顶点的所有点属性"}]}]},{"ID":"20240513170435-pcfgndu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-pcfgndu","updated":"20240513170435"},"Children":[{"ID":"20240513170435-gp0srvs","Type":"NodeParagraph","Properties":{"id":"20240513170435-gp0srvs","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"可将属性通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"out"},{"Type":"NodeText","Data":"​ 输出到片元着色器中，但不需要以数组形式表示 - 在每一次 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EmitVertex"},{"Type":"NodeText","Data":"​  传递一次属性值"}]}]}]}]},{"ID":"20240513170435-ozzh8ib","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-ozzh8ib","updated":"20240513170645"},"Children":[{"ID":"20240513170435-39rbizl","Type":"NodeParagraph","Properties":{"id":"20240513170435-39rbizl","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"内建变量 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"gl_in"},{"Type":"NodeText","Data":"​ 是一个数组，只读，包含顶点着色器的属性"}]},{"ID":"20240513170435-kpzmyrh","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513170435-kpzmyrh","updated":"20240513170645"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"in gl_Vertex {\n    vec4 gl_Position;\n    float gl_PointSize;\n    float gl_ClipDistance;\n} gl_in[];\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240513170704-hy5tm8s","Type":"NodeBlockquote","Properties":{"id":"20240513170704-hy5tm8s","updated":"20240513170705"},"Children":[{"ID":"20240513170435-o9bl8u6","Type":"NodeParagraph","Properties":{"id":"20240513170435-o9bl8u6","updated":"20240513170705"},"Children":[{"Type":"NodeText","Data":"几何着色器通常用于"}]},{"ID":"20240513170435-ic2zxri","Type":"NodeList","ListData":{},"Properties":{"id":"20240513170435-ic2zxri","updated":"20240513170705"},"Children":[{"ID":"20240513170435-3qqlwah","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-3qqlwah","updated":"20240513170435"},"Children":[{"ID":"20240513170435-lrfyyf0","Type":"NodeParagraph","Properties":{"id":"20240513170435-lrfyyf0","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"炸裂效果：片元沿法线向前移动一段距离"}]}]},{"ID":"20240513170435-xptxq36","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513170435-xptxq36","updated":"20240513170435"},"Children":[{"ID":"20240513170435-zxml0o5","Type":"NodeParagraph","Properties":{"id":"20240513170435-zxml0o5","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"法线可视化，用于调试或毛发效果"}]}]}]},{"Type":"NodeBlockquoteMarker","Data":"\u003e"}]},{"ID":"20240513170435-0chy7me","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513170435-0chy7me","updated":"20240513170435"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"// 获取一个三角形的法向量\nvec3 a = gl_in[0].gl_Position.xyz - gl_in[1].gl_Position.xyz;\nvec3 b = gl_in[2].gl_Position.xyz - gl_in[1].gl_Position.xyz;\nvec norm = normalize(cross(a, b));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513170435-lr8icg2","Type":"NodeParagraph","Properties":{"id":"20240513170435-lr8icg2","updated":"20240513170435"},"Children":[{"Type":"NodeText","Data":"一个几何着色器的代码示例："}]},{"ID":"20240513170435-trdrjp1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513170435-trdrjp1","updated":"20240513170435"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yysr"},{"Type":"NodeCodeBlockCode","Data":"#include 460 core\n\nlayout(points) in;\nlayout(triangle_strip, max_vertices=5) out;\n\n// 顶点着色器: out vec4 vColor;\nin vec4 vColor[];\nout vec4 gColor;\n\nvoid main() {\n    // 因为是点，gl_in，vColor 只有一个变量\n    vec4 position = gl_in[0].gl_Position;\n    gColor = vColor[0];\n\n    // 左下\n    gl_Position = position + vec4(-0.2, -0.2, 0, 0); EndVertex();\n    // 右下\n    gl_Position = position + vec4( 0.2, -0.2, 0, 0); EndVertex();\n    // 左上\n    gl_Position = position + vec4(-0.2,  0.2, 0, 0); EndVertex();\n    // 右上\n    gl_Position = position + vec4( 0.2,  0.2, 0, 0);\n    // 顶部\n    gl_Position = position + vec4( 0.0,  0.4, 0, 0);\n    gColor = vec4(1, 1, 1, 1);\n    EmitVertex();\n\n    EndPrimitive();\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}