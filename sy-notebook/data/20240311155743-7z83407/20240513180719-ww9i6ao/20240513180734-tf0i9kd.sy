{"ID":"20240513180734-tf0i9kd","Spec":"1","Type":"NodeDocument","Properties":{"icon":"minecraft.ico","id":"20240513180734-tf0i9kd","title":"双端通信","type":"doc","updated":"20240513180741"},"Children":[{"ID":"20240513180741-e4ug0aq","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513180741-e4ug0aq","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"自定义网络通信"}]},{"ID":"20240513180741-hmjg0mx","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240513180741-hmjg0mx","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"Forge"}]},{"ID":"20240513180741-m0dv25z","Type":"NodeParagraph","Properties":{"id":"20240513180741-m0dv25z","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"LexForge 与 NeoForge 都采用相似的方法注册和使用网络通信，提供 Channel 与 Event 两种处理方式。"}]},{"ID":"20240513180741-i1wywac","Type":"NodeParagraph","Properties":{"id":"20240513180741-i1wywac","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"网络通信可以直接在 Mod 主类构造函数中创建。"}]},{"ID":"20240513180741-ysss0vm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513180741-ysss0vm","updated":"20240513180742"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"SimpleChannel channel = ChannelBuilder.named(id)\n        .networkProtocolVersion(1)\n        .simpleChannel();\n\nEventNetworkChannel channel = ChannelBuilder.named(id)\n        .networkProtocolVersion(1)\n        .eventNetworkChannel();\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513180741-tkvvdot","Type":"NodeParagraph","Properties":{"id":"20240513180741-tkvvdot","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"SimpleChannel 通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel.messageBuilder().add()"},{"Type":"NodeText","Data":"​ 注册数据包，EventNetworkChannel 通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel.registryObject"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel.addListener"},{"Type":"NodeText","Data":"​ 注册数据包。"}]},{"ID":"20240513180741-vqxw3sl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513180741-vqxw3sl","updated":"20240513180742"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"channel.messageBuilder(type, direction)\n        .encoder(Packet::write) // 这里使用 MC 原版的 Packet 作为数据包类型\n        .decoder(decoder)       // decoder 为 Function\u003cFriendlyByteBuf, Packet\u003e\n        .consumerMainThread((p, ctx) -\u003e {\n            ctx.enqueueWork(() -\u003e /* do something */); // 在主线程运行\n            ctx.setPacketHandled(true);                // 标记包已处理\n        })\n        .add();\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513180741-08eloti","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240513180741-08eloti","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"Fabric"}]},{"ID":"20240513180741-zcut2ma","Type":"NodeParagraph","Properties":{"id":"20240513180741-zcut2ma","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"Fabric 的网络通信在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ClientPlayConnectionEvents.INIT"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ServerPlayConnectionEvents.INIT"},{"Type":"NodeText","Data":"​ 事件中注册"}]},{"ID":"20240513180741-c5n5gfb","Type":"NodeParagraph","Properties":{"id":"20240513180741-c5n5gfb","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"Fabric 数据包格式为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FabricPacket"},{"Type":"NodeText","Data":"​："}]},{"ID":"20240513180741-mjjebux","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513180741-mjjebux","updated":"20240513180742"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public interface FabricPacket {\n    // 将数据包写入 Buffer\n\tvoid write(FriendlyByteBuf buf);\n\t// 获取数据包类型，其中包括如何将 Buffer 转换为数据包的方法\n\tPacketType\u003c?\u003e getType();\n}\n\npublic static \u003cP extends FabricPacket\u003e PacketType\u003cP\u003e create(\n  ResourceLocation id, \n  Function\u003cFriendlyByteBuf, P\u003e constructor);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513180741-aob7opr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513180741-aob7opr","updated":"20240513180742"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"// 注册从服务端向客户端发送的数据包\nClientPlayConnectionEvents.INIT.register((h, c) -\u003e\n        ClientPlayNetworking.registerGlobalReceiver(id, (client, handler, buf, responseSender) -\u003e {\n            // client: Minecraft 对象\n            // handle: 接收该包的 Network Handler\n            // buf: 数据包\n            // responseSender: 数据包发送者，用于向发送者发送信息\n            // do something\n            // 在客户端主线程中运行\n            client.execute(() -\u003e { /* do something */ });\n        }));\n\n// 注册从客户端向服务端发送的数据包\n ServerPlayConnectionEvents.INIT.register((h, s) -\u003e \n        ServerPlayNetworking.registerGlobalReceiver(id, (server, player, handler, buf, responseSender) -\u003e {\n            // server: MinecraftServer 对象\n            // player: 接收者 ServerPlayer\n            // handle: 接收该包的 Network Handler\n            // buf: 数据包\n            // responseSender: 数据包发送者，用于向发送者发送信息\n            // do something\n            // 在服务器主线程中运行\n            server.execute(() -\u003e { /* do something */ });  \n        }));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513180741-sne3701","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513180741-sne3701","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"双端判定"}]},{"ID":"20240513180741-t0brmyl","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240513180741-t0brmyl","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"确认当前端"}]},{"ID":"20240513180741-osuht4m","Type":"NodeParagraph","Properties":{"id":"20240513180741-osuht4m","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"主要区分逻辑客户端和逻辑服务端"}]},{"ID":"20240513180741-46xfbb1","Type":"NodeList","ListData":{},"Properties":{"id":"20240513180741-46xfbb1","updated":"20240513180742"},"Children":[{"ID":"20240513180741-sh5nnoz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-sh5nnoz","updated":"20240513180741"},"Children":[{"ID":"20240513180741-ajxe1in","Type":"NodeParagraph","Properties":{"id":"20240513180741-ajxe1in","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"Vanilla"}]},{"ID":"20240513180741-k6nr295","Type":"NodeList","ListData":{},"Properties":{"id":"20240513180741-k6nr295","updated":"20240513180741"},"Children":[{"ID":"20240513180741-frwb8xs","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-frwb8xs","updated":"20240513180741"},"Children":[{"ID":"20240513180741-ijuzyii","Type":"NodeParagraph","Properties":{"id":"20240513180741-ijuzyii","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Level#isClientSide()"},{"Type":"NodeText","Data":"​"}]}]}]}]},{"ID":"20240513180741-fj3ia04","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-fj3ia04","updated":"20240513180741"},"Children":[{"ID":"20240513180741-msapdxm","Type":"NodeParagraph","Properties":{"id":"20240513180741-msapdxm","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"Forge"}]},{"ID":"20240513180741-eke46s3","Type":"NodeList","ListData":{},"Properties":{"id":"20240513180741-eke46s3","updated":"20240513180741"},"Children":[{"ID":"20240513180741-m707saf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-m707saf","updated":"20240513180741"},"Children":[{"ID":"20240513180741-ts76ezq","Type":"NodeParagraph","Properties":{"id":"20240513180741-ts76ezq","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@OnlyIn"},{"Type":"NodeText","Data":"​：注解成员仅在对应端存在"}]}]},{"ID":"20240513180741-suced1a","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-suced1a","updated":"20240513180741"},"Children":[{"ID":"20240513180741-aff19ln","Type":"NodeParagraph","Properties":{"id":"20240513180741-aff19ln","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"net.minecraftforge.forgespi.Environment.get().getDist()"},{"Type":"NodeText","Data":"​"}]}]}]}]},{"ID":"20240513180741-4o870co","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-4o870co","updated":"20240513180741"},"Children":[{"ID":"20240513180741-qx3uxys","Type":"NodeParagraph","Properties":{"id":"20240513180741-qx3uxys","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"Fabric"}]},{"ID":"20240513180741-xe1chji","Type":"NodeList","ListData":{},"Properties":{"id":"20240513180741-xe1chji","updated":"20240513180741"},"Children":[{"ID":"20240513180741-kza5gqp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-kza5gqp","updated":"20240513180741"},"Children":[{"ID":"20240513180741-vfikr28","Type":"NodeParagraph","Properties":{"id":"20240513180741-vfikr28","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@Environment"},{"Type":"NodeText","Data":"​：注解成员仅在对应端存在"}]}]},{"ID":"20240513180741-ix9g3pe","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-ix9g3pe","updated":"20240513180741"},"Children":[{"ID":"20240513180741-bg5nnko","Type":"NodeParagraph","Properties":{"id":"20240513180741-bg5nnko","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"net.fabricmc.loader.api.FabricLoader.getInstance().getEnvironmentType()"},{"Type":"NodeText","Data":"​"}]}]}]}]}]},{"ID":"20240513180741-5pczb3k","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240513180741-5pczb3k","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"主线程运行"}]},{"ID":"20240513180741-yr3gi2u","Type":"NodeParagraph","Properties":{"id":"20240513180741-yr3gi2u","updated":"20240513180742"},"Children":[{"Type":"NodeText","Data":"主要区分主线程和 IO 线程（网络通信）"}]},{"ID":"20240513180741-lx9mc3j","Type":"NodeList","ListData":{},"Properties":{"id":"20240513180741-lx9mc3j","updated":"20240513180742"},"Children":[{"ID":"20240513180741-kznqtt4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-kznqtt4","updated":"20240513180741"},"Children":[{"ID":"20240513180741-orqpo5i","Type":"NodeParagraph","Properties":{"id":"20240513180741-orqpo5i","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"Forge"}]},{"ID":"20240513180741-tn044i3","Type":"NodeList","ListData":{},"Properties":{"id":"20240513180741-tn044i3","updated":"20240513180741"},"Children":[{"ID":"20240513180741-gskzmwb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-gskzmwb","updated":"20240513180741"},"Children":[{"ID":"20240513180741-0zuv3yk","Type":"NodeParagraph","Properties":{"id":"20240513180741-0zuv3yk","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DistExecutor.unsafeCallWhenOn"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240513180741-e1uz5ug","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-e1uz5ug","updated":"20240513180741"},"Children":[{"ID":"20240513180741-yp2qbp2","Type":"NodeParagraph","Properties":{"id":"20240513180741-yp2qbp2","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DistExecutor.unsafeRunWhenOn"},{"Type":"NodeText","Data":"​"}]}]}]}]},{"ID":"20240513180741-ytwnh4y","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-ytwnh4y","updated":"20240513180741"},"Children":[{"ID":"20240513180741-ajmx9wp","Type":"NodeParagraph","Properties":{"id":"20240513180741-ajmx9wp","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"Fabric"}]},{"ID":"20240513180741-cokptxt","Type":"NodeList","ListData":{},"Properties":{"id":"20240513180741-cokptxt","updated":"20240513180741"},"Children":[{"ID":"20240513180741-n4gxzrg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-n4gxzrg","updated":"20240513180741"},"Children":[{"ID":"20240513180741-1xud07u","Type":"NodeParagraph","Properties":{"id":"20240513180741-1xud07u","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Minecraft#execute()"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240513180741-9j31qdq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513180741-9j31qdq","updated":"20240513180741"},"Children":[{"ID":"20240513180741-icx5x8u","Type":"NodeParagraph","Properties":{"id":"20240513180741-icx5x8u","updated":"20240513180741"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MinecraftServer#execute()"},{"Type":"NodeText","Data":"​"}]}]}]}]}]}]}