{"ID":"20240513184852-hr8vnsv","Spec":"1","Type":"NodeDocument","Properties":{"icon":"flask.webp","id":"20240513184852-hr8vnsv","title":"Flask-WTF","type":"doc","updated":"20240513184900"},"Children":[{"ID":"20240513184900-blgkv57","Type":"NodeParagraph","Properties":{"id":"20240513184900-blgkv57","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"该插件主要用于 Flask 服务器的表单数据校验插件，基于 wtForms"}]},{"ID":"20240513184900-6ossdcb","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513184900-6ossdcb","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"创建模型"}]},{"ID":"20240513184900-qhkmf5s","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513184900-qhkmf5s","updated":"20240513184900"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"class RegisterForm(wtforms.Form):\n    email = wtforms.StringField(validators=[Email(message='邮箱格式错误')])\n    captcha = wtforms.StringField(validators=[Length(6, 6, '验证码错误')])\n    username = wtforms.StringField(validators=[Length(3, 20, '用户名格式错误')])\n    password = wtforms.StringField(validators=[Length(6, 100, '密码格式错误')])\n    password_confirm = wtforms.StringField(validators=[EqualTo('password', \"密码不一致\")])\n\n    def validate_email(self, field):\n        \"\"\"\n        额外验证邮箱是否存在\n        \"\"\"\n        email = field.data\n        if UserModel.query.filter_by(email=email).first() is not None:\n            raise wtforms.ValidationError('邮箱已存在')\n\n    def validate_captcha(self, field):\n        \"\"\"\n        额外验证验证码是否正确\n        \"\"\"\n        captcha = field.data\n        email = self.email.data\n        required_captcha = EmailCaptchaModel.query.filter_by(email=email).first()\n        print(required_captcha)\n        if required_captcha is None or required_captcha.captcha != captcha:\n            raise wtforms.ValidationError('验证码错误')\n        else:\n            db.session.delete(required_captcha)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513184900-yvyicbf","Type":"NodeList","ListData":{},"Properties":{"id":"20240513184900-yvyicbf","updated":"20240513184900"},"Children":[{"ID":"20240513184900-sr02tnh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-sr02tnh","updated":"20240513184900"},"Children":[{"ID":"20240513184900-iuma4tj","Type":"NodeParagraph","Properties":{"id":"20240513184900-iuma4tj","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"表单字段对应网页端输入元素的 name 属性，即表单 form 的键"}]}]},{"ID":"20240513184900-q7b2eob","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-q7b2eob","updated":"20240513184900"},"Children":[{"ID":"20240513184900-nb5ff83","Type":"NodeParagraph","Properties":{"id":"20240513184900-nb5ff83","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"根据输入的数据类型不同，WTF 支持 StringField, TextAreaField, BooleanField 等多种不同类型的 Field 类"}]}]},{"ID":"20240513184900-goehyco","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-goehyco","updated":"20240513184900"},"Children":[{"ID":"20240513184900-w27c4o4","Type":"NodeParagraph","Properties":{"id":"20240513184900-w27c4o4","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"validators 表示使用的内置校验器，是一个列表，可用校验器位于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"wtforms.validators"},{"Type":"NodeText","Data":"​ 包中"}]},{"ID":"20240513184900-d1w4l4t","Type":"NodeList","ListData":{},"Properties":{"id":"20240513184900-d1w4l4t","updated":"20240513184900"},"Children":[{"ID":"20240513184900-wzvwtvf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-wzvwtvf","updated":"20240513184900"},"Children":[{"ID":"20240513184900-lla8zig","Type":"NodeParagraph","Properties":{"id":"20240513184900-lla8zig","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"每个校验期都支持传入一个 message 参数，表示校验错误后显示的内容"}]}]}]}]},{"ID":"20240513184900-1bhohy0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-1bhohy0","updated":"20240513184900"},"Children":[{"ID":"20240513184900-hpklss7","Type":"NodeParagraph","Properties":{"id":"20240513184900-hpklss7","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"类中定义的诸如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"validate_name"},{"Type":"NodeText","Data":"​ 表示对 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"name"},{"Type":"NodeText","Data":"​ 这个表单元素的自定义校验"}]},{"ID":"20240513184900-rh5ja28","Type":"NodeList","ListData":{},"Properties":{"id":"20240513184900-rh5ja28","updated":"20240513184900"},"Children":[{"ID":"20240513184900-kuj5n1n","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-kuj5n1n","updated":"20240513184900"},"Children":[{"ID":"20240513184900-71oel6p","Type":"NodeParagraph","Properties":{"id":"20240513184900-71oel6p","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"校验失败则抛出 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"wtforms.ValidationError"},{"Type":"NodeText","Data":"​ 异常即可"}]}]},{"ID":"20240513184900-2sjdyd8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-2sjdyd8","updated":"20240513184900"},"Children":[{"ID":"20240513184900-5fpni0k","Type":"NodeParagraph","Properties":{"id":"20240513184900-5fpni0k","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"传入两个参数，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"self"},{"Type":"NodeText","Data":"​ 可以访问到各个表单元素，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"field"},{"Type":"NodeText","Data":"​ 表示当前校验元素。访问 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"field.data"},{"Type":"NodeText","Data":"​ 可以获取元素值"}]}]}]}]}]},{"ID":"20240513184900-6mvrb4p","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513184900-6mvrb4p","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"校验"}]},{"ID":"20240513184900-psiol13","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513184900-psiol13","updated":"20240513184900"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"form = RegisterForm(request.form)\nif form.validate():\n    # 校验成功\nelse:\n    # 校验失败\n    err = form.errors\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513184900-in03ker","Type":"NodeList","ListData":{},"Properties":{"id":"20240513184900-in03ker","updated":"20240513184900"},"Children":[{"ID":"20240513184900-eqlzjle","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-eqlzjle","updated":"20240513184900"},"Children":[{"ID":"20240513184900-2goa1zr","Type":"NodeParagraph","Properties":{"id":"20240513184900-2goa1zr","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"通过表单模型创建一个表单校验对象"}]}]},{"ID":"20240513184900-qvx9gds","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-qvx9gds","updated":"20240513184900"},"Children":[{"ID":"20240513184900-5wpmjx0","Type":"NodeParagraph","Properties":{"id":"20240513184900-5wpmjx0","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"validate()"},{"Type":"NodeText","Data":"​ 方法进行校验，返回值为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"True"},{"Type":"NodeText","Data":"​ 表示校验成功"}]}]},{"ID":"20240513184900-jvxokip","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-jvxokip","updated":"20240513184900"},"Children":[{"ID":"20240513184900-7zkrd0m","Type":"NodeParagraph","Properties":{"id":"20240513184900-7zkrd0m","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"校验失败则会将失败的信息存于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"errors"},{"Type":"NodeText","Data":"​ 中，该变量是一个字典，保存了所有未通过的表单键及异常信息"}]},{"ID":"20240513184900-7o2casu","Type":"NodeList","ListData":{},"Properties":{"id":"20240513184900-7o2casu","updated":"20240513184900"},"Children":[{"ID":"20240513184900-9ia682p","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-9ia682p","updated":"20240513184900"},"Children":[{"ID":"20240513184900-eajusme","Type":"NodeParagraph","Properties":{"id":"20240513184900-eajusme","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"key：未校验通过的表单键（name 属性）"}]}]},{"ID":"20240513184900-5n0oh8v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513184900-5n0oh8v","updated":"20240513184900"},"Children":[{"ID":"20240513184900-91y3kym","Type":"NodeParagraph","Properties":{"id":"20240513184900-91y3kym","updated":"20240513184900"},"Children":[{"Type":"NodeText","Data":"value：列表，包括所有检验出的异常（内置校验类和自定义校验抛出异常的 message 值）"}]}]}]}]}]}]}