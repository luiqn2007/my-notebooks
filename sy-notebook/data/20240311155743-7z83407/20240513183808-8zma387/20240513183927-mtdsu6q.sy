{"ID":"20240513183927-mtdsu6q","Spec":"1","Type":"NodeDocument","Properties":{"icon":"flask.webp","id":"20240513183927-mtdsu6q","title":"Session","type":"doc","updated":"20240513184556"},"Children":[{"ID":"20240513184556-f5wfamh","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513184556-f5wfamh","updated":"20240513184556"},"Children":[{"Type":"NodeText","Data":"Cookie"}]},{"ID":"20240513184556-cwssfwt","Type":"NodeParagraph","Properties":{"id":"20240513184556-cwssfwt","updated":"20240513184557"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"request.cookies"},{"Type":"NodeText","Data":"​ 获取 cookie"}]},{"ID":"20240513184556-o7aprjd","Type":"NodeParagraph","Properties":{"id":"20240513184556-o7aprjd","updated":"20240513184557"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"response.set_cookie()"},{"Type":"NodeText","Data":"​ 设置 cookie"}]},{"ID":"20240513184556-q1idunm","Type":"NodeParagraph","Properties":{"id":"20240513184556-q1idunm","updated":"20240513184557"},"Children":[{"Type":"NodeText","Data":"更推荐使用 Session，更安全"}]},{"ID":"20240513184556-si4c708","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513184556-si4c708","updated":"20240513184556"},"Children":[{"Type":"NodeText","Data":"Session"}]},{"ID":"20240513184556-dxdor9f","Type":"NodeParagraph","Properties":{"id":"20240513184556-dxdor9f","updated":"20240513184557"},"Children":[{"Type":"NodeText","Data":"通过导入库中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"session"},{"Type":"NodeText","Data":"​ 访问。Flask 的 Session 加密存储于 Cookie 中"}]},{"ID":"20240513184556-bca5zzi","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513184556-bca5zzi","updated":"20240513184557"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"from flask import session\n\n# 使用 session 需要先设定一个密钥\n# 越长越安全，但加解密越慢，一般 20 字符左右\napp.secret_key = '密钥'\n# 设置 session 信息\nsession['key'] = 'value'\n# 检查是否存在\nv = session.get('key')\nif v is None:\n    # 数据不存在\n    pass\n# 清空 session 信息\nsession.clear()\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240513184556-v9jbstz","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513184556-v9jbstz","updated":"20240513184556"},"Children":[{"Type":"NodeText","Data":"全局对象"}]},{"ID":"20240513184556-9o0ilpo","Type":"NodeParagraph","Properties":{"id":"20240513184556-9o0ilpo","updated":"20240513184557"},"Children":[{"Type":"NodeText","Data":"对每一个会话请求，Flask 都有一个线程上下文的全局变量 g"}]},{"ID":"20240513184556-foyd70j","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240513184556-foyd70j","updated":"20240513184557"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"from flask import session, g\n\n@app.before_request\ndef on_before_request():\n    \"\"\"\n    在请求被处理前从 session 中获取登录信息并保存到线程的全局上下文 \n    \"\"\"\n    setattr(g, 'username', session.get('name'))\n    setattr(g, 'email', session.get('email'))\n\n\n@app.context_processor\ndef on_process_context():\n    \"\"\"\n    在处理模板时将上下文的用户信息传递给模板\n    \"\"\"\n    return {\n        'username': g.username,\n        'email': g.email\n    }\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}