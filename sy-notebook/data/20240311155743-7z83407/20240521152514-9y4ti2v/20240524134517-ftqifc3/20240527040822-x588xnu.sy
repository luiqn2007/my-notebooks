{"ID":"20240527040822-x588xnu","Spec":"1","Type":"NodeDocument","Properties":{"icon":"vue.svg","id":"20240527040822-x588xnu","title":"响应式侦听","type":"doc","updated":"20240527155925"},"Children":[{"ID":"20240527040822-fmmsmig","Type":"NodeParagraph","Properties":{"id":"20240527040822-fmmsmig","updated":"20240527153137"},"Children":[{"Type":"NodeText","Data":"组合式 API 中响应式侦听有两种方式："}]},{"ID":"20240527153137-v528v95","Type":"NodeList","ListData":{},"Properties":{"id":"20240527153137-v528v95","updated":"20240527155925"},"Children":[{"ID":"20240527153138-ttf6p4v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527153138-ttf6p4v","updated":"20240527153138"},"Children":[{"ID":"20240527153138-kohnlwn","Type":"NodeParagraph","Properties":{"id":"20240527153138-kohnlwn","updated":"20240527153241"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Vue.watchEffect"},{"Type":"NodeText","Data":"​：立即执行传入的函数，响应式追踪其中的依赖，并在依赖变更时重新运行该函数"}]},{"ID":"20240527153403-t5wp3vb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527153403-t5wp3vb","updated":"20240527153737"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"anM="},{"Type":"NodeCodeBlockCode","Data":"const count = Vue.ref(0)\n// 添加侦听器\nVue.watchEffect(() =\u003e console.log(count.value))\n// 修改 count 验证\nsetTimeout(() =\u003e count.value++, 100) // 输出: 0 1\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240527153143-bfg9yfp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527153143-bfg9yfp","updated":"20240527155925"},"Children":[{"ID":"20240527153143-4xozst2","Type":"NodeParagraph","Properties":{"id":"20240527153143-4xozst2","updated":"20240527155742"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Vue.watch"},{"Type":"NodeText","Data":"​：侦听特定数据源，在回调函数中执行副作用，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"懒执行"}]},{"ID":"20240527155903-f9w1cht","Type":"NodeParagraph","Properties":{"id":"20240527155903-f9w1cht","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240527155925"},"Children":[{"Type":"NodeText","Data":"数据源：拥有返回值的 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"getter"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 函数，或 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"ref"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240527153408-zg1dfc5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527153408-zg1dfc5","updated":"20240527160423"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"anM="},{"Type":"NodeCodeBlockCode","Data":"// 侦听 getter\nconst state = Vue.reactive({ count: 0 })\nVue.watch(() =\u003e state.count, (newValue, oldValue) =\u003e {\n    // do something\n})\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527160136-pz05czr","Type":"NodeParagraph","Properties":{"id":"20240527160136-pz05czr","updated":"20240527160225"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Vue.watch"},{"Type":"NodeText","Data":"​ 可以侦听多个数据源"}]},{"ID":"20240527160226-av32plb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527160226-av32plb","updated":"20240527160419"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"anM="},{"Type":"NodeCodeBlockCode","Data":"const state = Vue.reactive({ count: 0 })\nconst title = Vue.ref('')\nVue.watch([() =\u003e state.count, title], ([newCount, newTitle], [oldCount, oldTitle]) =\u003e {\n    // do something\n})\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240527153823-m8vsk6v","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240527153823-m8vsk6v","updated":"20240527153949"},"Children":[{"Type":"NodeText","Data":"侦听器控制"}]},{"ID":"20240527153946-ehb6aor","Type":"NodeList","ListData":{},"Properties":{"id":"20240527153946-ehb6aor","updated":"20240527153949"},"Children":[{"ID":"20240527153949-fg3r97q","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527153949-fg3r97q","updated":"20240527153949"},"Children":[{"ID":"20240527153949-diziyue","Type":"NodeParagraph","Properties":{"id":"20240527153949-diziyue","updated":"20240527153950"},"Children":[{"Type":"NodeText","Data":"组件停止"}]},{"ID":"20240527153836-2sab0vu","Type":"NodeParagraph","Properties":{"id":"20240527153836-2sab0vu","style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);","updated":"20240527154005"},"Children":[{"Type":"NodeText","Data":"当侦听器在组件 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"setup()"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​ 或生命周期钩子函数中调用时，改监听器将绑定到该组件，并在组件卸载时自动停止。"}]},{"ID":"20240527154001-7p300h2","Type":"NodeParagraph","Properties":{"id":"20240527154001-7p300h2","updated":"20240527154035"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Vue.watchEffect()"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Vue.effect()"},{"Type":"NodeText","Data":"​ 会返回一个函数，调用该函数可以手动停止监听器"}]},{"ID":"20240527154036-e853bmz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527154036-e853bmz","updated":"20240527154132"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"anM="},{"Type":"NodeCodeBlockCode","Data":"const stop = Vue.watchEffect(() =\u003e { ... })\n// 停止监听\nstop()\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527153951-b9y2jm9","Type":"NodeParagraph","Properties":{"id":"20240527153951-b9y2jm9","updated":"20240527154542"},"Children":[{"Type":"NodeText","Data":"在侦听器回调传入一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"onInvalidate"},{"Type":"NodeText","Data":"​，在侦听器中调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"onInvalidate(func)"},{"Type":"NodeText","Data":"​ 方法可以设置侦听器停止时的行为，可用于结束一些异步调用等"}]},{"ID":"20240527154852-99riroc","Type":"NodeParagraph","Properties":{"id":"20240527154852-99riroc","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240527154910"},"Children":[{"Type":"NodeText","Data":"该方法在 Vue 源码中传入参数名称为 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"onCleanup"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240527154544-556h7w7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527154544-556h7w7","updated":"20240527154634"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"anM="},{"Type":"NodeCodeBlockCode","Data":"const stop = Vue.watchEffect(onInvalidate =\u003e { \n    // do something ...\n    onInvalidate(() =\u003e {\n        // do something clean\n    })\n})\n// 停止监听\nstop()\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240527153954-gr87g4g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527153954-gr87g4g"},"Children":[{"ID":"20240527153954-2jh86mz","Type":"NodeParagraph","Properties":{"id":"20240527153954-2jh86mz","updated":"20240527155105"},"Children":[{"Type":"NodeText","Data":"调试："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Vue.watchEffect"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Vue.watch"},{"Type":"NodeText","Data":"​ 方法可以接受第二个对象类型参数，用于设置调试行为，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"仅开发模式下生效"}]},{"ID":"20240527155017-qwzb6wa","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527155017-qwzb6wa","updated":"20240527155704"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"anM="},{"Type":"NodeCodeBlockCode","Data":"}\n    onTrack: (e) =\u003e {},  // 当该响应式对象被追踪时调用\n    onTrigger: (e) =\u003e {} // 当该响应式对象的依赖项被修改时调用\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240527155717-f3ccfc1","Type":"NodeParagraph","Properties":{"id":"20240527155717-f3ccfc1","updated":"20240527155718"}}]}