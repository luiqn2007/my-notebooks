{"ID":"20240318004505-y3swr4z","Spec":"1","Type":"NodeDocument","Properties":{"icon":"jclasslib256x256.png","id":"20240318004505-y3swr4z","title":"TreeAPI","type":"doc","updated":"20240318041904"},"Children":[{"ID":"20240318021043-e9gpgo7","Type":"NodeParagraph","Properties":{"id":"20240318021043-e9gpgo7","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240318021118"},"Children":[{"Type":"NodeText","Data":"Maven 库："},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"org.ow2.asm:asm-tree"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240318021741-xexplxw","Type":"NodeParagraph","Properties":{"id":"20240318021741-xexplxw","style":"color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);","updated":"20240318021849"},"Children":[{"Type":"NodeText","Data":"TreeAPI 比 CoreAPI 用起来更方便，可以随时访问类的全部信息，但处理速度会慢 30% 左右，同时会消耗更多内存，应根据实际情况选择"}]},{"ID":"20240318021447-kgion68","Type":"NodeParagraph","Properties":{"id":"20240318021447-kgion68","updated":"20240318021658"},"Children":[{"Type":"NodeText","Data":"TreeAPI 只需要向 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ClassReader"},{"Type":"NodeText","Data":"​ 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"accept"},{"Type":"NodeText","Data":"​ 方法传入一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ClassNode"},{"Type":"NodeText","Data":"​ 类即可。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"accept"},{"Type":"NodeText","Data":"​ 后，所有类信息都将保存到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ClassNode"},{"Type":"NodeText","Data":"​ 中"}]},{"ID":"20240318020748-w5bjijw","Type":"NodeList","ListData":{},"Properties":{"id":"20240318020748-w5bjijw","updated":"20240318041900"},"Children":[{"ID":"20240318020748-7gmcswn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240318020748-7gmcswn","updated":"20240318020748"},"Children":[{"ID":"20240318020748-8enqss5","Type":"NodeParagraph","Properties":{"id":"20240318020748-8enqss5","updated":"20240318020748"},"Children":[{"Type":"NodeText","Data":"例：输出类的方法和字段"}]},{"ID":"20240318020748-it219go","Type":"NodeSuperBlock","Properties":{"id":"20240318020748-it219go","updated":"20240318020748"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240318020748-z5xc9sq","Type":"NodeSuperBlock","Properties":{"id":"20240318020748-z5xc9sq","updated":"20240318020748"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240318020748-lhswxar","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318020748-lhswxar","updated":"20240318020748"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"// 待看类\npublic class MyClass {\n    public int a = 0;\n    public int b = 1;\n    public void test01() {}\n    public void test02() {}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240318020748-2xkxjbq","Type":"NodeParagraph","Properties":{"id":"20240318020748-2xkxjbq","updated":"20240318020748"},"Children":[{"Type":"NodeText","Data":"输出内容："}]},{"ID":"20240318020748-rbtm5qo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318020748-rbtm5qo","updated":"20240318021440"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"Field: a\nField: b\nMethod: \u003cinit\u003e\nMethod: test01\nMethod: test02\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240318020748-l0z8l0o","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318020748-l0z8l0o","updated":"20240318021415"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"ClassReader cr = new ClassReader(bytes);\nClassNode cn = new ClassNode();\ncr.accept(cn, ClassReader.SKIP_DEBUG | ClassReader.SKIP_CODE);\nfor (FieldNode field : cn.fields) {\n    System.out.println(\"Field: \" + field.name);\n}\nfor (MethodNode method : cn.methods) {\n    System.out.println(\"Method: \" + method.name);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240318020748-6wkfs18","Type":"NodeParagraph","Properties":{"id":"20240318020748-6wkfs18","updated":"20240318020748"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ClassReader"},{"Type":"NodeText","Data":"​ 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"accept"},{"Type":"NodeText","Data":"​ 第二个参数 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"flags"},{"Type":"NodeText","Data":"​ 是一个位掩码，可选以下值："}]},{"ID":"20240318020748-x5u9qu1","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;","id":"20240318020748-x5u9qu1","updated":"20240318020748"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"值"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"SKIP_DEBUG"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"跳过调试信息（行号等）"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"SKIP_CODE"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"跳过 Code 属性（方法字节码、异常表等）"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"EXPAND_FRAMES"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"展开 StackMapTable 属性"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"SKIP_FRAMES"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"跳过 StackMapTable 属性"}]}]}]}]},{"ID":"20240318020748-v8kl7rl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240318020748-v8kl7rl","updated":"20240318020748"},"Children":[{"ID":"20240318020748-jipqkv1","Type":"NodeParagraph","Properties":{"id":"20240318020748-jipqkv1","updated":"20240318021859"},"Children":[{"Type":"NodeText","Data":"例：新增字段和方法"}]},{"ID":"20240318033131-pkuuazo","Type":"NodeSuperBlock","Properties":{"id":"20240318033131-pkuuazo"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240318033008-kkidmnv","Type":"NodeSuperBlock","Properties":{"id":"20240318033008-kkidmnv","updated":"20240318033008"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240318033008-nfbo5w1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318033008-nfbo5w1","updated":"20240318033008"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class MyClass {\n    public int a = 0;\n    public int b = 1;\n    public void test01() {}\n    public void test02() {}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240318033008-bpa7yyr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318033008-bpa7yyr","updated":"20240318034317"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class MyClass {\n    public int a = 0;\n    public int b = 1;\n    public static final String xyz;\n    public void test01() {}\n    public void test02() {}\n    public void foo(int var1, String var2) {\n        // System.out.println(var1 + var2);\n        System.out.println(new StringBuilder()\n                            .append(var1)\n                            .append(var2)\n                            .toString());\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240318033008-2qd63m3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318033008-2qd63m3","updated":"20240318034210"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"ClassReader cr = new ClassReader(bytes);\nClassWriter cw = new ClassWriter(0);\nClassNode cn = new ClassNode(ASM9);\n\nFieldNode xyz = new FieldNode(ACC_PUBLIC | ACC_STATIC | ACC_FINAL,\n        \"xyz\", \"Ljava/lang/String;\", null, null);\ncn.fields.add(xyz);\n\nMethodNode foo = new MethodNode(ACC_PUBLIC,\n        \"foo\", \"(ILjava/lang/String;)V\", null, null);\nInsnList insnList = foo.instructions;\n// sb = new StringBuilder();\ninsnList.add(new TypeInsnNode(NEW, \"java/lang/StringBuilder\"));\ninsnList.add(new InsnNode(DUP));\ninsnList.add(new MethodInsnNode(INVOKESPECIAL,\n        \"java/lang/StringBuilder\", \"\u003cinit\u003e\", \"()V\", false));\n// sb.append(i);\ninsnList.add(new VarInsnNode(ILOAD, 1));\ninsnList.add(new MethodInsnNode(INVOKEVIRTUAL, \"java/lang/StringBuilder\", \"append\", \n        \"(I)Ljava/lang/StringBuilder;\", false));\n// sb.append(s);\ninsnList.add(new VarInsnNode(ALOAD, 2));\ninsnList.add(new MethodInsnNode(INVOKEVIRTUAL, \"java/lang/StringBuilder\", \"append\", \n        \"(Ljava/lang/String;)Ljava/lang/StringBuilder;\", false));\n// sb.toString();\ninsnList.add(new MethodInsnNode(INVOKEVIRTUAL, \"java/lang/StringBuilder\", \"toString\", \n        \"()Ljava/lang/StringBuilder;\", false));\n// System.out.println(s)\ninsnList.add(new FieldInsnNode(GETSTATIC,\n        \"java/lang/System\", \"out\", \"java/io/PrintStream\"));\ninsnList.add(new InsnNode(SWAP));\ninsnList.add(new MethodInsnNode(INVOKEVIRTUAL,\n        \"java/lang/PrintStream\", \"println\", \"(Ljava/lang/String;)V\", false));\ncn.methods.add(foo);\ncr.accept(cn, ClassReader.SKIP_DEBUG);\ncn.accept(cw);\nreturn cw.toByteArray();\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]}]},{"ID":"20240318020748-ptj5kkr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240318020748-ptj5kkr","updated":"20240318041900"},"Children":[{"ID":"20240318020748-d3eqqmz","Type":"NodeParagraph","Properties":{"id":"20240318020748-d3eqqmz","updated":"20240318041702"},"Children":[{"Type":"NodeText","Data":"例：移除方法和字段，修改方法内容"}]},{"ID":"20240318034817-wfm8r56","Type":"NodeSuperBlock","Properties":{"id":"20240318034817-wfm8r56","updated":"20240318040434"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240318034817-siuhhp1","Type":"NodeSuperBlock","Properties":{"id":"20240318034817-siuhhp1","updated":"20240318035136"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240318034817-xndvax4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318034817-xndvax4","updated":"20240318034817"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class MyClass {\n    public int a = 0;\n    public int b = 1;\n    public void test01() {}\n    public void test02() {}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240318034817-3snd8fg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318034817-3snd8fg","updated":"20240318035136"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class MyClass {\n    public int a = 0;\n    public void test01() {}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240318034817-gh7yfdp","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318034817-gh7yfdp","updated":"20240318040434"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"ClassReader cr = new ClassReader(bytes);\nClassWriter cw = new ClassWriter(0);\nClassNode cn = new ClassNode(ASM9);\ncr.accept(cn, ClassReader.SKIP_DEBUG);\ncn.methods.removeIf(node -\u003e node.name.equals(\"test02\"));\ncn.fields.removeIf(node -\u003e node.name.equals(\"b\"));\n// 删除构造函数中的赋值\nfor (MethodNode method : cn.methods) {\n    if (\"\u003cinit\u003e\".equals(method.name)) {\n        InsnList insnList = method.instructions;\n        AbstractInsnNode n0 = insnList.get(0);\n        AbstractInsnNode n1 = insnList.get(1);\n        for (int i = 2; i \u003c insnList.size(); i++) {\n            if (insnList.get(i) instanceof FieldInsnNode n\n                    \u0026\u0026 n.getOpcode() == PUTFIELD\n                    \u0026\u0026 n.name.equals(\"b\")) {\n                insnList.remove(n);  // putfield b 1\n                insnList.remove(n0); // aload 0\n                insnList.remove(n1); // iconst_1\n                break;\n            }\n            n0 = n1;\n            n1 = insnList.get(i);\n        }\n        break;\n    }\n}\ncn.accept(cw);\nreturn cw.toByteArray();\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]}]}]},{"ID":"20240318041904-zibc47r","Type":"NodeParagraph","Properties":{"id":"20240318041904-zibc47r"}}]}