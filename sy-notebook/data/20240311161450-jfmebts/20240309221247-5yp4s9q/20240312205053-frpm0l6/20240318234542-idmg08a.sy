{"ID":"20240318234542-idmg08a","Spec":"1","Type":"NodeDocument","Properties":{"icon":"jclasslib256x256.png","id":"20240318234542-idmg08a","title":"JVM Attach API","type":"doc","updated":"20240427153501"},"Children":[{"ID":"20240318234542-e47z1xw","Type":"NodeParagraph","Properties":{"id":"20240318234542-e47z1xw","updated":"20240427153501"},"Children":[{"Type":"NodeText","Data":"从 JDK 6 开始，JVM 支持动态 Attach Agent，可在 JVM 启动后在任意时刻远程加载 Agent Jar 包，底层主要依赖于","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"block-ref","TextMarkBlockRefID":"20240319005138-iytf3mg","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"信号和 Unix 域套接字"},{"Type":"NodeText","Data":"。","Properties":{"id":""}}]},{"ID":"20240319004402-egoetbn","Type":"NodeParagraph","Properties":{"id":"20240319004402-egoetbn","updated":"20240319004430"},"Children":[{"Type":"NodeText","Data":"使用 Attach Agent 启动的代理，入口是 ","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"agentmain"},{"Type":"NodeText","Data":"​ 方法，其方法签名如下：","Properties":{"id":""}}]},{"ID":"20240319004436-6ih346a","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"amF2YQ==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240319004436-6ih346a","updated":"20240319004625"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"public static void agentmain(String agentArgument, Instrumentation instrumentation) throws Exception;\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20240319004449-n2c8mi4","Type":"NodeParagraph","Properties":{"id":"20240319004449-n2c8mi4","updated":"20240319004927"},"Children":[{"Type":"NodeText","Data":"由于跨进程，JVM 通过发起一个独立的 Java 程序，使用 ","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"VirtualMachine.attach"},{"Type":"NodeText","Data":"​ 绑定对应进程。因此还需要一个 main 函数：","Properties":{"id":""}}]},{"ID":"20240319004549-4oj90w4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"amF2YQ==","CodeBlockCloseFence":"YGBg","Properties":{"id":"20240319004549-4oj90w4","updated":"20240319004915"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ==","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"public static void main(String[] args) throws Exception {\n    VirtualMachine vm = VirtualMachine.attach(\"进程 id\");\n    try {\n        vm.loadAgent(\"Agent Jar 包位置\")\n    } finally {\n        vm.detach();\n    }\n}\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]}]}