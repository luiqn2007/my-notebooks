{"ID":"20240319005138-iytf3mg","Spec":"1","Type":"NodeDocument","Properties":{"icon":"jclasslib256x256.png","id":"20240319005138-iytf3mg","title":"JVM Attach API 原理","type":"doc","updated":"20240319020618"},"Children":[{"ID":"20240319014408-6ogd6yy","Type":"NodeParagraph","Properties":{"id":"20240319014408-6ogd6yy","updated":"20240319014408"},"Children":[{"Type":"NodeText","Data":" JVM Attach API 的实现主要基于信号和 Unix 域套接字。"}]},{"ID":"20240319015759-p3vi0lz","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240319015759-p3vi0lz","updated":"20240319020618"},"Children":[{"ID":"20240319015800-d81rexp","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240319015800-d81rexp","updated":"20240319020618"},"Children":[{"ID":"20240319015800-fyphem2","Type":"NodeParagraph","Properties":{"id":"20240319015800-fyphem2","updated":"20240319020618"},"Children":[{"Type":"NodeText","Data":"Attach 端检查临时文件目录是否存在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".java_pidXXX"},{"Type":"NodeText","Data":"​ 文件，即 Unix 套接字文件。如果不存在则创建对应文件，发送 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SIGQUIT"},{"Type":"NodeText","Data":"​ 信号给目标 JVM。每 200ms 检查一次目标 JVM 端 Socket 文件是否生成，5s 还未生成则退出"}]}]},{"ID":"20240319015849-bnguzpi","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240319015849-bnguzpi","updated":"20240319020509"},"Children":[{"ID":"20240319015849-0xhfxz9","Type":"NodeParagraph","Properties":{"id":"20240319015849-0xhfxz9","updated":"20240319020441"},"Children":[{"Type":"NodeText","Data":"目标 JVM 进程：收到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SIGQUIT"},{"Type":"NodeText","Data":"​ 信号后，检查 Attach 端 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".java_pidXXX"},{"Type":"NodeText","Data":"​ 是否存在"}]},{"ID":"20240319020239-b56b9a8","Type":"NodeList","ListData":{},"Properties":{"id":"20240319020239-b56b9a8","updated":"20240319020509"},"Children":[{"ID":"20240319020242-oo9afkw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240319020242-oo9afkw","updated":"20240319020447"},"Children":[{"ID":"20240319020242-av4dow8","Type":"NodeParagraph","Properties":{"id":"20240319020242-av4dow8","updated":"20240319020447"},"Children":[{"Type":"NodeText","Data":"存在：Attach 操作，启动 Attach Listener 线程，负责 Attach 请求，并创建 JVM 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".java_pidXXX"},{"Type":"NodeText","Data":"​ 文件"}]}]},{"ID":"20240319020347-o5gpcef","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240319020347-o5gpcef","updated":"20240319020509"},"Children":[{"ID":"20240319020347-dly6ea6","Type":"NodeParagraph","Properties":{"id":"20240319020347-dly6ea6","updated":"20240319020509"},"Children":[{"Type":"NodeText","Data":"不存在：不是 Attach 操作，执行默认逻辑打印栈"}]}]}]}]}]},{"ID":"20240319014557-79x7a5b","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240319014557-79x7a5b","updated":"20240319014559"},"Children":[{"Type":"NodeText","Data":"信号"}]},{"ID":"20240319005536-t9cag1c","Type":"NodeParagraph","Properties":{"id":"20240319005536-t9cag1c","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240319014944"},"Children":[{"Type":"NodeText","Data":"信号：Signal，事件发生时对进行的通知机制，又称“软件中断”，可以看成一种轻量级进程间通信。"}]},{"ID":"20240319005803-z69att8","Type":"NodeParagraph","Properties":{"id":"20240319005803-z69att8","updated":"20240319014559"},"Children":[{"Type":"NodeText","Data":"每个信号都有一个名称，以 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SIG"},{"Type":"NodeText","Data":"​ 开头。"}]},{"ID":"20240319014413-m6e48tc","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;|min-width: 60px;","id":"20240319014413-m6e48tc","updated":"20240319014559"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"信号名"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"信号量"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SIGINT"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"2"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"键盘中断信号（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Ctrl+C"},{"Type":"NodeText","Data":"​）"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SIGQUIT"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"3"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"键盘退出信号"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SIGKILL"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"9"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sure kill"},{"Type":"NodeText","Data":"​ 信号，应用程序总是被杀死"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SIGTERM"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"15"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"终止信号"}]}]}]},{"ID":"20240319014617-jifatjq","Type":"NodeParagraph","Properties":{"id":"20240319014617-jifatjq","updated":"20240319014901"},"Children":[{"Type":"NodeText","Data":"JVM 对 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SIGQUIT"},{"Type":"NodeText","Data":"​ 信号的默认行为是打印所有运行的虚拟机线程堆栈信息。"}]},{"ID":"20240319014906-tavhxcf","Type":"NodeParagraph","Properties":{"id":"20240319014906-tavhxcf","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240319014928"},"Children":[{"Type":"NodeText","Data":"类 Unit 系统可以通过 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"kill -3 pid"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 发送"}]},{"ID":"20240319014403-q02e1qo","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240319014403-q02e1qo","updated":"20240319014614"},"Children":[{"Type":"NodeText","Data":"Unix 域套接字"}]},{"ID":"20240319014955-uywt6sw","Type":"NodeParagraph","Properties":{"id":"20240319014955-uywt6sw","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240319015114"},"Children":[{"Type":"NodeText","Data":"Unix 域套接字：Unix Domain Socket，实现同一主机上进程间的通信"}]},{"ID":"20240319015145-tpmfw0y","Type":"NodeParagraph","Properties":{"id":"20240319015145-tpmfw0y","updated":"20240319015248"},"Children":[{"Type":"NodeText","Data":"Unix 域套接字与普通套接字（使用 127.0.0.1 回环地址）相比，"}]},{"ID":"20240319015232-fkmcewj","Type":"NodeList","ListData":{},"Properties":{"id":"20240319015232-fkmcewj","updated":"20240319015550"},"Children":[{"ID":"20240319015233-mk9jrzd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240319015233-mk9jrzd","updated":"20240319015233"},"Children":[{"ID":"20240319015233-1gj0y43","Type":"NodeParagraph","Properties":{"id":"20240319015233-1gj0y43","updated":"20240319015514"},"Children":[{"Type":"NodeText","Data":"更高效：不进行协议处理，不需要计算序列号，也不需要发送确认报文"}]}]},{"ID":"20240319015509-818jgse","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240319015509-818jgse"},"Children":[{"ID":"20240319015509-8e2zqcl","Type":"NodeParagraph","Properties":{"id":"20240319015509-8e2zqcl","updated":"20240319015535"},"Children":[{"Type":"NodeText","Data":"更可靠：不会丢失数据，而普通套接字是为不可靠通信设计的"}]}]},{"ID":"20240319015536-ipdlorl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240319015536-ipdlorl","updated":"20240319015550"},"Children":[{"ID":"20240319015536-zwlkvh8","Type":"NodeParagraph","Properties":{"id":"20240319015536-zwlkvh8","updated":"20240319015550"},"Children":[{"Type":"NodeText","Data":"可简单修改为普通套接字"}]}]}]},{"ID":"20240319015152-td5e2mi","Type":"NodeParagraph","Properties":{"id":"20240319015152-td5e2mi"}}]}