{"ID":"20240317203528-784hvpk","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f630","id":"20240317203528-784hvpk","title":"Javassist","updated":"20240318205601"},"Children":[{"ID":"20240318123722-rk29cjk","Type":"NodeParagraph","Properties":{"id":"20240318123722-rk29cjk","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240318123759"},"Children":[{"Type":"NodeText","Data":"Maven 库："},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"org.javassist:javassist"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240317203528-64rmjrz","Type":"NodeParagraph","Properties":{"id":"20240317203528-64rmjrz","updated":"20240318122727"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Javassist"},{"Type":"NodeText","Data":"​ 性能比 ASM 稍差，但使用起来比 ASM 简单的多，，不需要对字节码有很深的理解。"}]},{"ID":"20240318122710-2ayt39a","Type":"NodeWidget","Data":"\u003ciframe src=\"/widgets/widget-excalidraw\" data-src=\"/widgets/widget-excalidraw\" data-subtype=\"widget\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"width: 937px; height: 347px;\"\u003e\u003c/iframe\u003e","Properties":{"custom-data-assets":"assets/widget-excalidraw/0-20240318123433-pv8er65","custom-options":"\u0026#123;\u0026quot;gridModeEnabled\u0026quot;:true,\u0026quot;exportBackground\u0026quot;:true,\u0026quot;theme\u0026quot;:\u0026quot;light\u0026quot;\u0026#125;","data-assets":"assets/widget-excalidraw/0-20240318123433-pv8er65","id":"20240318122710-2ayt39a","options":"\u0026#123;\u0026quot;gridModeEnabled\u0026quot;:true,\u0026quot;exportBackground\u0026quot;:true,\u0026quot;theme\u0026quot;:\u0026quot;light\u0026quot;\u0026#125;","updated":"20240318122710"}},{"ID":"20240318123410-hk17s4t","Type":"NodeList","ListData":{},"Properties":{"id":"20240318123410-hk17s4t","updated":"20240318205601"},"Children":[{"ID":"20240318123518-endgi8r","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240318123518-endgi8r","updated":"20240318123529"},"Children":[{"ID":"20240318123518-419qz16","Type":"NodeParagraph","Properties":{"id":"20240318123518-419qz16","updated":"20240318123521"},"Children":[{"Type":"NodeText","Data":"新增方法"}]},{"ID":"20240318123525-g8wc59h","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318123525-g8wc59h","updated":"20240318203109"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"ClassPool cp = ClassPool.getDefault();\n// 载入 MyClass.class 路径\ncp.insertClassPath(\"org.example.MyClass.class\");\nCtClass ct = cp.get(\"org.example.MyClass\");\n// 创建 public void foo(int, int)\nCtMethod foo = new CtMethod(voidType, \"foo\", new CtClass[] {intType, intType}, ct);\nfoo.setModifiers(Modifier.PUBLIC);\n// 设置函数体 sout(\"hello\")\nfoo.setBody(\"System.out.println(\\\"hello\\\");\");\nct.addMethod(foo);\n// 输出\nct.writeFile(\"./out\");\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240318123521-8s2qwlf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240318123521-8s2qwlf","updated":"20240318205601"},"Children":[{"ID":"20240318123521-m8thafx","Type":"NodeParagraph","Properties":{"id":"20240318123521-m8thafx","updated":"20240318204533"},"Children":[{"Type":"NodeText","Data":"修改方法："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CtMethod"},{"Type":"NodeText","Data":"​ 类可以用于修改方法"}]},{"ID":"20240318204449-ipd8bg2","Type":"NodeList","ListData":{},"Properties":{"id":"20240318204449-ipd8bg2","updated":"20240318204535"},"Children":[{"ID":"20240318204535-0djmv1u","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240318204535-0djmv1u","updated":"20240318204535"},"Children":[{"ID":"20240318204535-ck0yiel","Type":"NodeParagraph","Properties":{"id":"20240318204535-ck0yiel","updated":"20240318204607"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"setBody"},{"Type":"NodeText","Data":"​：将一段 Java 代码翻译成字节码作为函数体"}]}]},{"ID":"20240318204608-ir597ox","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240318204608-ir597ox"},"Children":[{"ID":"20240318204608-7dl12i0","Type":"NodeParagraph","Properties":{"id":"20240318204608-7dl12i0","updated":"20240318204647"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"insertBefore"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"insertAfter"},{"Type":"NodeText","Data":"​ 系列在方法开头和结尾插入语句"}]}]},{"ID":"20240318204647-vmhdx7z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240318204647-vmhdx7z"},"Children":[{"ID":"20240318204647-ox25pc8","Type":"NodeParagraph","Properties":{"id":"20240318204647-ox25pc8","updated":"20240318204706"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"instrument"},{"Type":"NodeText","Data":"​ 方法可以按某些方式替换字节码"}]}]}]},{"ID":"20240318204712-d6onzq1","Type":"NodeParagraph","Properties":{"id":"20240318204712-d6onzq1","updated":"20240318205432"},"Children":[{"Type":"NodeText","Data":"关于参数引用，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$"},{"Type":"NodeText","Data":"​，常用的有："}]},{"ID":"20240318204725-4c9z3zv","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;|","id":"20240318204725-4c9z3zv","updated":"20240318205354"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"符号"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"foo(符号) 表达的内容"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$0"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"this"},{"Type":"NodeText","Data":"​，静态方法不可用"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"foo(this)"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$1"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$2"},{"Type":"NodeText","Data":"​，..."}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"当前局部变量表第 1，2，...个参数"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"foo(第 i 个参数)"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$args"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Object[]"},{"Type":"NodeText","Data":"​，包含所有参数"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"foo(new Object[]{第一个参数, 第二个参数, ...})"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$$"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"将所有参数展开，即表示为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"第一个参数, 第二个参数, ..."},{"Type":"NodeText","Data":"​ 的形式"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"foo(第一个参数, 第二个参数, ...)"},{"Type":"NodeText","Data":"​"},{"Type":"NodeBr","Data":"br"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$cflow(函数名)"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"某函数递归调用的深度"}]},{"Type":"NodeTableCell","Data":"td"}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$_"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"insertAfter"},{"Type":"NodeText","Data":"​ 用，表示返回值"}]},{"Type":"NodeTableCell","Data":"td"}]}]},{"ID":"20240318204726-edv1x9d","Type":"NodeParagraph","Properties":{"id":"20240318204726-edv1x9d","updated":"20240318205601"},"Children":[{"Type":"NodeText","Data":"还有其他的但用得不多，如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$r"},{"Type":"NodeText","Data":"​ 表示返回值类型，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$w"},{"Type":"NodeText","Data":"​ 用于包装器类型，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$sig"},{"Type":"NodeText","Data":"​ 表示类型为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Class"},{"Type":"NodeText","Data":"​ 的参数类型数组，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$type"},{"Type":"NodeText","Data":"​ 表示返回值 Class，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$class"},{"Type":"NodeText","Data":"​ 表示修改类的 Class"}]}]}]}]}