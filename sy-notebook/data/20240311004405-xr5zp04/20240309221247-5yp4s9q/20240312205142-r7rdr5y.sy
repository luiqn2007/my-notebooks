{"ID":"20240312205142-r7rdr5y","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f630","id":"20240312205142-r7rdr5y","title":"全链路分布式跟踪与 APM","type":"doc","updated":"20240322015222"},"Children":[{"ID":"20240322015212-f3r7z05","Type":"NodeParagraph","Properties":{"id":"20240322015212-f3r7z05","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240322015212"},"Children":[{"Type":"NodeText","Data":"APM：Application Performance Management，应用性能管理，对企业关键业务进行监控、诊断、分析、优化，提高可靠性和质量。"}]},{"ID":"20240322015222-512zkes","Type":"NodeParagraph","Properties":{"id":"20240322015222-512zkes","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"随着互联网技术的发展，单架构应用越来越庞大臃肿，难以维护，于是将其拆分为若干功能单一的微服务，各个微服务之间通过接口协议进行通信，独立开发，独立部署，可以使用不同技术栈。"}]},{"ID":"20240322015222-xtw9gju","Type":"NodeParagraph","Properties":{"id":"20240322015222-xtw9gju","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"微服务解决了单一服务过大问题，但出现问题时，难以查找问题来源，故出现了全链路分布式跟踪技术。该技术起于 2005 Google 的 Dapper 设计与实现，每个请求有对应的 "},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"一次用户请求，所有链路上子过程节点共用","TextMarkTextContent":"TraceID"},{"Type":"NodeText","Data":"，"},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"一次处理过程","TextMarkTextContent":"SpanID"},{"Type":"NodeText","Data":"，"},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"父节点","TextMarkTextContent":"ParentID"},{"Type":"NodeText","Data":" 完成对一次访问服务的追踪。"}]},{"ID":"20240322015222-vh04non","Type":"NodeWidget","Data":"\u003ciframe src=\"/widgets/widget-excalidraw/\" data-src=\"/widgets/widget-excalidraw/\" data-subtype=\"widget\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"width: 1103px; height: 641px;\"\u003e\u003c/iframe\u003e","Properties":{"custom-data-assets":"assets/widget-excalidraw/0-20240321235444-z9v2r9e","custom-options":"\u0026#123;\u0026quot;gridModeEnabled\u0026quot;:true,\u0026quot;exportBackground\u0026quot;:true,\u0026quot;theme\u0026quot;:\u0026quot;light\u0026quot;\u0026#125;","id":"20240322015222-vh04non","updated":"20240322015222"}},{"ID":"20240322015222-3hgbybt","Type":"NodeParagraph","Properties":{"id":"20240322015222-3hgbybt","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"Dapper 促生了多个开源实现，后来出现了"},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"Cloud Native Computing Foundation，CNCF","TextMarkTextContent":"原生计算基金会"},{"Type":"NodeText","Data":"，创建了 OpenTracing 规范，定义了一套通用接口。"}]},{"ID":"20240322015222-4cgkxde","Type":"NodeParagraph","Properties":{"id":"20240322015222-4cgkxde","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"Tracer：一次调用链，由多个 Span 组成"}]},{"ID":"20240322015222-oga4r3y","Type":"NodeParagraph","Properties":{"id":"20240322015222-oga4r3y","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"Span：一段处理过程，可以是一个方法调用，一次 HTTP 请求，一次数据库操作等，通常包含以下状态值："}]},{"ID":"20240322015222-v15x449","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;","id":"20240322015222-v15x449","updated":"20240322015222"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"状态"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Span名"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"一般是函数名或关键操作名"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"SpanContext"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"上下文，包括 TraceID，SpanID 等"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"时间戳"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"开始和结束的时间戳"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Span关系"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"ChildOf","TextMarkTextContent":"父子关系"},{"Type":"NodeText","Data":"或"},{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"FollowsFrom","TextMarkTextContent":"顺序执行关系"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"附加信息"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"日志等"}]}]}]},{"ID":"20240322015222-enkr7f6","Type":"NodeParagraph","Properties":{"id":"20240322015222-enkr7f6","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"SpanContext：包含 TraceID，SpanID，ParentID 等信息，嵌套调用、跨进程调用时表示调用层级关系"}]},{"ID":"20240322015222-wl096lm","Type":"NodeParagraph","Properties":{"id":"20240322015222-wl096lm","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"Sampling：采样率，确定信息收集的精度（等级），平衡分析数据和吞吐量、延迟的关系，包括全采样、RateLimit采样、自适应采样等"}]},{"ID":"20240322015222-fy1o3bg","Type":"NodeParagraph","Properties":{"id":"20240322015222-fy1o3bg","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"以 Jaeger 为例，可以直接通过 Docker 镜像启动"}]},{"ID":"20240322015222-5vayaqm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240322015222-5vayaqm","updated":"20240322015222"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker run -d --name jaeger \\\n           -p 6831:6831/udp -p 16686:16686 -p 14268:14268 \\\n           jaegertracing/all-in-one:1.55\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240322015222-288vm0i","Type":"NodeList","ListData":{},"Properties":{"id":"20240322015222-288vm0i","updated":"20240322015222"},"Children":[{"ID":"20240322015222-ilhzavh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-ilhzavh","updated":"20240322015222"},"Children":[{"ID":"20240322015222-3wosyj6","Type":"NodeParagraph","Properties":{"id":"20240322015222-3wosyj6","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-d"},{"Type":"NodeText","Data":"​：后台运行"}]}]},{"ID":"20240322015222-jwif09x","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-jwif09x","updated":"20240322015222"},"Children":[{"ID":"20240322015222-8eauy97","Type":"NodeParagraph","Properties":{"id":"20240322015222-8eauy97","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-p"},{"Type":"NodeText","Data":"​：对外开放端口，6831 为 UDP 数据上报端口，16686 为后台数据展示服务端口，14268 表示通过 HTTP 上报 Trace 数据的端口"}]}]}]},{"ID":"20240322015222-27xceu6","Type":"NodeParagraph","Properties":{"id":"20240322015222-27xceu6","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"OpenTracing 中每个程序初始化一个 Tracer 实例，核心参数为："}]},{"ID":"20240322015222-auc1ahx","Type":"NodeList","ListData":{},"Properties":{"id":"20240322015222-auc1ahx","updated":"20240322015222"},"Children":[{"ID":"20240322015222-aedc8x7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-aedc8x7","updated":"20240322015222"},"Children":[{"ID":"20240322015222-dxq64ym","Type":"NodeParagraph","Properties":{"id":"20240322015222-dxq64ym","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"serviceName"},{"Type":"NodeText","Data":"​：应用名"}]}]},{"ID":"20240322015222-e7azfwm","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-e7azfwm","updated":"20240322015222"},"Children":[{"ID":"20240322015222-c8halch","Type":"NodeParagraph","Properties":{"id":"20240322015222-c8halch","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"reporter"},{"Type":"NodeText","Data":"​：调用 Span 后如何上传，常见有 HTTP，TCP，UDP"}]}]},{"ID":"20240322015222-e7csdmz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-e7csdmz","updated":"20240322015222"},"Children":[{"ID":"20240322015222-so32tyd","Type":"NodeParagraph","Properties":{"id":"20240322015222-so32tyd","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sampler"},{"Type":"NodeText","Data":"​：采样器，可指定全采样、固定频率采样等"}]}]}]},{"ID":"20240322015222-on6thm3","Type":"NodeParagraph","Properties":{"id":"20240322015222-on6thm3","style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"所需依赖："},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"io.jaegertracing:jaeger-client"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240322015222-gqbokni","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240322015222-gqbokni","updated":"20240322015222"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"private static Tracer tracer;\n\n// 初始化 Tracer\nRemoteReporter reporter = new RemoteReporter.Builder()\n        .withSender(new UdpSender(\"127.0.0.1\", 6831, 0))\n        .build();\ntracer = new JaegerTracer.Builder(\"my-service\")\n        .withReporter(reporter)\n        .withSampler(new ConstSampler(true))\n        .build();\nGlobalTracer.register(tracer);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240322015222-05pwqj2","Type":"NodeList","ListData":{},"Properties":{"id":"20240322015222-05pwqj2","updated":"20240322015222"},"Children":[{"ID":"20240322015222-j4ed9de","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-j4ed9de","updated":"20240322015222"},"Children":[{"ID":"20240322015222-rat0m9w","Type":"NodeParagraph","Properties":{"id":"20240322015222-rat0m9w","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"方法级跟踪实现：分布式跟踪的基本功能，通过对方法体内容增加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"try-finally"},{"Type":"NodeText","Data":"​ 块包裹，通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Span"},{"Type":"NodeText","Data":"​ 块分析。"}]},{"ID":"20240322015222-xvkqco7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240322015222-xvkqco7","updated":"20240322015222"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public void doDbOperation(String username) {\n    System.out.println(\"Save user \" + username);\n}\npublic void createUser(String username) {\n    Span span = tracer.buildSpan(\"createUser\").start();\n    try {\n        System.out.println(\"Save user \" + username);\n        doDbOperation(username);\n    } finally {\n        span.finish();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240322015222-utugg33","Type":"NodeParagraph","Properties":{"id":"20240322015222-utugg33","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240322005116-3rv3p4m.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240322015222-hdktfhv","Type":"NodeList","ListData":{},"Properties":{"id":"20240322015222-hdktfhv","updated":"20240322015222"},"Children":[{"ID":"20240322015222-w1t0wme","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-w1t0wme","updated":"20240322015222"},"Children":[{"ID":"20240322015222-obgkf7w","Type":"NodeParagraph","Properties":{"id":"20240322015222-obgkf7w","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"多函数调用链路跟踪实现：引入 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Scope"},{"Type":"NodeText","Data":"​ 类，将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Span"},{"Type":"NodeText","Data":"​ 放入 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ThreadLocal"},{"Type":"NodeText","Data":"​ 中，进行下一级 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Span"},{"Type":"NodeText","Data":"​ 时自动将上一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SpanContext"},{"Type":"NodeText","Data":"​ 作为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Parent"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240322015222-0z986eq","Type":"NodeSuperBlock","Properties":{"id":"20240322015222-0z986eq","updated":"20240322015222"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240322015222-2tlexp3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240322015222-2tlexp3","style":"width: 33%; flex: 0 0 auto;","updated":"20240322015222"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public void doDbOperation(String username) {\n    Span span = tracer.buildSpan(\"doDbOperation\").start();\n    try(Scope scope = tracer.scopeManager().activate(span)) {\n        System.out.println(\"Save user \" + username);\n    } finally {\n        span.finish();\n    }\n}\npublic void createUser(String username) {\n    Span span = tracer.buildSpan(\"createUser\").start();\n    try(Scope scope = tracer.scopeManager().activate(span)) {\n        System.out.println(\"Save user \" + username);\n        doDbOperation(username);\n    } finally {\n        span.finish();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240322015222-p29ktmm","Type":"NodeSuperBlock","Properties":{"id":"20240322015222-p29ktmm","updated":"20240322015222"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"row"},{"ID":"20240322015222-1y1tnx9","Type":"NodeParagraph","Properties":{"id":"20240322015222-1y1tnx9","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240322012054-44plipy.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240322015222-5gj1hhe","Type":"NodeParagraph","Properties":{"id":"20240322015222-5gj1hhe","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240322012116-kyn3zmh.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"Type":"NodeSuperBlockCloseMarker"}]}]},{"ID":"20240322015222-j35zk2g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-j35zk2g","updated":"20240322015222"},"Children":[{"ID":"20240322015222-v6c572w","Type":"NodeParagraph","Properties":{"id":"20240322015222-v6c572w","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"扩展进程调用链路跟踪：需要将 TraceID 与 SpanID 传递给下一层调用"}]},{"ID":"20240322015222-dlt1130","Type":"NodeList","ListData":{},"Properties":{"id":"20240322015222-dlt1130","updated":"20240322015222"},"Children":[{"ID":"20240322015222-ksn52mt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-ksn52mt","updated":"20240322015222"},"Children":[{"ID":"20240322015222-wxszos4","Type":"NodeParagraph","Properties":{"id":"20240322015222-wxszos4","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"发送：通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"X-B3-TraceId"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"X-B3-SpanId"},{"Type":"NodeText","Data":"​ 传递"}]},{"ID":"20240322015222-5dwj5rh","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240322015222-5dwj5rh","updated":"20240322015222"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public void sendHttp() throws Exception {\n    Tracer tracer = GlobalTracer.get();\n    Span span = tracer.buildSpan(\"sendHttp\").start();\n    try(Scope ignore = tracer.scopeManager().activate(span)) {\n        Request request = new Request.Builder()\n                .url(\"...\")\n                .addHeader(\"X-B3-TraceId\", span.context().toTraceId())\n                .addHeader(\"X-B3-SpanId\", span.context().toSpanId())\n                .addHeader(\"X-B3-Sampled\", \"1\")\n                .get().build();\n        // ...\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240322015222-8k1f5sr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240322015222-8k1f5sr","updated":"20240322015222"},"Children":[{"ID":"20240322015222-4v08bdn","Type":"NodeParagraph","Properties":{"id":"20240322015222-4v08bdn","updated":"20240322015222"},"Children":[{"Type":"NodeText","Data":"接收：使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"extract"},{"Type":"NodeText","Data":"​ 方法重建 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SpanContext"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240322015222-lcgqp63","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240322015222-lcgqp63","updated":"20240322015222"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"@RequestMapping(...)\npublic void accept(@RequestHeader(\"X-B3-TraceId\") Map\u003cString, String\u003e headers, HttpServletRequest request) {\n    Tracer tracer = GlobalTracer.get();\n    Tracer.SpanBuilder spanBuilder = tracer.buildSpan(\"HTTP Request\");\n    SpanContext context = tracer.extract(Format.Builtin.HTTP_HEADERS, new TextMapAdapter(headers));\n    if (context != null) {\n        spanBuilder.asChildOf(context);\n    }\n    Span span = spanBuilder.start();\n    try (Scope scope = tracer.scopeManager().activate(span)) {\n        // ...\n    } finally {\n        span.finish();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]}]}]},{"ID":"20240322015222-36c534b","Type":"NodeParagraph","Properties":{"id":"20240322015222-36c534b","updated":"20240322015222"}},{"ID":"20240322015222-bfqc6k3","Type":"NodeParagraph","Properties":{"id":"20240322015222-bfqc6k3","updated":"20240322015222"}}]}