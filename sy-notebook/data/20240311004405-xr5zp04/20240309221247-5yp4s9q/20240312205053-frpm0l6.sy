{"ID":"20240312205053-frpm0l6","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f630","id":"20240312205053-frpm0l6","title":"Java Instrumentation 原理","updated":"20240319000219"},"Children":[{"ID":"20240312205053-5sp3pfd","Type":"NodeParagraph","Properties":{"id":"20240312205053-5sp3pfd","updated":"20240318230134"},"Children":[{"Type":"NodeText","Data":"JDK 1.5 开始引入 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"java.lang.instrument"},{"Type":"NodeText","Data":"​，通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Instrumentation"},{"Type":"NodeText","Data":"​ 可以完成注册类文件转换器、获取所有类等，允许对类进行修改，实现 AOP、性能监控等。"}]},{"ID":"20240318222714-kfwwzej","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240318222714-kfwwzej","updated":"20240318234405"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public interface Instrumentation {\n    // 注入类文件转化器\n    // ClassFileTransformer#transform 返回 null 表示不转换\n    void addTransformer(ClassFileTransformer transformer, boolean canRetransform);\n    // 对已加载的类重新触发类加载\n    void retransformClasses(Class\u003c?\u003e... classes) throws UnmodifiableClassException;\n    // 当前 JVM 是否允许使用类重新转换\n    boolean isRedefineClassesSupported();\n    // 获取所有已加载类\n    Class[] getAllLoadedClasses();\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240318223305-4k50r18","Type":"NodeParagraph","Properties":{"id":"20240318223305-4k50r18","updated":"20240319000219"},"Children":[{"Type":"NodeText","Data":"Java Instrumentation 有两种注入方式："},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240318234508-m5o5r2q","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"Agent Jar 包"},{"Type":"NodeText","Data":"和 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240318234542-idmg08a","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"Attach API 远程加载"},{"Type":"NodeText","Data":" Agent Jar 包"}]},{"ID":"20240319000213-h7dl2tg","Type":"NodeParagraph","Properties":{"id":"20240319000213-h7dl2tg"}}]}