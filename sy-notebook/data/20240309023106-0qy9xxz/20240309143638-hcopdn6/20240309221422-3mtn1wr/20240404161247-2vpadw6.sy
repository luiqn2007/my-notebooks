{"ID":"20240404161247-2vpadw6","Spec":"1","Type":"NodeDocument","Properties":{"icon":"2615","id":"20240404161247-2vpadw6","tags":"Java21","title":"Virtual Threads 虚拟线程","type":"doc","updated":"20240404161328"},"Children":[{"ID":"20240404161302-ql17frp","Type":"NodeParagraph","Properties":{"id":"20240404161302-ql17frp","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"Loom 子项目，JEP444"}]},{"ID":"20240404161311-paqxvgw","Type":"NodeParagraph","Properties":{"id":"20240404161311-paqxvgw","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240404161317"},"Children":[{"Type":"NodeText","Data":"平台线程：运行于底层操作系统线程，并在代码整个生命周期捕获操作系统线程"}]},{"ID":"20240404161318-2puxphx","Type":"NodeParagraph","Properties":{"id":"20240404161318-2puxphx","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240404161328"},"Children":[{"Type":"NodeText","Data":"虚拟线程：运行于底层操作系统线程，但不会在整个生命周期捕获操作系统线程，因此多个虚拟线程可以共享一个平台线程"}]},{"ID":"20240404161302-77ew8qo","Type":"NodeParagraph","Properties":{"id":"20240404161302-77ew8qo","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"Virtual Thread，由 JVM 而非操作系统实现的轻量级线程，多虚拟线程共享一个线程"}]},{"ID":"20240404161302-qwdelra","Type":"NodeList","ListData":{},"Properties":{"id":"20240404161302-qwdelra","updated":"20240404161302"},"Children":[{"ID":"20240404161302-v1ww276","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-v1ww276","updated":"20240404161302"},"Children":[{"ID":"20240404161302-kve3f9v","Type":"NodeParagraph","Properties":{"id":"20240404161302-kve3f9v","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"避免上下文切换的额外开销"}]}]},{"ID":"20240404161302-amt40ha","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-amt40ha","updated":"20240404161302"},"Children":[{"ID":"20240404161302-h4phct0","Type":"NodeParagraph","Properties":{"id":"20240404161302-h4phct0","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"简化并发程序的复杂性"}]}]},{"ID":"20240404161302-86ruaj1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-86ruaj1","updated":"20240404161302"},"Children":[{"ID":"20240404161302-idwervo","Type":"NodeParagraph","Properties":{"id":"20240404161302-idwervo","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"可共享平台线程，因此可以产生远比普通线程更多的线程"}]}]}]},{"ID":"20240404161302-7d0wwy9","Type":"NodeParagraph","Properties":{"id":"20240404161302-7d0wwy9","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"虚拟线程可以通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Thread.ofVirtual().name(\u0026quot;name\u0026quot;).unstarted(runnable)"},{"Type":"NodeText","Data":"​ 创建，或通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Thread.startVirtualThread(runnable)"},{"Type":"NodeText","Data":"​ 快速创建并运行"}]},{"ID":"20240404161302-9ashu5g","Type":"NodeParagraph","Properties":{"id":"20240404161302-9ashu5g","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"虚拟线程创建后，对象类型仍为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Thread"},{"Type":"NodeText","Data":"​ 对象，其余 API 使用方法与普通线程类似"}]},{"ID":"20240404161302-tb0dbkk","Type":"NodeList","ListData":{},"Properties":{"id":"20240404161302-tb0dbkk","updated":"20240404161302"},"Children":[{"ID":"20240404161302-bry5830","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-bry5830","updated":"20240404161302"},"Children":[{"ID":"20240404161302-inwfv6v","Type":"NodeParagraph","Properties":{"id":"20240404161302-inwfv6v","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"isVirtual()"},{"Type":"NodeText","Data":"​：线程是否为虚拟线程"}]}]},{"ID":"20240404161302-31az4wg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-31az4wg","updated":"20240404161302"},"Children":[{"ID":"20240404161302-6rv9elv","Type":"NodeParagraph","Properties":{"id":"20240404161302-6rv9elv","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Executors.newVirtualThreadPerTaskExecutor()"},{"Type":"NodeText","Data":"​：创建一个线程池，线程池创建的线程都是虚拟线程"}]}]}]},{"ID":"20240404161302-udpqztc","Type":"NodeParagraph","Properties":{"id":"20240404161302-udpqztc","updated":"20240404161302"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意："}]},{"ID":"20240404161302-zsa4a2h","Type":"NodeList","ListData":{},"Properties":{"id":"20240404161302-zsa4a2h","updated":"20240404161302"},"Children":[{"ID":"20240404161302-kzdgq71","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-kzdgq71","updated":"20240404161302"},"Children":[{"ID":"20240404161302-3no5ibc","Type":"NodeParagraph","Properties":{"id":"20240404161302-3no5ibc","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"虚拟线程旨在增大系统并发量，对于高度依赖于 CPU 的工作并不会提升性能"}]}]},{"ID":"20240404161302-1pu2dsj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-1pu2dsj","updated":"20240404161302"},"Children":[{"ID":"20240404161302-t0oci6y","Type":"NodeParagraph","Properties":{"id":"20240404161302-t0oci6y","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"虚拟线程支持 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ThreadLocal"},{"Type":"NodeText","Data":"​，且虚拟线程之间，虚拟线程与平台线程之间的对象是互相隔离的"}]}]},{"ID":"20240404161302-f456ydk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-f456ydk","updated":"20240404161302"},"Children":[{"ID":"20240404161302-o7nv7l9","Type":"NodeParagraph","Properties":{"id":"20240404161302-o7nv7l9","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"虚拟线程不应池化，因为虚拟线程非常轻量"}]}]},{"ID":"20240404161302-5cmqgce","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240404161302-5cmqgce","updated":"20240404161302"},"Children":[{"ID":"20240404161302-6c9z5f3","Type":"NodeParagraph","Properties":{"id":"20240404161302-6c9z5f3","updated":"20240404161302"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"synchronized"},{"Type":"NodeText","Data":"​ 会使虚拟线程被固定在平台线程上，应使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ReentrantLock"},{"Type":"NodeText","Data":"​ 替换"}]}]}]}]}