{"ID":"20240428175831-rzbobke","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f980","id":"20240428175831-rzbobke","title":"Async","type":"doc","updated":"20240428204404"},"Children":[{"ID":"20240428175831-7b5gy72","Type":"NodeParagraph","Properties":{"id":"20240428175831-7b5gy72","updated":"20240428180506"},"Children":[{"Type":"NodeText","Data":"Async 模型是一种异步操作模型"}]},{"ID":"20240428175857-sw4ytbt","Type":"NodeParagraph","Properties":{"id":"20240428175857-sw4ytbt","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240428180301"},"Children":[{"Type":"NodeText","Data":"依赖：futures"}]},{"ID":"20240428182225-bhh5ifo","Type":"NodeParagraph","Properties":{"id":"20240428182225-bhh5ifo","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240428182230"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"async"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 与多线程并非二选一，只是一种风格。"}]},{"ID":"20240428175848-17exh96","Type":"NodeParagraph","Properties":{"id":"20240428175848-17exh96","updated":"20240428185333"},"Children":[{"Type":"NodeText","Data":"在函数前面添加 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"async"},{"Type":"NodeText","Data":"​ 修饰，表示该函数是一个异步函数。此时函数的返回值隐式为 "},{"Type":"NodeTextMark","TextMarkType":"code block-ref","TextMarkBlockRefID":"20240428185309-9ghprnc","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"Future"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240428203251-k70ug8g","Type":"NodeParagraph","Properties":{"id":"20240428203251-k70ug8g","style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);","updated":"20240428203335"},"Children":[{"Type":"NodeText","Data":"在一个代码块前加 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"async"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​ 表示一个异步表达式，类似闭包，也支持 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);"},"TextMarkType":"code","TextMarkTextContent":"async move"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240428180112-w3e908y","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240428180112-w3e908y","updated":"20240428180229"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"async fn downloads() {\n    let future_one = download_async(\"...\");\n    let future_two = download_async(\"...\");\n    // 等待两个任务完成\n    join!(future_one, future_two);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240428184250-7t93l80","Type":"NodeParagraph","Properties":{"id":"20240428184250-7t93l80","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240428192428"},"Children":[{"Type":"NodeText","Data":"运行时，"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"block-ref","TextMarkBlockRefID":"20240428192342-x3uq819","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"执行器"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"会通过 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"Future::poll()"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 轮询任务是否执行完成"}]},{"ID":"20240428180401-c7r3eoz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240428180401-c7r3eoz","updated":"20240428180513"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"use futures::executor::block_on;\n\nasync fn downloads() { ... }\n\nfn main() {\n    let future = downloads();\n    // 阻塞运行直到任务完成\n    block_on(future);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240428182732-qkluh3c","Type":"NodeParagraph","Properties":{"id":"20240428182732-qkluh3c","updated":"20240428184249"},"Children":[{"Type":"NodeText","Data":"在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"async"},{"Type":"NodeText","Data":"​ 方法中通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".await"},{"Type":"NodeText","Data":"​，可以等待另一个异步方法完成。"}]},{"ID":"20240428184108-k9r44l9","Type":"NodeParagraph","Properties":{"id":"20240428184108-k9r44l9","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240428184119"},"Children":[{"Type":"NodeText","Data":"等待异步任务完成时，线程并非阻塞，而是在异步等待状态，还是可以执行其他 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"future"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 达到并发效果的"}]},{"ID":"20240428183118-su1obf9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240428183118-su1obf9","updated":"20240428184134"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"async fn hello_world() {\n    println!(\"hello world\";\n}\n\nasync fn hello_kitty() {\n    hello_world().await;\n    println!(\"hello kitty\");\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240428183715-lc87owa","Type":"NodeParagraph","Properties":{"id":"20240428183715-lc87owa","updated":"20240428203839"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"join!"},{"Type":"NodeText","Data":"​ 宏可以异步的等待多个任务完成；如果多个任务在一个数组中，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"futures::future::join_all"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240428203934-kuo3atj","Type":"NodeList","ListData":{},"Properties":{"id":"20240428203934-kuo3atj","updated":"20240428204016"},"Children":[{"ID":"20240428203936-h4d1ejo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240428203936-h4d1ejo","updated":"20240428204016"},"Children":[{"ID":"20240428203936-pjdx47j","Type":"NodeParagraph","Properties":{"id":"20240428203936-pjdx47j","updated":"20240428204016"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"try_join!"},{"Type":"NodeText","Data":"​ 返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Result"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240428203643-2hgwwns","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240428203643-2hgwwns","updated":"20240428203857"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"async fn enjoy_book_and_music() -\u003e (Book, Music) {\n    let book = enjoy_book();\n    let music = enjoy_music();\n    // join_all([book, music])\n    join!(book, music)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240428204017-ndhjj8z","Type":"NodeParagraph","Properties":{"id":"20240428204017-ndhjj8z","updated":"20240428204242"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select!"},{"Type":"NodeText","Data":"​ 宏表示当有任意一个任务完成时，执行其处理器"}]},{"ID":"20240428204242-wd0163d","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240428204242-wd0163d","updated":"20240428204404"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"async fn enjoy_book_and_music() {\n    let book = enjoy_book().fuse();\n    let music = enjoy_music().fuse();\n    pin_mut!(book, music)\n    select! {\n        () = t1 =\u003e println!(\"enjoy_book ok\"),\n        () = t2 =\u003e println!(\"enjoy_music ok\"),\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240428204322-apomzzw","Type":"NodeParagraph","Properties":{"id":"20240428204322-apomzzw"}}]}