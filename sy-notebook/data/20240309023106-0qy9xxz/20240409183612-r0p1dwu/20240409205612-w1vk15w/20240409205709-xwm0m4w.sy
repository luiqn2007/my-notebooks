{"ID":"20240409205709-xwm0m4w","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f980","id":"20240409205709-xwm0m4w","title":"所有权转移","type":"doc","updated":"20240409205753"},"Children":[{"ID":"20240409205709-80337v6","Type":"NodeParagraph","Properties":{"id":"20240409205709-80337v6","updated":"20240409205726"},"Children":[{"Type":"NodeText","Data":"所有权转移通常有以下情况："}]},{"ID":"20240409205726-21fcggt","Type":"NodeList","ListData":{},"Properties":{"id":"20240409205726-21fcggt","updated":"20240409205753"},"Children":[{"ID":"20240409205727-9gyqfkt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240409205727-9gyqfkt","updated":"20240409205727"},"Children":[{"ID":"20240409205727-hqbggjb","Type":"NodeParagraph","Properties":{"id":"20240409205727-hqbggjb","updated":"20240409205727"},"Children":[{"Type":"NodeText","Data":"作用域传递"}]},{"ID":"20240409205736-bqa8j21","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240409205736-bqa8j21","updated":"20240409205737"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"fn main() {\n    let x = 5; // x 进入作用域\n    makes_copy(x); // 由于 i32 实现了 Copy，因此 x 复制到了方法中\n    println!(\"{}\", x); // x 原始变量仍有效\n\n    let s = String::from(\"hello\"); // s 进入作用域\n    takes_ownership(s); // 由于 String 未实现 Copy，因此 String 传递到了方法中\n  \n    // let s = String::from(\"hello\");\n    //     - move occurs because `s` has type `String`, which does not implement the `Copy` trait\n    // takes_ownership(s);\n    //                 - value moved here\n    // println!(\"{}\", s);\n    //                ^ value borrowed here after move\n    // println!(\"{}\", s); // 由于 s 在 takes_ownership 方法中已经释放，这里不再有效\n}\n\nfn takes_ownership(str: String) { // str 进入作用域\n    println!(\"{}\", str);\n} // str 离开所用域，并使用 drop 方法释放内存\n\nfn makes_copy(a: i32) {\n    println!(\"{}\", a);\n} // i32 类型实现了 Copy，因此不会有特殊操作\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240409205731-0o4l00m","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240409205731-0o4l00m","updated":"20240409205753"},"Children":[{"ID":"20240409205731-x1984mx","Type":"NodeParagraph","Properties":{"id":"20240409205731-x1984mx","updated":"20240409205747"},"Children":[{"Type":"NodeText","Data":"返回值转移："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"return"},{"Type":"NodeText","Data":"​ 用于转移所有权"}]},{"ID":"20240409205749-3ycsyh4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240409205749-3ycsyh4","updated":"20240409205753"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"fn main() {\n    let s1 = gives_ownership(); // gives_ownership 通过 return 将 some_string 的所有权转移给 s1\n    let s2 = String::from(\"hello\"); // s2 进入作用域\n    let s3 = takes_and_gives_back(s2); // s2 移动到 takes_and_gives_back 中，takes_and_gives_back 将返回值再次转移给 s3\n\n    println!(\"{}\", s1); // hello\n    // let s2 = String::from(\"hello\");\n    //     -- move occurs because `s2` has type `String`, which does not implement the `Copy` trait\n    // let s3 = takes_and_gives_back(s2);\n    //                               -- value moved here\n    // ...\n    // println!(\"{}\", s2);\n    //                ^^ value borrowed here after move\n    // println!(\"{}\", s2);\n    println!(\"{}\", s3); // hello\n} // s1 和 s3 通过 drop 释放，s2 已被释放无事发生\n\nfn gives_ownership() -\u003e String {\n    let some_string = String::from(\"hello\"); // some_string 进入作用域\n    some_string // return 将 some_string 作用域移交给函数调用者\n}\n\nfn takes_and_gives_back(str: String) -\u003e String {\n    str // return 将 str 作用域移交给函数调用者\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]}]}