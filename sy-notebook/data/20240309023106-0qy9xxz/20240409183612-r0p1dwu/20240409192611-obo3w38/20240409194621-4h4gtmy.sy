{"ID":"20240409194621-4h4gtmy","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f980","id":"20240409194621-4h4gtmy","title":"动态大小类型","type":"doc","updated":"20240409194821"},"Children":[{"ID":"20240409194631-0v85dz6","Type":"NodeParagraph","Properties":{"id":"20240409194631-0v85dz6","updated":"20240409194654"},"Children":[{"Type":"NodeTextMark","TextMarkType":"inline-memo","TextMarkInlineMemoContent":"dynamically sized types, DST 或 unsized type","TextMarkTextContent":"动态大小类型"},{"Type":"NodeText","Data":"需要根据实际的值确定内存大小的类型，在声明时无法确定需要的内存占用。这类类型允许我们处理只有在运行时才知道大小的类型。"}]},{"ID":"20240409194631-1ujvizk","Type":"NodeParagraph","Properties":{"id":"20240409194631-1ujvizk","updated":"20240409194707"},"Children":[{"Type":"NodeText","Data":"动态大小类型的一个规则是，必须将动态大小类型的值置于某种指针之后，他们有一些额外的元信息来存储动态信息大小。"}]},{"ID":"20240409194631-5jiq1f3","Type":"NodeParagraph","Properties":{"id":"20240409194631-5jiq1f3","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240409194753"},"Children":[{"Type":"NodeText","Data":"一个很常见的动态大小类型为字符串 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"str"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​。当我们直接使用字符串字面量时获得的是一个 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"\u0026amp;str"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 类型值，这个指针不同于普通指针，他存储了 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"str"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 值指向的内存和大小。"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"str"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 可以直接与 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"Box\u0026lt;T\u0026gt;"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"Rc\u0026lt;T\u0026gt;"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 等智能指针结合。"}]},{"ID":"20240409194631-ei8d8t7","Type":"NodeParagraph","Properties":{"id":"20240409194631-ei8d8t7","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240409194821"},"Children":[{"Type":"NodeText","Data":"另一个常用的 DST 是 trait。使用 trait 对象时可使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"dyn"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 之后，如 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"\u0026amp;dyn Trait"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);"},"TextMarkType":"code","TextMarkTextContent":"Box\u0026lt;dyn Trait\u0026gt;"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);\"}"},{"Type":"NodeText","Data":"​ 等。"}]},{"ID":"20240409194631-madbwrf","Type":"NodeParagraph","Properties":{"id":"20240409194631-madbwrf","updated":"20240409194631"},"Children":[{"Type":"NodeText","Data":"为了处理 DST，Rust 提供了一个特殊的 trait - "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Sized"},{"Type":"NodeText","Data":"​，该 trait 为编译器提供了一个编译时获取类型大小的实现。另外 Rust 隐式为每个泛型增加了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Sized"},{"Type":"NodeText","Data":"​ bound。"}]},{"ID":"20240409194631-y38ww08","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240409194631-y38ww08","updated":"20240409194631"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"fn generic\u003cT\u003e(t: T) {}\n\n// 等同于\n\nfn generic2\u003cT: Sized\u003e(t: T) {}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240409194631-31zlcvc","Type":"NodeParagraph","Properties":{"id":"20240409194631-31zlcvc","updated":"20240409194631"},"Children":[{"Type":"NodeText","Data":"可使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"?"},{"Type":"NodeText","Data":"​ 移除该 trait"}]},{"ID":"20240409194631-2m9m704","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240409194631-2m9m704","updated":"20240409194631"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"fn generic\u003cT: ?Sized\u003e(t: \u0026T) {}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240409194631-2w30pi4","Type":"NodeParagraph","Properties":{"id":"20240409194631-2w30pi4","updated":"20240409194631"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"?Sized"},{"Type":"NodeText","Data":"​ 表示 T 可能不是 Sized，但由于 DST 只能在某个指针之后使用，因此参数中使用了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026amp;T"},{"Type":"NodeText","Data":"​。"}]}]}