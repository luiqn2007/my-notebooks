{"ID":"20240409190317-hhuz2yl","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f980","id":"20240409190317-hhuz2yl","title":"闭包","type":"doc","updated":"20240428164720"},"Children":[{"ID":"20240409190326-euhy2ba","Type":"NodeParagraph","Properties":{"id":"20240409190326-euhy2ba","updated":"20240427183726"},"Children":[{"Type":"NodeText","Data":"闭包，或称为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lambda"},{"Type":"NodeText","Data":"​ 表达式，是可以以变量或参数形式存在的匿名"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240409190114-dcvb75u","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"函数"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240427183728-t2d4eqc","Type":"NodeParagraph","Properties":{"id":"20240427183728-t2d4eqc","updated":"20240427183746"},"Children":[{"Type":"NodeText","Data":"闭包使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"||"},{"Type":"NodeText","Data":"​ 声明参数，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-\u0026gt;"},{"Type":"NodeText","Data":"​ 声明返回值，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"{}"},{"Type":"NodeText","Data":"​ 声明函数体。以下是写法及几种简写"}]},{"ID":"20240409190326-c06s70f","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240409190326-c06s70f","updated":"20240428164048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"fn add_one(x: u32) -\u003e u32 { x+1 }\n\nfn main() {\n    let add_one_v1 = |x: u32| -\u003e u32 { x+1 };\n    // 参数和返回值类型可省略，编译器根据调用时的参数自动推断\n    let add_one_v2 = |x| { x + 1 };\n    // 闭包只有一行，大括号也可以省略了\n    let add_one_v3 = |x| x+1;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240428164054-w2mmhgq","Type":"NodeParagraph","Properties":{"id":"20240428164054-w2mmhgq","style":"color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);","updated":"20240428164112"},"Children":[{"Type":"NodeText","Data":"注意：闭包推断不是泛型，当编译器推导出一种类型后，它就会一直使用该类型"}]},{"ID":"20240409190326-d71r7u2","Type":"NodeParagraph","Properties":{"id":"20240409190326-d71r7u2","updated":"20240409190326"},"Children":[{"Type":"NodeText","Data":"根据捕获外部环境值的方法，闭包实现了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Fn"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FnMut"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FnOnce"},{"Type":"NodeText","Data":"​ 中的一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"trait"},{"Type":"NodeText","Data":"​，完整类型可能是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Fn(i32)"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Fn(i32) -\u0026gt; i32"},{"Type":"NodeText","Data":"​ 等形式"}]},{"ID":"20240409190326-0s34279","Type":"NodeList","ListData":{},"Properties":{"id":"20240409190326-0s34279","updated":"20240428164434"},"Children":[{"ID":"20240409190326-vo55elj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240409190326-vo55elj","updated":"20240428164434"},"Children":[{"ID":"20240409190326-y7hohb3","Type":"NodeParagraph","Properties":{"id":"20240409190326-y7hohb3","updated":"20240428164434"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FnOnce"},{"Type":"NodeText","Data":"​: 闭包从周围作用域捕获变量并获取其所有权，且只能执行一次"}]}]},{"ID":"20240409190326-si7v1a3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240409190326-si7v1a3","updated":"20240409190326"},"Children":[{"ID":"20240409190326-5yhzwft","Type":"NodeParagraph","Properties":{"id":"20240409190326-5yhzwft","updated":"20240409190326"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FnMut"},{"Type":"NodeText","Data":"​: 闭包从周围作用域获取可变引用"}]}]},{"ID":"20240409190326-x455lmo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240409190326-x455lmo","updated":"20240409190326"},"Children":[{"ID":"20240409190326-l6vga3a","Type":"NodeParagraph","Properties":{"id":"20240409190326-l6vga3a","updated":"20240409190326"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Fn"},{"Type":"NodeText","Data":"​: 闭包从周围作用域获取不可变引用"}]}]}]},{"ID":"20240409190522-g3sy1e7","Type":"NodeSuperBlock","Properties":{"id":"20240409190522-g3sy1e7","updated":"20240409190523"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240409190326-nmm067q","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240409190326-nmm067q","updated":"20240409190523"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"struct Cached\u003cT\u003e where T: Fn(u32) -\u003e u32 {\n    calculation: T,\n    value: Option\u003cu32\u003e\n}\n\nimpl\u003cT\u003e Cached\u003cT\u003e where T: Fn(u32) -\u003e u32 {\n\n    fn new (calculation: T) -\u003e Cached\u003cT\u003e {\n        Cached {\n            calculation,\n            value: None\n        }\n    }\n\n    fn value(\u0026mut self, arg: u32) -\u003e u32 {\n        match self.value {\n            Some(v) =\u003e v,\n            None =\u003e {\n                let v = (self.calculation)(arg);\n                self.value = Some(v);\n                v\n            }\n        }\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240409190518-jqu9u56","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240409190518-jqu9u56","updated":"20240409190523"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"fn main() {\n    let f = |x| {\n        println!(\"Called with {}\", x);\n        x+1\n    };\n    let mut cached = Cached::new(f);\n    // Called with 5\n    // 6\n    println!(\"{}\", cached.value(5));\n    // 6\n    println!(\"{}\", cached.value(5));\n    // 6\n    println!(\"{}\", cached.value(5));\n    // 6\n    println!(\"{}\", cached.value(5));\n    // 6\n    println!(\"{}\", cached.value(5));\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]},{"ID":"20240428164500-d7svydc","Type":"NodeParagraph","Properties":{"id":"20240428164500-d7svydc","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240428164626"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"Fn"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"FnMut"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 可以使用 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);"},"TextMarkType":"code","TextMarkTextContent":"move"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);\"}"},{"Type":"NodeText","Data":"​ 强制要求转移捕获参数的所有权"}]},{"ID":"20240428164712-ksuj7ry","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240428164712-ksuj7ry","updated":"20240428164719"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cnVzdA=="},{"Type":"NodeCodeBlockCode","Data":"let s = String::new();\nlet update_string = move || println!(\"{}\", s);\nupdate_string();\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240428164720-dois9wv","Type":"NodeParagraph","Properties":{"id":"20240428164720-dois9wv"}}]}