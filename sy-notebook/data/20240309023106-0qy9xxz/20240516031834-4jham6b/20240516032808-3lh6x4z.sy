{"ID":"20240516032808-3lh6x4z","Spec":"1","Type":"NodeDocument","Properties":{"icon":"sql.png","id":"20240516032808-3lh6x4z","title":"事务","type":"doc","updated":"20240516032818"},"Children":[{"ID":"20240516032814-89lllwq","Type":"NodeParagraph","Properties":{"id":"20240516032814-89lllwq","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240516032818"},"Children":[{"Type":"NodeText","Data":"事务：向数据库同时提交或撤销的一组操作的集合。事务请求所包含的所有操作要么全部成功，要么全部失败"}]},{"ID":"20240516032814-h8fdxnv","Type":"NodeParagraph","Properties":{"id":"20240516032814-h8fdxnv","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"一般来说，一条 SQL 就是一个事务，事务自动提交。"}]},{"ID":"20240516032814-rb96qmp","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240516032814-rb96qmp","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"操作"}]},{"ID":"20240516032814-zg8nt88","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240516032814-zg8nt88","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"提交方式"}]},{"ID":"20240516032814-cr79fgy","Type":"NodeParagraph","Properties":{"id":"20240516032814-cr79fgy","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"设置提交方式仅对当前会话有效"}]},{"ID":"20240516032814-2j81mpl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240516032814-2j81mpl","updated":"20240516032814"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c3Fs"},{"Type":"NodeCodeBlockCode","Data":"-- 查看事务提交方式\n--   1 自动提交\n--   0 手动提交\nselect @@autocommit;\n\n-- 设置手动提交\nset @@autocommit = 0;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240516032814-ymek4dx","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240516032814-ymek4dx","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"提交/回滚"}]},{"ID":"20240516032814-zvju212","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240516032814-zvju212","updated":"20240516032814"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c3Fs"},{"Type":"NodeCodeBlockCode","Data":"-- 提交事务\ncommit;\n-- 回滚事务\nrollback;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240516032814-cxrcbx4","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240516032814-cxrcbx4","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"开启事务"}]},{"ID":"20240516032814-zbcm3po","Type":"NodeParagraph","Properties":{"id":"20240516032814-zbcm3po","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"在不修改会话事务提交方式的情况下，可以通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"start transaction"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"begin"},{"Type":"NodeText","Data":"​ 手动开启一个事务"}]},{"ID":"20240516032814-dwbwhj3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240516032814-dwbwhj3","updated":"20240516032814"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c3Fs"},{"Type":"NodeCodeBlockCode","Data":"-- 开启事务\n-- 或 begin;\nstart transaction;\n\n-- 执行 SQL 语句\n\n-- 提交\ncommit;\n-- 回滚\nrollback;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240516032814-p9bcbfe","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240516032814-p9bcbfe","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"特性"}]},{"ID":"20240516032814-ounbzyg","Type":"NodeParagraph","Properties":{"id":"20240516032814-ounbzyg","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"ACID"}]},{"ID":"20240516032814-uouuzfo","Type":"NodeList","ListData":{},"Properties":{"id":"20240516032814-uouuzfo","updated":"20240516032814"},"Children":[{"ID":"20240516032814-kebvmsp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-kebvmsp","updated":"20240516032814"},"Children":[{"ID":"20240516032814-g04dxjn","Type":"NodeParagraph","Properties":{"id":"20240516032814-g04dxjn","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"原子性："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"A"},{"Type":"NodeText","Data":"tomicity，在一次任务中，事务不可再次分割，要么全部成功，要么全部失败"}]}]},{"ID":"20240516032814-qq2bflq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-qq2bflq","updated":"20240516032814"},"Children":[{"ID":"20240516032814-8knu2ew","Type":"NodeParagraph","Properties":{"id":"20240516032814-8knu2ew","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"一致性："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"C"},{"Type":"NodeText","Data":"onsistency，事务完成时，所有数据必须保持一致状态"}]}]},{"ID":"20240516032814-7lgome7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-7lgome7","updated":"20240516032814"},"Children":[{"ID":"20240516032814-b0opum8","Type":"NodeParagraph","Properties":{"id":"20240516032814-b0opum8","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"隔离性："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"I"},{"Type":"NodeText","Data":"solation，数据库系统提供隔离机制，保证事务在不受外部并发操作影响的独立环境下运行"}]}]},{"ID":"20240516032814-hhflpde","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-hhflpde","updated":"20240516032814"},"Children":[{"ID":"20240516032814-hdnon2f","Type":"NodeParagraph","Properties":{"id":"20240516032814-hdnon2f","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"持久性："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"D"},{"Type":"NodeText","Data":"urability，事务一旦提交或回滚，其对数据库数据的改变是永久的"}]}]}]},{"ID":"20240516032814-32lxdtg","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240516032814-32lxdtg","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"并发"}]},{"ID":"20240516032814-thqivka","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240516032814-thqivka","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"并发问题"}]},{"ID":"20240516032814-cpkclrb","Type":"NodeList","ListData":{},"Properties":{"id":"20240516032814-cpkclrb","updated":"20240516032814"},"Children":[{"ID":"20240516032814-rs88tue","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-rs88tue","updated":"20240516032814"},"Children":[{"ID":"20240516032814-33fmx33","Type":"NodeParagraph","Properties":{"id":"20240516032814-33fmx33","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"脏读：一个事务读到另一个事务尚未提交的数据"}]}]},{"ID":"20240516032814-c7nk8vl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-c7nk8vl","updated":"20240516032814"},"Children":[{"ID":"20240516032814-relefxt","Type":"NodeParagraph","Properties":{"id":"20240516032814-relefxt","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"不可重复读：一个事务先后读取同一条记录，但两次数据不同"}]}]},{"ID":"20240516032814-zoe3thr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-zoe3thr","updated":"20240516032814"},"Children":[{"ID":"20240516032814-u5j2iug","Type":"NodeParagraph","Properties":{"id":"20240516032814-u5j2iug","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"幻读：一个事务按条件查询数据时，没有对应的数据行，但插入数据时，该行数据却已经存在"}]}]}]},{"ID":"20240516032814-p71tneg","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240516032814-p71tneg","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"隔离级别"}]},{"ID":"20240516032814-i9zws16","Type":"NodeParagraph","Properties":{"id":"20240516032814-i9zws16","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"不同事务操作隔离级别不同，以解决不同问题"}]},{"ID":"20240516032814-caa3ncx","Type":"NodeList","ListData":{},"Properties":{"id":"20240516032814-caa3ncx","updated":"20240516032814"},"Children":[{"ID":"20240516032814-q8y5np0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-q8y5np0","updated":"20240516032814"},"Children":[{"ID":"20240516032814-9v3lyfr","Type":"NodeParagraph","Properties":{"id":"20240516032814-9v3lyfr","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"Read uncommitted：读未提交"}]},{"ID":"20240516032814-7s2jqi1","Type":"NodeList","ListData":{},"Properties":{"id":"20240516032814-7s2jqi1","updated":"20240516032814"},"Children":[{"ID":"20240516032814-4t2gfns","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-4t2gfns","updated":"20240516032814"},"Children":[{"ID":"20240516032814-zb5jpbk","Type":"NodeParagraph","Properties":{"id":"20240516032814-zb5jpbk","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"可能出现脏读，不可重复读，幻读"}]}]}]}]},{"ID":"20240516032814-u9rdlgh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-u9rdlgh","updated":"20240516032814"},"Children":[{"ID":"20240516032814-h8kk7ey","Type":"NodeParagraph","Properties":{"id":"20240516032814-h8kk7ey","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"Read committed：Oracle 等默认，读已提交"}]},{"ID":"20240516032814-xbpql5j","Type":"NodeList","ListData":{},"Properties":{"id":"20240516032814-xbpql5j","updated":"20240516032814"},"Children":[{"ID":"20240516032814-733gbff","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-733gbff","updated":"20240516032814"},"Children":[{"ID":"20240516032814-4md5izs","Type":"NodeParagraph","Properties":{"id":"20240516032814-4md5izs","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"可能出现不可重复读，幻读"}]}]}]}]},{"ID":"20240516032814-h5lqbix","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-h5lqbix","updated":"20240516032814"},"Children":[{"ID":"20240516032814-f5bf4ll","Type":"NodeParagraph","Properties":{"id":"20240516032814-f5bf4ll","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"Repeatable Read：MySQL 默认"}]},{"ID":"20240516032814-s2bybmx","Type":"NodeList","ListData":{},"Properties":{"id":"20240516032814-s2bybmx","updated":"20240516032814"},"Children":[{"ID":"20240516032814-3k2vhyn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-3k2vhyn","updated":"20240516032814"},"Children":[{"ID":"20240516032814-7qt9oxu","Type":"NodeParagraph","Properties":{"id":"20240516032814-7qt9oxu","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"可能出现幻读"}]}]}]}]},{"ID":"20240516032814-gsr4oj3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240516032814-gsr4oj3","updated":"20240516032814"},"Children":[{"ID":"20240516032814-e4b8yz2","Type":"NodeParagraph","Properties":{"id":"20240516032814-e4b8yz2","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"Serializable：串行化，解决所有问题"}]}]}]},{"ID":"20240516032814-ic5k9ld","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240516032814-ic5k9ld","updated":"20240516032814"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c3Fs"},{"Type":"NodeCodeBlockCode","Data":"-- 查看当前事务隔离级别\nselect @@transaction_isolation;\n\n-- 设置事务隔离级别\n--   session: 仅对当前会话有效\n--   global：对全局有效\nset [session | global] tansaction isolation level 隔离级别;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240516032814-i4rex16","Type":"NodeParagraph","Properties":{"id":"20240516032814-i4rex16","updated":"20240516032814"},"Children":[{"Type":"NodeText","Data":"事务隔离级别越高，数据越安全，但性能越低（串行化已经无法并行提交了）"}]}]}