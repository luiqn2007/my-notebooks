{"ID":"20240321084309-qonr74s","Spec":"1","Type":"NodeDocument","Properties":{"icon":"jclasslib256x256.png","id":"20240321084309-qonr74s","title":"JNI 隐藏核心逻辑","type":"doc","updated":"20240321091405"},"Children":[{"ID":"20240321084520-sapzk6m","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240321084520-sapzk6m","updated":"20240321091405"},"Children":[{"ID":"20240321084521-320e03r","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240321084521-320e03r","updated":"20240321084521"},"Children":[{"ID":"20240321084521-4y5kb3b","Type":"NodeParagraph","Properties":{"id":"20240321084521-4y5kb3b","updated":"20240321091059"},"Children":[{"Type":"NodeText","Data":"将核心代码使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"native"},{"Type":"NodeText","Data":"​修饰。这里是 ClassLoader 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"decryptJni"},{"Type":"NodeText","Data":"​ 方法"}]},{"ID":"20240321084633-h7ire9x","Type":"NodeSuperBlock","Properties":{"id":"20240321084633-h7ire9x"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240321084309-o8o0y2j","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240321084309-o8o0y2j","updated":"20240321091035"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class MyCustomClassLoader extends ClassLoader {\n\n    @Override\n    protected Class\u003c?\u003e findClass(String name) throws ClassNotFoundException {\n        byte[] bytes = new byte[0];\n        try {\n            bytes = decryptJni(name, Files.readAllBytes(Path.of(name + \".class\")));\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n        return defineClass(name, bytes, 0, bytes.length);\n    }\n\n    public static native byte[] decryptJni(String name, byte[] bytes);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240321084628-j4py552","Type":"NodeParagraph","Properties":{"id":"20240321084628-j4py552"}},{"Type":"NodeSuperBlockCloseMarker"}]}]},{"ID":"20240321084623-gn6jvmy","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240321084623-gn6jvmy"},"Children":[{"ID":"20240321084623-hi6bq5z","Type":"NodeParagraph","Properties":{"id":"20240321084623-hi6bq5z","updated":"20240321085131"},"Children":[{"Type":"NodeText","Data":"执行 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"javah"},{"Type":"NodeText","Data":"​ 生成方法定义头文件，新版本使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"javac -h"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240321084716-c2vmlhr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240321084716-c2vmlhr","updated":"20240321090109"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"javah -cp . -jni -o customloader.h org.example.classloader.MyCustomClassLoader\njavac -h . ./org/example/classloader/MyCustomClassLoader.java\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240321084625-l97rqks","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240321084625-l97rqks"},"Children":[{"ID":"20240321084625-sfld1b1","Type":"NodeParagraph","Properties":{"id":"20240321084625-sfld1b1","updated":"20240321091238"},"Children":[{"Type":"NodeText","Data":"创建对应 C++ 文件，引入生成的头文件并实现，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"jni.h"},{"Type":"NodeText","Data":"​ 头文件在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$JAVA_HOME$/include"},{"Type":"NodeText","Data":"​ 下，编译"}]}]},{"ID":"20240321091238-xq8sukm","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240321091238-xq8sukm","updated":"20240321091405"},"Children":[{"ID":"20240321091238-f90cnxu","Type":"NodeParagraph","Properties":{"id":"20240321091238-f90cnxu","updated":"20240321091312"},"Children":[{"Type":"NodeText","Data":"在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MyCustomClassLoader"},{"Type":"NodeText","Data":"​ 中加载对应的依赖"}]},{"ID":"20240321091313-uogj6bi","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240321091313-uogj6bi","updated":"20240321091405"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"public class MyCustomClassLoader extends ClassLoader {\n\n    static {\n        System.loadLibrary(\"生成文件路径\");\n    }\n  \n    // ...\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]}]}