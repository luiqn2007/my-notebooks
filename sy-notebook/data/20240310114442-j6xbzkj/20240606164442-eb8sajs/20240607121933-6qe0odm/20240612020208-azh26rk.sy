{"ID":"20240612020208-azh26rk","Spec":"1","Type":"NodeDocument","Properties":{"icon":"docker.png","id":"20240612020208-azh26rk","title":"服务管理","type":"doc","updated":"20240612022558"},"Children":[{"ID":"20240612020208-9thtm0f","Type":"NodeParagraph","Properties":{"id":"20240612020208-9thtm0f","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240612020314"},"Children":[{"Type":"NodeText","Data":"集群服务管理仅在管理节点执行"}]},{"ID":"20240612020434-wifp4s5","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240612020434-wifp4s5","updated":"20240612022558"},"Children":[{"Type":"NodeText","Data":"创建与删除"}]},{"ID":"20240612020316-4dm4uoa","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240612020316-4dm4uoa","updated":"20240612020439"},"Children":[{"ID":"20240612020439-ltuh3pv","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240612020439-ltuh3pv","updated":"20240612020439"},"Children":[{"ID":"20240612020439-8i6ucnt","Type":"NodeParagraph","Properties":{"id":"20240612020439-8i6ucnt","updated":"20240612020439"},"Children":[{"Type":"NodeText","Data":"创建一个服务，该服务会由管理器随机分配到某个工作节点部署启动"}]},{"ID":"20240612020448-cdz95co","Type":"NodeParagraph","Properties":{"id":"20240612020448-cdz95co","updated":"20240612020529"},"Children":[{"Type":"NodeText","Data":"创建名为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"mynginx"},{"Type":"NodeText","Data":"​，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nginx"},{"Type":"NodeText","Data":"​ 镜像的服务（镜像）"}]},{"ID":"20240612020408-2gkm8os","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240612020408-2gkm8os","updated":"20240612020510"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker service create --replicas 1 --name mynginx -p 80:80 nginx:latest\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240612020442-0c2k01i","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240612020442-0c2k01i"},"Children":[{"ID":"20240612020442-vwt8shb","Type":"NodeParagraph","Properties":{"id":"20240612020442-vwt8shb","updated":"20240612020552"},"Children":[{"Type":"NodeText","Data":"查看服务运行信息"}]},{"ID":"20240612020552-0idms3s","Type":"NodeList","ListData":{},"Properties":{"id":"20240612020552-0idms3s","updated":"20240612020555"},"Children":[{"ID":"20240612020555-11vsgc2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240612020555-11vsgc2","updated":"20240612020555"},"Children":[{"ID":"20240612020555-l7ltlkd","Type":"NodeParagraph","Properties":{"id":"20240612020555-l7ltlkd","updated":"20240612020629"},"Children":[{"Type":"NodeText","Data":"查看运行的服务："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker service ls"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240612020559-2hiwssz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240612020559-2hiwssz"},"Children":[{"ID":"20240612020559-v1s4jrm","Type":"NodeParagraph","Properties":{"id":"20240612020559-v1s4jrm","updated":"20240612020705"},"Children":[{"Type":"NodeText","Data":"查看服务详细信息："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker service inspect \u0026lt;server name|id\u0026gt;"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240612020609-zdegvea","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240612020609-zdegvea"},"Children":[{"ID":"20240612020609-vz6j5v9","Type":"NodeParagraph","Properties":{"id":"20240612020609-vz6j5v9","updated":"20240612020712"},"Children":[{"Type":"NodeText","Data":"查看服务所在节点："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker ps \u0026lt;server name|id\u0026gt; "},{"Type":"NodeText","Data":"​"}]}]}]}]},{"ID":"20240612020749-fjqf439","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240612020749-fjqf439"},"Children":[{"ID":"20240612020749-cddws5v","Type":"NodeParagraph","Properties":{"id":"20240612020749-cddws5v","updated":"20240612020818"},"Children":[{"Type":"NodeText","Data":"删除服务："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker service rm \u0026lt;server name|id\u0026gt;"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240612020820-nll6850","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240612020820-nll6850","updated":"20240612022558"},"Children":[{"Type":"NodeText","Data":"弹性扩容"}]},{"ID":"20240612020837-j3h3mob","Type":"NodeParagraph","Properties":{"id":"20240612020837-j3h3mob","updated":"20240612021155"},"Children":[{"Type":"NodeText","Data":"集群创建后，允许通过指令弹性扩缩容 Service 中的容器数量"}]},{"ID":"20240612020913-ynxvye1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240612020913-ynxvye1","updated":"20240612021148"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker service scale \u003cserver name|id\u003e=\u003ccount\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240612021122-ikftuq9","Type":"NodeParagraph","Properties":{"id":"20240612021122-ikftuq9","updated":"20240612021159"},"Children":[{"Type":"NodeText","Data":"或"}]},{"ID":"20240612021159-43is40g","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240612021159-43is40g","updated":"20240612021343"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker service update --replicas \u003ccount\u003e \u003cserver name|id\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240612021353-io95rwg","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240612021353-io95rwg","updated":"20240612022558"},"Children":[{"Type":"NodeText","Data":"调度策略"}]},{"ID":"20240612021407-k4yx1iw","Type":"NodeParagraph","Properties":{"id":"20240612021407-k4yx1iw","updated":"20240612021513"},"Children":[{"Type":"NodeText","Data":"Swarm 选择运行的节点时，根据指定的策略计算最适合节点，目前节点有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"spread"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"binpack"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"random"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240612021514-1tfhr2h","Type":"NodeList","ListData":{},"Properties":{"id":"20240612021514-1tfhr2h","updated":"20240612021726"},"Children":[{"ID":"20240612021514-x0flc99","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240612021514-x0flc99","updated":"20240612021514"},"Children":[{"ID":"20240612021514-h84dcvr","Type":"NodeParagraph","Properties":{"id":"20240612021514-h84dcvr","updated":"20240612021545"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"random"},{"Type":"NodeText","Data":"​：随机选择一个节点，一般用于调试"}]}]},{"ID":"20240612021535-rm6sqj9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240612021535-rm6sqj9"},"Children":[{"ID":"20240612021535-ua1bsmt","Type":"NodeParagraph","Properties":{"id":"20240612021535-ua1bsmt","updated":"20240612021633"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"spread"},{"Type":"NodeText","Data":"​：选择运行容器最少的节点，使容器均衡的分布在各个节点上"}]}]},{"ID":"20240612021634-8bm79pn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240612021634-8bm79pn","updated":"20240612021726"},"Children":[{"ID":"20240612021634-t6ub0pv","Type":"NodeParagraph","Properties":{"id":"20240612021634-t6ub0pv","updated":"20240612021726"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"binpack"},{"Type":"NodeText","Data":"​：选择运行容器最集中的节点，最大化避免容器碎片化，尽可能把还未使用的节点留给需要更大空间的容器运行"}]}]}]},{"ID":"20240612021729-rspe53x","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240612021729-rspe53x","updated":"20240612022558"},"Children":[{"Type":"NodeText","Data":"滚动升级"}]},{"ID":"20240612021735-68a3dpu","Type":"NodeParagraph","Properties":{"id":"20240612021735-68a3dpu","updated":"20240612022020"},"Children":[{"Type":"NodeText","Data":"Docker Swarm 允许实现服务的平滑升级，更新服务不停机，客户端无感知"}]},{"ID":"20240612022020-r60sz1b","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240612022020-r60sz1b","updated":"20240612022105"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"docker service update --image \u003cimage:new-tag\u003e \u003cname\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240612022041-iu3ouc1","Type":"NodeParagraph","Properties":{"id":"20240612022041-iu3ouc1","updated":"20240612022154"},"Children":[{"Type":"NodeText","Data":"若新镜像导致重新部署失败，可自动回滚。在创建或更新服务时可以通过选项设置相关配置"}]},{"ID":"20240612022155-p3zbshl","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;|min-width: 60px;","id":"20240612022155-p3zbshl","updated":"20240612022558"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"选项"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"默认值"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--rollback-delay"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"0s"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"回滚任务结束后，进行下一个任务之前的等待时间"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--rollback-failure-action"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"pause"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"当任务无法回滚时的操作，无论 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"pause"},{"Type":"NodeText","Data":"​ 还是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"continue"},{"Type":"NodeText","Data":"​ 都会回滚其他任务"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--rollback-max-failure-ratio"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"0"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"回滚期间容忍的故障率，0-1 之间的浮点"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--rollback-monitor"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"5s"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"每个任务回滚之后的持续时间，在此期间容器停止则认为回滚是否失败"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--rollback-parallelism"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"1"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"并行回滚的最大任务数，0 表示同时回滚所有任务"}]}]}]}]}