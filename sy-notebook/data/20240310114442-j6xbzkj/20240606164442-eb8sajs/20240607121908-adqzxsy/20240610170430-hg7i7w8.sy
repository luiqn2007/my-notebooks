{"ID":"20240610170430-hg7i7w8","Spec":"1","Type":"NodeDocument","Properties":{"icon":"docker.png","id":"20240610170430-hg7i7w8","title":"模板文件","type":"doc","updated":"20240610202501"},"Children":[{"ID":"20240610170430-g9l8p2o","Type":"NodeParagraph","Properties":{"id":"20240610170430-g9l8p2o","updated":"20240610172559"},"Children":[{"Type":"NodeText","Data":"模板文件使用 YAML 格式，包含 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"version"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"services"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"networks"},{"Type":"NodeText","Data":"​ 三大类"}]},{"ID":"20240610172502-9826f17","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610172502-9826f17","updated":"20240610172930"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"version: '3'\nservices: \n  web:\n    image: nginx\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610172943-8tuddce","Type":"NodeParagraph","Properties":{"id":"20240610172943-8tuddce","updated":"20240610173021"},"Children":[{"Type":"NodeText","Data":"以上配置文件创建了一个名为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"web"},{"Type":"NodeText","Data":"​ 的项目，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nginx"},{"Type":"NodeText","Data":"​ 镜像，Compose 配置文件版本 3"}]},{"ID":"20240610170847-0ed9ndb","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170847-0ed9ndb","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"构建镜像"}]},{"ID":"20240610170854-0xsk8tn","Type":"NodeParagraph","Properties":{"id":"20240610170854-0xsk8tn","updated":"20240610171745"},"Children":[{"Type":"NodeText","Data":"每个 Compose 模板文件必须包含一个构建镜像的指令"}]},{"ID":"20240610171746-3s4rgkn","Type":"NodeList","ListData":{},"Properties":{"id":"20240610171746-3s4rgkn","updated":"20240610173046"},"Children":[{"ID":"20240610171747-j3coa3b","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610171747-j3coa3b","updated":"20240610171747"},"Children":[{"ID":"20240610171747-rx4t0cd","Type":"NodeParagraph","Properties":{"id":"20240610171747-rx4t0cd","updated":"20240610172120"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"image"},{"Type":"NodeText","Data":"​：指定一个镜像名或 ID。若本地不存在，则从服务器（通常为 Docker Hub）上查找镜像"}]},{"ID":"20240610172216-pckds0t","Type":"NodeSuperBlock","Properties":{"id":"20240610172216-pckds0t"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240610172126-ldahinb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610172126-ldahinb","updated":"20240610172140"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"image:\n  ubuntu\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610172141-z2k1zvt","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610172141-z2k1zvt","updated":"20240610172158"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"image:\n  orchardup/postgresql\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610172159-kmceniz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610172159-kmceniz","updated":"20240610172212"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"image:\n  a4bc65fd\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]}]},{"ID":"20240610171856-iy9ohph","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610171856-iy9ohph","updated":"20240610173046"},"Children":[{"ID":"20240610171856-qytct40","Type":"NodeParagraph","Properties":{"id":"20240610171856-qytct40","updated":"20240610172000"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"build"},{"Type":"NodeText","Data":"​：从指定目录使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 构建镜像"}]},{"ID":"20240610173027-hzux6rk","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610173027-hzux6rk","updated":"20240610173046"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":" build: ./src\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240610173113-a28fjzy","Type":"NodeParagraph","Properties":{"id":"20240610173113-a28fjzy","updated":"20240610174229"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"command"},{"Type":"NodeText","Data":"​ 可以覆盖 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240610173239-2ydc4f8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610173239-2ydc4f8","updated":"20240610174216"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"command: bundle exec thin -p 3000\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610170612-hvtza8o","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170612-hvtza8o","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"链接"}]},{"ID":"20240610173300-4kffwxv","Type":"NodeList","ListData":{},"Properties":{"id":"20240610173300-4kffwxv","updated":"20240610173638"},"Children":[{"ID":"20240610173610-7ab1ayn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610173610-7ab1ayn","updated":"20240610173610"},"Children":[{"ID":"20240610173610-7b9e5x1","Type":"NodeParagraph","Properties":{"id":"20240610173610-7b9e5x1","updated":"20240610173610"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"links"},{"Type":"NodeText","Data":"​ 链接到其他容器，使用服务名或服务别名（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;name\u0026gt;:\u0026lt;alias\u0026gt;"},{"Type":"NodeText","Data":"​）即可"}]}]},{"ID":"20240610173613-qj25pwc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610173613-qj25pwc","updated":"20240610173638"},"Children":[{"ID":"20240610173613-o3u6d0q","Type":"NodeParagraph","Properties":{"id":"20240610173613-o3u6d0q","updated":"20240610173638"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"external_links"},{"Type":"NodeText","Data":"​ 可以链接到项目之外的容器，甚至可以不是 Docker 的容器，格式与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"links"},{"Type":"NodeText","Data":"​ 相同"}]}]}]},{"ID":"20240610173325-j6zyuui","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610173325-j6zyuui","updated":"20240610173458"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"links:\n  - db\n  - db:database\n  - redis\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610170623-reozsx6","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170623-reozsx6","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"端口"}]},{"ID":"20240610173658-pe8a2bc","Type":"NodeList","ListData":{},"Properties":{"id":"20240610173658-pe8a2bc","updated":"20240610174129"},"Children":[{"ID":"20240610174012-g9rl2l6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610174012-g9rl2l6","updated":"20240610174012"},"Children":[{"ID":"20240610174012-xt4gsp6","Type":"NodeParagraph","Properties":{"id":"20240610174012-xt4gsp6","updated":"20240610174030"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ports"},{"Type":"NodeText","Data":"​ 暴露指定端口并映射到宿主机端口，完整格式为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"宿主端口:容器端口"},{"Type":"NodeText","Data":"​，也可以省略宿主机端口"}]},{"ID":"20240610173713-kx3ujx8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610173713-kx3ujx8","updated":"20240610173900"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"ports:\n  - \"3306\"                 // 暴露容器 3306 端口，映射到宿主机随机分配端口\n  - \"8080:80\"              // 暴露容器 80 端口，映射到宿主机 8080 端口\n  - \"127.0.0.1:8090:8001\"  // 暴露容器 8001 端口，映射到 127.0.0.1 的 8090 端口\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240610174032-rdjwne0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610174032-rdjwne0","updated":"20240610174129"},"Children":[{"ID":"20240610174032-r697kxh","Type":"NodeParagraph","Properties":{"id":"20240610174032-r697kxh","updated":"20240610174105"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"expose"},{"Type":"NodeText","Data":"​ 暴露指定端口但不映射到宿主机端口，只提供外部服务连接容器"}]},{"ID":"20240610174109-dn0y7uc","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610174109-dn0y7uc","updated":"20240610174129"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"expose:\n  - \"3000\"\n  - \"8000\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240610170632-it5jkng","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170632-it5jkng","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"数据卷"}]},{"ID":"20240610174149-608smni","Type":"NodeList","ListData":{},"Properties":{"id":"20240610174149-608smni","updated":"20240610174150"},"Children":[{"ID":"20240610174150-rddwrsm","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610174150-rddwrsm","updated":"20240610174150"},"Children":[{"ID":"20240610174150-ykefcv1","Type":"NodeParagraph","Properties":{"id":"20240610174150-ykefcv1","updated":"20240610174303"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"volumes"},{"Type":"NodeText","Data":"​ 设置数据卷，格式为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"宿主机路径:容器路径[:访问模式]"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240610174329-jnjfyx5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610174329-jnjfyx5","updated":"20240610174520"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"volumes:\n  - /var/lib/mysql:/var/lib/mysql    // 将宿主机 /var/lib/mysql 映射到容器 /var/lib/mysql\n  - /configs/mysql:/etc/configs/:ro  // 将宿主机 /configs/mysql 映射到容器 /etc/configs/，容器内只读\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240610174306-3do72n9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610174306-3do72n9"},"Children":[{"ID":"20240610174306-ckieibc","Type":"NodeParagraph","Properties":{"id":"20240610174306-ckieibc","updated":"20240610174327"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"volumes_from"},{"Type":"NodeText","Data":"​ 可以挂载另一个服务或容器的所有数据卷"}]},{"ID":"20240610174526-qpwlbpx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610174526-qpwlbpx","updated":"20240610174548"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"volumes_from:\n  - services_name\n  - container_name\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240610170643-7x1o8lx","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170643-7x1o8lx","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"环境变量"}]},{"ID":"20240610174625-kn1z5iy","Type":"NodeList","ListData":{},"Properties":{"id":"20240610174625-kn1z5iy","updated":"20240610175000"},"Children":[{"ID":"20240610174627-sp43z3v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610174627-sp43z3v","updated":"20240610174627"},"Children":[{"ID":"20240610174627-flxssxw","Type":"NodeParagraph","Properties":{"id":"20240610174627-flxssxw","updated":"20240610174644"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"environment"},{"Type":"NodeText","Data":"​ 设置环境变量，可以接受一个数组或 Map"}]},{"ID":"20240610174726-qitbmyq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610174726-qitbmyq","updated":"20240610174757"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"environment:\n  - RACK_ENV=development\n  - SESSION_SECRET\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240610174645-be064wo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610174645-be064wo","updated":"20240610175000"},"Children":[{"ID":"20240610174645-hrqzlzh","Type":"NodeParagraph","Properties":{"id":"20240610174645-hrqzlzh","updated":"20240610174845"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"env_file"},{"Type":"NodeText","Data":"​ 可以读取某个文件中的环境变量，可以是单独文件或列表，环境变量文件中允许包含注释"}]},{"ID":"20240610174959-lmhqul7","Type":"NodeSuperBlock","Properties":{"id":"20240610174959-lmhqul7","updated":"20240610175000"},"Children":[{"Type":"NodeSuperBlockOpenMarker"},{"Type":"NodeSuperBlockLayoutMarker","Data":"col"},{"ID":"20240610174801-2zi7p57","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610174801-2zi7p57","updated":"20240610175000"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"env_file:\n  - ./common.env\n  - /opt/secrets.env\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610174912-2feyhx2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610174912-2feyhx2","updated":"20240610175000"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHJvcGVydGllcw=="},{"Type":"NodeCodeBlockCode","Data":"# common.env: Rails/Rack environment\nRACK_ENV=development\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"Type":"NodeSuperBlockCloseMarker"}]}]}]},{"ID":"20240610170653-bdzokqm","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170653-bdzokqm","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"extends"}]},{"ID":"20240610175057-bi0jk8g","Type":"NodeParagraph","Properties":{"id":"20240610175057-bi0jk8g","updated":"20240610175114"},"Children":[{"Type":"NodeText","Data":"继承另一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"yml"},{"Type":"NodeText","Data":"​ 文件的配置"}]},{"ID":"20240610175118-l0q1wbb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610175118-l0q1wbb","updated":"20240610175206"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"# common.yml\nwebapp:\n  build: ./webapp\n  environment:\n    - DEBUG=false\n    - SEND_EMAILS=false\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610175207-2qjbjge","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610175207-2qjbjge","updated":"20240610200718"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"# development.yml\nweb:\n  extends:\n    file: common.yml\n    service:\n      ports:\n        - \"8080:80\"\n      links:\n        - db\n      environment:\n        - DEBUG=true\n    db:\n      image: mysql:5.7\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610201018-xnsnlfq","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610201018-xnsnlfq","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"网络相关"}]},{"ID":"20240610200736-nzrsdwi","Type":"NodeList","ListData":{},"Properties":{"id":"20240610200736-nzrsdwi","updated":"20240610201048"},"Children":[{"ID":"20240610201027-7psnuhg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610201027-7psnuhg","updated":"20240610201027"},"Children":[{"ID":"20240610201027-cv52wo2","Type":"NodeParagraph","Properties":{"id":"20240610201027-cv52wo2","updated":"20240610201030"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"net"},{"Type":"NodeText","Data":"​："},{"Type":"NodeTextMark","TextMarkType":"text"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240607121840-eb6iye7","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"网络模式"},{"Type":"NodeText","Data":"，相当于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--net"},{"Type":"NodeText","Data":"​ 参数，可选 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;none\u0026quot;"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;bridge\u0026quot;"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;host\u0026quot;"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;container:{\u0026lt;容器 id 或 name\u0026gt;}\u0026quot;"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240610201034-cagwa9v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610201034-cagwa9v"},"Children":[{"ID":"20240610201034-w8ijcgk","Type":"NodeParagraph","Properties":{"id":"20240610201034-w8ijcgk","updated":"20240610201126"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"dns"},{"Type":"NodeText","Data":"​：DNS 服务器，可以是一个值或列表"}]}]},{"ID":"20240610201110-lf2wfxc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240610201110-lf2wfxc"},"Children":[{"ID":"20240610201110-bvq6oan","Type":"NodeParagraph","Properties":{"id":"20240610201110-bvq6oan","updated":"20240610201146"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"dns_search"},{"Type":"NodeText","Data":"​：DNS 搜索域，可以是值或列表"}]}]}]},{"ID":"20240610201146-qad0sxi","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610201146-qad0sxi","updated":"20240610201232"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"net: \"bridge\"\ndns:\n  - 8.8.8.8\n  - 9.9.9.9\ndns_search:\n  - domain.example.com\n  - domain2.example.com\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610170702-8wlg5cz","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170702-8wlg5cz","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"pid"}]},{"ID":"20240610200908-e4yfngi","Type":"NodeParagraph","Properties":{"id":"20240610200908-e4yfngi","updated":"20240610200945"},"Children":[{"Type":"NodeText","Data":"与宿主机系统共享的远程命名空间，宿主机和容器之间可以通过该进程 id 互相访问"}]},{"ID":"20240610200948-tx2ujko","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610200948-tx2ujko","updated":"20240610200957"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"pid: \"host\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610170711-76lmdrq","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170711-76lmdrq","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"cap_add cap_drop"}]},{"ID":"20240610201326-ikq9h2p","Type":"NodeParagraph","Properties":{"id":"20240610201326-ikq9h2p","updated":"20240610201355"},"Children":[{"Type":"NodeText","Data":"添加或放弃 Linux Capability"}]},{"ID":"20240610201357-3aik8u6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610201357-3aik8u6","updated":"20240610201430"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"cap_add:\n  - ALL\ncap_drop:\n  - NET_ADMIN\n  - SYS_ADMIN\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610170719-81euhyn","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170719-81euhyn","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"healthcheck"}]},{"ID":"20240610201710-38or9il","Type":"NodeParagraph","Properties":{"id":"20240610201710-38or9il","updated":"20240610201934"},"Children":[{"Type":"NodeText","Data":"健康检查，等待依赖的服务准备完成后再上线"}]},{"ID":"20240610201742-80nxy8s","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610201742-80nxy8s","updated":"20240610201832"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"healthcheck:\n  test: [\"CMD\", \"curl\", \"-f\", \"http://localhost/alive\"]\n  interval: 5s\n  timeout: 3s\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610201917-rohewb2","Type":"NodeParagraph","Properties":{"id":"20240610201917-rohewb2","updated":"20240610201952"},"Children":[{"Type":"NodeText","Data":"通常健康检查会写在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 中"}]},{"ID":"20240610201954-v4qez50","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610201954-v4qez50","updated":"20240610202043"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"ZG9ja2VyZmlsZQ=="},{"Type":"NodeCodeBlockCode","Data":"healthcheck --interval=5s --timeout=3s CMD curl -f http://localhost/alive || exit 1\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610170726-nzyls30","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170726-nzyls30","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"depends_on"}]},{"ID":"20240610202054-fzl4wp3","Type":"NodeParagraph","Properties":{"id":"20240610202054-fzl4wp3","updated":"20240610202124"},"Children":[{"Type":"NodeText","Data":"依赖服务，包含多个应用程序时调整启动顺序"}]},{"ID":"20240610202125-umcm9ek","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610202125-umcm9ek","updated":"20240610202207"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"depends_on:\n  - redis\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610170735-4y2t3gj","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240610170735-4y2t3gj","updated":"20240610202501"},"Children":[{"Type":"NodeText","Data":"deploy"}]},{"ID":"20240610202210-rdx1lsq","Type":"NodeParagraph","Properties":{"id":"20240610202210-rdx1lsq","updated":"20240610202213"},"Children":[{"Type":"NodeText","Data":"部署配置"}]},{"ID":"20240610202213-1hmxsa1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610202213-1hmxsa1","updated":"20240610202501"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"deploy:\n  mode: replicated\n  replices: 2\n  restart_policy:\n    condition: on-failure\n    max_attempts: 3\n  update_config:\n    delay: 5s\n    order: start-first\n  resources:\n    limits:\n      cpu: \"0.50\"\n      memory: 1g\ndeploy:\n  mode: global # 全局配置\n  placement:\n    constraints: [ node.role == manager ]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610170740-nmvnaac","Type":"NodeParagraph","Properties":{"id":"20240610170740-nmvnaac","updated":"20240610201444"},"Children":[{"Type":"NodeText","Data":"其他"}]},{"ID":"20240610201452-64vmde7","Type":"NodeParagraph","Properties":{"id":"20240610201452-64vmde7","updated":"20240610202314"},"Children":[{"Type":"NodeText","Data":"以下配置类似 docker run 的对应参数"}]},{"ID":"20240610201445-nhd394f","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240610201445-nhd394f","updated":"20240610202314"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"cpu_shares: 73\nwork_dir: /code\nentrypoint: /code/entrypoint.sh\nuser: postgresql\nhostname: foo\ndomainname: foo.com\nmem_limit: 1000000000\nprivileged: true\nrestart: always\nstdin_open: true\ntty: true\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240610201511-0rnn5o4","Type":"NodeParagraph","Properties":{"id":"20240610201511-0rnn5o4","updated":"20240610202314"}}]}