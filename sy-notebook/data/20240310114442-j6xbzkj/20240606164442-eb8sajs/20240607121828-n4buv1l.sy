{"ID":"20240607121828-n4buv1l","Spec":"1","Type":"NodeDocument","Properties":{"icon":"docker.png","id":"20240607121828-n4buv1l","title":"应用容器化","type":"doc","updated":"20240608032031"},"Children":[{"ID":"20240607121828-ufeap47","Type":"NodeParagraph","Properties":{"id":"20240607121828-ufeap47","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240608020607"},"Children":[{"Type":"NodeText","Data":"容器化：Containerizing，又称 Docker 化（Dockerizing），将应用整合到容器中并运行起来的过程"}]},{"ID":"20240608020714-0i8wix4","Type":"NodeParagraph","Properties":{"id":"20240608020714-0i8wix4","updated":"20240608030949"},"Children":[{"Type":"NodeText","Data":"应用容器化通常使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker build"},{"Type":"NodeText","Data":"​ 的形式"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240608024348-4fyamf5","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"创建"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240608020845-r9pxa9c","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240608020845-r9pxa9c","updated":"20240608032031"},"Children":[{"Type":"NodeText","Data":"多阶段构建"}]},{"ID":"20240608030839-s7czyxm","Type":"NodeParagraph","Properties":{"id":"20240608030839-s7czyxm","updated":"20240608031343"},"Children":[{"Type":"NodeText","Data":"允许在一个 Dockerfile 中出现多条 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FROM"},{"Type":"NodeText","Data":"​ 指令，每个指令只作为中间过程服务，后面的阶段可以访问前面阶段的文件，最后一条 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FROM"},{"Type":"NodeText","Data":"​ 作为镜像的基础镜像。"}]},{"ID":"20240608031111-dwti47t","Type":"NodeParagraph","Properties":{"id":"20240608031111-dwti47t","updated":"20240608031228"},"Children":[{"Type":"NodeText","Data":"通常多 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FROM"},{"Type":"NodeText","Data":"​ 指令多用于编译、打包、运行环境分离的情况，运行环境和编译环境完全不一样。"}]},{"ID":"20240608031401-n8fww6l","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240608031401-n8fww6l","updated":"20240608031921"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"ZG9ja2Vy"},{"Type":"NodeCodeBlockCode","Data":"FROM node:12-alpine as builder\nWORKDIR /xxapi\nRUN apk add --no-cache wget python make\nENV VERSION=1.9.2\nRUN wget https://github.com/YMFE/xxapi/archive/refs/tags/v${VERSION}.zip\nRUN unzip v${VERSION}.zip \u0026\u0026 mv xxapi-${VERSION} vendors\nRUN cd /xxapi/vendors \u0026\u0026 npm install --production --registry https://registry.npm.taobao.org\n\nFROM node:12-alpine\nMAINTAINER ronwxy\nENV TZ=\"Asia/Shanghai\"\nWORKDIR /xxapi/vendors\nCOPY --from=builder /xxapi/vendors /xxapi/vendors\nRUN mv /xxapi/vendors/config_example.json /xxapi/config.json\nEXPOSE 3000\nENTRYPOINT [\"node\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240608031936-350arkt","Type":"NodeList","ListData":{},"Properties":{"id":"20240608031936-350arkt","updated":"20240608032031"},"Children":[{"ID":"20240608031937-uznrnsq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608031937-uznrnsq","updated":"20240608032031"},"Children":[{"ID":"20240608031937-wbcoygh","Type":"NodeParagraph","Properties":{"id":"20240608031937-wbcoygh","updated":"20240608032031"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY --from=\u0026lt;n\u0026gt;"},{"Type":"NodeText","Data":"​ 表示源位置，也可以使用数字表示从第几个阶段复制，从 0 开始"}]}]}]},{"ID":"20240608020856-aqviuwu","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240608020856-aqviuwu","updated":"20240608022021"},"Children":[{"Type":"NodeText","Data":"常用指令"}]},{"ID":"20240608020905-srgu3it","Type":"NodeList","ListData":{},"Properties":{"id":"20240608020905-srgu3it","updated":"20240608021217"},"Children":[{"ID":"20240608020906-orallom","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608020906-orallom","updated":"20240608021108"},"Children":[{"ID":"20240608020906-pu8rkln","Type":"NodeParagraph","Properties":{"id":"20240608020906-pu8rkln","updated":"20240608020927"},"Children":[{"Type":"NodeText","Data":"镜像："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FROM"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240608020956-dfpakko","Type":"NodeList","ListData":{},"Properties":{"id":"20240608020956-dfpakko","updated":"20240608021108"},"Children":[{"ID":"20240608020956-24d2e82","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608020956-24d2e82","updated":"20240608021034"},"Children":[{"ID":"20240608020956-rvob3as","Type":"NodeParagraph","Properties":{"id":"20240608020956-rvob3as","updated":"20240608021034"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FROM"},{"Type":"NodeText","Data":"​：指定构建镜像的一个基础层"}]}]},{"ID":"20240608021000-7icg11m","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608021000-7icg11m","updated":"20240608021049"},"Children":[{"ID":"20240608021000-w6lcm97","Type":"NodeParagraph","Properties":{"id":"20240608021000-w6lcm97","updated":"20240608021049"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​：在镜像中执行命令，并创建一个新层"}]}]},{"ID":"20240608021002-y758711","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608021002-y758711","updated":"20240608021108"},"Children":[{"ID":"20240608021002-pjnks9j","Type":"NodeParagraph","Properties":{"id":"20240608021002-pjnks9j","updated":"20240608021108"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​：将文件复制到容器中并创建新层"}]}]}]}]},{"ID":"20240608020921-epft4eo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608020921-epft4eo","updated":"20240608021217"},"Children":[{"ID":"20240608020921-301r849","Type":"NodeParagraph","Properties":{"id":"20240608020921-301r849","updated":"20240608020951"},"Children":[{"Type":"NodeText","Data":"元数据："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EXPOSE"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENV"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTERPOINT"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240608021008-bvodtpn","Type":"NodeList","ListData":{},"Properties":{"id":"20240608021008-bvodtpn","updated":"20240608021217"},"Children":[{"ID":"20240608021007-2qhelc9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608021007-2qhelc9","updated":"20240608021124"},"Children":[{"ID":"20240608021007-apjy6b1","Type":"NodeParagraph","Properties":{"id":"20240608021007-apjy6b1","updated":"20240608021124"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EXPOSE"},{"Type":"NodeText","Data":"​：设置镜像使用的网络端口"}]}]},{"ID":"20240608021010-smf5d2f","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608021010-smf5d2f","updated":"20240608021217"},"Children":[{"ID":"20240608021010-6tmdwu1","Type":"NodeParagraph","Properties":{"id":"20240608021010-6tmdwu1","updated":"20240608021217"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​：工作目录"}]}]},{"ID":"20240608021014-e74ih1k","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608021014-e74ih1k","updated":"20240608021214"},"Children":[{"ID":"20240608021014-v1c2kiz","Type":"NodeParagraph","Properties":{"id":"20240608021014-v1c2kiz","updated":"20240608021214"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENV"},{"Type":"NodeText","Data":"​：环境变量"}]}]},{"ID":"20240608021017-ynz3akd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240608021017-ynz3akd","updated":"20240608021203"},"Children":[{"ID":"20240608021017-22l7vit","Type":"NodeParagraph","Properties":{"id":"20240608021017-22l7vit","updated":"20240608021203"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTERPOINT"},{"Type":"NodeText","Data":"​：指定镜像启动后默认运行的程序"}]}]}]}]}]},{"ID":"20240608021225-y17niqv","Type":"NodeParagraph","Properties":{"id":"20240608021225-y17niqv","updated":"20240608021238"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker image build"},{"Type":"NodeText","Data":"​ 常用参数包括："}]},{"ID":"20240608021315-smof9vj","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;|min-width: 60px;","id":"20240608021315-smof9vj","updated":"20240608022021"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"参数"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"默认值"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--no-cache"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Build Cache"},{"Type":"NodeText","Data":"​ 构建"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--pull"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"总是尝试拉取镜像最新版本"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--compress"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"gzip"},{"Type":"NodeText","Data":"​ 压缩构建上下文"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--disable-content-trust"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"true"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"对镜像进行验证"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--file"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-f"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"./Dockerfile"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 完整路径"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--isolation"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Linux 命名空间，还可选 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"process"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"hyperv"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--label"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td"},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"设置镜像元数据"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--squash"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"将构建出的多个层压缩到一个层，无法在多个镜像间共享新层。实际上是创建了新镜像同时保留旧镜像"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--tag"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-t"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td"},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"镜像名称及 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"tag"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;name\u0026gt;:\u0026lt;tag\u0026gt;"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;name\u0026gt;"},{"Type":"NodeText","Data":"​ 的形式，可以有多个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"tag"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--network"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240607121840-eb6iye7","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"网络模式"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--quiet"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-q"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"仅输出镜像 ID"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--force-rm"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"总是删除中间环节容器"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--rm"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"true"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"构建成功后删除中间环节容器"}]}]}]}]}