{"ID":"20240515022803-za3hwpp","Spec":"1","Type":"NodeDocument","Properties":{"icon":"mysql.ico","id":"20240515022803-za3hwpp","title":"主从复制","type":"doc","updated":"20240515030407"},"Children":[{"ID":"20240515030316-m02da3g","Type":"NodeParagraph","Properties":{"id":"20240515030316-m02da3g","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"主从复制通过重做保证主从数据库保持同步。MySQL 支持一台主库向多台从库进行复制，一台数据库可以是主库也可以是从库"}]},{"ID":"20240515030324-loujegr","Type":"NodeParagraph","Properties":{"id":"20240515030324-loujegr","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240515030331"},"Children":[{"Type":"NodeText","Data":"重做：主数据库中的 DDL、DML 操作通过二进制日志传递给从库服务器，在从库上对这些日志重新执行"}]},{"ID":"20240515030316-2va3d49","Type":"NodeParagraph","Properties":{"id":"20240515030316-2va3d49","updated":"20240515030319"},"Children":[{"Type":"NodeText","Data":"主从复制（及主从库设计）的优点有："}]},{"ID":"20240515030316-cb68t5d","Type":"NodeList","ListData":{},"Properties":{"id":"20240515030316-cb68t5d","updated":"20240515030319"},"Children":[{"ID":"20240515030316-fm9wd3l","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-fm9wd3l","updated":"20240515030316"},"Children":[{"ID":"20240515030316-txdnxa8","Type":"NodeParagraph","Properties":{"id":"20240515030316-txdnxa8","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"失败迁移：主库出现问题时可快速切换到从库提供服务"}]}]},{"ID":"20240515030316-fm3070p","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-fm3070p","updated":"20240515030316"},"Children":[{"ID":"20240515030316-tfhxsd4","Type":"NodeParagraph","Properties":{"id":"20240515030316-tfhxsd4","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"读写分离：读写分离，降低主库压力"}]}]},{"ID":"20240515030316-svhoo9y","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-svhoo9y","updated":"20240515030316"},"Children":[{"ID":"20240515030316-67wjk6k","Type":"NodeParagraph","Properties":{"id":"20240515030316-67wjk6k","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"数据备份：备份时需要加全局锁，避免备份时影响主库服务"}]}]}]},{"ID":"20240515030316-vauvska","Type":"NodeParagraph","Properties":{"id":"20240515030316-vauvska","updated":"20240515030319"},"Children":[{"Type":"NodeText","Data":"主库通常称为 Master，从库成为 Slave。"}]},{"ID":"20240515030316-beq55zy","Type":"NodeParagraph","Properties":{"id":"20240515030316-beq55zy","updated":"20240515030355"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230919180426"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230919180426-20240515030355-jcbgl7d.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515030316-bpdq92m","Type":"NodeParagraph","Properties":{"id":"20240515030316-bpdq92m","updated":"20240515030319"},"Children":[{"Type":"NodeText","Data":"主从复制的过程为："}]},{"ID":"20240515030316-ghc7ren","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240515030316-ghc7ren","updated":"20240515030319"},"Children":[{"ID":"20240515030316-as53mxw","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240515030316-as53mxw","updated":"20240515030316"},"Children":[{"ID":"20240515030316-441moo3","Type":"NodeParagraph","Properties":{"id":"20240515030316-441moo3","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"Master 执行修改操作时，会将变更记录写入二进制日志"}]}]},{"ID":"20240515030316-3n0v8u9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240515030316-3n0v8u9","updated":"20240515030316"},"Children":[{"ID":"20240515030316-q30zq8e","Type":"NodeParagraph","Properties":{"id":"20240515030316-q30zq8e","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"Slave 通过 IOThread 读取主库 binlog，将变更记录写入到中继日志 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Relay.log"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240515030316-hvxp7g8","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240515030316-hvxp7g8","updated":"20240515030316"},"Children":[{"ID":"20240515030316-q34nbsi","Type":"NodeParagraph","Properties":{"id":"20240515030316-q34nbsi","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"Slave 通过 SQLThread 读取 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Relay.log"},{"Type":"NodeText","Data":"​ 完成数据合并"}]}]}]},{"ID":"20240515030316-ma3sjtw","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515030316-ma3sjtw","updated":"20240515030407"},"Children":[{"Type":"NodeText","Data":"主从服务器搭建"}]},{"ID":"20240515030316-t2ux1h6","Type":"NodeParagraph","Properties":{"id":"20240515030316-t2ux1h6","updated":"20240515030317"},"Children":[{"Type":"NodeText","Data":"准备两台服务器，并允许防火墙 3306 端口（或自定义 MySQL 服务器端口），分别安装并初始化 MySQL。分别进行配置并重启 MySQL 服务器（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"etc/my.cnf"},{"Type":"NodeText","Data":"​）"}]},{"ID":"20240515030316-9gd7b1y","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515030316-9gd7b1y","updated":"20240515030317"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"server-id=1\nread-only=0\n#binlog-ignore-db=mysql\n#binlog-do-db=db01\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515030316-qpqlrto","Type":"NodeList","ListData":{},"Properties":{"id":"20240515030316-qpqlrto","updated":"20240515030317"},"Children":[{"ID":"20240515030316-p2kauvb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-p2kauvb","updated":"20240515030316"},"Children":[{"ID":"20240515030316-3np3npi","Type":"NodeParagraph","Properties":{"id":"20240515030316-3np3npi","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"server-id"},{"Type":"NodeText","Data":"​：服务器 id，默认为 1，保证所有服务器集群中 id 互不相同"}]}]},{"ID":"20240515030316-5x3eviz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-5x3eviz","updated":"20240515030316"},"Children":[{"ID":"20240515030316-ijjjuyj","Type":"NodeParagraph","Properties":{"id":"20240515030316-ijjjuyj","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"read-only"},{"Type":"NodeText","Data":"​：数据库服务器是否只读，主库可写，从库只读"}]}]},{"ID":"20240515030316-6jre92b","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-6jre92b","updated":"20240515030316"},"Children":[{"ID":"20240515030316-l0gy4ep","Type":"NodeParagraph","Properties":{"id":"20240515030316-l0gy4ep","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"binlog-ignore-db"},{"Type":"NodeText","Data":"​：可选，指定不需要同步的数据库（黑名单模式）"}]}]},{"ID":"20240515030316-s38to1h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-s38to1h","updated":"20240515030316"},"Children":[{"ID":"20240515030316-oay93f0","Type":"NodeParagraph","Properties":{"id":"20240515030316-oay93f0","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"binlog-do-db"},{"Type":"NodeText","Data":"​：可选，指定需要同步的数据库（白名单模式）"}]}]}]},{"ID":"20240515030316-m05sdqx","Type":"NodeParagraph","Properties":{"id":"20240515030316-m05sdqx","updated":"20240515030317"},"Children":[{"Type":"NodeText","Data":"在主库上，创建远程连接的账号，并赋予主从复制的权限"}]},{"ID":"20240515030316-tezu6h6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515030316-tezu6h6","updated":"20240515030317"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"-- 创建一个任何服务器都可以访问的用户和密码\ncreate user '用户名'@'%' identified with mysql_native_password by '密码';\n-- 赋予主从复制权限\ngrant replication slave on *.* to '用户名'@'%';\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515030316-rhldsj9","Type":"NodeParagraph","Properties":{"id":"20240515030316-rhldsj9","updated":"20240515030317"},"Children":[{"Type":"NodeText","Data":"在从库上设置主库（8.0.23 之前的版本参数将 SOURCE 更改为 MASTER 即可）："}]},{"ID":"20240515030316-i7eboih","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515030316-i7eboih","updated":"20240515030317"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"change replication source to source_host='主库地址', source_user='连接用户名', source_password='连接密码', source_log_file='二进制日志', source_log_pos='位置';\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515030316-ptio2ar","Type":"NodeList","ListData":{},"Properties":{"id":"20240515030316-ptio2ar","updated":"20240515030317"},"Children":[{"ID":"20240515030316-1lz3o7d","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-1lz3o7d","updated":"20240515030316"},"Children":[{"ID":"20240515030316-wobsvdp","Type":"NodeParagraph","Properties":{"id":"20240515030316-wobsvdp","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"source_user"},{"Type":"NodeText","Data":"​：之前赋予主从复制的用户名"}]}]},{"ID":"20240515030316-fabyq9e","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-fabyq9e","updated":"20240515030316"},"Children":[{"ID":"20240515030316-816z9xd","Type":"NodeParagraph","Properties":{"id":"20240515030316-816z9xd","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"source_password"},{"Type":"NodeText","Data":"​：之前赋予主从复制的用户密码"}]}]},{"ID":"20240515030316-00z90wg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-00z90wg","updated":"20240515030316"},"Children":[{"ID":"20240515030316-15twtbr","Type":"NodeParagraph","Properties":{"id":"20240515030316-15twtbr","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"source_log_file"},{"Type":"NodeText","Data":"​：从主库的哪个二进制文件开始进行同步，可在主库通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"show master status"},{"Type":"NodeText","Data":"​ 查看当前二进制日志文件"}]}]},{"ID":"20240515030316-426wte3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-426wte3","updated":"20240515030316"},"Children":[{"ID":"20240515030316-ohog3fu","Type":"NodeParagraph","Properties":{"id":"20240515030316-ohog3fu","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"source_log_pos"},{"Type":"NodeText","Data":"​：从选定的二进制日志文件的那个位置开始同步可在主库通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"show master status"},{"Type":"NodeText","Data":"​ 查看当前二进制日志文件写入位置（position 列）"}]}]}]},{"ID":"20240515030316-fcydp3w","Type":"NodeParagraph","Properties":{"id":"20240515030316-fcydp3w","updated":"20240515030317"},"Children":[{"Type":"NodeText","Data":"配置完成后，通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"start replica"},{"Type":"NodeText","Data":"​ 开启同步。8.0.22 之前使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"start slave"},{"Type":"NodeText","Data":"​ 命令。"}]},{"ID":"20240515030316-lj8oi87","Type":"NodeParagraph","Properties":{"id":"20240515030316-lj8oi87","updated":"20240515030317"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"show replica status"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"show slave status"},{"Type":"NodeText","Data":"​ 查看主从复制的状态，其中"}]},{"ID":"20240515030316-4cy64np","Type":"NodeList","ListData":{},"Properties":{"id":"20240515030316-4cy64np","updated":"20240515030405"},"Children":[{"ID":"20240515030316-ckrnh2p","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-ckrnh2p","updated":"20240515030316"},"Children":[{"ID":"20240515030316-c19q46z","Type":"NodeParagraph","Properties":{"id":"20240515030316-c19q46z","updated":"20240515030316"},"Children":[{"Type":"NodeText","Data":"Replica_IO_Running = YES（IOThread 是否正常运行）"}]}]},{"ID":"20240515030316-at5esaq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515030316-at5esaq","updated":"20240515030405"},"Children":[{"ID":"20240515030316-0a8nxnt","Type":"NodeParagraph","Properties":{"id":"20240515030316-0a8nxnt","updated":"20240515030405"},"Children":[{"Type":"NodeText","Data":"Replica_SQL_Running = YES（SQLThread 是否正常运行）\n"}]}]}]},{"ID":"20240515030406-j36z7sd","Type":"NodeParagraph","Properties":{"id":"20240515030406-j36z7sd","updated":"20240515030407"},"Children":[{"Type":"NodeText","Data":"即表示主从复制正常进行。"}]}]}