{"ID":"20240515022726-byh2bh2","Spec":"1","Type":"NodeDocument","Properties":{"icon":"mysql.ico","id":"20240515022726-byh2bh2","title":"索引","type":"doc","updated":"20240515023627"},"Children":[{"ID":"20240515023627-6x3ozjl","Type":"NodeParagraph","Properties":{"id":"20240515023627-6x3ozjl","updated":"20240515023644"},"Children":[{"Type":"NodeText","Data":"索引（Index）用于帮助 MySQL "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"高效获取数据"},{"Type":"NodeText","Data":"的"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"有序数据结构"},{"Type":"NodeText","Data":"。这些数据结构以某种方式引用数据，以此基础上可以开发高级查找算法。"}]},{"ID":"20240515023713-13ytjbo","Type":"NodeBlockquote","Properties":{"id":"20240515023713-13ytjbo","updated":"20240515023713"},"Children":[{"ID":"20240515023627-8u4use9","Type":"NodeParagraph","Properties":{"id":"20240515023627-8u4use9","updated":"20240515023713"},"Children":[{"Type":"NodeText","Data":"优点：降低查询时 IO 成本和排序时的成本\n缺点：占用空间，降低更新表的效率（insert，update，delete 等）"}]},{"Type":"NodeBlockquoteMarker","Data":"\u003e"}]},{"ID":"20240515023627-2vnn43q","Type":"NodeParagraph","Properties":{"id":"20240515023627-2vnn43q","updated":"20240515023715"},"Children":[{"Type":"NodeText","Data":"索引结构因引擎而异，不同引擎的支持和实现不同："}]},{"ID":"20240515023627-ew03xrb","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20240515023627-ew03xrb","updated":"20240515024023"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"索引结构"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"描述"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"引擎"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code block-ref","TextMarkBlockRefID":"20240515023847-0cebkpe","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"B+Tree"},{"Type":"NodeText","Data":"​ 索引"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"最常见索引"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"大多数均支持"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code block-ref","TextMarkBlockRefID":"20240515023936-pvfp188","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"Hash"},{"Type":"NodeText","Data":"​ 索引"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"使用哈希表实现，效率高，但支支持精确匹配搜索，不支持范围查询"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"仅 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Memory"},{"Type":"NodeText","Data":"​ 支持"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"R-tree"},{"Type":"NodeText","Data":"​ （空间索引）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"MyISAM 的特殊索引类型，主要用于存储地理空间数据"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"仅 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MyISAM"},{"Type":"NodeText","Data":"​ 支持"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Full-text"},{"Type":"NodeText","Data":"​（全文索引）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"类似 Lucene，Solr，ES 等，通过建立倒排索引快速匹配文档"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Memory"},{"Type":"NodeText","Data":"​ 不支持"}]}]}]},{"ID":"20240515023627-ncts98o","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-ncts98o","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"分类"}]},{"ID":"20240515023627-fnojd11","Type":"NodeParagraph","Properties":{"id":"20240515023627-fnojd11","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"根据索引类型："}]},{"ID":"20240515023627-813navb","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20240515023627-813navb","updated":"20240515023628"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"索引类型"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"含义"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"关键字"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"主键索引"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"针对主键创建的索引"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"primary"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"唯一索引"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"避免同一个表中某列存在相同数据"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"unique"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"常规索引"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"快速定位数据"}]},{"Type":"NodeTableCell","Data":"td"}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"全文索引"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"查找文本中的关键词而非索引中的值"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"fulltext"}]}]}]},{"ID":"20240515023627-6und0a8","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-6und0a8","updated":"20240515023628"},"Children":[{"ID":"20240515023627-a8yte3e","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-a8yte3e","updated":"20240515023627"},"Children":[{"ID":"20240515023627-ahzz8w7","Type":"NodeParagraph","Properties":{"id":"20240515023627-ahzz8w7","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"主键索引仅能创建一个，且由数据库自动创建。其他索引可以创建多个"}]}]},{"ID":"20240515023627-oy4hetz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-oy4hetz","updated":"20240515023627"},"Children":[{"ID":"20240515023627-sl6b856","Type":"NodeParagraph","Properties":{"id":"20240515023627-sl6b856","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"建表时使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"unique"},{"Type":"NodeText","Data":"​ 关键字修饰字段会自动创建唯一索引"}]}]}]},{"ID":"20240515023627-rxeq5yq","Type":"NodeParagraph","Properties":{"id":"20240515023627-rxeq5yq","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"根据储存形式（InnoDB）："}]},{"ID":"20240515023627-09mp52b","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20240515023627-09mp52b","updated":"20240515023628"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"索引类型"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"含义"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"聚集索引 Clustered Index"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"将所有索引存在一起，叶节点保存行数据"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"二级索引 Secondary Index"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"将索引与数据分离，叶节点保存主键"}]}]}]},{"ID":"20240515023627-icpp892","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-icpp892","updated":"20240515023628"},"Children":[{"ID":"20240515023627-ruwhkpy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-ruwhkpy","updated":"20240515023627"},"Children":[{"ID":"20240515023627-05p1htu","Type":"NodeParagraph","Properties":{"id":"20240515023627-05p1htu","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"聚集索引有且只有一个"}]},{"ID":"20240515023627-yet4y1s","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-yet4y1s","updated":"20240515023627"},"Children":[{"ID":"20240515023627-n8s00oz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-n8s00oz","updated":"20240515023627"},"Children":[{"ID":"20240515023627-mgpdbfw","Type":"NodeParagraph","Properties":{"id":"20240515023627-mgpdbfw","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"如果存在主键，主键索引即聚集索引"}]}]},{"ID":"20240515023627-i2qeeyd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-i2qeeyd","updated":"20240515023627"},"Children":[{"ID":"20240515023627-8zm6ie6","Type":"NodeParagraph","Properties":{"id":"20240515023627-8zm6ie6","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"如果不存在主键，使用第一个唯一索引作为聚集索引"}]}]},{"ID":"20240515023627-9l1hz4j","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-9l1hz4j","updated":"20240515023627"},"Children":[{"ID":"20240515023627-fbcfcgp","Type":"NodeParagraph","Properties":{"id":"20240515023627-fbcfcgp","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"如果不存在主键和唯一索引，InnoDB 自动生成唯一 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rowid"},{"Type":"NodeText","Data":"​ 作为隐藏的聚集索引"}]}]}]}]},{"ID":"20240515023627-2uti0bn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-2uti0bn","updated":"20240515023627"},"Children":[{"ID":"20240515023627-q8lyf44","Type":"NodeParagraph","Properties":{"id":"20240515023627-q8lyf44","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"二级索引又称辅助索引、非聚集索引，可以有多个"}]}]}]},{"ID":"20240515024102-per0wn8","Type":"NodeParagraph","Properties":{"id":"20240515024102-per0wn8","style":"color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);","updated":"20240515024105"},"Children":[{"Type":"NodeText","Data":"回表查询：进行不以主键为关键字的具体查询时，先通过二级索引查询主键值，然后再通过聚集索引查询具体行数据"}]},{"ID":"20240515024049-04fmeu8","Type":"NodeParagraph","Properties":{"id":"20240515024049-04fmeu8","updated":"20240515024049"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230722125135"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230722125135-20240515024049-wi8uk5n.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515023627-j8weztc","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-j8weztc","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"创建索引"}]},{"ID":"20240515023627-aby9tqz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-aby9tqz","updated":"20240515024132"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"create [unique | fulltext] index 索引名 on 表名 ( 字段1, 字段2, ... );\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-r0rl58q","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-r0rl58q","updated":"20240515024132"},"Children":[{"ID":"20240515023627-xlatxys","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-xlatxys","updated":"20240515023627"},"Children":[{"ID":"20240515023627-yx9tp7p","Type":"NodeParagraph","Properties":{"id":"20240515023627-yx9tp7p","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"unique | fulltext：索引类型（唯一索引、全文索引），省略表示常规索引"}]}]},{"ID":"20240515023627-sqxr4bv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-sqxr4bv","updated":"20240515023627"},"Children":[{"ID":"20240515023627-0ku2sbd","Type":"NodeParagraph","Properties":{"id":"20240515023627-0ku2sbd","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"索引可以关联多个字段，仅关联一个字段的索引称为单列索引，关联多个字段的索引称为联合索引或组合索引"}]},{"ID":"20240515023627-74wqr38","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-74wqr38","updated":"20240515023627"},"Children":[{"ID":"20240515023627-kv52x1l","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-kv52x1l","updated":"20240515023627"},"Children":[{"ID":"20240515023627-vli5jw8","Type":"NodeParagraph","Properties":{"id":"20240515023627-vli5jw8","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"联合索引需要考虑字段顺序"}]}]},{"ID":"20240515023627-cnw6s8m","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-cnw6s8m","updated":"20240515023627"},"Children":[{"ID":"20240515023627-h1f3dtj","Type":"NodeParagraph","Properties":{"id":"20240515023627-h1f3dtj","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"建议使用联合索引，效率更高"}]}]}]}]},{"ID":"20240515023627-algc8kc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-algc8kc","updated":"20240515023627"},"Children":[{"ID":"20240515023627-e94puq3","Type":"NodeParagraph","Properties":{"id":"20240515023627-e94puq3","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"索引名通常遵循 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"idx_表名_字段名"},{"Type":"NodeText","Data":"​ 的命名规则"}]}]}]},{"ID":"20240515023627-7sj4u13","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-7sj4u13","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"查看索引"}]},{"ID":"20240515023627-axpgk0w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-axpgk0w","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"show index from 表名;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-63wmdir","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-63wmdir","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"删除索引"}]},{"ID":"20240515023627-21wgt8j","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-21wgt8j","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"drop index 索引名 on 表名;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-9wtyzxw","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-9wtyzxw","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"性能分析"}]},{"ID":"20240515023627-jai52ju","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515023627-jai52ju","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"执行频率"}]},{"ID":"20240515023627-h9yc2r2","Type":"NodeParagraph","Properties":{"id":"20240515023627-h9yc2r2","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"一般来说，性能优化主要优化查询。MySQL 可以使用以下命令查询某数据库中某个操作的访问频次，包括 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"insert"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"update"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"delete"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​。当 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Com_select"},{"Type":"NodeText","Data":"​ 频次较高时可重点进行优化"}]},{"ID":"20240515023627-e9cqfre","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-e9cqfre","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"show [session | global] status like 'Com_______';\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-k4nhv86","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-k4nhv86","updated":"20240515023628"},"Children":[{"ID":"20240515023627-befc0l8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-befc0l8","updated":"20240515023627"},"Children":[{"ID":"20240515023627-301e53b","Type":"NodeParagraph","Properties":{"id":"20240515023627-301e53b","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Com_______"},{"Type":"NodeText","Data":"​ 匹配 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Com_insert"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Com_update"},{"Type":"NodeText","Data":"​ 等"}]}]}]},{"ID":"20240515023627-2hcfmwq","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515023627-2hcfmwq","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"慢查询日志"}]},{"ID":"20240515023627-mneykc2","Type":"NodeParagraph","Properties":{"id":"20240515023627-mneykc2","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"慢查询日志记录了 MySQL 中执行时间超过指定参数（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"long_query_time"},{"Type":"NodeText","Data":"​，默认 10s）的所有语句日志。默认未开启，需要修改 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"my.cnf"},{"Type":"NodeText","Data":"​ 开启"}]},{"ID":"20240515023627-1d7ys65","Type":"NodeParagraph","Properties":{"id":"20240515023627-1d7ys65","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"查看慢查询日志是否开启，显示 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ON"},{"Type":"NodeText","Data":"​ 即开启。Windows 默认开启，Linux 默认关闭。"}]},{"ID":"20240515023627-hlyigd2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-hlyigd2","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"show variables like 'slow_query_log';\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-qrhibsb","Type":"NodeParagraph","Properties":{"id":"20240515023627-qrhibsb","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"开启慢查询日志修改配置文件 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/etc/my.cnf"},{"Type":"NodeText","Data":"​，增加以下两行："}]},{"ID":"20240515023627-5vrsf1t","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-5vrsf1t","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# 开启慢查询日志\nshow_query_log = 1\n# 设置记录到慢查询日志的 SQL 语句执行时间为 2s\nlong_query_time = 2\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-k7c8ggt","Type":"NodeParagraph","Properties":{"id":"20240515023627-k7c8ggt","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"之后重启 MySQL 服务器即可。"}]},{"ID":"20240515023627-9zadrro","Type":"NodeParagraph","Properties":{"id":"20240515023627-9zadrro","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"慢查询日志存放于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"主机名-slow.log"},{"Type":"NodeText","Data":"​ 中，Linux 下在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/var/lib/mysql/"},{"Type":"NodeText","Data":"​ 目录中，Windows 下则在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ProgramData\\MySQL\\MySQL Server 8.0\\Data"},{"Type":"NodeText","Data":"​ 目录下。"}]},{"ID":"20240515023627-rervmw5","Type":"NodeParagraph","Properties":{"id":"20240515023627-rervmw5","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"慢查询日志默认不记录管理语句和不使用索引的查找语句，可在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"my.cnf"},{"Type":"NodeText","Data":"​ 增加以下两项配置："}]},{"ID":"20240515023627-tltrqy8","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-tltrqy8","updated":"20240515023628"},"Children":[{"ID":"20240515023627-auc289v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-auc289v","updated":"20240515023627"},"Children":[{"ID":"20240515023627-2t9iyg5","Type":"NodeParagraph","Properties":{"id":"20240515023627-2t9iyg5","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"log_show_admin_statements=1"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240515023627-k1c8ow9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-k1c8ow9","updated":"20240515023627"},"Children":[{"ID":"20240515023627-2cblpbi","Type":"NodeParagraph","Properties":{"id":"20240515023627-2cblpbi","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"log_queries_not_suing_indexes=1"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240515023627-j3oxv5p","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515023627-j3oxv5p","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"profile"}]},{"ID":"20240515024154-lxib663","Type":"NodeParagraph","Properties":{"id":"20240515024154-lxib663","style":"color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);","updated":"20240515024156"},"Children":[{"Type":"NodeText","Data":"MySQL 5.7+ 推荐使用 Performance_shema 取代 profile"}]},{"ID":"20240515023627-3rmfdnc","Type":"NodeParagraph","Properties":{"id":"20240515023627-3rmfdnc","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"show profiles"},{"Type":"NodeText","Data":"​ 指令可以显示每一条语句的耗时详情。"}]},{"ID":"20240515023627-hposrlm","Type":"NodeParagraph","Properties":{"id":"20240515023627-hposrlm","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"使用前先查看是否支持，返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"YES"},{"Type":"NodeText","Data":"​ 即支持"}]},{"ID":"20240515023627-024pv0a","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-024pv0a","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"select @@have_profiling;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-webkkmm","Type":"NodeParagraph","Properties":{"id":"20240515023627-webkkmm","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"检查是否开启了 profile，返回 1 即开启"}]},{"ID":"20240515023627-csn93ex","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-csn93ex","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"-- 检查是否开启\nselect @@profiling;\n-- 开启\nset profiling = 1;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-h74lbag","Type":"NodeParagraph","Properties":{"id":"20240515023627-h74lbag","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"开启后便可以查询所有指令的耗时时间"}]},{"ID":"20240515023627-r1gmagp","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-r1gmagp","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"show profiles;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-8fqny6o","Type":"NodeParagraph","Properties":{"id":"20240515023627-8fqny6o","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"根据上一步给出的结果中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"query_id"},{"Type":"NodeText","Data":"​，可以进一步查询其耗时的详细信息"}]},{"ID":"20240515023627-6dbxxg9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-6dbxxg9","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"-- 检查每个执行阶段的耗时\nshow profile for query query_id;\n-- 检查 CPU 使用情况\nshow profile cpu for query query_id;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-n5zf549","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515023627-n5zf549","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"explain"}]},{"ID":"20240515023627-sow9wl8","Type":"NodeParagraph","Properties":{"id":"20240515023627-sow9wl8","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"explain"},{"Type":"NodeText","Data":"​ 查看 MySQL 的执行计划，可以查询 select 命令执行过程中表如何连接、连接顺序、使用到的索引等情况"}]},{"ID":"20240515023627-k2z01zv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-k2z01zv","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"-- 可以使用 explain 或 desc 均可\nexplain select ...;\ndesc select ...;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-pznuuvs","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-pznuuvs","updated":"20240515023628"},"Children":[{"ID":"20240515023627-otm4w2h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-otm4w2h","updated":"20240515023627"},"Children":[{"ID":"20240515023627-bme7dnc","Type":"NodeParagraph","Properties":{"id":"20240515023627-bme7dnc","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"id"},{"Type":"NodeText","Data":"​：执行顺序；值越大越先执行，值相等从上到下执行"}]}]},{"ID":"20240515023627-lvrkmbq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-lvrkmbq","updated":"20240515023627"},"Children":[{"ID":"20240515023627-w8x00yp","Type":"NodeParagraph","Properties":{"id":"20240515023627-w8x00yp","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select_type"},{"Type":"NodeText","Data":"​：查询类型，参考意义不大"}]},{"ID":"20240515023627-k5tdql6","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-k5tdql6","updated":"20240515023627"},"Children":[{"ID":"20240515023627-ehan21p","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-ehan21p","updated":"20240515023627"},"Children":[{"ID":"20240515023627-gqte2u8","Type":"NodeParagraph","Properties":{"id":"20240515023627-gqte2u8","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"simple"},{"Type":"NodeText","Data":"​：简单表，不使用表连接或子查询"}]}]},{"ID":"20240515023627-kfq8sf5","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-kfq8sf5","updated":"20240515023627"},"Children":[{"ID":"20240515023627-m0fjdti","Type":"NodeParagraph","Properties":{"id":"20240515023627-m0fjdti","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"primary"},{"Type":"NodeText","Data":"​：主查询（外层查询）"}]}]},{"ID":"20240515023627-9hc8vpn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-9hc8vpn","updated":"20240515023627"},"Children":[{"ID":"20240515023627-2t32nhs","Type":"NodeParagraph","Properties":{"id":"20240515023627-2t32nhs","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"union"},{"Type":"NodeText","Data":"​：union 中第二个及之后的查询语句"}]}]},{"ID":"20240515023627-rqn7a1i","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-rqn7a1i","updated":"20240515023627"},"Children":[{"ID":"20240515023627-1nrujmb","Type":"NodeParagraph","Properties":{"id":"20240515023627-1nrujmb","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"subquery"},{"Type":"NodeText","Data":"​：select/where 中包含的子查询"}]}]}]}]},{"ID":"20240515023627-3h5iqsc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-3h5iqsc","updated":"20240515023627"},"Children":[{"ID":"20240515023627-6ggt9u9","Type":"NodeParagraph","Properties":{"id":"20240515023627-6ggt9u9","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"type"},{"Type":"NodeText","Data":"​：连接类型，以下自上而下性能逐渐变差"}]},{"ID":"20240515023627-3h3qxpu","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-3h3qxpu","updated":"20240515023627"},"Children":[{"ID":"20240515023627-5vbqnsu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-5vbqnsu","updated":"20240515023627"},"Children":[{"ID":"20240515023627-wwqgs4u","Type":"NodeParagraph","Properties":{"id":"20240515023627-wwqgs4u","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NULL"},{"Type":"NodeText","Data":"​：查询不访问任何表（类似 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select 值"},{"Type":"NodeText","Data":"​ 这样的语句直接返回值）"}]}]},{"ID":"20240515023627-zt299kc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-zt299kc","updated":"20240515023627"},"Children":[{"ID":"20240515023627-2o0s8tv","Type":"NodeParagraph","Properties":{"id":"20240515023627-2o0s8tv","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"system"},{"Type":"NodeText","Data":"​：访问系统表"}]}]},{"ID":"20240515023627-elk7wwe","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-elk7wwe","updated":"20240515023627"},"Children":[{"ID":"20240515023627-lc6fk3d","Type":"NodeParagraph","Properties":{"id":"20240515023627-lc6fk3d","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"const"},{"Type":"NodeText","Data":"​：根据主键或唯一索引访问"}]}]},{"ID":"20240515023627-jxjtygz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-jxjtygz","updated":"20240515023627"},"Children":[{"ID":"20240515023627-1totulr","Type":"NodeParagraph","Properties":{"id":"20240515023627-1totulr","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"eq_ref"},{"Type":"NodeText","Data":"​：子查询的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"const"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240515023627-361tmq1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-361tmq1","updated":"20240515023627"},"Children":[{"ID":"20240515023627-5aysjtk","Type":"NodeParagraph","Properties":{"id":"20240515023627-5aysjtk","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ref"},{"Type":"NodeText","Data":"​：使用非唯一索引进行访问"}]}]},{"ID":"20240515023627-fql31sp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-fql31sp","updated":"20240515023627"},"Children":[{"ID":"20240515023627-1sjlgoh","Type":"NodeParagraph","Properties":{"id":"20240515023627-1sjlgoh","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"range"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240515023627-zoqv6k8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-zoqv6k8","updated":"20240515023627"},"Children":[{"ID":"20240515023627-478bwrt","Type":"NodeParagraph","Properties":{"id":"20240515023627-478bwrt","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"index"},{"Type":"NodeText","Data":"​：遍历整个索引树"}]}]},{"ID":"20240515023627-lo2idz9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-lo2idz9","updated":"20240515023627"},"Children":[{"ID":"20240515023627-h47heq9","Type":"NodeParagraph","Properties":{"id":"20240515023627-h47heq9","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"all"},{"Type":"NodeText","Data":"​：全表扫描"}]}]}]}]},{"ID":"20240515023627-5sjbf7j","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-5sjbf7j","updated":"20240515023627"},"Children":[{"ID":"20240515023627-o0akc27","Type":"NodeParagraph","Properties":{"id":"20240515023627-o0akc27","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"possible_key"},{"Type":"NodeText","Data":"​：可能用到的索引"}]}]},{"ID":"20240515023627-fpeawfj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-fpeawfj","updated":"20240515023627"},"Children":[{"ID":"20240515023627-zisnzxt","Type":"NodeParagraph","Properties":{"id":"20240515023627-zisnzxt","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"key"},{"Type":"NodeText","Data":"​：实际使用到的索引"}]}]},{"ID":"20240515023627-cf34e14","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-cf34e14","updated":"20240515023627"},"Children":[{"ID":"20240515023627-iwlnaax","Type":"NodeParagraph","Properties":{"id":"20240515023627-iwlnaax","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"key_len"},{"Type":"NodeText","Data":"​：使用到的索引字节数，索引字段可能的最大长度。不失真的情况下越短越好"}]}]},{"ID":"20240515023627-ynkretf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-ynkretf","updated":"20240515023627"},"Children":[{"ID":"20240515023627-ezirs66","Type":"NodeParagraph","Properties":{"id":"20240515023627-ezirs66","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rows"},{"Type":"NodeText","Data":"​：执行查询的行数（InnoDB 为预估值）"}]}]},{"ID":"20240515023627-7p9gbac","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-7p9gbac","updated":"20240515023627"},"Children":[{"ID":"20240515023627-upjddrm","Type":"NodeParagraph","Properties":{"id":"20240515023627-upjddrm","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"filter"},{"Type":"NodeText","Data":"​：查询行数占总读取行数的百分比，越大越好"}]}]},{"ID":"20240515023627-a3tt00l","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-a3tt00l","updated":"20240515023627"},"Children":[{"ID":"20240515023627-ha966t8","Type":"NodeParagraph","Properties":{"id":"20240515023627-ha966t8","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"extra"},{"Type":"NodeText","Data":"​：额外信息"}]}]}]},{"ID":"20240515023627-maqz4wv","Type":"NodeParagraph","Properties":{"id":"20240515023627-maqz4wv","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"主要关注的字段有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"type"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"possible_key"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"key"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"key_len"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rows"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"extra"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20240515023627-c431fjw","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-c431fjw","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"索引失效"}]},{"ID":"20240515023627-a9utqla","Type":"NodeParagraph","Properties":{"id":"20240515023627-a9utqla","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"某些情况下，数据查询不会通过索引："}]},{"ID":"20240515023627-q8js9i2","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-q8js9i2","updated":"20240515023628"},"Children":[{"ID":"20240515023627-dvr8ycc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-dvr8ycc","updated":"20240515023627"},"Children":[{"ID":"20240515023627-svavw4a","Type":"NodeParagraph","Properties":{"id":"20240515023627-svavw4a","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"最左前缀法则：联合索引中，查询需要从索引最左列开始，不跳过索引中间列"}]},{"ID":"20240515023627-hozdj4w","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-hozdj4w","updated":"20240515023627"},"Children":[{"ID":"20240515023627-oenb8gd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-oenb8gd","updated":"20240515023627"},"Children":[{"ID":"20240515023627-92gtcyj","Type":"NodeParagraph","Properties":{"id":"20240515023627-92gtcyj","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"跳过则产生索引部分失效现象，跳过字段之后的字段全部失效"}]}]},{"ID":"20240515023627-7qw73sx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-7qw73sx","updated":"20240515023627"},"Children":[{"ID":"20240515023627-mxfmj70","Type":"NodeParagraph","Properties":{"id":"20240515023627-mxfmj70","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"MySQL 8+ 不包含最左侧列时不会全部失效"}]}]}]}]},{"ID":"20240515023627-gr9rmyb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-gr9rmyb","updated":"20240515023627"},"Children":[{"ID":"20240515023627-46dnyv9","Type":"NodeParagraph","Properties":{"id":"20240515023627-46dnyv9","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"范围查询：联合查询时出现 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026gt;"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;"},{"Type":"NodeText","Data":"​ 范围查询，索引失效"}]},{"ID":"20240515023627-q7f4v8g","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-q7f4v8g","updated":"20240515023627"},"Children":[{"ID":"20240515023627-lubjo5u","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-lubjo5u","updated":"20240515023627"},"Children":[{"ID":"20240515023627-39x820m","Type":"NodeParagraph","Properties":{"id":"20240515023627-39x820m","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"尽量使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026gt;="},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;="},{"Type":"NodeText","Data":"​ 即可使用索引"}]}]}]}]},{"ID":"20240515023627-793mhce","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-793mhce","updated":"20240515023627"},"Children":[{"ID":"20240515023627-zink2qb","Type":"NodeParagraph","Properties":{"id":"20240515023627-zink2qb","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"不要在索引列上进行运算，否则索引失效"}]}]},{"ID":"20240515023627-qreaemj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-qreaemj","updated":"20240515023627"},"Children":[{"ID":"20240515023627-uufvc2m","Type":"NodeParagraph","Properties":{"id":"20240515023627-uufvc2m","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"字符串类型不加引号索引失效（隐式类型转换）"}]}]},{"ID":"20240515023627-gxchvt2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-gxchvt2","updated":"20240515023627"},"Children":[{"ID":"20240515023627-w6labi2","Type":"NodeParagraph","Properties":{"id":"20240515023627-w6labi2","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"模糊查询 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"%"},{"Type":"NodeText","Data":"​ 放在开头会使索引失效"}]}]},{"ID":"20240515023627-rieyp3r","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-rieyp3r","updated":"20240515023627"},"Children":[{"ID":"20240515023627-q6b07vl","Type":"NodeParagraph","Properties":{"id":"20240515023627-q6b07vl","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"or"},{"Type":"NodeText","Data":"​ 连接时，若前后两个条件存在无索引的情况，另一个条件索引失效"}]},{"ID":"20240515023627-k3y2403","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-k3y2403","updated":"20240515023627"},"Children":[{"ID":"20240515023627-qa9ve99","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-qa9ve99","updated":"20240515023627"},"Children":[{"ID":"20240515023627-8aqwt83","Type":"NodeParagraph","Properties":{"id":"20240515023627-8aqwt83","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"可使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"union"},{"Type":"NodeText","Data":"​ 或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"union all"},{"Type":"NodeText","Data":"​ 规避"}]}]}]}]},{"ID":"20240515023627-yrq47vw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-yrq47vw","updated":"20240515023627"},"Children":[{"ID":"20240515023627-najxt17","Type":"NodeParagraph","Properties":{"id":"20240515023627-najxt17","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"数据分布影响：若 MySQL 评估使用索引比全表扫描更慢，索引失效"}]},{"ID":"20240515023627-4pcarsy","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-4pcarsy","updated":"20240515023627"},"Children":[{"ID":"20240515023627-1u3jmi2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-1u3jmi2","updated":"20240515023627"},"Children":[{"ID":"20240515023627-ksahui5","Type":"NodeParagraph","Properties":{"id":"20240515023627-ksahui5","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"当大多数甚至所有数据都符合条件时，MySQL 自动使用全表扫描，此时效率比索引更高"}]}]}]}]}]},{"ID":"20240515023627-1sjfj82","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-1sjfj82","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"SQL 提示"}]},{"ID":"20240515023627-mfpcm0m","Type":"NodeParagraph","Properties":{"id":"20240515023627-mfpcm0m","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"当某个查询可以选择多个索引时，MySQL 可以自动评估效率最高的一个索引。但我们可以通过 SQL 提示向 SQL 语句中人为插入提示选择索引达到优化效果"}]},{"ID":"20240515023627-txym7f0","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-txym7f0","updated":"20240515023628"},"Children":[{"ID":"20240515023627-ha2jwf3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-ha2jwf3","updated":"20240515023627"},"Children":[{"ID":"20240515023627-rsdtvxl","Type":"NodeParagraph","Properties":{"id":"20240515023627-rsdtvxl","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"use index：建议 MySQL 使用某索引"}]}]},{"ID":"20240515023627-0ae02js","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-0ae02js","updated":"20240515023627"},"Children":[{"ID":"20240515023627-hpufh8a","Type":"NodeParagraph","Properties":{"id":"20240515023627-hpufh8a","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"ignore index：使 MySQL 忽略某索引"}]}]},{"ID":"20240515023627-uufgjwe","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-uufgjwe","updated":"20240515023627"},"Children":[{"ID":"20240515023627-d3loiqt","Type":"NodeParagraph","Properties":{"id":"20240515023627-d3loiqt","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"force index：强制 MySQL 使用某索引"}]}]}]},{"ID":"20240515023627-u6qmuj1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-u6qmuj1","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"select * from 表 use|ignore|force index(索引名) where ...\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-x0fzghk","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-x0fzghk","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"覆盖索引"}]},{"ID":"20240515023627-r32g11r","Type":"NodeParagraph","Properties":{"id":"20240515023627-r32g11r","updated":"20240515024249"},"Children":[{"Type":"NodeText","Data":"覆盖索引：在查询中使用了索引，且查询需要返回的列在索引中已经全部找到，则只返回索引的列（也可以包含主键），不要返回其他数据或 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select *"},{"Type":"NodeText","Data":"​，可以省去一次回表查询。"}]},{"ID":"20240515023627-3yjk5ok","Type":"NodeParagraph","Properties":{"id":"20240515023627-3yjk5ok","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"在此种情况下，根据条件和返回值涉及的字段建立联合索引通常比只根据条件建立的索引效率更高"}]},{"ID":"20240515023627-nbyyj0u","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-nbyyj0u","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"前缀索引"}]},{"ID":"20240515023627-qf06ey8","Type":"NodeParagraph","Properties":{"id":"20240515023627-qf06ey8","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"当存储的数据为字符串，且字符串很长时，针对其建立的索引会很大，查询时也会浪费大量的磁盘 IO。此时仅使用字符串的部分前缀作为索引可以节约索引空间，提高索引效率"}]},{"ID":"20240515023627-t32i57n","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-t32i57n","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"create index 索引名 on 表名(字段名(字符串前缀长度));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-hzek47o","Type":"NodeParagraph","Properties":{"id":"20240515023627-hzek47o","updated":"20240515023628"},"Children":[{"Type":"NodeText","Data":"长度通常根据索引的选择性决定，选择性指不重复的索引值与记录总数的比值，越高则查询效率越好。可以直接通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 查询出条目数后相除获取"}]},{"ID":"20240515023627-b36lm34","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515023627-b36lm34","updated":"20240515023628"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"select count(distinct substring(字段名, 1, 长度)) / count(*) from 表名;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515023627-53d1azt","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515023627-53d1azt","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"设计原则"}]},{"ID":"20240515023627-duv0930","Type":"NodeList","ListData":{},"Properties":{"id":"20240515023627-duv0930","updated":"20240515023627"},"Children":[{"ID":"20240515023627-bct1miz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-bct1miz","updated":"20240515023627"},"Children":[{"ID":"20240515023627-2z09ylr","Type":"NodeParagraph","Properties":{"id":"20240515023627-2z09ylr","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"针对数据量大（\u003e100W），查询频繁的表建立索引"}]}]},{"ID":"20240515023627-8lhewkb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-8lhewkb","updated":"20240515023627"},"Children":[{"ID":"20240515023627-kf9cfk6","Type":"NodeParagraph","Properties":{"id":"20240515023627-kf9cfk6","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"针对常用于查询 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"where"},{"Type":"NodeText","Data":"​、排序 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"order by"},{"Type":"NodeText","Data":"​、分组 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"group by"},{"Type":"NodeText","Data":"​ 操作的字段建立索引"}]}]},{"ID":"20240515023627-fpeak1i","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-fpeak1i","updated":"20240515023627"},"Children":[{"ID":"20240515023627-m1f9v0f","Type":"NodeParagraph","Properties":{"id":"20240515023627-m1f9v0f","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"尽量选择区分度高的列（重复元素少）作为索引，尽量使用唯一索引"}]}]},{"ID":"20240515023627-0wz03j8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-0wz03j8","updated":"20240515023627"},"Children":[{"ID":"20240515023627-0s5zwvy","Type":"NodeParagraph","Properties":{"id":"20240515023627-0s5zwvy","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"长字符串可以考虑前缀索引"}]}]},{"ID":"20240515023627-nmqcmyy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-nmqcmyy","updated":"20240515023627"},"Children":[{"ID":"20240515023627-8701pv7","Type":"NodeParagraph","Properties":{"id":"20240515023627-8701pv7","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"尽量使用联合索引而非单列索引，利用覆盖索引的特性，节省存储空间，避免回表"}]}]},{"ID":"20240515023627-jkqfyb4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-jkqfyb4","updated":"20240515023627"},"Children":[{"ID":"20240515023627-s6py8ys","Type":"NodeParagraph","Properties":{"id":"20240515023627-s6py8ys","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"控制索引数量，减少维护索引结构的代价（影响增加、删除、修改表的效率，空间占用）"}]}]},{"ID":"20240515023627-70ii0gp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515023627-70ii0gp","updated":"20240515023627"},"Children":[{"ID":"20240515023627-9z7dale","Type":"NodeParagraph","Properties":{"id":"20240515023627-9z7dale","updated":"20240515023627"},"Children":[{"Type":"NodeText","Data":"若索引列不能存储 NULL 值，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"not null"},{"Type":"NodeText","Data":"​ 约束，方便 MySQL 优化"}]}]}]}]}