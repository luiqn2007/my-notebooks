{"ID":"20240515025823-fosa31t","Spec":"1","Type":"NodeDocument","Properties":{"icon":"mysql.ico","id":"20240515025823-fosa31t","title":"事务原理","type":"doc","updated":"20240515025850"},"Children":[{"ID":"20240515025838-pki553y","Type":"NodeParagraph","Properties":{"id":"20240515025838-pki553y","updated":"20240515025845"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230810184943"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230810184943-20240515025845-brvzxfd.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515025838-gy2nogd","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025838-gy2nogd","updated":"20240515025850"},"Children":[{"Type":"NodeText","Data":"重做日志"}]},{"ID":"20240515025838-5x3ldp7","Type":"NodeParagraph","Properties":{"id":"20240515025838-5x3ldp7","updated":"20240515025839"},"Children":[{"Type":"NodeText","Data":"redo log，记录事务提交时数据页的物理修改，实现事务的持久性"}]},{"ID":"20240515025838-ib2geer","Type":"NodeParagraph","Properties":{"id":"20240515025838-ib2geer","updated":"20240515025850"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230810190029"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230810190029-20240515025850-4ufcokc.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515025838-6subb80","Type":"NodeParagraph","Properties":{"id":"20240515025838-6subb80","updated":"20240515025839"},"Children":[{"Type":"NodeText","Data":"当事务提交之后，所有修改信息会记录到重做日志中，用于刷新脏页到磁盘发生错误时进行数据恢复"}]},{"ID":"20240515025838-6r8fczh","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025838-6r8fczh","updated":"20240515025839"},"Children":[{"ID":"20240515025838-xspwlat","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025838-xspwlat","updated":"20240515025838"},"Children":[{"ID":"20240515025838-2lxe68b","Type":"NodeParagraph","Properties":{"id":"20240515025838-2lxe68b","updated":"20240515025838"},"Children":[{"Type":"NodeText","Data":"将 redo log 写入磁盘是事务的一部分，写入失败会造成事务失败"}]}]},{"ID":"20240515025838-f8ih226","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025838-f8ih226","updated":"20240515025838"},"Children":[{"ID":"20240515025838-3g5kips","Type":"NodeParagraph","Properties":{"id":"20240515025838-3g5kips","updated":"20240515025838"},"Children":[{"Type":"NodeText","Data":"不直接将数据写入磁盘而是写入日志，主要由于日志写入是追加，不涉及到随机 IO 操作，性能更高"}]}]}]},{"ID":"20240515025838-0bzvaki","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025838-0bzvaki","updated":"20240515025838"},"Children":[{"Type":"NodeText","Data":"回滚日志"}]},{"ID":"20240515025838-fkoixiq","Type":"NodeParagraph","Properties":{"id":"20240515025838-fkoixiq","updated":"20240515025839"},"Children":[{"Type":"NodeText","Data":"undo log，记录数据被修改前的信息，提供回滚和 MVCC，保证数据库原子性"}]},{"ID":"20240515025838-o5ova11","Type":"NodeParagraph","Properties":{"id":"20240515025838-o5ova11","updated":"20240515025839"},"Children":[{"Type":"NodeText","Data":"与 redo log 不同的是，redo log 记录了新数据的数据内容，属于物理日志；undo log 记录了与执行的操作相反的 SQL 语句，属于逻辑日志。当我们执行 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"rollback"},{"Type":"NodeText","Data":"​ 时，可以方便的从 undo log 中找到相应内容并回滚。"}]},{"ID":"20240515025838-qeikwzr","Type":"NodeParagraph","Properties":{"id":"20240515025838-qeikwzr","updated":"20240515025839"},"Children":[{"Type":"NodeText","Data":"undo log 在事务执行时产生，事务提交后不会立即删除，当不涉及 MVCC 后再删除。"}]},{"ID":"20240515025838-w9jjz70","Type":"NodeParagraph","Properties":{"id":"20240515025838-w9jjz70","updated":"20240515025839"},"Children":[{"Type":"NodeText","Data":"undo log 以段方式记录和管理，存放于 rollback segment，内包含 1024 个 undo log segment。"}]}]}