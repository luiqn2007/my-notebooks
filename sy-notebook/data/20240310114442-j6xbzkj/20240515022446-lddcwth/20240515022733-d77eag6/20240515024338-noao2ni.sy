{"ID":"20240515024338-noao2ni","Spec":"1","Type":"NodeDocument","Properties":{"icon":"mysql.ico","id":"20240515024338-noao2ni","title":"主键优化","type":"doc","updated":"20240515024444"},"Children":[{"ID":"20240515024348-g0op7qq","Type":"NodeParagraph","Properties":{"id":"20240515024348-g0op7qq","updated":"20240515024348"},"Children":[{"Type":"NodeText","Data":"IOT：InnoDB 中，表数据根据主键顺序存放，这类存储方式建立的表称为索引组织表（Index Organized Table，IOT）"}]},{"ID":"20240515024348-fg31e5y","Type":"NodeParagraph","Properties":{"id":"20240515024348-fg31e5y","updated":"20240515024348"},"Children":[{"Type":"NodeText","Data":"页分裂：InnoDB 中，页可以为空，可以填充一半，也可以填充满。但每个页至少包含 2 条数据。根据这个原则，当插入的数据根据主键排序不在末尾，且所在页剩余空间无法完全容纳他时，引起页分裂现象："}]},{"ID":"20240515024401-ep9v2tn","Type":"NodeParagraph","Properties":{"id":"20240515024401-ep9v2tn","updated":"20240515024401"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230727233816"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230727233816-20240515024401-eqohdrs.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515024348-o12qcaa","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240515024348-o12qcaa","updated":"20240515024348"},"Children":[{"ID":"20240515024348-9a7zvxq","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240515024348-9a7zvxq","updated":"20240515024348"},"Children":[{"ID":"20240515024348-t8mpex4","Type":"NodeParagraph","Properties":{"id":"20240515024348-t8mpex4","updated":"20240515024348"},"Children":[{"Type":"NodeText","Data":"所在页 1 从中间分裂成两页 1 和 3"}]}]}]},{"ID":"20240515024348-v5g9tab","Type":"NodeParagraph","Properties":{"id":"20240515024348-v5g9tab","updated":"20240515024406"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230727233846"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230727233846-20240515024406-17wmqvh.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515024348-n53j4vz","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240515024348-n53j4vz","updated":"20240515024348"},"Children":[{"ID":"20240515024348-xh4epmy","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240515024348-xh4epmy","updated":"20240515024348"},"Children":[{"ID":"20240515024348-ayztszv","Type":"NodeParagraph","Properties":{"id":"20240515024348-ayztszv","updated":"20240515024348"},"Children":[{"Type":"NodeText","Data":"将待插入数据插入到正确位置"}]}]}]},{"ID":"20240515024348-n3y6dxd","Type":"NodeParagraph","Properties":{"id":"20240515024348-n3y6dxd","updated":"20240515024410"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230727233857"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230727233857-20240515024410-aftskbd.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515024348-25pvmn4","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240515024348-25pvmn4","updated":"20240515024348"},"Children":[{"ID":"20240515024348-dv04vvt","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240515024348-dv04vvt","updated":"20240515024348"},"Children":[{"ID":"20240515024348-2j4gl6n","Type":"NodeParagraph","Properties":{"id":"20240515024348-2j4gl6n","updated":"20240515024348"},"Children":[{"Type":"NodeText","Data":"将 3 与原本 1 后面的页 2 之间创建双向链接，将 1 与 3 之间创建双向链接"}]}]}]},{"ID":"20240515024348-46nh0w8","Type":"NodeParagraph","Properties":{"id":"20240515024348-46nh0w8","updated":"20240515024415"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230727233929"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230727233929-20240515024415-izogktf.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515024348-8gxu91a","Type":"NodeParagraph","Properties":{"id":"20240515024348-8gxu91a","updated":"20240515024348"},"Children":[{"Type":"NodeText","Data":"页合并：当删除一个数据时，不会真正删除数据，而是做一个数据废弃的标记。当删除的数据达到一定的阈值时（MERGE_THRESHOLD，默认 50%），InnoDB 自动查找上一个或下一个表，若可以合并则进行合并操作。MERGE_THRESHOLD 可以在创建表或创建索引时设定"}]},{"ID":"20240515024348-ccub0hs","Type":"NodeParagraph","Properties":{"id":"20240515024348-ccub0hs","updated":"20240515024419"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230727234158"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230727234158-20240515024419-yvlkh8y.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515024348-75951un","Type":"NodeParagraph","Properties":{"id":"20240515024348-75951un","updated":"20240515024423"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230727234235"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230727234235-20240515024423-9hzz3oc.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515024444-1g01jy7","Type":"NodeBlockquote","Properties":{"id":"20240515024444-1g01jy7","updated":"20240515024445"},"Children":[{"ID":"20240515024435-7gx2zux","Type":"NodeParagraph","Properties":{"id":"20240515024435-7gx2zux","updated":"20240515024445"},"Children":[{"Type":"NodeText","Data":"主键设计原则"}]},{"ID":"20240515024435-pdu50dw","Type":"NodeList","ListData":{},"Properties":{"id":"20240515024435-pdu50dw","updated":"20240515024445"},"Children":[{"ID":"20240515024435-aar6nu1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515024435-aar6nu1","updated":"20240515024435"},"Children":[{"ID":"20240515024435-fsz2pzp","Type":"NodeParagraph","Properties":{"id":"20240515024435-fsz2pzp","updated":"20240515024435"},"Children":[{"Type":"NodeText","Data":"满足需求的条件下，尽量降低主键长度，减少二级索引中主键长度，减少磁盘 IO"}]}]},{"ID":"20240515024435-5jwjtp8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515024435-5jwjtp8","updated":"20240515024435"},"Children":[{"ID":"20240515024435-ibzmlu9","Type":"NodeParagraph","Properties":{"id":"20240515024435-ibzmlu9","updated":"20240515024435"},"Children":[{"Type":"NodeText","Data":"插入时尽量按主键顺序插入，尽量选择 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"auto_increment"},{"Type":"NodeText","Data":"​ 自增主键"}]}]},{"ID":"20240515024435-iyfjnha","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515024435-iyfjnha","updated":"20240515024435"},"Children":[{"ID":"20240515024435-4ysyri1","Type":"NodeParagraph","Properties":{"id":"20240515024435-4ysyri1","updated":"20240515024435"},"Children":[{"Type":"NodeText","Data":"尽量不要使用 UUID 或身份证号等自然主键"}]}]},{"ID":"20240515024435-l4yc8ey","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515024435-l4yc8ey","updated":"20240515024435"},"Children":[{"ID":"20240515024435-8iqtkew","Type":"NodeParagraph","Properties":{"id":"20240515024435-8iqtkew","updated":"20240515024435"},"Children":[{"Type":"NodeText","Data":"尽量不要修改主键值"}]}]}]},{"Type":"NodeBlockquoteMarker","Data":"\u003e"}]},{"ID":"20240515024444-5u8zhyr","Type":"NodeParagraph","Properties":{"id":"20240515024444-5u8zhyr"}}]}