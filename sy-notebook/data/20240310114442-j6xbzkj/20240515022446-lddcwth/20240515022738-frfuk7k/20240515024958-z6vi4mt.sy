{"ID":"20240515024958-z6vi4mt","Spec":"1","Type":"NodeDocument","Properties":{"icon":"mysql.ico","id":"20240515024958-z6vi4mt","title":"存储过程","type":"doc","updated":"20240515025306"},"Children":[{"ID":"20240515025021-h8gcz6s","Type":"NodeParagraph","Properties":{"id":"20240515025021-h8gcz6s","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"存储过程：事先编译并存储在数据库中的一段 SQL 语句的集合（类似一个函数），是数据库 SQL 语言层面上的代码封装与重用"}]},{"ID":"20240515025021-xhy9j1y","Type":"NodeParagraph","Properties":{"id":"20240515025021-xhy9j1y","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"特点："}]},{"ID":"20240515025021-se038kp","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025021-se038kp","updated":"20240515025021"},"Children":[{"ID":"20240515025021-0kzm6l4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025021-0kzm6l4","updated":"20240515025021"},"Children":[{"ID":"20240515025021-zslku5f","Type":"NodeParagraph","Properties":{"id":"20240515025021-zslku5f","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"封装，复用"}]}]},{"ID":"20240515025021-mzz4vrn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025021-mzz4vrn","updated":"20240515025021"},"Children":[{"ID":"20240515025021-9rvb853","Type":"NodeParagraph","Properties":{"id":"20240515025021-9rvb853","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"支持参数和返回值"}]}]},{"ID":"20240515025021-33fze00","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025021-33fze00","updated":"20240515025021"},"Children":[{"ID":"20240515025021-ml0yg79","Type":"NodeParagraph","Properties":{"id":"20240515025021-ml0yg79","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"减少数据库与服务器之间的网络传输，提升效率"}]}]}]},{"ID":"20240515025021-nl15ibu","Type":"NodeParagraph","Properties":{"id":"20240515025021-nl15ibu","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"创建："}]},{"ID":"20240515025021-s4qqguj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515025021-s4qqguj","updated":"20240515025021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"create procedure 存储过程名称(参数)\nbegin\n  -- 需要执行的 SQL 语句，注意不能省略 ;\nend;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515025021-uus0yuu","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025021-uus0yuu","updated":"20240515025021"},"Children":[{"ID":"20240515025021-nz0ix4y","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025021-nz0ix4y","updated":"20240515025021"},"Children":[{"ID":"20240515025021-8jj8182","Type":"NodeParagraph","Properties":{"id":"20240515025021-8jj8182","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"注意：使用 SHELL 命令行创建时，需要先使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"delimiter 新符号或字符串"},{"Type":"NodeText","Data":"​ 更改下结束语句的符号，并将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"end"},{"Type":"NodeText","Data":"​ 后的分号更换为新符号。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"delimiter"},{"Type":"NodeText","Data":"​ 不影响 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"begin"},{"Type":"NodeText","Data":"​ 与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"end"},{"Type":"NodeText","Data":"​ 之间的语句"}]}]}]},{"ID":"20240515025021-dlubytc","Type":"NodeParagraph","Properties":{"id":"20240515025021-dlubytc","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"删除："}]},{"ID":"20240515025021-ar2yx7p","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515025021-ar2yx7p","updated":"20240515025021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"drop procedure [if exists] 存储过程名;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515025021-sdhvnzf","Type":"NodeParagraph","Properties":{"id":"20240515025021-sdhvnzf","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"使用："}]},{"ID":"20240515025021-csriy2u","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515025021-csriy2u","updated":"20240515025021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"call 存储过程名称(参数);\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515025021-x6i1yv0","Type":"NodeParagraph","Properties":{"id":"20240515025021-x6i1yv0","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"创建后，可通过内置表查找所有的存储过程（包含系统和自定义的），并通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"show"},{"Type":"NodeText","Data":"​ 查看存储过程创建语句："}]},{"ID":"20240515025021-i4tyhqw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515025021-i4tyhqw","updated":"20240515025021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"-- 显示所有存储过程\nselect * from INFORMATION_SCHEMA.ROUTINES where ROUTINE_SCHEMA = '存储过程名';\n-- 查看存储过程定义\nshow create procedure 存储过程名;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515025021-jj97mec","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515025021-jj97mec","updated":"20240515025306"},"Children":[{"Type":"NodeText","Data":"系统变量"}]},{"ID":"20240515025021-34kai14","Type":"NodeParagraph","Properties":{"id":"20240515025021-34kai14","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"MySQL 服务器提供的变量，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"session|global"},{"Type":"NodeText","Data":"​ 省略时默认为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"session"},{"Type":"NodeText","Data":"​\n\t- 使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"show [session|global] variables [like ...]"},{"Type":"NodeText","Data":"​ 查看所有（名称满足条件的）系统变量\n\t- 使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select @@[session.|global.]系统变量名"},{"Type":"NodeText","Data":"​ 查看指定系统变量\n\t- 使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"set [@@][session|global] 系统变量名 = 值"},{"Type":"NodeText","Data":"​ 设置系统变量"}]},{"ID":"20240515025021-m2xe650","Type":"NodeParagraph","Properties":{"id":"20240515025021-m2xe650","style":"color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);","updated":"20240515025256"},"Children":[{"Type":"NodeText","Data":"注意：即便修改了全局变量，下次重启 MySQL 也会恢复到默认情况。永久更改需要更改 "},{"Type":"NodeTextMark","Properties":{"parent-style":"color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);"},"TextMarkType":"code","TextMarkTextContent":"my.conf"},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);\"}"},{"Type":"NodeText","Data":"​ 配置文件"}]},{"ID":"20240515025021-1u95k2k","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515025021-1u95k2k","updated":"20240515025306"},"Children":[{"Type":"NodeText","Data":"用户变量"}]},{"ID":"20240515025021-ug5cspg","Type":"NodeParagraph","Properties":{"id":"20240515025021-ug5cspg","updated":"20240515025306"},"Children":[{"Type":"NodeText","Data":"用户自己定义的变量，作用域为当前会话。用户变量通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@变量名"},{"Type":"NodeText","Data":"​ 使用，不需要声明。当不存在时返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"null"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515025021-8gy40au","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515025021-8gy40au","updated":"20240515025021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"-- 赋值\nset @变量名 = 值;\nset @变量名 := 值;\nselect @变量名 := 值;\nselect 字段名 into @变量名 from 表名 where ...;\n-- 查看\nselect @变量名;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515025021-fcrgyui","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515025021-fcrgyui","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"局部变量"}]},{"ID":"20240515025021-i2crpl3","Type":"NodeParagraph","Properties":{"id":"20240515025021-i2crpl3","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"局部变量使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"declare"},{"Type":"NodeText","Data":"​ 声明，变量类型详见[[MySQL 数据类型]]，其有效范围在其所在的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"begin...end"},{"Type":"NodeText","Data":"​ 块中："}]},{"ID":"20240515025021-qu5ni4p","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515025021-qu5ni4p","updated":"20240515025021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"-- 声明变量\ndeclare 变量名 变量类型 [default 默认值];\n-- 变量赋值\nset 变量名 = 值;\nset 变量名 := 值;\nselect 字段名 into 变量名 from 表名 where ...;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515025021-17ujlf7","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515025021-17ujlf7","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"参数传递"}]},{"ID":"20240515025021-xberhqv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515025021-xberhqv","updated":"20240515025021"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"create procedure 过程名([in|out|inout] 变量名 类型， ...)\nbegin\n  -- ...\nend;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515025021-9wflmc6","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025021-9wflmc6","updated":"20240515025021"},"Children":[{"ID":"20240515025021-enhyb80","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025021-enhyb80","updated":"20240515025021"},"Children":[{"ID":"20240515025021-toyy971","Type":"NodeParagraph","Properties":{"id":"20240515025021-toyy971","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"in：仅输入，默认，参数仅作传入参数"}]}]},{"ID":"20240515025021-tciifep","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025021-tciifep","updated":"20240515025021"},"Children":[{"ID":"20240515025021-9l77mop","Type":"NodeParagraph","Properties":{"id":"20240515025021-9l77mop","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"out：仅输出，改变后会改变原变量，但不能读取值"}]}]},{"ID":"20240515025021-7p63w9l","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025021-7p63w9l","updated":"20240515025021"},"Children":[{"ID":"20240515025021-n1cxrqy","Type":"NodeParagraph","Properties":{"id":"20240515025021-n1cxrqy","updated":"20240515025021"},"Children":[{"Type":"NodeText","Data":"inout：既输入又输出"}]}]}]},{"ID":"20240515025021-iohzqsd","Type":"NodeParagraph","Properties":{"id":"20240515025021-iohzqsd","updated":"20240515025021"}}]}