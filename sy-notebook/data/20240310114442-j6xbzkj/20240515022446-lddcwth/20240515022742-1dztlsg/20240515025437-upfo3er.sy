{"ID":"20240515025437-upfo3er","Spec":"1","Type":"NodeDocument","Properties":{"icon":"mysql.ico","id":"20240515025437-upfo3er","title":"表级锁","type":"doc","updated":"20240515025448"},"Children":[{"ID":"20240515025448-ro3lepi","Type":"NodeParagraph","Properties":{"id":"20240515025448-ro3lepi","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"每次锁住整张表，锁定粒度大，冲突概率最高，并发度低，应用于 MyISAM、InnoDB、BDB 等引擎中"}]},{"ID":"20240515025448-gha7yrt","Type":"NodeParagraph","Properties":{"id":"20240515025448-gha7yrt","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"表级锁通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"unlock tables"},{"Type":"NodeText","Data":"​ 释放，或客户端断开连接后自动释放。"}]},{"ID":"20240515025448-2uqw3hm","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025448-2uqw3hm","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"表锁"}]},{"ID":"20240515025448-sw2hn3o","Type":"NodeParagraph","Properties":{"id":"20240515025448-sw2hn3o","updated":"20240515025449"},"Children":[{"Type":"NodeText","Data":"表锁分为两种："}]},{"ID":"20240515025448-d51cb7e","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025448-d51cb7e","updated":"20240515025449"},"Children":[{"ID":"20240515025448-hc2tf10","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025448-hc2tf10","updated":"20240515025448"},"Children":[{"ID":"20240515025448-yy8f2vw","Type":"NodeParagraph","Properties":{"id":"20240515025448-yy8f2vw","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"表共享读锁，读锁：不影响读表数据，当前客户端修改数据失败，其他客户端修改数据阻塞"}]}]},{"ID":"20240515025448-5utlcj9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025448-5utlcj9","updated":"20240515025448"},"Children":[{"ID":"20240515025448-vjbimk3","Type":"NodeParagraph","Properties":{"id":"20240515025448-vjbimk3","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"表独占写锁，写锁：当前客户端读写均正常，其余客户端读写均阻塞"}]}]}]},{"ID":"20240515025448-olztn1f","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240515025448-olztn1f","updated":"20240515025449"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bXlzcWw="},{"Type":"NodeCodeBlockCode","Data":"# 加锁\nlock tables 表名... read|write\n# 释放锁\nunlock tables\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240515025448-woijzqi","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025448-woijzqi","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"元数据锁"}]},{"ID":"20240515025448-40lnide","Type":"NodeParagraph","Properties":{"id":"20240515025448-40lnide","updated":"20240515025449"},"Children":[{"Type":"NodeText","Data":"元数据锁（MDL，Meta Data Lock）由系统控制，无法显式使用。维护表元数据的一致性，在表上有活动事务时不可对元数据进行写入操作，分为共享（读锁）、排他（写锁）"}]},{"ID":"20240515025448-q3yyc4p","Type":"NodeParagraph","Properties":{"id":"20240515025448-q3yyc4p","updated":"20240515025449"},"Children":[{"Type":"NodeText","Data":"元数据锁保证增删改查操作（事务）和修改表结构不能同时发生"}]},{"ID":"20240515025448-x018h5z","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20240515025448-x018h5z","updated":"20240515025449"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"SQL"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"锁"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"lock table"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"shared_read_only / shared_no_read_write"}]},{"Type":"NodeTableCell","Data":"td"}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"select"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"shared_read"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"兼容 shared_read, shared_write, 与 exclusive 互斥"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"insert, update, delete, select...for update"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"shared_write"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"兼容 shared_read, shared_write, 与 exclusive 互斥"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"alter table"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"exclusive"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"与其他 MDL 互斥"}]}]}]},{"ID":"20240515025448-juy1ui1","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025448-juy1ui1","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"意向锁"}]},{"ID":"20240515025448-xx5i0df","Type":"NodeParagraph","Properties":{"id":"20240515025448-xx5i0df","updated":"20240515025449"},"Children":[{"Type":"NodeText","Data":"意向锁：当某客户端向表加行锁时，会向整张表加一个意向锁（标记），这样当其他客户端要为整张表加表锁时不需要扫描每一行有没有锁冲突，只需要检查有没有冲突的意向锁即可。"}]},{"ID":"20240515025448-tv8aapr","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025448-tv8aapr","updated":"20240515025449"},"Children":[{"ID":"20240515025448-m0vw8lu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025448-m0vw8lu","updated":"20240515025448"},"Children":[{"ID":"20240515025448-tve7bif","Type":"NodeParagraph","Properties":{"id":"20240515025448-tve7bif","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"意向锁不会真正锁住表，只是一个标记表示存在某种行锁"}]}]},{"ID":"20240515025448-kaq9fh1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025448-kaq9fh1","updated":"20240515025448"},"Children":[{"ID":"20240515025448-jgi9iqf","Type":"NodeParagraph","Properties":{"id":"20240515025448-jgi9iqf","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"意向锁解决的是加表锁需要扫描整张表每一行有没有冲突的行锁的效率问题"}]}]},{"ID":"20240515025448-1559efg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025448-1559efg","updated":"20240515025448"},"Children":[{"ID":"20240515025448-7wfd0kg","Type":"NodeParagraph","Properties":{"id":"20240515025448-7wfd0kg","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"当意向锁与待加的表锁冲突时，加表锁的语句阻塞"}]}]}]},{"ID":"20240515025448-hew9xxo","Type":"NodeParagraph","Properties":{"id":"20240515025448-hew9xxo","updated":"20240515025449"},"Children":[{"Type":"NodeText","Data":"意向锁分为两种"}]},{"ID":"20240515025448-jcyz5nd","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025448-jcyz5nd","updated":"20240515025449"},"Children":[{"ID":"20240515025448-mje45is","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025448-mje45is","updated":"20240515025448"},"Children":[{"ID":"20240515025448-cv8klxn","Type":"NodeParagraph","Properties":{"id":"20240515025448-cv8klxn","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"意向共享锁 IS：由 select ... lock in share mode 添加，与表共享锁兼容，与表排它锁互斥"}]}]},{"ID":"20240515025448-vitka12","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025448-vitka12","updated":"20240515025448"},"Children":[{"ID":"20240515025448-wmdci9o","Type":"NodeParagraph","Properties":{"id":"20240515025448-wmdci9o","updated":"20240515025448"},"Children":[{"Type":"NodeText","Data":"意向排它锁 IX：由 insert, update, delete, select ... for update 添加，与所有表锁都互斥"}]}]}]}]}