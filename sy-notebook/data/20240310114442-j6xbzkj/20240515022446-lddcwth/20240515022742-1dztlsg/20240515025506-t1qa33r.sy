{"ID":"20240515025506-t1qa33r","Spec":"1","Type":"NodeDocument","Properties":{"icon":"mysql.ico","id":"20240515025506-t1qa33r","title":"行级锁","type":"doc","updated":"20240515025558"},"Children":[{"ID":"20240515025531-lku1om5","Type":"NodeParagraph","Properties":{"id":"20240515025531-lku1om5","updated":"20240515025539"},"Children":[{"Type":"NodeText","Data":"每次操作行数据时锁定数据所在的行，粒度最小，冲突概率最低，并发度最高，主要在 InnoDB 引擎中使用"}]},{"ID":"20240515025539-unmbvqx","Type":"NodeParagraph","Properties":{"id":"20240515025539-unmbvqx","style":"color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);","updated":"20240515025541"},"Children":[{"Type":"NodeText","Data":"MyISAM 没有行级锁"}]},{"ID":"20240515025531-02vabtj","Type":"NodeParagraph","Properties":{"id":"20240515025531-02vabtj","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"InnoDB 数据基于索引组织，因此行级锁是通过对索引上的索引项加锁实现，而非对整条记录加锁"}]},{"ID":"20240515025531-sj4tt09","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025531-sj4tt09","updated":"20240515025558"},"Children":[{"Type":"NodeText","Data":"行锁"}]},{"ID":"20240515025531-g2c0yp8","Type":"NodeParagraph","Properties":{"id":"20240515025531-g2c0yp8","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"行锁（Record Lock），又叫记录锁，锁定单行记录，防止其他事务对此进行 update、delete"}]},{"ID":"20240515025531-jpw0o9g","Type":"NodeParagraph","Properties":{"id":"20240515025531-jpw0o9g","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"行锁适用于 RC（Read Commit）、RR（Reaptable Read） 隔离级别"}]},{"ID":"20240515025531-jd3mvyz","Type":"NodeParagraph","Properties":{"id":"20240515025531-jd3mvyz","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"行锁分为两种"}]},{"ID":"20240515025531-xrugitb","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025531-xrugitb","updated":"20240515025531"},"Children":[{"ID":"20240515025531-auobdrl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025531-auobdrl","updated":"20240515025531"},"Children":[{"ID":"20240515025531-5et5qyn","Type":"NodeParagraph","Properties":{"id":"20240515025531-5et5qyn","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"共享锁 S：允许任何事务读取该行（获取共享锁），但阻塞其他事务获取该行数据集的排它锁"}]}]},{"ID":"20240515025531-iq5puiz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025531-iq5puiz","updated":"20240515025531"},"Children":[{"ID":"20240515025531-dxkn5vi","Type":"NodeParagraph","Properties":{"id":"20240515025531-dxkn5vi","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"排他锁 X：允许该事务读取和更新数据，但阻止其他事务获取该数据集的共享锁和排他锁"}]}]}]},{"ID":"20240515025531-altd4o6","Type":"NodeParagraph","Properties":{"id":"20240515025531-altd4o6","updated":"20240515025558"},"Children":[{"Type":"NodeText","Data":"加锁类型："}]},{"ID":"20240515025553-yqums7a","Type":"NodeParagraph","Properties":{"id":"20240515025553-yqums7a","updated":"20240515025553"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"Pasted image 20230731184008"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/Pasted image 20230731184008-20240515025553-68br97v.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515025531-whx4fd3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025531-whx4fd3","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"间隙锁"}]},{"ID":"20240515025531-i3orqav","Type":"NodeParagraph","Properties":{"id":"20240515025531-i3orqav","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"间隙锁（Gap Lock）锁定索引间的间隙（不含边界记录），保证索引记录间隙不变，防止其他事务在有锁期间对该间隙进行 insert 操作产生幻读"}]},{"ID":"20240515025531-guk1x8k","Type":"NodeParagraph","Properties":{"id":"20240515025531-guk1x8k","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"间隙锁适用于 RR（Reaptable Read） 隔离级别"}]},{"ID":"20240515025531-t8phys7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025531-t8phys7","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"临键锁"}]},{"ID":"20240515025531-rywl7vr","Type":"NodeParagraph","Properties":{"id":"20240515025531-rywl7vr","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"临键锁（Next-Key Lock），同时锁住数据和数据前的间隙，可以认为是行锁和间隙锁的组合"}]},{"ID":"20240515025531-e3ffoay","Type":"NodeParagraph","Properties":{"id":"20240515025531-e3ffoay","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"临键锁适用于 RR（Reaptable Read） 隔离级别"}]},{"ID":"20240515025531-dvnaj0q","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240515025531-dvnaj0q","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"隔离级别"}]},{"ID":"20240515025531-35dl4rg","Type":"NodeParagraph","Properties":{"id":"20240515025531-35dl4rg","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"默认情况下，InnoDB 运行在 RR 隔离级别下"}]},{"ID":"20240515025531-eyxz2fy","Type":"NodeList","ListData":{},"Properties":{"id":"20240515025531-eyxz2fy","updated":"20240515025531"},"Children":[{"ID":"20240515025531-t6p6o0o","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025531-t6p6o0o","updated":"20240515025531"},"Children":[{"ID":"20240515025531-y359p4v","Type":"NodeParagraph","Properties":{"id":"20240515025531-y359p4v","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"一般使用临键锁对表进行搜索和索引扫描，防止幻读"}]}]},{"ID":"20240515025531-0p2dh85","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025531-0p2dh85","updated":"20240515025531"},"Children":[{"ID":"20240515025531-dqml62f","Type":"NodeParagraph","Properties":{"id":"20240515025531-dqml62f","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"通过唯一索引进行检索，对已存在记录进行等值匹配时，优化为行锁"}]}]},{"ID":"20240515025531-oflm1y8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025531-oflm1y8","updated":"20240515025531"},"Children":[{"ID":"20240515025531-8w9ioam","Type":"NodeParagraph","Properties":{"id":"20240515025531-8w9ioam","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"不通过索引检索数据，则 InnoDB 将对表中记录全部加锁 ，行锁升级为表锁"}]}]},{"ID":"20240515025531-8s0uy37","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025531-8s0uy37","updated":"20240515025531"},"Children":[{"ID":"20240515025531-yin5gbd","Type":"NodeParagraph","Properties":{"id":"20240515025531-yin5gbd","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"通过唯一索引进行等值查询，对不存在记录加锁，优化为间隙锁"}]}]},{"ID":"20240515025531-hx20z9c","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025531-hx20z9c","updated":"20240515025531"},"Children":[{"ID":"20240515025531-j6d0vm3","Type":"NodeParagraph","Properties":{"id":"20240515025531-j6d0vm3","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"通过普通索引进行等值查询，向右遍历最后一个值也不满足需求，退化为间隙锁"}]}]},{"ID":"20240515025531-3elnpyb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240515025531-3elnpyb","updated":"20240515025531"},"Children":[{"ID":"20240515025531-6nepprw","Type":"NodeParagraph","Properties":{"id":"20240515025531-6nepprw","updated":"20240515025531"},"Children":[{"Type":"NodeText","Data":"通过唯一索引进行范围查询，会访问到不满足条件的第一个值为止"}]}]}]}]}