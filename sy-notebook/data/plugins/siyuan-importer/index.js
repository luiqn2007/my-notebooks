"use strict";var Gt=Object.defineProperty;var Kt=(e,t,n)=>t in e?Gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Ce=(e,t,n)=>(Kt(e,typeof t!="symbol"?t+"":t,n),n);const siyuan=require("siyuan"),createLogger=e=>{const t="importer",n=l=>{const s=l.getFullYear(),o=String(l.getMonth()+1).padStart(2,"0"),u=String(l.getDate()).padStart(2,"0"),_=String(l.getHours()).padStart(2,"0"),i=String(l.getMinutes()).padStart(2,"0"),c=String(l.getSeconds()).padStart(2,"0");return`${s}-${o}-${u} ${_}:${i}:${c}`},a=(l,s,o)=>{const u=n(new Date);o?console.log(`[${t}] [${u}] [${l}] [${e}] ${s}`,o):console.log(`[${t}] [${u}] [${l}] [${e}] ${s}`)};return{debug:(l,s)=>a("DEBUG",l,s),info:(l,s)=>a("INFO",l,s),warn:(l,s)=>{const o=n(new Date);s?console.warn(`[${t}] [${o}] [WARN] ${l}`,s):console.warn(`[${t}] [${o}] [WARN] ${l}`)},error:(l,s)=>{typeof l=="string"?a("ERROR",l,s):console.error(`[${t}] [${n(new Date)}] [ERROR] [${e}] error occurred`,l)}}},workspaceDir=`${window.siyuan.config.system.workspaceDir}`;`${window.siyuan.config.system.dataDir}`;const mediaDir="./../assets",isDev=!1,siyuanApiUrl="",siyuanApiToken="";class BaseApi{constructor(){Ce(this,"logger");this.logger=createLogger("base-api")}async siyuanRequest(t,n){const a=`${siyuanApiUrl}${t}`,l={body:JSON.stringify(n),method:"POST"},o=await(await fetch(a,l)).json();if(o.code===-1)throw new Error(o.msg);return o}}function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var bitwise=function(e){var t=0;if(e.length==0)return t;for(var n=0;n<e.length;n++){var a=e.charCodeAt(n);t=(t<<5)-t+a,t=t&t}return t},binaryTransfer=function(e,t){var n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";t=t||62;var a=[],l,s="",o=e<0?"-":"";for(e=Math.abs(e);e>=t;)l=e%t,e=Math.floor(e/t),a.push(n[l]);e>0&&a.push(n[e]);for(var u=a.length-1;u>=0;u--)s+=a[u];return o+s},shortHash=function(e){var t=typeof e;if(t==="string"||t==="number"){var n=binaryTransfer(bitwise(String(e)),61);return n.replace("-","Z")}else throw new Error("Unexpected input type")},dist=shortHash;const shortHash$1=getDefaultExportFromCjs(dist);class KernelApi extends BaseApi{async lsNotebooks(){return await this.siyuanRequest("/api/notebook/lsNotebooks",{})}async openNotebook(t){return await this.siyuanRequest("/api/notebook/openNotebook",{notebook:t})}async readDir(t){return await this.siyuanRequest("/api/file/readDir",{path:t})}putFile(t,n){const a=new FormData;return a.append("path",t),a.append("isDir","false"),a.append("modTime",Math.floor(Date.now()/1e3).toString()),a.append("file",n),new Promise((l,s)=>{siyuan.fetchPost("/api/file/putFile",a,o=>{o.code===0?l(o):s(o)})})}async saveTextData(t,n){return new Promise(a=>{const l=`/temp/convert/pandoc/${t}`,s=new File([new Blob([n])],l.split("/").pop()),o=new FormData;o.append("path",l),o.append("file",s),o.append("isDir","false"),siyuan.fetchPost("/api/file/putFile",o,u=>{a(u)})})}async convertPandoc(t,n){const a={args:["--to","gfm-raw_html+tex_math_dollars+pipe_tables",t,"-o",n,"--extract-media",`${mediaDir}/${shortHash$1(t).toLowerCase()}`,"--wrap=none"]};return await this.siyuanRequest("/api/convert/pandoc",a)}async convertPandocCustom(t){const n={args:t};return await this.siyuanRequest("/api/convert/pandoc",n)}async getFile(t,n){const a=await fetch(`${siyuanApiUrl}/api/file/getFile`,{method:"POST",headers:{Authorization:`Token ${siyuanApiToken}`},body:JSON.stringify({path:t})});if(a.status===200){if(n==="text")return await a.text();if(n==="json")return await a.json()}return null}async removeFile(t){const n={path:t};return await this.siyuanRequest("/api/file/removeFile",n)}async createDocWithMd(t,n,a){const l={notebook:t,path:n,markdown:a};return await this.siyuanRequest("/api/filetree/createDocWithMd",l)}async importStdMd(t,n,a){const l={localPath:t,notebook:n,toPath:a};return await this.siyuanRequest("/api/import/importStdMd",l)}}const index="";function noop(){}function run(e){return e()}function blank_object(){return Object.create(null)}function run_all(e){e.forEach(run)}function is_function(e){return typeof e=="function"}function safe_not_equal(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function is_empty(e){return Object.keys(e).length===0}function null_to_empty(e){return e??""}function append(e,t){e.appendChild(t)}function insert(e,t,n){e.insertBefore(t,n||null)}function detach(e){e.parentNode&&e.parentNode.removeChild(e)}function destroy_each(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function element(e){return document.createElement(e)}function svg_element(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function text(e){return document.createTextNode(e)}function space(){return text(" ")}function listen(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}function attr(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function xlink_attr(e,t,n){e.setAttributeNS("http://www.w3.org/1999/xlink",t,n)}function children(e){return Array.from(e.childNodes)}function set_data(e,t){t=""+t,e.data!==t&&(e.data=t)}function set_input_value(e,t){e.value=t??""}function set_style(e,t,n,a){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,a?"important":"")}function select_option(e,t,n){for(let a=0;a<e.options.length;a+=1){const l=e.options[a];if(l.__value===t){l.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function select_value(e){const t=e.querySelector(":checked");return t&&t.__value}let current_component;function set_current_component(e){current_component=e}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(e){get_current_component().$$.on_mount.push(e)}const dirty_components=[],binding_callbacks=[];let render_callbacks=[];const flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(e){render_callbacks.push(e)}const seen_callbacks=new Set;let flushidx=0;function flush(){if(flushidx!==0)return;const e=current_component;do{try{for(;flushidx<dirty_components.length;){const t=dirty_components[flushidx];flushidx++,set_current_component(t),update(t.$$)}}catch(t){throw dirty_components.length=0,flushidx=0,t}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let t=0;t<render_callbacks.length;t+=1){const n=render_callbacks[t];seen_callbacks.has(n)||(seen_callbacks.add(n),n())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(e)}function update(e){if(e.fragment!==null){e.update(),run_all(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(add_render_callback)}}function flush_render_callbacks(e){const t=[],n=[];render_callbacks.forEach(a=>e.indexOf(a)===-1?t.push(a):n.push(a)),n.forEach(a=>a()),render_callbacks=t}const outroing=new Set;function transition_in(e,t){e&&e.i&&(outroing.delete(e),e.i(t))}function ensure_array_like(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function mount_component(e,t,n){const{fragment:a,after_update:l}=e.$$;a&&a.m(t,n),add_render_callback(()=>{const s=e.$$.on_mount.map(run).filter(is_function);e.$$.on_destroy?e.$$.on_destroy.push(...s):run_all(s),e.$$.on_mount=[]}),l.forEach(add_render_callback)}function destroy_component(e,t){const n=e.$$;n.fragment!==null&&(flush_render_callbacks(n.after_update),run_all(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function make_dirty(e,t){e.$$.dirty[0]===-1&&(dirty_components.push(e),schedule_update(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function init(e,t,n,a,l,s,o,u=[-1]){const _=current_component;set_current_component(e);const i=e.$$={fragment:null,ctx:[],props:s,update:noop,not_equal:l,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:blank_object(),dirty:u,skip_bound:!1,root:t.target||_.$$.root};o&&o(i.root);let c=!1;if(i.ctx=n?n(e,t.props||{},(d,v,...h)=>{const g=h.length?h[0]:v;return i.ctx&&l(i.ctx[d],i.ctx[d]=g)&&(!i.skip_bound&&i.bound[d]&&i.bound[d](g),c&&make_dirty(e,d)),v}):[],i.update(),c=!0,run_all(i.before_update),i.fragment=a?a(i.ctx):!1,t.target){if(t.hydrate){const d=children(t.target);i.fragment&&i.fragment.l(d),d.forEach(detach)}else i.fragment&&i.fragment.c();t.intro&&transition_in(e.$$.fragment),mount_component(e,t.target,t.anchor),flush()}set_current_component(_)}class SvelteComponent{constructor(){Ce(this,"$$");Ce(this,"$$set")}$destroy(){destroy_component(this,1),this.$destroy=noop}$on(t,n){if(!is_function(n))return noop;const a=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return a.push(n),()=>{const l=a.indexOf(n);l!==-1&&a.splice(l,1)}}$set(t){this.$$set&&!is_empty(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const PUBLIC_VERSION="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(PUBLIC_VERSION);const importerStorage="importer-config.txt";async function loadImporterConfig(e){const t=await e.loadData(importerStorage);let n;try{n=JSON.parse(t)}catch{n={}}return n}async function saveImporterConfig(e,t){const n=JSON.stringify(t);await e.saveData(importerStorage,n)}const removeEmptyLines=e=>e.replace(/^#+\s*\n|\n\u00A0+/gm,`
`);function convertPathToUnixStyle(e){return e.replace(/\\/g,"/")}function replaceImagePath(e){const t=/!\[(.*?)\]\(([^\s]*?)\)/g;return e.replace(t,(n,a,l)=>{let s=a,o=l;return o=convertPathToUnixStyle(o),o=o.replace(/\.\/\.\.\/assets/g,"./assets"),`![${s}](${o})`})}function removeFootnotes(e){const t=/\^\(\[.*[0-9].*]\(#.*#.*\)\)/g;return e.replace(t,"")}function removeLinks(e){const t=/\[([^\]]+)]\(([^)]+)\)/g;return e.replace(t,(n,a,l)=>l.includes("./Text")||l.includes("#")||l.includes("kindle:")?a:n)}const isPC=()=>{const e=siyuan.getBackend(),t=siyuan.getFrontend();return(e==="windows"||"linux")&&t==="desktop"};async function mkdirp(e){const t=window.require("fs/promises"),n=window.require("path"),a=n.isAbsolute(e)?e:n.join(process.cwd(),e);try{return await t.access(a),a}catch(l){if(l.code==="ENOENT")return await mkdirp(n.dirname(a)),t.mkdir(a);throw l}}const copyDir=async(e,t)=>{if(!isPC()){console.warn("Not PC, it will not work");return}const n=window.require("fs"),a=window.require("path");if(!n.existsSync(e)){console.warn("Can not get path");return}n.existsSync(t)||await mkdirp(t);const l=n.readdirSync(e);for(let s of l){const o=a.join(e,s),u=a.join(t,s);n.statSync(o).isDirectory()?copyDir(o,u):n.copyFileSync(o,u)}},getExports=jsText=>eval(jsText);class ImportService{static async uploadAndConvert(t,n){const a=n.name,l=a.substring(0,a.lastIndexOf(".")),s=`${l}.md`,o=a.split(".").pop().toLowerCase();if(o==="md"){const y=n.path;return t.logger.info(`import md from ${y}`),{toFilePath:y,isMd:!0}}if(o==="html"&&isPC()){t.logger.info("copying html assets...");const y=n.path,I=y.lastIndexOf("/"),S=y.substring(0,I),$=window.require("path").join(S,`${l}_files`);t.logger.info("fullDirPath=>",$),await copyDir($,`${workspaceDir}/temp/convert/pandoc/${l}_files`)}const u=`/temp/convert/pandoc/${a}`,_=`/temp/convert/pandoc/${s}`,i=u;t.logger.info(`upload file from ${i} to /temp/convert/pandoc`);const c=await t.kernelApi.putFile(i,n);if(c.code!==0){siyuan.showMessage(`${t.i18n.msgFileUploadError}：${c.msg}`,7e3,"error");return}const d=`./../${a}`,v=`./../${s}`;t.logger.info(`convertPandoc from [${d}] to [${v}]`);const h=await t.kernelApi.convertPandoc(d,v);if(h.code!==0){siyuan.showMessage(`${t.i18n.msgFileConvertError}：${h.msg}`,7e3,"error");return}let g=await t.kernelApi.getFile(_,"text")??"";if(g===""){siyuan.showMessage(t.i18n.msgFileConvertEmpty,7e3,"error");return}const k=await loadImporterConfig(t);if(k.bundledFnSwitch!==!1&&(t.logger.info("Using bundled handler process text"),g=removeLinks(g),g=removeEmptyLines(g),g=replaceImagePath(g),g=removeFootnotes(g)),k.customFnSwitch){t.logger.warn("Using custom handler process text");try{const y=k.customFn;g=getExports(y)(g)}catch(y){throw siyuan.showMessage(`${t.i18n.customFnHandlerError} ${y.toString()}`,5e3,"error"),y}}return await t.kernelApi.saveTextData(`${s}`,g),{toFilePath:_,isMd:!1}}static async singleImport(t,n,a,l){const s=l?n:`${workspaceDir}${n}`;(await t.kernelApi.importStdMd(s,a,"/")).code!==0&&siyuan.showMessage(`${t.i18n.msgDocCreateFailed}=>${n}`,7e3,"error"),await t.kernelApi.openNotebook(a),siyuan.showMessage(t.i18n.msgImportSuccess,5e3,"info")}static async multiImport(t,n){const a=`${workspaceDir}/temp/convert/pandoc`;(await t.kernelApi.importStdMd(a,n,"/")).code!==0&&siyuan.showMessage(`${t.i18n.msgDocCreateFailed}=>${a}`,7e3,"error"),await t.kernelApi.openNotebook(n),siyuan.showMessage(t.i18n.msgImportSuccess,5e3,"info")}}const ImportForm_svelte_svelte_type_style_lang="";function get_each_context(e,t,n){const a=e.slice();return a[22]=t[n],a}function create_else_block(e){let t,n=e[0].i18n.loading+"",a,l;return{c(){t=element("option"),a=text(n),l=text("..."),t.__value="0",set_input_value(t,t.__value)},m(s,o){insert(s,t,o),append(t,a),append(t,l)},p(s,o){o&1&&n!==(n=s[0].i18n.loading+"")&&set_data(a,n)},d(s){s&&detach(t)}}}function create_each_block(e){let t,n=e[22].name+"",a,l;return{c(){t=element("option"),a=text(n),t.__value=l=e[22].id,set_input_value(t,t.__value)},m(s,o){insert(s,t,o),append(t,a)},p(s,o){o&2&&n!==(n=s[22].name+"")&&set_data(a,n),o&2&&l!==(l=s[22].id)&&(t.__value=l,set_input_value(t,t.__value))},d(s){s&&detach(t)}}}function create_fragment$1(e){let t,n,a,l,s=e[0].i18n.targetNotebook+"",o,u,_,i=e[0].i18n.selectNotebookTip+"",c,d,v,h,g,k,y,I,S,Y,$,A,z=e[0].i18n.importFile+"",V,Z,r,m,C=e[0].i18n.importTip+"",E,B,N,re,ae=e[0].i18n.importTipHelp+"",Q,we,pe,Me,U,Fe=e[0].i18n.importSingleNotice1+"",ye,ke,O,X,Se=e[0].i18n.importSingleNotice2+"",ce,x,ue,de,j=e[0].i18n.importSingleNotice3+"",De,le,Re,$e,Ie,q,J,Oe,L,xe,H=e[0].i18n.startImport+"",fe,Ae,W,P,se=e[0].i18n.importFolder+"",_e,qe,D,G,oe=e[0].i18n.importFolderTip+"",Ee,ze,K,Le,ee=e[0].i18n.importTipHelp+"",me,Be,he,He,b,F=e[0].i18n.importNotRecursive1+"",rt,Ke,Et,Ue,Ye=e[0].i18n.importNotRecursive2+"",pt,Ve,Ct,je,Ze=e[0].i18n.importNotRecursive3+"",ct,Qe,Dt,ut,xt,ge,Je,At,dt,ft,Xe=e[0].i18n.importFolder+"",_t,Bt,ve,Pe,et=e[0].i18n.cleanTemp+"",mt,Pt,te,tt=e[0].i18n.tempTotal+"",ht,Tt,Te,Nt,gt,Mt,Rt,nt=e[0].i18n.tempCount+"",vt,It,Ne,Ot,bt,qt,ne,We,zt,at,wt,Lt,lt=e[0].i18n.clean+"",Ft,Ht,be,st=e[0].i18n.reportBug1+"",yt,Ut,Ge,ot=e[0].i18n.reportBug2+"",kt,jt,it=e[0].i18n.reportBug3+"",St,$t,Jt,ie=ensure_array_like(e[1]),M=[];for(let p=0;p<ie.length;p+=1)M[p]=create_each_block(get_each_context(e,ie,p));let R=null;return ie.length||(R=create_else_block(e)),{c(){t=element("div"),n=element("div"),a=element("label"),l=element("div"),o=text(s),u=space(),_=element("div"),c=text(i),d=element("span"),v=text("["),h=text(e[3]),g=text("]"),k=space(),y=element("span"),I=space(),S=element("select");for(let p=0;p<M.length;p+=1)M[p].c();R&&R.c(),Y=space(),$=element("div"),A=element("div"),V=text(z),Z=space(),r=element("div"),m=element("div"),E=text(C),B=space(),N=element("span"),re=text("("),Q=text(ae),we=text(")"),Me=space(),U=element("div"),ye=text(Fe),O=space(),X=element("div"),ce=text(Se),ue=space(),de=element("div"),De=text(j),Re=space(),$e=element("span"),Ie=space(),q=element("button"),J=element("input"),Oe=space(),L=svg_element("svg"),xe=svg_element("use"),fe=text(H),Ae=space(),W=element("div"),P=element("div"),_e=text(se),qe=space(),D=element("div"),G=element("div"),Ee=text(oe),ze=space(),K=element("span"),Le=text("("),me=text(ee),Be=text(")"),He=space(),b=element("div"),rt=text(F),Et=space(),Ue=element("div"),pt=text(Ye),Ct=space(),je=element("div"),ct=text(Ze),Dt=space(),ut=element("span"),xt=space(),ge=element("button"),Je=element("input"),At=space(),dt=svg_element("svg"),ft=svg_element("use"),_t=text(Xe),Bt=space(),ve=element("div"),Pe=element("div"),mt=text(et),Pt=space(),te=element("div"),ht=text(tt),Tt=space(),Te=element("span"),Nt=text("[ "),gt=text(e[4]),Mt=text(" ]"),Rt=space(),vt=text(nt),It=space(),Ne=element("span"),Ne.textContent="显示临时文件夹路径",Ot=space(),bt=element("span"),qt=space(),ne=element("button"),We=element("input"),zt=space(),at=svg_element("svg"),wt=svg_element("use"),Lt=space(),Ft=text(lt),Ht=space(),be=element("div"),yt=text(st),Ut=text(`
       `),Ge=element("a"),kt=text(ot),jt=text(` 
      `),St=text(it),attr(d,"class","selected svelte-c3a8hl"),attr(_,"class","b3-label__text"),attr(l,"class","fn__flex-1"),attr(y,"class","fn__space"),attr(S,"id","blockEmbedMode"),attr(S,"class","b3-select fn__flex-center fn__size200"),e[2]===void 0&&add_render_callback(()=>e[16].call(S)),attr(a,"class","fn__flex b3-label config__item"),attr(N,"class",pe=null_to_empty(e[5]?"sign hidden":"sign")+" svelte-c3a8hl"),attr(U,"class",ke=null_to_empty(e[5]?"highlight":"highlight hidden")+" svelte-c3a8hl"),attr(X,"class",x=null_to_empty(e[5]?"highlight":"highlight hidden")+" svelte-c3a8hl"),attr(de,"class",le=null_to_empty(e[5]?"highlight":"highlight hidden")+" svelte-c3a8hl"),attr(r,"class","b3-label__text tips svelte-c3a8hl"),attr(A,"class","fn__flex-1 fn__flex-center"),attr($e,"class","fn__space"),attr(J,"id","importData"),attr(J,"class","b3-form__upload"),attr(J,"type","file"),attr(J,"accept",".md,.docx,.epub,.html,.opml"),xlink_attr(xe,"xlink:href","#iconDownload"),attr(q,"class","b3-button b3-button--outline fn__flex-center fn__size200"),set_style(q,"position","relative"),attr($,"class","fn__flex b3-label config__item"),attr(K,"class",he=null_to_empty(e[6]?"sign hidden":"sign")+" svelte-c3a8hl"),attr(b,"class",Ke=null_to_empty(e[6]?"highlight":"highlight hidden")+" svelte-c3a8hl"),attr(Ue,"class",Ve=null_to_empty(e[6]?"highlight":"highlight hidden")+" svelte-c3a8hl"),attr(je,"class",Qe=null_to_empty(e[6]?"highlight":"highlight hidden")+" svelte-c3a8hl"),attr(D,"class","b3-label__text tips svelte-c3a8hl"),attr(P,"class","fn__flex-1 fn__flex-center"),attr(ut,"class","fn__space"),attr(Je,"id","batchImportData"),attr(Je,"class","b3-form__upload"),xlink_attr(ft,"xlink:href","#iconDownload"),attr(ge,"class","b3-button b3-button--outline fn__flex-center fn__size200"),set_style(ge,"position","relative"),attr(W,"class","fn__flex b3-label config__item"),attr(Te,"class","selected svelte-c3a8hl"),attr(Ne,"class","link svelte-c3a8hl"),attr(te,"class","b3-label__text"),attr(Pe,"class","fn__flex-1 fn__flex-center"),attr(bt,"class","fn__space"),attr(We,"id","batchRemoveData"),attr(We,"class","b3-form__upload"),xlink_attr(wt,"xlink:href","#iconTrashcan"),attr(at,"class","svg"),attr(ne,"id","removeAll"),attr(ne,"class","b3-button b3-button--outline fn__flex-center fn__size200"),set_style(ne,"position","relative"),attr(ve,"class","fn__flex b3-label config__item"),attr(Ge,"href","https://github.com/terwer/siyuan-plugin-importer/issues/new"),attr(Ge,"target","_blank"),attr(be,"class","fn__flex b3-label config__item"),attr(n,"class","config__tab-container svelte-c3a8hl"),attr(t,"class","b3-dialog__content importer-form-container svelte-c3a8hl")},m(p,f){insert(p,t,f),append(t,n),append(n,a),append(a,l),append(l,o),append(l,u),append(l,_),append(_,c),append(_,d),append(d,v),append(d,h),append(d,g),append(a,k),append(a,y),append(a,I),append(a,S);for(let T=0;T<M.length;T+=1)M[T]&&M[T].m(S,null);R&&R.m(S,null),select_option(S,e[2],!0),append(n,Y),append(n,$),append($,A),append(A,V),append(A,Z),append(A,r),append(r,m),append(m,E),append(m,B),append(m,N),append(N,re),append(N,Q),append(N,we),append(r,Me),append(r,U),append(U,ye),append(r,O),append(r,X),append(X,ce),append(r,ue),append(r,de),append(de,De),append($,Re),append($,$e),append($,Ie),append($,q),append(q,J),append(q,Oe),append(q,L),append(L,xe),append(q,fe),append(n,Ae),append(n,W),append(W,P),append(P,_e),append(P,qe),append(P,D),append(D,G),append(G,Ee),append(G,ze),append(G,K),append(K,Le),append(K,me),append(K,Be),append(D,He),append(D,b),append(b,rt),append(D,Et),append(D,Ue),append(Ue,pt),append(D,Ct),append(D,je),append(je,ct),append(W,Dt),append(W,ut),append(W,xt),append(W,ge),append(ge,Je),append(ge,At),append(ge,dt),append(dt,ft),append(ge,_t),append(n,Bt),append(n,ve),append(ve,Pe),append(Pe,mt),append(Pe,Pt),append(Pe,te),append(te,ht),append(te,Tt),append(te,Te),append(Te,Nt),append(Te,gt),append(Te,Mt),append(te,Rt),append(te,vt),append(te,It),append(te,Ne),append(ve,Ot),append(ve,bt),append(ve,qt),append(ve,ne),append(ne,We),append(ne,zt),append(ne,at),append(at,wt),append(ne,Lt),append(ne,Ft),append(n,Ht),append(n,be),append(be,yt),append(be,Ut),append(be,Ge),append(Ge,kt),append(be,jt),append(be,St),$t||(Jt=[listen(S,"change",e[16]),listen(S,"change",e[7]),listen(r,"click",e[13]),listen(r,"keydown",e[10]),listen(J,"change",e[11]),listen(D,"click",e[14]),listen(D,"keydown",e[10]),listen(Je,"click",e[12]),listen(Ne,"click",e[9]),listen(Ne,"keydown",e[10]),listen(We,"click",e[8])],$t=!0)},p(p,[f]){if(f&1&&s!==(s=p[0].i18n.targetNotebook+"")&&set_data(o,s),f&1&&i!==(i=p[0].i18n.selectNotebookTip+"")&&set_data(c,i),f&8&&set_data(h,p[3]),f&3){ie=ensure_array_like(p[1]);let T;for(T=0;T<ie.length;T+=1){const Wt=get_each_context(p,ie,T);M[T]?M[T].p(Wt,f):(M[T]=create_each_block(Wt),M[T].c(),M[T].m(S,null))}for(;T<M.length;T+=1)M[T].d(1);M.length=ie.length,!ie.length&&R?R.p(p,f):ie.length?R&&(R.d(1),R=null):(R=create_else_block(p),R.c(),R.m(S,null))}f&6&&select_option(S,p[2]),f&1&&z!==(z=p[0].i18n.importFile+"")&&set_data(V,z),f&1&&C!==(C=p[0].i18n.importTip+"")&&set_data(E,C),f&1&&ae!==(ae=p[0].i18n.importTipHelp+"")&&set_data(Q,ae),f&32&&pe!==(pe=null_to_empty(p[5]?"sign hidden":"sign")+" svelte-c3a8hl")&&attr(N,"class",pe),f&1&&Fe!==(Fe=p[0].i18n.importSingleNotice1+"")&&set_data(ye,Fe),f&32&&ke!==(ke=null_to_empty(p[5]?"highlight":"highlight hidden")+" svelte-c3a8hl")&&attr(U,"class",ke),f&1&&Se!==(Se=p[0].i18n.importSingleNotice2+"")&&set_data(ce,Se),f&32&&x!==(x=null_to_empty(p[5]?"highlight":"highlight hidden")+" svelte-c3a8hl")&&attr(X,"class",x),f&1&&j!==(j=p[0].i18n.importSingleNotice3+"")&&set_data(De,j),f&32&&le!==(le=null_to_empty(p[5]?"highlight":"highlight hidden")+" svelte-c3a8hl")&&attr(de,"class",le),f&1&&H!==(H=p[0].i18n.startImport+"")&&set_data(fe,H),f&1&&se!==(se=p[0].i18n.importFolder+"")&&set_data(_e,se),f&1&&oe!==(oe=p[0].i18n.importFolderTip+"")&&set_data(Ee,oe),f&1&&ee!==(ee=p[0].i18n.importTipHelp+"")&&set_data(me,ee),f&64&&he!==(he=null_to_empty(p[6]?"sign hidden":"sign")+" svelte-c3a8hl")&&attr(K,"class",he),f&1&&F!==(F=p[0].i18n.importNotRecursive1+"")&&set_data(rt,F),f&64&&Ke!==(Ke=null_to_empty(p[6]?"highlight":"highlight hidden")+" svelte-c3a8hl")&&attr(b,"class",Ke),f&1&&Ye!==(Ye=p[0].i18n.importNotRecursive2+"")&&set_data(pt,Ye),f&64&&Ve!==(Ve=null_to_empty(p[6]?"highlight":"highlight hidden")+" svelte-c3a8hl")&&attr(Ue,"class",Ve),f&1&&Ze!==(Ze=p[0].i18n.importNotRecursive3+"")&&set_data(ct,Ze),f&64&&Qe!==(Qe=null_to_empty(p[6]?"highlight":"highlight hidden")+" svelte-c3a8hl")&&attr(je,"class",Qe),f&1&&Xe!==(Xe=p[0].i18n.importFolder+"")&&set_data(_t,Xe),f&1&&et!==(et=p[0].i18n.cleanTemp+"")&&set_data(mt,et),f&1&&tt!==(tt=p[0].i18n.tempTotal+"")&&set_data(ht,tt),f&16&&set_data(gt,p[4]),f&1&&nt!==(nt=p[0].i18n.tempCount+"")&&set_data(vt,nt),f&1&&lt!==(lt=p[0].i18n.clean+"")&&set_data(Ft,lt),f&1&&st!==(st=p[0].i18n.reportBug1+"")&&set_data(yt,st),f&1&&ot!==(ot=p[0].i18n.reportBug2+"")&&set_data(kt,ot),f&1&&it!==(it=p[0].i18n.reportBug3+"")&&set_data(St,it)},i:noop,o:noop,d(p){p&&detach(t),destroy_each(M,p),R&&R.d(),$t=!1,run_all(Jt)}}}function instance$1(e,t,n){let{pluginInstance:a}=t,{dialog:l}=t,s,o=[],u,_;const i=new Set(["思源笔记用户指南","SiYuan User Guide"]);let c=0;const d=["docx","epub","opml"],v=async function(){const r=o.find(m=>m.id===u);n(3,_=r.name),s=await loadImporterConfig(a),s.notebook=u,await saveImporterConfig(a,s),a.logger.info(`${a.i18n.notebookConfigUpdated}=>`,u)},h=async()=>{const r="/temp/convert/pandoc";await a.kernelApi.removeFile(`${r}`),await g(),siyuan.showMessage(a.i18n.msgTempFileCleaned,5e3,"info")};onMount(async()=>{await g(),s=await loadImporterConfig(a);const m=(await a.kernelApi.lsNotebooks()).data;n(1,o=m.notebooks??[]),n(1,o=o.filter(E=>!E.closed&&!i.has(E.name))),n(2,u=(s==null?void 0:s.notebook)??o[0].id);const C=o.find(E=>E.id===u);n(3,_=C.name),a.logger.info(`${a.i18n.selected} [${_}] toNotebookId=>`,u)});const g=async()=>{const r="/temp/convert/pandoc",m=await a.kernelApi.readDir(r);m.code===0&&m.data.length>0&&n(4,c=m.data.length),m.code===404&&n(4,c=0)},k=async r=>{const m=await r.getFile(),C=new FileReader;return C.readAsArrayBuffer(m),new Promise((E,B)=>{C.onload=()=>{const N=C.result,re=new Blob([N],{type:m.type}),ae=m.name;E(new File([re],ae))},C.onerror=B})},y=()=>{siyuan.confirm("⚠️临时文件路径",`${workspaceDir}/temp/convert/pandoc`,()=>{})},I=r=>{(r.key==="Enter"||r.key===" ")&&r.preventDefault()},S=async r=>{a.logger.debug(`${a.i18n.startImport}...`),l.destroy();const m=r.target.files??[];if(m.length===0){siyuan.showMessage(`${a.i18n.msgFileNotEmpty}`,7e3,"error");return}const C=m[0];siyuan.showMessage(`${a.i18n.msgConverting} ${C.name}...`,1e3,"info");const E=await ImportService.uploadAndConvert(a,C);await ImportService.singleImport(a,E.toFilePath,u,E.isMd)},Y=async()=>{if(c>0){siyuan.showMessage(`${a.i18n.tempCountExists}`,1e3,"error");return}const r=await window.showDirectoryPicker();l.destroy();const m=await r.values();for await(const C of m){if(C.kind==="directory")continue;const E=C.name,B=E.split(".").pop().toLowerCase();if(!d.includes(B)){console.warn(`${a.i18n.importTipNotAllowed} ${E}`);continue}siyuan.showMessage(`${E} ${a.i18n.msgConverting}...`,5e3,"info");const N=await k(C);await ImportService.uploadAndConvert(a,N)}await ImportService.multiImport(a,u)};let $=!1,A=!1;const z=()=>{n(5,$=!$)},V=()=>{n(6,A=!A),console.log(A)};function Z(){u=select_value(this),n(2,u),n(1,o)}return e.$$set=r=>{"pluginInstance"in r&&n(0,a=r.pluginInstance),"dialog"in r&&n(15,l=r.dialog)},[a,o,u,_,c,$,A,v,h,y,I,S,Y,z,V,l,Z]}class ImportForm extends SvelteComponent{constructor(t){super(),init(this,t,instance$1,create_fragment$1,safe_not_equal,{pluginInstance:0,dialog:15})}}const iconImporter={iconImporter:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M352 96l64 0c17.7 0 32 14.3 32 32l0 256c0 17.7-14.3 32-32 32l-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0c53 0 96-43 96-96l0-256c0-53-43-96-96-96l-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32zm-9.4 182.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L242.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l210.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128z"/></svg>',iconSetting:'<span class="importer-menu-icon"><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/></svg></span>'},ImportSetting_svelte_svelte_type_style_lang="";function create_fragment(e){let t,n,a,l=e[0].i18n.bundledFnSwitch+"",s,o,u,_=e[0].i18n.bundledFnSwitchTips+"",i,c,d,v,h,g,k,y,I=e[0].i18n.customFnSwitch+"",S,Y,$,A=e[0].i18n.customFnSwitchTips+"",z,V,Z,r,m,C,E,B,N=e[0].i18n.customFnHandler+"",re,ae,Q,we=e[0].i18n.customFnHandlerTips+"",pe,Me,U,Fe,ye,ke,O,X,Se,ce,x,ue,de,j,De,le,Re,$e,Ie,q=e[0].i18n.testInput+"",J,Oe,L,xe,H,fe=e[0].i18n.testOutput+"",Ae,W,P,se,_e,qe,D,G,oe=e[0].i18n.cancel+"",Ee,ze,K,Le,ee,me=e[0].i18n.save+"",Be,he,He;return{c(){t=element("div"),n=element("label"),a=element("div"),s=text(l),o=space(),u=element("div"),i=text(_),c=space(),d=element("span"),v=space(),h=element("input"),g=space(),k=element("label"),y=element("div"),S=text(I),Y=space(),$=element("div"),z=text(A),V=space(),Z=element("span"),r=space(),m=element("input"),C=space(),E=element("label"),B=element("div"),re=text(N),ae=space(),Q=element("div"),pe=text(we),Me=space(),U=element("a"),U.textContent="https://www.regextester.com",Fe=space(),ye=element("div"),ke=space(),O=element("textarea"),Se=space(),ce=element("label"),x=element("div"),ue=element("button"),ue.textContent="开始测试",de=space(),j=element("button"),De=text("隐藏结果"),Re=space(),$e=element("div"),Ie=space(),J=text(q),Oe=space(),L=element("textarea"),xe=space(),H=element("div"),Ae=text(fe),W=space(),P=element("textarea"),qe=space(),D=element("div"),G=element("button"),Ee=text(oe),ze=space(),K=element("div"),Le=space(),ee=element("button"),Be=text(me),attr(u,"class","b3-label__text"),attr(a,"class","fn__flex-1"),attr(d,"class","fn__space"),attr(h,"id","bundledFnSwitch"),attr(h,"class","b3-switch fn__flex-center"),attr(h,"type","checkbox"),attr(n,"class","fn__flex b3-label"),attr($,"class","b3-label__text"),attr(y,"class","fn__flex-1"),attr(Z,"class","fn__space"),attr(m,"id","customFnSwitch"),attr(m,"class","b3-switch fn__flex-center"),attr(m,"type","checkbox"),attr(k,"class","fn__flex b3-label"),attr(U,"href","https://www.regextester.com"),attr(U,"target","_blank"),attr(Q,"class","b3-label__text"),attr(ye,"class","fn__hr"),attr(O,"class","b3-text-field fn__block"),attr(O,"placeholder",X=e[0].i18n.customFnHandlerPlaceholder),attr(O,"rows","8"),attr(O,"spellcheck","false"),attr(B,"class","fn__flex-1"),attr(E,"class","fn__flex b3-label"),attr(ue,"class","b3-button b3-button--outline fn__flex-right fn__size200"),attr(j,"class",le=null_to_empty(e[6]?"b3-button b3-button--outline fn__flex-right fn__size200 pull-right":"b3-button b3-button--outline fn__flex-right fn__size200 pull-right hidden")+" svelte-15pkbbz"),attr($e,"class","fn__hr"),attr(L,"class","b3-text-field fn__block test-data-item svelte-15pkbbz"),attr(L,"rows","6"),attr(L,"spellcheck","false"),attr(P,"class","b3-text-field fn__block test-data-item svelte-15pkbbz"),attr(P,"placeholder",se=e[0].i18n.testOutputPlaceholder),attr(P,"rows","6"),attr(P,"spellcheck","false"),attr(H,"class",_e=null_to_empty(e[6]?"":"hidden")+" svelte-15pkbbz"),attr(x,"class","fn__flex-1"),attr(ce,"class","fn__flex b3-label"),attr(G,"class","b3-button b3-button--cancel"),attr(K,"class","fn__space"),attr(ee,"class","b3-button b3-button--text"),attr(D,"class","b3-dialog__action"),attr(t,"class","config__tab-container")},m(b,F){insert(b,t,F),append(t,n),append(n,a),append(a,s),append(a,o),append(a,u),append(u,i),append(n,c),append(n,d),append(n,v),append(n,h),h.checked=e[1],append(t,g),append(t,k),append(k,y),append(y,S),append(y,Y),append(y,$),append($,z),append(k,V),append(k,Z),append(k,r),append(k,m),m.checked=e[2],append(t,C),append(t,E),append(E,B),append(B,re),append(B,ae),append(B,Q),append(Q,pe),append(Q,Me),append(Q,U),append(B,Fe),append(B,ye),append(B,ke),append(B,O),set_input_value(O,e[3]),append(t,Se),append(t,ce),append(ce,x),append(x,ue),append(x,de),append(x,j),append(j,De),append(x,Re),append(x,$e),append(x,Ie),append(x,J),append(x,Oe),append(x,L),set_input_value(L,e[4]),append(x,xe),append(x,H),append(H,Ae),append(H,W),append(H,P),set_input_value(P,e[5]),append(t,qe),append(t,D),append(D,G),append(G,Ee),append(D,ze),append(D,K),append(D,Le),append(D,ee),append(ee,Be),he||(He=[listen(h,"click",e[14]),listen(h,"change",e[15]),listen(m,"click",e[16]),listen(m,"change",e[17]),listen(O,"input",e[18]),listen(ue,"click",e[11]),listen(j,"click",e[12]),listen(L,"input",e[19]),listen(P,"input",e[20]),listen(G,"click",e[8]),listen(ee,"click",e[7])],he=!0)},p(b,[F]){F&1&&l!==(l=b[0].i18n.bundledFnSwitch+"")&&set_data(s,l),F&1&&_!==(_=b[0].i18n.bundledFnSwitchTips+"")&&set_data(i,_),F&2&&(h.checked=b[1]),F&1&&I!==(I=b[0].i18n.customFnSwitch+"")&&set_data(S,I),F&1&&A!==(A=b[0].i18n.customFnSwitchTips+"")&&set_data(z,A),F&4&&(m.checked=b[2]),F&1&&N!==(N=b[0].i18n.customFnHandler+"")&&set_data(re,N),F&1&&we!==(we=b[0].i18n.customFnHandlerTips+"")&&set_data(pe,we),F&1&&X!==(X=b[0].i18n.customFnHandlerPlaceholder)&&attr(O,"placeholder",X),F&8&&set_input_value(O,b[3]),F&64&&le!==(le=null_to_empty(b[6]?"b3-button b3-button--outline fn__flex-right fn__size200 pull-right":"b3-button b3-button--outline fn__flex-right fn__size200 pull-right hidden")+" svelte-15pkbbz")&&attr(j,"class",le),F&1&&q!==(q=b[0].i18n.testInput+"")&&set_data(J,q),F&16&&set_input_value(L,b[4]),F&1&&fe!==(fe=b[0].i18n.testOutput+"")&&set_data(Ae,fe),F&1&&se!==(se=b[0].i18n.testOutputPlaceholder)&&attr(P,"placeholder",se),F&32&&set_input_value(P,b[5]),F&64&&_e!==(_e=null_to_empty(b[6]?"":"hidden")+" svelte-15pkbbz")&&attr(H,"class",_e),F&1&&oe!==(oe=b[0].i18n.cancel+"")&&set_data(Ee,oe),F&1&&me!==(me=b[0].i18n.save+"")&&set_data(Be,me)},i:noop,o:noop,d(b){b&&detach(t),he=!1,run_all(He)}}}function instance(e,t,n){let{pluginInstance:a}=t,{dialog:l}=t,s=!0,o=!1,u,_={};const i=async()=>{l.destroy(),_.bundledFnSwitch=s,_.customFnSwitch=o,_.customFn=u,await saveImporterConfig(a,_),a.logger.info("saved important config =>",_),siyuan.showMessage(`${a.i18n.importConfigSaveSuccess}`,2e3,"info")},c=async()=>{l.destroy()},d=r=>{r.stopPropagation(),o||siyuan.confirm(`⚠️${a.i18n.enableCustomFn}`,`${a.i18n.enableCustomFnTips}`,()=>{const m=document.querySelector("#customFnSwitch");m.checked=o},()=>{n(2,o=!o)})},v=r=>{r.stopPropagation(),s&&siyuan.confirm(`⚠️${a.i18n.bundledFnSwitch}`,`${a.i18n.disableBundledFnSwitchTips}`,()=>{const m=document.querySelector("#bundledFnSwitch");m.checked=s},()=>{n(1,s=!s)})};let h=`我衷心期盼，子孙后代们读到这封信时，会带着一种自豪感和正当的优越感。

## 评伯特兰·罗素的知识论^([\\[16\\]](#part0019.html#footnote_16))

当编者要我就罗素写点东西时，出于对这位作者的钦佩和尊敬，我立刻答应了下来。`,g="",k=!1;const y=()=>{const r=getExports(u);n(5,g=r(h)),n(6,k=!0)},I=()=>{n(6,k=!1)};onMount(async()=>{_=await loadImporterConfig(a),n(1,s=_.bundledFnSwitch??!0),n(2,o=_.customFnSwitch??!1),n(3,u=_.customFn??`// 您可以参考这个案例进行修改，注意：请勿修改方法名和参数名，只需修改customFn内部实现即可
// 将字符串中形如"xxx^yyy"的部分替换成"xxx"
const customFn = (mdText) => {
  const regex = /\\^\\(\\[.*[0-9].*]\\(#.*#.*\\)\\)/g // 匹配格式为 ^[[数字]](#链接) 的脚注
  return mdText.replace(regex, "") // 使用空字符串替换匹配到的脚注
}

module.exports = customFn`)});const S=r=>v(r);function Y(){s=this.checked,n(1,s)}const $=r=>d(r);function A(){o=this.checked,n(2,o)}function z(){u=this.value,n(3,u)}function V(){h=this.value,n(4,h)}function Z(){g=this.value,n(5,g)}return e.$$set=r=>{"pluginInstance"in r&&n(0,a=r.pluginInstance),"dialog"in r&&n(13,l=r.dialog)},[a,s,o,u,h,g,k,i,c,d,v,y,I,l,S,Y,$,A,z,V,Z]}class ImportSetting extends SvelteComponent{constructor(t){super(),init(this,t,instance,create_fragment,safe_not_equal,{pluginInstance:0,dialog:13})}}async function initTopbar(e){const t=e.addTopBar({icon:iconImporter.iconImporter,title:e.i18n.importer,position:"right",callback:()=>{e.logger.info("this.i18n.importer added toolbar")}});t.addEventListener("click",async()=>{const a=siyuan.getFrontend(),l=a==="mobile"||a==="browser-mobile",s="siyuan-import-form",o=new siyuan.Dialog({title:`${e.i18n.selectFile} - ${e.i18n.importer}`,content:`<div id="${s}"></div>`,width:l?"92vw":"720px"});new ImportForm({target:document.getElementById(s),props:{pluginInstance:e,dialog:o}})}),t.addEventListener("contextmenu",()=>{let a=t.getBoundingClientRect();a.width===0&&(a=document.querySelector("#barMore").getBoundingClientRect()),n(e,a)});const n=async(a,l)=>{const s=new siyuan.Menu("importerContextMenu");s.addItem({iconHTML:iconImporter.iconSetting,label:a.i18n.setting,click:()=>{const o="siyuan-importing-setting",u=new siyuan.Dialog({title:`${a.i18n.setting} - ${a.i18n.importer}`,content:`<div id="${o}"></div>`,width:a.isMobile?"92vw":"720px"});new ImportSetting({target:document.getElementById(o),props:{pluginInstance:a,dialog:u}})}}),a.isMobile?s.fullscreen():s.open({x:l.right,y:l.bottom,isLeft:!0})}}const w=(e,t,n)=>{const a=t??"zhi",l=i=>{const c=i.getFullYear(),d=String(i.getMonth()+1).padStart(2,"0"),v=String(i.getDate()).padStart(2,"0"),h=String(i.getHours()).padStart(2,"0"),g=String(i.getMinutes()).padStart(2,"0"),k=String(i.getSeconds()).padStart(2,"0");return`${c}-${d}-${v} ${h}:${g}:${k}`},s=(i,c)=>{const d=l(new Date),v=typeof c=="boolean"?String(c):c;v?console.log(`[${a}] [${d}] [DEBUG] [${e}] ${i}`,v):console.log(`[${a}] [${d}] [DEBUG] [${e}] ${i}`)},o=(i,c)=>{const d=l(new Date),v=typeof c=="boolean"?String(c):c;v?console.info(`[${a}] [${d}] [INFO] [${e}] ${i}`,v):console.info(`[${a}] [${d}] [INFO] [${e}] ${i}`)},u=(i,c)=>{const d=l(new Date),v=typeof c=="boolean"?String(c):c;v?console.warn(`[${a}] [${d}] [WARN] [${e}] ${i}`,v):console.warn(`[${a}] [${d}] [WARN] [${e}] ${i}`)},_=(i,c)=>{const d=l(new Date),v=i instanceof Error?"an error occurred =>":`${i}`,h=typeof c=="boolean"?String(c):c||`${i}`;h?console.error(`[${a}] [${d}] [ERROR] [${e}] ${v}`,h):console.error(`[${a}] [${d}] [ERROR] [${e}] ${v}`)};return{debug:(i,c)=>{n&&(c?s(i,c):s(i))},info:(i,c)=>{c?o(i,c):o(i)},warn:(i,c)=>{c?u(i,c):u(i)},error:(i,c)=>{c?_(i,c):_(i)}}};class ImporterPlugin extends siyuan.Plugin{constructor(n){super(n);Ce(this,"logger");Ce(this,"kernelApi");Ce(this,"isMobile");const a=siyuan.getFrontend();this.isMobile=a==="mobile"||a==="browser-mobile",this.logger=w("index","importer",isDev),this.kernelApi=new KernelApi}async onload(){await initTopbar(this),this.logger.info("mediaDir=>",mediaDir),this.logger.info(this.i18n.importerLoaded)}async onunload(){this.logger.info(this.i18n.importerUnloaded)}}module.exports=ImporterPlugin;
