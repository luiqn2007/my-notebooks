"use strict";var Ge=Object.defineProperty;var Xe=(t,e,n)=>e in t?Ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var A=(t,e,n)=>(Xe(t,typeof e!="symbol"?e+"":e,n),n);const v=require("siyuan");function Re(t,e){return function(){return t.apply(e,arguments)}}const{toString:Ze}=Object.prototype,{getPrototypeOf:oe}=Object,J=(t=>e=>{const n=Ze.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),R=t=>(t=t.toLowerCase(),e=>J(e)===t),W=t=>e=>typeof e===t,{isArray:L}=Array,B=W("undefined");function Qe(t){return t!==null&&!B(t)&&t.constructor!==null&&!B(t.constructor)&&k(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Ae=R("ArrayBuffer");function Ye(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Ae(t.buffer),e}const et=W("string"),k=W("function"),Oe=W("number"),K=t=>t!==null&&typeof t=="object",tt=t=>t===!0||t===!1,H=t=>{if(J(t)!=="object")return!1;const e=oe(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},nt=R("Date"),st=R("File"),rt=R("Blob"),it=R("FileList"),at=t=>K(t)&&k(t.pipe),ot=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||k(t.append)&&((e=J(t))==="formdata"||e==="object"&&k(t.toString)&&t.toString()==="[object FormData]"))},lt=R("URLSearchParams"),ct=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function j(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let s,r;if(typeof t!="object"&&(t=[t]),L(t))for(s=0,r=t.length;s<r;s++)e.call(null,t[s],s,t);else{const i=n?Object.getOwnPropertyNames(t):Object.keys(t),a=i.length;let o;for(s=0;s<a;s++)o=i[s],e.call(null,t[o],o,t)}}function Ce(t,e){e=e.toLowerCase();const n=Object.keys(t);let s=n.length,r;for(;s-- >0;)if(r=n[s],e===r.toLowerCase())return r;return null}const Ue=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),ve=t=>!B(t)&&t!==Ue;function ne(){const{caseless:t}=ve(this)&&this||{},e={},n=(s,r)=>{const i=t&&Ce(e,r)||r;H(e[i])&&H(s)?e[i]=ne(e[i],s):H(s)?e[i]=ne({},s):L(s)?e[i]=s.slice():e[i]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&j(arguments[s],n);return e}const ut=(t,e,n,{allOwnKeys:s}={})=>(j(e,(r,i)=>{n&&k(r)?t[i]=Re(r,n):t[i]=r},{allOwnKeys:s}),t),dt=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ft=(t,e,n,s)=>{t.prototype=Object.create(e.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},ht=(t,e,n,s)=>{let r,i,a;const o={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),i=r.length;i-- >0;)a=r[i],(!s||s(a,t,e))&&!o[a]&&(e[a]=t[a],o[a]=!0);t=n!==!1&&oe(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},pt=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const s=t.indexOf(e,n);return s!==-1&&s===n},mt=t=>{if(!t)return null;if(L(t))return t;let e=t.length;if(!Oe(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},gt=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&oe(Uint8Array)),yt=(t,e)=>{const s=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=s.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},bt=(t,e)=>{let n;const s=[];for(;(n=t.exec(e))!==null;)s.push(n);return s},wt=R("HTMLFormElement"),_t=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,r){return s.toUpperCase()+r}),he=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),Et=R("RegExp"),Pe=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),s={};j(n,(r,i)=>{let a;(a=e(r,i,t))!==!1&&(s[i]=a||r)}),Object.defineProperties(t,s)},St=t=>{Pe(t,(e,n)=>{if(k(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if(k(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},kt=(t,e)=>{const n={},s=r=>{r.forEach(i=>{n[i]=!0})};return L(t)?s(t):s(String(t).split(e)),n},xt=()=>{},Tt=(t,e)=>(t=+t,Number.isFinite(t)?t:e),Q="abcdefghijklmnopqrstuvwxyz",pe="0123456789",Ne={DIGIT:pe,ALPHA:Q,ALPHA_DIGIT:Q+Q.toUpperCase()+pe},Rt=(t=16,e=Ne.ALPHA_DIGIT)=>{let n="";const{length:s}=e;for(;t--;)n+=e[Math.random()*s|0];return n};function At(t){return!!(t&&k(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const Ot=t=>{const e=new Array(10),n=(s,r)=>{if(K(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const i=L(s)?[]:{};return j(s,(a,o)=>{const u=n(a,r+1);!B(u)&&(i[o]=u)}),e[r]=void 0,i}}return s};return n(t,0)},Ct=R("AsyncFunction"),Ut=t=>t&&(K(t)||k(t))&&k(t.then)&&k(t.catch),l={isArray:L,isArrayBuffer:Ae,isBuffer:Qe,isFormData:ot,isArrayBufferView:Ye,isString:et,isNumber:Oe,isBoolean:tt,isObject:K,isPlainObject:H,isUndefined:B,isDate:nt,isFile:st,isBlob:rt,isRegExp:Et,isFunction:k,isStream:at,isURLSearchParams:lt,isTypedArray:gt,isFileList:it,forEach:j,merge:ne,extend:ut,trim:ct,stripBOM:dt,inherits:ft,toFlatObject:ht,kindOf:J,kindOfTest:R,endsWith:pt,toArray:mt,forEachEntry:yt,matchAll:bt,isHTMLForm:wt,hasOwnProperty:he,hasOwnProp:he,reduceDescriptors:Pe,freezeMethods:St,toObjectSet:kt,toCamelCase:_t,noop:xt,toFiniteNumber:Tt,findKey:Ce,global:Ue,isContextDefined:ve,ALPHABET:Ne,generateString:Rt,isSpecCompliantForm:At,toJSONObject:Ot,isAsyncFn:Ct,isThenable:Ut};function m(t,e,n,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),s&&(this.request=s),r&&(this.response=r)}l.inherits(m,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:l.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Le=m.prototype,Fe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Fe[t]={value:t}});Object.defineProperties(m,Fe);Object.defineProperty(Le,"isAxiosError",{value:!0});m.from=(t,e,n,s,r,i)=>{const a=Object.create(Le);return l.toFlatObject(t,a,function(u){return u!==Error.prototype},o=>o!=="isAxiosError"),m.call(a,t.message,e,n,s,r),a.cause=t,a.name=t.name,i&&Object.assign(a,i),a};const vt=null;function se(t){return l.isPlainObject(t)||l.isArray(t)}function De(t){return l.endsWith(t,"[]")?t.slice(0,-2):t}function me(t,e,n){return t?t.concat(e).map(function(r,i){return r=De(r),!n&&i?"["+r+"]":r}).join(n?".":""):e}function Pt(t){return l.isArray(t)&&!t.some(se)}const Nt=l.toFlatObject(l,{},null,function(e){return/^is[A-Z]/.test(e)});function G(t,e,n){if(!l.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=l.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,y){return!l.isUndefined(y[h])});const s=n.metaTokens,r=n.visitor||d,i=n.dots,a=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&l.isSpecCompliantForm(e);if(!l.isFunction(r))throw new TypeError("visitor must be a function");function f(p){if(p===null)return"";if(l.isDate(p))return p.toISOString();if(!u&&l.isBlob(p))throw new m("Blob is not supported. Use a Buffer instead.");return l.isArrayBuffer(p)||l.isTypedArray(p)?u&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function d(p,h,y){let w=p;if(p&&!y&&typeof p=="object"){if(l.endsWith(h,"{}"))h=s?h:h.slice(0,-2),p=JSON.stringify(p);else if(l.isArray(p)&&Pt(p)||(l.isFileList(p)||l.endsWith(h,"[]"))&&(w=l.toArray(p)))return h=De(h),w.forEach(function(S,M){!(l.isUndefined(S)||S===null)&&e.append(a===!0?me([h],M,i):a===null?h:h+"[]",f(S))}),!1}return se(p)?!0:(e.append(me(y,h,i),f(p)),!1)}const c=[],g=Object.assign(Nt,{defaultVisitor:d,convertValue:f,isVisitable:se});function b(p,h){if(!l.isUndefined(p)){if(c.indexOf(p)!==-1)throw Error("Circular reference detected in "+h.join("."));c.push(p),l.forEach(p,function(w,E){(!(l.isUndefined(w)||w===null)&&r.call(e,w,l.isString(E)?E.trim():E,h,g))===!0&&b(w,h?h.concat(E):[E])}),c.pop()}}if(!l.isObject(t))throw new TypeError("data must be an object");return b(t),e}function ge(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function le(t,e){this._pairs=[],t&&G(t,this,e)}const Be=le.prototype;Be.append=function(e,n){this._pairs.push([e,n])};Be.toString=function(e){const n=e?function(s){return e.call(this,s,ge)}:ge;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function Lt(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function je(t,e,n){if(!e)return t;const s=n&&n.encode||Lt,r=n&&n.serialize;let i;if(r?i=r(e,n):i=l.isURLSearchParams(e)?e.toString():new le(e,n).toString(s),i){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class Ft{constructor(){this.handlers=[]}use(e,n,s){return this.handlers.push({fulfilled:e,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){l.forEach(this.handlers,function(s){s!==null&&e(s)})}}const ye=Ft,Ie={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Dt=typeof URLSearchParams<"u"?URLSearchParams:le,Bt=typeof FormData<"u"?FormData:null,jt=typeof Blob<"u"?Blob:null,It={isBrowser:!0,classes:{URLSearchParams:Dt,FormData:Bt,Blob:jt},protocols:["http","https","file","blob","url","data"]},Me=typeof window<"u"&&typeof document<"u",Mt=(t=>Me&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),zt=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Ht=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Me,hasStandardBrowserEnv:Mt,hasStandardBrowserWebWorkerEnv:zt},Symbol.toStringTag,{value:"Module"})),T={...Ht,...It};function qt(t,e){return G(t,new T.classes.URLSearchParams,Object.assign({visitor:function(n,s,r,i){return T.isNode&&l.isBuffer(n)?(this.append(s,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function Vt(t){return l.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function $t(t){const e={},n=Object.keys(t);let s;const r=n.length;let i;for(s=0;s<r;s++)i=n[s],e[i]=t[i];return e}function ze(t){function e(n,s,r,i){let a=n[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),u=i>=n.length;return a=!a&&l.isArray(r)?r.length:a,u?(l.hasOwnProp(r,a)?r[a]=[r[a],s]:r[a]=s,!o):((!r[a]||!l.isObject(r[a]))&&(r[a]=[]),e(n,s,r[a],i)&&l.isArray(r[a])&&(r[a]=$t(r[a])),!o)}if(l.isFormData(t)&&l.isFunction(t.entries)){const n={};return l.forEachEntry(t,(s,r)=>{e(Vt(s),r,n,0)}),n}return null}function Jt(t,e,n){if(l.isString(t))try{return(e||JSON.parse)(t),l.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(t)}const ce={transitional:Ie,adapter:["xhr","http"],transformRequest:[function(e,n){const s=n.getContentType()||"",r=s.indexOf("application/json")>-1,i=l.isObject(e);if(i&&l.isHTMLForm(e)&&(e=new FormData(e)),l.isFormData(e))return r?JSON.stringify(ze(e)):e;if(l.isArrayBuffer(e)||l.isBuffer(e)||l.isStream(e)||l.isFile(e)||l.isBlob(e))return e;if(l.isArrayBufferView(e))return e.buffer;if(l.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return qt(e,this.formSerializer).toString();if((o=l.isFileList(e))||s.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return G(o?{"files[]":e}:e,u&&new u,this.formSerializer)}}return i||r?(n.setContentType("application/json",!1),Jt(e)):e}],transformResponse:[function(e){const n=this.transitional||ce.transitional,s=n&&n.forcedJSONParsing,r=this.responseType==="json";if(e&&l.isString(e)&&(s&&!this.responseType||r)){const a=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?m.from(o,m.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:T.classes.FormData,Blob:T.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};l.forEach(["delete","get","head","post","put","patch"],t=>{ce.headers[t]={}});const ue=ce,Wt=l.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Kt=t=>{const e={};let n,s,r;return t&&t.split(`
`).forEach(function(a){r=a.indexOf(":"),n=a.substring(0,r).trim().toLowerCase(),s=a.substring(r+1).trim(),!(!n||e[n]&&Wt[n])&&(n==="set-cookie"?e[n]?e[n].push(s):e[n]=[s]:e[n]=e[n]?e[n]+", "+s:s)}),e},be=Symbol("internals");function D(t){return t&&String(t).trim().toLowerCase()}function q(t){return t===!1||t==null?t:l.isArray(t)?t.map(q):String(t)}function Gt(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)e[s[1]]=s[2];return e}const Xt=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Y(t,e,n,s,r){if(l.isFunction(s))return s.call(this,e,n);if(r&&(e=n),!!l.isString(e)){if(l.isString(s))return e.indexOf(s)!==-1;if(l.isRegExp(s))return s.test(e)}}function Zt(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,s)=>n.toUpperCase()+s)}function Qt(t,e){const n=l.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(r,i,a){return this[s].call(this,e,r,i,a)},configurable:!0})})}class X{constructor(e){e&&this.set(e)}set(e,n,s){const r=this;function i(o,u,f){const d=D(u);if(!d)throw new Error("header name must be a non-empty string");const c=l.findKey(r,d);(!c||r[c]===void 0||f===!0||f===void 0&&r[c]!==!1)&&(r[c||u]=q(o))}const a=(o,u)=>l.forEach(o,(f,d)=>i(f,d,u));return l.isPlainObject(e)||e instanceof this.constructor?a(e,n):l.isString(e)&&(e=e.trim())&&!Xt(e)?a(Kt(e),n):e!=null&&i(n,e,s),this}get(e,n){if(e=D(e),e){const s=l.findKey(this,e);if(s){const r=this[s];if(!n)return r;if(n===!0)return Gt(r);if(l.isFunction(n))return n.call(this,r,s);if(l.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=D(e),e){const s=l.findKey(this,e);return!!(s&&this[s]!==void 0&&(!n||Y(this,this[s],s,n)))}return!1}delete(e,n){const s=this;let r=!1;function i(a){if(a=D(a),a){const o=l.findKey(s,a);o&&(!n||Y(s,s[o],o,n))&&(delete s[o],r=!0)}}return l.isArray(e)?e.forEach(i):i(e),r}clear(e){const n=Object.keys(this);let s=n.length,r=!1;for(;s--;){const i=n[s];(!e||Y(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const n=this,s={};return l.forEach(this,(r,i)=>{const a=l.findKey(s,i);if(a){n[a]=q(r),delete n[i];return}const o=e?Zt(i):String(i).trim();o!==i&&delete n[i],n[o]=q(r),s[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return l.forEach(this,(s,r)=>{s!=null&&s!==!1&&(n[r]=e&&l.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const s=new this(e);return n.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[be]=this[be]={accessors:{}}).accessors,r=this.prototype;function i(a){const o=D(a);s[o]||(Qt(r,a),s[o]=!0)}return l.isArray(e)?e.forEach(i):i(e),this}}X.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);l.reduceDescriptors(X.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(s){this[n]=s}}});l.freezeMethods(X);const C=X;function ee(t,e){const n=this||ue,s=e||n,r=C.from(s.headers);let i=s.data;return l.forEach(t,function(o){i=o.call(n,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function He(t){return!!(t&&t.__CANCEL__)}function I(t,e,n){m.call(this,t??"canceled",m.ERR_CANCELED,e,n),this.name="CanceledError"}l.inherits(I,m,{__CANCEL__:!0});function Yt(t,e,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):e(new m("Request failed with status code "+n.status,[m.ERR_BAD_REQUEST,m.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}const en=T.hasStandardBrowserEnv?{write(t,e,n,s,r,i){const a=[t+"="+encodeURIComponent(e)];l.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),l.isString(s)&&a.push("path="+s),l.isString(r)&&a.push("domain="+r),i===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function tn(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function nn(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function qe(t,e){return t&&!tn(e)?nn(t,e):e}const sn=T.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");let s;function r(i){let a=i;return e&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return s=r(window.location.href),function(a){const o=l.isString(a)?r(a):a;return o.protocol===s.protocol&&o.host===s.host}}():function(){return function(){return!0}}();function rn(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function an(t,e){t=t||10;const n=new Array(t),s=new Array(t);let r=0,i=0,a;return e=e!==void 0?e:1e3,function(u){const f=Date.now(),d=s[i];a||(a=f),n[r]=u,s[r]=f;let c=i,g=0;for(;c!==r;)g+=n[c++],c=c%t;if(r=(r+1)%t,r===i&&(i=(i+1)%t),f-a<e)return;const b=d&&f-d;return b?Math.round(g*1e3/b):void 0}}function we(t,e){let n=0;const s=an(50,250);return r=>{const i=r.loaded,a=r.lengthComputable?r.total:void 0,o=i-n,u=s(o),f=i<=a;n=i;const d={loaded:i,total:a,progress:a?i/a:void 0,bytes:o,rate:u||void 0,estimated:u&&a&&f?(a-i)/u:void 0,event:r};d[e?"download":"upload"]=!0,t(d)}}const on=typeof XMLHttpRequest<"u",ln=on&&function(t){return new Promise(function(n,s){let r=t.data;const i=C.from(t.headers).normalize();let{responseType:a,withXSRFToken:o}=t,u;function f(){t.cancelToken&&t.cancelToken.unsubscribe(u),t.signal&&t.signal.removeEventListener("abort",u)}let d;if(l.isFormData(r)){if(T.hasStandardBrowserEnv||T.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((d=i.getContentType())!==!1){const[h,...y]=d?d.split(";").map(w=>w.trim()).filter(Boolean):[];i.setContentType([h||"multipart/form-data",...y].join("; "))}}let c=new XMLHttpRequest;if(t.auth){const h=t.auth.username||"",y=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";i.set("Authorization","Basic "+btoa(h+":"+y))}const g=qe(t.baseURL,t.url);c.open(t.method.toUpperCase(),je(g,t.params,t.paramsSerializer),!0),c.timeout=t.timeout;function b(){if(!c)return;const h=C.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),w={data:!a||a==="text"||a==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:h,config:t,request:c};Yt(function(S){n(S),f()},function(S){s(S),f()},w),c=null}if("onloadend"in c?c.onloadend=b:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(b)},c.onabort=function(){c&&(s(new m("Request aborted",m.ECONNABORTED,t,c)),c=null)},c.onerror=function(){s(new m("Network Error",m.ERR_NETWORK,t,c)),c=null},c.ontimeout=function(){let y=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const w=t.transitional||Ie;t.timeoutErrorMessage&&(y=t.timeoutErrorMessage),s(new m(y,w.clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,t,c)),c=null},T.hasStandardBrowserEnv&&(o&&l.isFunction(o)&&(o=o(t)),o||o!==!1&&sn(g))){const h=t.xsrfHeaderName&&t.xsrfCookieName&&en.read(t.xsrfCookieName);h&&i.set(t.xsrfHeaderName,h)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&l.forEach(i.toJSON(),function(y,w){c.setRequestHeader(w,y)}),l.isUndefined(t.withCredentials)||(c.withCredentials=!!t.withCredentials),a&&a!=="json"&&(c.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&c.addEventListener("progress",we(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",we(t.onUploadProgress)),(t.cancelToken||t.signal)&&(u=h=>{c&&(s(!h||h.type?new I(null,t,c):h),c.abort(),c=null)},t.cancelToken&&t.cancelToken.subscribe(u),t.signal&&(t.signal.aborted?u():t.signal.addEventListener("abort",u)));const p=rn(g);if(p&&T.protocols.indexOf(p)===-1){s(new m("Unsupported protocol "+p+":",m.ERR_BAD_REQUEST,t));return}c.send(r||null)})},re={http:vt,xhr:ln};l.forEach(re,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const _e=t=>`- ${t}`,cn=t=>l.isFunction(t)||t===null||t===!1,Ve={getAdapter:t=>{t=l.isArray(t)?t:[t];const{length:e}=t;let n,s;const r={};for(let i=0;i<e;i++){n=t[i];let a;if(s=n,!cn(n)&&(s=re[(a=String(n)).toLowerCase()],s===void 0))throw new m(`Unknown adapter '${a}'`);if(s)break;r[a||"#"+i]=s}if(!s){const i=Object.entries(r).map(([o,u])=>`adapter ${o} `+(u===!1?"is not supported by the environment":"is not available in the build"));let a=e?i.length>1?`since :
`+i.map(_e).join(`
`):" "+_e(i[0]):"as no adapter specified";throw new m("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s},adapters:re};function te(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new I(null,t)}function Ee(t){return te(t),t.headers=C.from(t.headers),t.data=ee.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ve.getAdapter(t.adapter||ue.adapter)(t).then(function(s){return te(t),s.data=ee.call(t,t.transformResponse,s),s.headers=C.from(s.headers),s},function(s){return He(s)||(te(t),s&&s.response&&(s.response.data=ee.call(t,t.transformResponse,s.response),s.response.headers=C.from(s.response.headers))),Promise.reject(s)})}const Se=t=>t instanceof C?{...t}:t;function N(t,e){e=e||{};const n={};function s(f,d,c){return l.isPlainObject(f)&&l.isPlainObject(d)?l.merge.call({caseless:c},f,d):l.isPlainObject(d)?l.merge({},d):l.isArray(d)?d.slice():d}function r(f,d,c){if(l.isUndefined(d)){if(!l.isUndefined(f))return s(void 0,f,c)}else return s(f,d,c)}function i(f,d){if(!l.isUndefined(d))return s(void 0,d)}function a(f,d){if(l.isUndefined(d)){if(!l.isUndefined(f))return s(void 0,f)}else return s(void 0,d)}function o(f,d,c){if(c in e)return s(f,d);if(c in t)return s(void 0,f)}const u={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(f,d)=>r(Se(f),Se(d),!0)};return l.forEach(Object.keys(Object.assign({},t,e)),function(d){const c=u[d]||r,g=c(t[d],e[d],d);l.isUndefined(g)&&c!==o||(n[d]=g)}),n}const $e="1.6.8",de={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{de[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}});const ke={};de.transitional=function(e,n,s){function r(i,a){return"[Axios v"+$e+"] Transitional option '"+i+"'"+a+(s?". "+s:"")}return(i,a,o)=>{if(e===!1)throw new m(r(a," has been removed"+(n?" in "+n:"")),m.ERR_DEPRECATED);return n&&!ke[a]&&(ke[a]=!0,console.warn(r(a," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(i,a,o):!0}};function un(t,e,n){if(typeof t!="object")throw new m("options must be an object",m.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let r=s.length;for(;r-- >0;){const i=s[r],a=e[i];if(a){const o=t[i],u=o===void 0||a(o,i,t);if(u!==!0)throw new m("option "+i+" must be "+u,m.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new m("Unknown option "+i,m.ERR_BAD_OPTION)}}const ie={assertOptions:un,validators:de},U=ie.validators;class ${constructor(e){this.defaults=e,this.interceptors={request:new ye,response:new ye}}async request(e,n){try{return await this._request(e,n)}catch(s){if(s instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}throw s}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=N(this.defaults,n);const{transitional:s,paramsSerializer:r,headers:i}=n;s!==void 0&&ie.assertOptions(s,{silentJSONParsing:U.transitional(U.boolean),forcedJSONParsing:U.transitional(U.boolean),clarifyTimeoutError:U.transitional(U.boolean)},!1),r!=null&&(l.isFunction(r)?n.paramsSerializer={serialize:r}:ie.assertOptions(r,{encode:U.function,serialize:U.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let a=i&&l.merge(i.common,i[n.method]);i&&l.forEach(["delete","get","head","post","put","patch","common"],p=>{delete i[p]}),n.headers=C.concat(a,i);const o=[];let u=!0;this.interceptors.request.forEach(function(h){typeof h.runWhen=="function"&&h.runWhen(n)===!1||(u=u&&h.synchronous,o.unshift(h.fulfilled,h.rejected))});const f=[];this.interceptors.response.forEach(function(h){f.push(h.fulfilled,h.rejected)});let d,c=0,g;if(!u){const p=[Ee.bind(this),void 0];for(p.unshift.apply(p,o),p.push.apply(p,f),g=p.length,d=Promise.resolve(n);c<g;)d=d.then(p[c++],p[c++]);return d}g=o.length;let b=n;for(c=0;c<g;){const p=o[c++],h=o[c++];try{b=p(b)}catch(y){h.call(this,y);break}}try{d=Ee.call(this,b)}catch(p){return Promise.reject(p)}for(c=0,g=f.length;c<g;)d=d.then(f[c++],f[c++]);return d}getUri(e){e=N(this.defaults,e);const n=qe(e.baseURL,e.url);return je(n,e.params,e.paramsSerializer)}}l.forEach(["delete","get","head","options"],function(e){$.prototype[e]=function(n,s){return this.request(N(s||{},{method:e,url:n,data:(s||{}).data}))}});l.forEach(["post","put","patch"],function(e){function n(s){return function(i,a,o){return this.request(N(o||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}$.prototype[e]=n(),$.prototype[e+"Form"]=n(!0)});const V=$;class fe{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const s=this;this.promise.then(r=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](r);s._listeners=null}),this.promise.then=r=>{let i;const a=new Promise(o=>{s.subscribe(o),i=o}).then(r);return a.cancel=function(){s.unsubscribe(i)},a},e(function(i,a,o){s.reason||(s.reason=new I(i,a,o),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}static source(){let e;return{token:new fe(function(r){e=r}),cancel:e}}}const dn=fe;function fn(t){return function(n){return t.apply(null,n)}}function hn(t){return l.isObject(t)&&t.isAxiosError===!0}const ae={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ae).forEach(([t,e])=>{ae[e]=t});const pn=ae;function Je(t){const e=new V(t),n=Re(V.prototype.request,e);return l.extend(n,V.prototype,e,{allOwnKeys:!0}),l.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return Je(N(t,r))},n}const _=Je(ue);_.Axios=V;_.CanceledError=I;_.CancelToken=dn;_.isCancel=He;_.VERSION=$e;_.toFormData=G;_.AxiosError=m;_.Cancel=_.CanceledError;_.all=function(e){return Promise.all(e)};_.spread=fn;_.isAxiosError=hn;_.mergeConfig=N;_.AxiosHeaders=C;_.formToJSON=t=>ze(l.isHTMLForm(t)?new FormData(t):t);_.getAdapter=Ve.getAdapter;_.HttpStatusCode=pn;_.default=_;const x=_;class mn{constructor(e,n,s,r,i){A(this,"plugin");A(this,"name");A(this,"file");A(this,"settings",new Map);A(this,"elements",new Map);this.name=n??"settings",this.plugin=e,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this.plugin.setting=new v.Setting({width:r,height:i,confirmCallback:()=>{for(let o of this.settings.keys())this.updateValueFromElement(o);let a=this.dump();s!==void 0?s(a):(this.plugin.data[this.name]=a,this.save())},destroyCallback:()=>{for(let a of this.settings.keys())this.updateElementFromValue(a)}})}async load(){let e=await this.plugin.loadData(this.file);if(console.debug("Load config:",e),e)for(let[n,s]of this.settings)s.value=(e==null?void 0:e[n])??s.value,this.updateElementFromValue(n);return this.plugin.data[this.name]=this.dump(),e}async save(){let e=this.dump();return await this.plugin.saveData(this.file,this.dump()),console.debug("Save config:",e),e}get(e){var n;return(n=this.settings.get(e))==null?void 0:n.value}take(e){let n=this.getElement(e);return this.settings.set(e,n),n.type==="button",n.value}set(e,n){let s=this.settings.get(e);s&&(s.value=n,this.updateElementFromValue(e))}async setAndSave(e,n){let s=this.settings.get(e);s&&(s.value=n,this.updateElementFromValue(e),await this.save())}async takeAndSave(e){let n=this.take(e);return await this.save(),n}disable(e){let n=this.elements.get(e);n&&(n.disabled=!0)}enable(e){let n=this.elements.get(e);n&&(n.disabled=!1)}dump(){let e={};for(let[n,s]of this.settings)s.type!=="button"&&(e[n]=s.value);return e}addItem(e){var s,r,i,a,o,u,f,d,c;this.settings.set(e.key,e);let n;switch(e.type){case"checkbox":let g=document.createElement("input");g.type="checkbox",g.checked=e.value,g.className="b3-switch fn__flex-center",n=g,g.onchange=((s=e.action)==null?void 0:s.callback)??(()=>{});break;case"select":let b=document.createElement("select");b.className="b3-select fn__flex-center fn__size200";let p=(e==null?void 0:e.options)??{};for(let F in p){let Z=document.createElement("option"),Ke=p[F];Z.value=F,Z.text=Ke,b.appendChild(Z)}b.value=e.value,b.onchange=((r=e.action)==null?void 0:r.callback)??(()=>{}),n=b;break;case"slider":let h=document.createElement("input");h.type="range",h.className="b3-slider fn__size200 b3-tooltips b3-tooltips__n",h.ariaLabel=e.value,h.min=((i=e.slider)==null?void 0:i.min.toString())??"0",h.max=((a=e.slider)==null?void 0:a.max.toString())??"100",h.step=((o=e.slider)==null?void 0:o.step.toString())??"1",h.value=e.value,h.onchange=()=>{var F;h.ariaLabel=h.value,(F=e.action)==null||F.callback()},n=h;break;case"textinput":let y=document.createElement("input");y.className="b3-text-field fn__flex-center fn__size200",y.value=e.value,y.onchange=((u=e.action)==null?void 0:u.callback)??(()=>{}),n=y;break;case"textarea":let w=document.createElement("textarea");w.className="b3-text-field fn__block",w.value=e.value,w.onchange=((f=e.action)==null?void 0:f.callback)??(()=>{}),n=w;break;case"number":let E=document.createElement("input");E.type="number",E.className="b3-text-field fn__flex-center fn__size200",E.value=e.value,n=E;break;case"button":let S=document.createElement("button");S.className="b3-button b3-button--outline fn__flex-center fn__size200",S.innerText=((d=e.button)==null?void 0:d.label)??"Button",S.onclick=((c=e.button)==null?void 0:c.callback)??(()=>{}),n=S;break;case"hint":let M=document.createElement("div");M.className="b3-label fn__flex-center",n=M;break}this.elements.set(e.key,n),this.plugin.setting.addItem({title:e.title,description:e==null?void 0:e.description,createActionElement:()=>this.getElement(e.key)})}getElement(e){let n=this.settings.get(e),s=this.elements.get(e);switch(n.type){case"checkbox":n.value=!!s.checked;break;case"select":n.value=s.value;break;case"slider":n.value=s.value;break;case"textinput":n.value=s.value;break;case"textarea":n.value=s.value;break}return s}updateValueFromElement(e){let n=this.settings.get(e),s=this.elements.get(e);switch(n.type){case"checkbox":n.value=s.checked;break;case"select":n.value=s.value;break;case"slider":n.value=s.value;break;case"textinput":n.value=s.value;break;case"textarea":n.value=s.value;break}}updateElementFromValue(e){let n=this.settings.get(e),s=this.elements.get(e);switch(n.type){case"checkbox":s.checked=n.value;break;case"select":s.value=n.value;break;case"slider":s.value=n.value;break;case"textinput":s.value=n.value;break;case"textarea":s.value=n.value;break}}}async function We(t,e){let n=await v.fetchSyncPost(t,e);return n.code===0?n.data:null}async function xe(t,e=7e3){return We("/api/notification/pushMsg",{msg:t,timeout:e})}async function O(t,e=7e3){return We("/api/notification/pushErrMsg",{msg:t,timeout:e})}const z=x.create({timeout:1e4,headers:{"Content-Type":"application/json"}}),Te="menu-config",P="temp/plugin/share-note";class gn extends v.Plugin{constructor(){super(...arguments);A(this,"isMobile");A(this,"plugin_version","1.2.1");A(this,"settingUtils")}async onload(){this.data[Te]={readonlyText:"Readonly"},console.debug("loading plugin-sample",this.i18n);const n=v.getFrontend();this.isMobile=n==="mobile"||n==="browser-mobile",this.addIcons(`<symbol id="iconFace" viewBox="0 0 32 32">
        <g>
        <rect height="37.0645" opacity="0" width="24.623" x="0" y="0"/>
        <path d="M24.2676 15.0664L24.2676 28.7109C24.2676 31.5273 22.832 32.9492 19.9746 32.9492L4.29297 32.9492C1.43555 32.9492 0 31.5273 0 28.7109L0 15.0664C0 12.25 1.43555 10.8281 4.29297 10.8281L8.4082 10.8281L8.4082 13.0293L4.32031 13.0293C2.95312 13.0293 2.20117 13.7676 2.20117 15.1895L2.20117 28.5879C2.20117 30.0098 2.95312 30.748 4.32031 30.748L19.9336 30.748C21.2871 30.748 22.0664 30.0098 22.0664 28.5879L22.0664 15.1895C22.0664 13.7676 21.2871 13.0293 19.9336 13.0293L15.8594 13.0293L15.8594 10.8281L19.9746 10.8281C22.832 10.8281 24.2676 12.25 24.2676 15.0664Z" fill="#000000" fill-opacity="0.85"/>
        <path d="M12.127 22.2441C12.7148 22.2441 13.2207 21.752 13.2207 21.1777L13.2207 7.13672L13.1387 5.08594L14.0547 6.05664L16.1328 8.27148C16.3242 8.49023 16.5977 8.59961 16.8711 8.59961C17.4316 8.59961 17.8691 8.18945 17.8691 7.62891C17.8691 7.3418 17.7461 7.12305 17.541 6.91797L12.9199 2.46094C12.6465 2.1875 12.4141 2.0918 12.127 2.0918C11.8535 2.0918 11.6211 2.1875 11.334 2.46094L6.71289 6.91797C6.50781 7.12305 6.39844 7.3418 6.39844 7.62891C6.39844 8.18945 6.80859 8.59961 7.38281 8.59961C7.64258 8.59961 7.94336 8.49023 8.13477 8.27148L10.1992 6.05664L11.1289 5.08594L11.0469 7.13672L11.0469 21.1777C11.0469 21.752 11.5391 22.2441 12.127 22.2441Z" fill="#000000" fill-opacity="0.85"/>
       </g>
        </symbol>
<symbol id="iconSaving" viewBox="0 0 32 32">
<path d="M224.653061 642.612245c-72.097959 0-130.612245-58.514286-130.612245-130.612245s58.514286-130.612245 130.612245-130.612245 130.612245 58.514286 130.612245 130.612245-58.514286 130.612245-130.612245 130.612245z m0-219.428572c-49.110204 0-88.816327 39.706122-88.816326 88.816327s39.706122 88.816327 88.816326 88.816327 88.816327-39.706122 88.816327-88.816327-40.228571-88.816327-88.816327-88.816327zM580.440816 355.265306c-72.097959 0-130.612245-58.514286-130.612245-130.612245s58.514286-130.612245 130.612245-130.612245 130.612245 58.514286 130.612245 130.612245-59.036735 130.612245-130.612245 130.612245z m0-219.428571c-49.110204 0-88.816327 39.706122-88.816326 88.816326s39.706122 88.816327 88.816326 88.816327 88.816327-39.706122 88.816327-88.816327-40.228571-88.816327-88.816327-88.816326zM799.346939 929.959184c-72.097959 0-130.612245-58.514286-130.612245-130.612245s58.514286-130.612245 130.612245-130.612245 130.612245 58.514286 130.612245 130.612245-58.514286 130.612245-130.612245 130.612245z m0-219.428572c-49.110204 0-88.816327 39.706122-88.816327 88.816327s39.706122 88.816327 88.816327 88.816326 88.816327-39.706122 88.816326-88.816326-39.706122-88.816327-88.816326-88.816327z" fill="#13227a" p-id="4434"></path><path d="M301.453061 454.530612c-6.791837 0-13.583673-3.134694-17.763265-9.404081-6.269388-9.926531-3.657143-22.465306 6.269388-28.734694l201.665306-131.657143c9.926531-6.269388 22.465306-3.657143 28.734694 6.269388s3.657143 22.465306-6.269388 28.734694L312.42449 451.395918c-3.134694 2.089796-7.314286 3.134694-10.971429 3.134694zM699.036735 775.836735c-3.134694 0-6.791837-0.522449-9.404082-2.612245l-376.163265-195.395919c-10.44898-5.22449-14.106122-17.763265-8.881633-28.212244 5.22449-10.44898 17.763265-14.106122 28.212245-8.881633l376.163265 195.395918c10.44898 5.22449 14.106122 17.763265 8.881633 28.212245-3.657143 7.314286-10.971429 11.493878-18.808163 11.493878z" fill="#13227a" p-id="4435"></path><</symbol>`);const s=this.addTopBar({icon:"iconFace",title:this.i18n.topBarTitle,position:"right",callback:()=>{if(this.isMobile)this.addMenu();else{let r=s.getBoundingClientRect();r.width===0&&(r=document.querySelector("#barMore").getBoundingClientRect()),r.width===0&&(r=document.querySelector("#barPlugins").getBoundingClientRect()),this.addMenu(r)}}});this.settingUtils=new mn(this,Te);try{console.debug("加载插件")}catch(r){console.error("Error loading settings storage, probably empty config json:",r)}this.settingUtils.addItem({key:"share_link",value:"",type:"textinput",title:this.i18n.memu_share_link_title,description:""}),this.settingUtils.addItem({key:"create_share",value:"",type:"button",title:this.i18n.menu_create_share_title,description:this.i18n.menu_create_share_desc,button:{label:this.i18n.menu_create_share_label,callback:async()=>{this.settingUtils.disable("create_share");let r=await this.createLink();r.err==!1?(this.settingUtils.set("share_link",r.data),this.settingUtils.enable("delete_share"),xe("创建成功",7e3)):O(r.data,7e3),this.settingUtils.enable("create_share")}}}),this.settingUtils.addItem({key:"delete_share",value:"",type:"button",title:this.i18n.menu_delete_share_title,description:this.i18n.menu_delete_share_desc,button:{label:this.i18n.menu_delete_share_label,callback:async()=>{let r=await this.deleteLink();r.err==!1?(this.settingUtils.set("share_link",""),xe("删除成功",7e3),this.settingUtils.disable("delete_share")):O(r.data,7e3)}}}),this.settingUtils.addItem({key:"address",value:"http://124.223.15.220",type:"textinput",title:this.i18n.menu_address_title,description:this.i18n.menu_address_desc,action:{callback:async()=>{this.settingUtils.takeAndSave("address")}}}),this.settingUtils.addItem({key:"access_code",value:"",type:"textinput",title:this.i18n.memu_access_code_title,description:this.i18n.memu_access_code_desc,action:{callback:async()=>{this.settingUtils.takeAndSave("access_code")}}}),this.settingUtils.addItem({key:"enable_browser",value:!1,type:"checkbox",title:this.i18n.memu_enable_browser_title,description:this.i18n.memu_enable_browser_desc,action:{callback:async()=>{const r=!this.settingUtils.get("enable_browser");this.settingUtils.set("enable_browser",r),this.settingUtils.save()}}}),this.settingUtils.addItem({key:"exist_link_create",value:!1,type:"checkbox",title:this.i18n.memu_exist_link_create_title,description:this.i18n.memu_exist_link_create_desc,action:{callback:async()=>{const r=!this.settingUtils.get("exist_link_create");console.debug(r),this.settingUtils.set("exist_link_create",r),this.settingUtils.save()}}}),this.settingUtils.addItem({key:"page_wide",value:"800px",type:"textinput",title:this.i18n.memu_page_wide_title,description:this.i18n.memu_page_wide_desc,action:{callback:async()=>{let r=this.settingUtils.take("page_wide");if(r.endsWith("%")){let i=parseInt(r);if(i>100||i<0){O("请输入正确的百分比，如100%或者0%",8e3),this.settingUtils.set("page_wide","800px");return}}else if(r.endsWith("px")){if(parseInt(r)<0){O("请输入正确的像素值，如800px",8e3),this.settingUtils.set("page_wide","800px");return}}else{O("请输入正确的格式，如800px或者100%",8e3),this.settingUtils.set("page_wide","800px");return}this.settingUtils.save()}}}),this.settingUtils.addItem({key:"hide_version",value:!0,type:"checkbox",title:this.i18n.memu_hide_version_title,description:this.i18n.memu_hide_version_desc,action:{callback:async()=>{const r=!this.settingUtils.get("hide_version");this.settingUtils.set("hide_version",r),this.settingUtils.save()}}}),this.settingUtils.addItem({key:"Hint",value:"",type:"hint",title:this.i18n.hintTitle,description:this.i18n.hintDesc}),console.debug(this.i18n.helloPlugin)}onLayoutReady(){console.debug("加载插件"),this.settingUtils.load()}async onunload(){console.debug(this.i18n.byePlugin),await this.settingUtils.save(),v.showMessage("Goodbye SiYuan Plugin"),console.debug("onunload")}uninstall(){console.debug("uninstall")}async getsystemInfo(){const n="api/system/getConf";let s="{}",r={id:"",name:"",kernelVersion:"",os:"",osPlatform:"",container:"",isMicrosoftStore:!1,isInsider:!1,homeDir:"",workspaceDir:"",appDir:"",confDir:"",dataDir:"",networkServe:!1,networkProxy:{scheme:"",host:"",port:""},uploadErrLog:!1,disableGoogleAnalytics:!1,downloadInstallPkg:!1,autoLaunch:!1,lockScreenMode:0},i={};const a=this.settingUtils.get("access_code");return i["Content-Type"]="application/json",a!=""&&(i.Authorization=" Token "+a),x.post(n,s,i).then(function(o){return r=o.data.data.conf.system,r}).catch(function(o){return console.error(o),r})}async getSystemID(){return(await this.getsystemInfo()).id}async getDocTitle(n){const s="api/block/getDocInfo";let r={id:n},i={code:0,msg:"",data:{id:"",rootID:"",name:"",refCount:0,subFileCount:0,refIDs:[],ial:{id:"",title:"",type:"",updated:""},icon:"",attrViews:[]}},a={};const o=this.settingUtils.get("access_code");return a["Content-Type"]="application/json",o!=""&&(a.Authorization=" Token "+o),z.post(s,r,a).then(function(u){return i=u.data,i.data.name}).catch(function(u){return console.error(u),""})}async getActivePage(){const n="api/system/getConf";let s="{}",r={children:[],height:"",instance:"",width:""},i={};const a=this.settingUtils.get("access_code");return i["Content-Type"]="application/json",a!=""&&(i.Authorization=" Token "+a),z.post(n,s,i).then(function(o){r=o.data.data.conf.uiLayout.layout.children[0].children[1].children[0];for(let u=0;u<r.children.length;u++)if(r.children[u].active==!0)return r.children[u].children.blockId}).catch(function(o){return console.error(o),""})}async getTheme(){const n="api/system/getConf";let s="{}",r={mode:0,modeOS:!1,darkThemes:[],lightThemes:[],themeDark:"",themeLight:"",themeVer:"",icons:[],icon:"",iconVer:"",codeBlockThemeLight:"",codeBlockThemeDark:"",lang:"",themeJS:!1,closeButtonBehavior:0,hideStatusBar:!1},i={};const a=this.settingUtils.get("access_code");return i["Content-Type"]="application/json",a!=""&&(i.Authorization=" Token "+a),z.post(n,s,i).then(function(o){return r=o.data.data.conf.appearance,r.mode==0?r.themeLight:r.themeDark}).catch(function(o){return console.error(o),""})}async exportHtml(n){let s=await this.get_temp_dir();await this.rmdir_temp_dir(),await this.mkdir_temp_dir();let r="api/export/exportHTML",i={id:n,pdf:!1,savePath:s},a={code:0,msg:"",data:{content:"",id:"",name:""}},o={};const u=this.settingUtils.get("access_code");return u==""?o={"Content-Type":"application/json"}:o={Authorization:"Token "+u,"Content-Type":"application/json"},z.post(r,i,o).then(function(f){return a=f.data,a.code==0&&a.data.id==n?(console.debug("导出资源文件夹成功"),a.data.content):""}).catch(function(f){return console.error(f),""})}async exportResource(){const n="resources";let s={err:!0,data:""};const r={paths:[P],name:n},i={"Content-Type":"application/json"};return await x.post("/api/export/exportResources",r,{headers:i}).then(function(a){a.data.code==0&&(s.err=!1),s.data=a.data.data.path,console.debug(`导出资源压缩包成功：${s.data}`)}).catch(function(a){s.data=a.message}),s}async get_temp_dir(){let n,s=await this.getsystemInfo();return s.os=="darwin"?n=s.workspaceDir+"/"+P:s.os=="windows"?n=s.workspaceDir+"\\"+P:n=s.workspaceDir+"/"+P,n}async mkdir_temp_dir(){let n={err:!0,data:""};const s={"Content-Type":"multipart/form-data"},r={path:P,isDir:"true",modTime:new Date().getTime()};return await x.post("/api/file/putFile",r,{headers:s}).then(function(i){i.data.code==0&&(n.err=!1),n.data=r.path}).catch(function(i){console.error(`创建缓存目录${i}`),n.data=i.message}),n}async rmdir_temp_dir(){const n={path:P};await x.post("/api/file/removeFile",n).then(function(){}).catch(function(s){console.error(`删除缓存目录${s}`)})}async getFile(n){let s={err:!0,data:""};const r=this.settingUtils.get("access_code");let i={};r!=""?i={Accept:"application/zip","Content-Type":"application/json",Authorization:"Token "+r}:i={Accept:"application/zip","Content-Type":"application/json"},i={Accept:"application/zip","Content-Type":"application/json"};const a={path:n};return await x.post("/api/file/getFile",a,{headers:i,responseType:"blob"}).then(function(o){return s.err=!1,s.fdata=o.data,s}).catch(function(o){return console.error("获取文件",o),s.data=o.message,s})}async uploadFile(n){let s=await this.getSystemID(),r=await this.getActivePage(),i={err:!0,data:""},a=await this.exportHtml(r);if(a=="")return;if(i=await this.exportResource(),i.err==!0||(i=await this.getFile(i.data),i.err==!0))return i;if(i.fdata==null)return i.err=!0,i.data="获取文件失败",i;const o=new FormData,u=new Blob([i.fdata],{type:"application/zip"});o.append("file",u);const f=this.settingUtils.get("enable_browser");let d={};f?d={"Content-Type":"multipart/form-data","cros-status":f}:d={"Content-Type":"multipart/form-data"};const c=v.getFrontend();return n=n+`/api/upload_file?appid=${s}&docid=${r}&type=${c}`,await x.post(n,o,{headers:d,timeout:3e5}).then(function(g){let b=g.data;return console.debug("上传文件",g.data),b.err==0?(i.err=!1,i.data=a,i):(i.data=b.msg,i)}).catch(function(g){return i.err=!0,i.data=g.message,console.error(g),i})}async uploadArgs(n,s){let r=await this.getActivePage(),i={appid:await this.getSystemID(),docid:r,content:s,version:v.Constants.SIYUAN_VERSION,theme:await this.getTheme(),title:await this.getDocTitle(r),hide_version:this.settingUtils.get("hide_version"),plugin_version:this.plugin_version,exist_link_create:this.settingUtils.get("exist_link_create"),page_wide:this.settingUtils.get("page_wide")},a=n+"/api/upload_args",o={};const u=this.settingUtils.get("enable_browser");u?(o["Content-Type"]="application/json",o["cros-status"]=u):o["Content-Type"]="text/plain";let f={err:!0,data:""};return x.post(a,i,{headers:o}).then(function(d){let c=d.data;return f.err=!1,f.data=c.data,console.debug("上传参数",c),c.err==0||O(c.msg,7e3),f}).catch(function(d){return console.error(d),f.data=d.message,f.err=!0,f})}async createLink(){let n={err:!0,data:""},s=this.settingUtils.get("address");return n=await this.uploadFile(s),n.err==!0?(O(n.data,7e3),n):await this.uploadArgs(s,n.data)}async getLink(){let n={err:!0,data:""};const s={appid:await this.getSystemID(),docid:await this.getActivePage(),plugin_version:this.plugin_version},r=this.settingUtils.get("address")+"/api/getlink";let i={};const a=this.settingUtils.get("enable_browser");return a?(i["Content-Type"]="application/json",i["cros-status"]=a):i["Content-Type"]="text/plain",x.post(r,s,{headers:i,timeout:3e3}).then(function(o){let u=o.data;return console.debug("获取链接",u),u.err==0||u.err==3?n.err=!1:n.err=!0,n.data=u.data,n}).catch(function(o){return console.error(o),n.data=o.message,n})}async deleteLink(){let n={err:!0,data:""};const s={appid:await this.getSystemID(),docid:await this.getActivePage(),plugin_version:this.plugin_version},r=this.settingUtils.get("address")+"/api/deletelink";let i={};const a=this.settingUtils.get("enable_browser");return a?(i["Content-Type"]="application/json",i["cros-status"]=a):i["Content-Type"]="text/plain",x.post(r,s,{headers:i}).then(function(o){let u=o.data;return console.debug("删除链接",u),u.err==0||u.err==3?n.err=!1:n.err=!0,n.data=u.data,n}).catch(function(o){return console.error(o),n.data=o.message,n})}async addMenu(n){const s=new v.Menu("topBar",()=>{});s.addSeparator(),s.addItem({icon:"iconSettings",label:"设置",click:async()=>{this.settingUtils.disable("delete_share"),this.settingUtils.set("share_link","");try{let r=await this.getLink();r.err==!1?(this.settingUtils.set("share_link",r.data),r.data!=""&&this.settingUtils.enable("delete_share")):O(r.data,7e3)}catch(r){O(r.message,7e3)}this.openSetting()}}),s.addSeparator(),this.isMobile?s.fullscreen():s.open({x:n.right,y:n.bottom,isLeft:!0})}}module.exports=gn;
