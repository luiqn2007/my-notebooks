"use strict";var yn=Object.defineProperty;var Tn=(n,e,t)=>e in n?yn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ae=(n,e,t)=>(Tn(n,typeof e!="symbol"?e+"":e,t),t);const Y=require("siyuan");function Te(){}function sn(n){return n()}function Lt(){return Object.create(null)}function Oe(n){n.forEach(sn)}function on(n){return typeof n=="function"}function ut(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let wt;function En(n,e){return wt||(wt=document.createElement("a")),wt.href=e,n===wt.href}function In(n){return Object.keys(n).length===0}const Mn=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function s(n,e){n.appendChild(e)}function Z(n,e,t){n.insertBefore(e,t||null)}function J(n){n.parentNode&&n.parentNode.removeChild(n)}function St(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function r(n){return document.createElement(n)}function q(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function ge(n){return document.createTextNode(n)}function f(){return ge(" ")}function cn(){return ge("")}function A(n,e,t,l){return n.addEventListener(e,t,l),()=>n.removeEventListener(e,t,l)}function Mt(n){return function(e){return e.stopPropagation(),n.call(this,e)}}function i(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function fe(n,e,t){n.setAttributeNS("http://www.w3.org/1999/xlink",e,t)}function We(n){return n===""?null:+n}function xn(n){return Array.from(n.childNodes)}function mt(n,e){e=""+e,n.data!==e&&(n.data=e)}function qe(n,e){n.value=e??""}function Me(n,e,t,l){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,l?"important":"")}class an{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,l=null){this.e||(this.is_svg?this.e=q(t.nodeName):this.e=r(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(l)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)Z(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(J)}}let Ct;function bt(n){Ct=n}function rn(){if(!Ct)throw new Error("Function called outside component initialization");return Ct}function un(n){rn().$$.on_mount.push(n)}function Dn(n){rn().$$.on_destroy.push(n)}const ct=[],kt=[];let at=[];const Ft=[],An=Promise.resolve();let xt=!1;function Nn(){xt||(xt=!0,An.then(fn))}function Dt(n){at.push(n)}const Et=new Set;let it=0;function fn(){if(it!==0)return;const n=Ct;do{try{for(;it<ct.length;){const e=ct[it];it++,bt(e),Ln(e.$$)}}catch(e){throw ct.length=0,it=0,e}for(bt(null),ct.length=0,it=0;kt.length;)kt.pop()();for(let e=0;e<at.length;e+=1){const t=at[e];Et.has(t)||(Et.add(t),t())}at.length=0}while(ct.length);for(;Ft.length;)Ft.pop()();xt=!1,Et.clear(),bt(n)}function Ln(n){if(n.fragment!==null){n.update(),Oe(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Dt)}}function Fn(n){const e=[],t=[];at.forEach(l=>n.indexOf(l)===-1?e.push(l):t.push(l)),t.forEach(l=>l()),at=e}const Tt=new Set;let nt;function Bn(){nt={r:0,c:[],p:nt}}function Hn(){nt.r||Oe(nt.c),nt=nt.p}function rt(n,e){n&&n.i&&(Tt.delete(n),n.i(e))}function At(n,e,t,l){if(n&&n.o){if(Tt.has(n))return;Tt.add(n),nt.c.push(()=>{Tt.delete(n),l&&(t&&n.d(1),l())}),n.o(e)}else l&&l()}function dn(n,e){n.d(1),e.delete(n.key)}function hn(n,e,t,l,o,a,c,u,p,h,_,k){let b=n.length,g=a.length,m=b;const D={};for(;m--;)D[n[m].key]=m;const O=[],S=new Map,C=new Map,x=[];for(m=g;m--;){const w=k(o,a,m),R=t(w);let te=c.get(R);te?l&&x.push(()=>te.p(w,e)):(te=h(R,w),te.c()),S.set(R,O[m]=te),R in D&&C.set(R,Math.abs(m-D[R]))}const $=new Set,N=new Set;function E(w){rt(w,1),w.m(u,_),c.set(w.key,w),_=w.first,g--}for(;b&&g;){const w=O[g-1],R=n[b-1],te=w.key,X=R.key;w===R?(_=w.first,b--,g--):S.has(X)?!c.has(te)||$.has(te)?E(w):N.has(X)?b--:C.get(te)>C.get(X)?(N.add(te),E(w)):($.add(X),b--):(p(R,c),b--)}for(;b--;){const w=n[b];S.has(w.key)||p(w,c)}for(;g;)E(O[g-1]);return Oe(x),O}function Pn(n){n&&n.c()}function _n(n,e,t,l){const{fragment:o,after_update:a}=n.$$;o&&o.m(e,t),l||Dt(()=>{const c=n.$$.on_mount.map(sn).filter(on);n.$$.on_destroy?n.$$.on_destroy.push(...c):Oe(c),n.$$.on_mount=[]}),a.forEach(Dt)}function pn(n,e){const t=n.$$;t.fragment!==null&&(Fn(t.after_update),Oe(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function qn(n,e){n.$$.dirty[0]===-1&&(ct.push(n),Nn(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ft(n,e,t,l,o,a,c,u=[-1]){const p=Ct;bt(n);const h=n.$$={fragment:null,ctx:[],props:a,update:Te,not_equal:o,bound:Lt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(p?p.$$.context:[])),callbacks:Lt(),dirty:u,skip_bound:!1,root:e.target||p.$$.root};c&&c(h.root);let _=!1;if(h.ctx=t?t(n,e.props||{},(k,b,...g)=>{const m=g.length?g[0]:b;return h.ctx&&o(h.ctx[k],h.ctx[k]=m)&&(!h.skip_bound&&h.bound[k]&&h.bound[k](m),_&&qn(n,k)),b}):[],h.update(),_=!0,Oe(h.before_update),h.fragment=l?l(h.ctx):!1,e.target){if(e.hydrate){const k=xn(e.target);h.fragment&&h.fragment.l(k),k.forEach(J)}else h.fragment&&h.fragment.c();e.intro&&rt(n.$$.fragment),_n(n,e.target,e.anchor,e.customElement),fn()}bt(p)}class dt{$destroy(){pn(this,1),this.$destroy=Te}$on(e,t){if(!on(t))return Te;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(t),()=>{const o=l.indexOf(t);o!==-1&&l.splice(o,1)}}$set(e){this.$$set&&!In(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}async function Nt(n,e){let t=await Y.fetchSyncPost(n,e);return t.code===0?t.data:null}async function gn(){return Nt("/api/notebook/lsNotebooks","")}async function Bt(n){return n?Nt("/api/block/checkBlockFold",{id:n}):Promise.reject(new Error("参数错误"))}async function On(n){return Nt("/api/query/sql",{stmt:n})}class Rn{constructor(e,t,l,o,a,c,u){ae(this,"keywords");ae(this,"pages");ae(this,"documentSortMethod");ae(this,"contentBlockSortMethod");ae(this,"includeTypes");ae(this,"includeConcatFields");ae(this,"excludeNotebookIds");this.keywords=e,this.pages=t,this.documentSortMethod=l,this.contentBlockSortMethod=o,this.includeTypes=a,this.includeConcatFields=c,this.excludeNotebookIds=u}}function zn(n){let e=n.keywords,t=n.pages,l=n.contentBlockSortMethod,o=n.includeTypes,a=n.includeConcatFields,c=jn(n),u=" (SELECT count( 1 ) FROM document_id_temp) as documentCount ",p=" SELECT root_id FROM document_id_temp "+vn(t),h=mn("concatContent",a),_=bn("type",o),k=Kn("concatContent",e),b=[];l=="modifiedAsc"?b=[" updated ASC "]:l=="modifiedDesc"?b=[" updated DESC "]:l=="createdAsc"?b=[" created ASC "]:l=="createdDesc"?b=[" created DESC "]:l=="rankAsc"?b=[vt("concatContent",e,!0)," sort ASC "," updated DESC "]:l=="rankDesc"?b=[vt("concatContent",e,!1)," sort ASC "," updated DESC "]:b=[" sort ASC ",vt("concatContent",e,!1)," updated DESC "];let g=kn(b),m=`	
        WITH document_id_temp AS (
            ${c}
        )
        SELECT *, ${h}, ${u}
        FROM blocks
        WHERE
            1 = 1
            ${_}
            AND (
                id IN (${p})
                OR (
                    root_id IN (${p})
                    AND (  ${k} ) 
                )
            )
        ${g}
        LIMIT 99999999;
    `;return Gn(m)}function jn(n){let e=n.keywords;n.pages;let t=n.documentSortMethod,l=n.includeTypes,o=n.includeConcatFields,a=n.excludeNotebookIds,c=mn(null,o),u=["root_id",`Max(CASE WHEN type = 'd' THEN ${c} END) documentContent`],p=`GROUP_CONCAT( ${c} )`,h=[];return t=="modifiedAsc"?h=[" MAX(updated) ASC "]:t=="modifiedDesc"?h=[" MAX(updated) DESC "]:t=="createdAsc"?h=[" MIN(created) ASC "]:t=="createdDesc"?h=[" MIN(created) DESC "]:t=="rankAsc"?h=[vt("documentContent",e,!0)," MAX(updated) DESC "]:h=[vt("documentContent",e,!1)," MAX(updated) DESC "],$n(u,e,p,l,a,h,null)}function $n(n,e,t,l,o,a,c){let u=n.join(","),p=bn("type",l),h=Wn("box",o),_=Vn(` ${t} `,e);_&&(_=` AND ( ${_} ) `);let k=kn(a),b=vn(c);return`  
        SELECT ${u} 
        FROM
            blocks 
        WHERE
            1 = 1 
            ${p}
            ${h}
        GROUP BY
            root_id 
        HAVING
            1 = 1 
            ${_}
        ${k}
        ${b}
    `}function mn(n,e){if(!e||e.length<=0)return"";let t=` ( ${e.join(" || ")} ) `;return n&&(t+=` AS ${n} `),t}function Gn(n){let e=n.replace(/[\r\n]+/g," ");return e=e.replace(/\s+/g," "),e=e.trim(),e}function Kn(n,e){return e.length===0?" ":e.map(o=>`${n} LIKE '%${o}%'`).join(" OR ")}function Vn(n,e){return e.length===0?" ":e.map(o=>`${n}  LIKE '%${o}%'`).join(" AND ")}function bn(n,e){if(!e||e.length===0)return" ";let t=` AND ${n} IN (`;const l=e.map(o=>` '${o}' `);return t=t+l.join(" , ")+" ) ",t}function Wn(n,e){if(!e||e.length===0)return" ";let t=` AND ${n} NOT IN (`;const l=e.map(o=>` '${o}' `);return t=t+l.join(" , ")+" ) ",t}function vt(n,e,t){let l="";for(let a=0;a<e.length;a++){let c=e[a];l+=` (${n} LIKE '%${c}%') `,a<e.length-1&&(l+=" + ")}let o="";return l&&(o=`( ${l} ) ${t?" ASC ":" DESC "}`),o}function kn(n){let e="";if(n){n=n.filter(l=>l);let t=n.join(",");t&&(e=` ORDER BY ${t} `)}return e}function vn(n){let e="";if(n){const t=n[1];if(n.length==1)e=` LIMIT ${t} `;else if(n.length==2){const l=(n[0]-1)*n[1];e=` LIMIT ${t} OFFSET ${l} `}}return e}class Ht{constructor(){ae(this,"block");ae(this,"subItems");ae(this,"isCollapsed");ae(this,"htmlContent");ae(this,"icon");ae(this,"index");ae(this,"path")}}const ot={iconDocumentSearch:{id:"iconDocumentSearch",source:`<symbol id="iconDocumentSearch" viewBox="0 0 1024 1024">
    <path d="M298.432 902.592c38.784 4.032 88.96 4.096 159.232 4.096h11.648a32 32 0 0 1 0 64h-13.44c-68.032 0-121.6 0-164.096-4.48-43.392-4.48-79.04-13.952-109.568-35.392a208.64 208.64 0 0 1-43.072-40.64c-23.296-29.184-33.536-63.616-38.4-105.088-4.736-40.32-4.736-90.88-4.736-154.688V518.592c0-62.208 0-110.528 2.56-149.504 2.56-39.488 7.936-71.68 19.712-101.248 35.712-90.24 111.04-160.64 205.568-193.92 54.4-19.008 120.128-20.48 229.632-20.608a176.128 176.128 0 0 1 1.6 0h41.792c69.76 0 113.28 0 149.12 12.608 57.536 20.16 103.68 63.168 125.632 118.656 7.488 18.816 10.688 38.784 12.16 62.016 1.536 22.72 1.536 50.688 1.536 85.888V512a32 32 0 0 1-64 0V333.568c0-36.48 0-62.4-1.344-82.752-1.28-20.096-3.84-32.64-7.808-42.688a144.384 144.384 0 0 0-87.424-81.856c-24.192-8.512-55.68-8.96-135.168-8.96H552.32a110.208 110.208 0 0 0-107.968 110.272c0 6.272 0.32 12.992 0.64 20.544l0.128 2.816c0.32 6.656 0.64 13.824 0.832 20.992a192 192 0 0 1-5.12 53.44c-9.536 35.584-37.312 63.36-72.896 72.896a192 192 0 0 1-53.376 5.12c-7.168-0.192-14.4-0.576-20.992-0.832l-2.816-0.128a452.672 452.672 0 0 0-20.608-0.64A110.208 110.208 0 0 0 160 512.832V628.352c0 66.24 0 113.152 4.288 149.248 4.16 35.392 11.968 56.512 24.96 72.768 8.384 10.56 18.432 20.032 29.824 28.096 17.792 12.544 41.088 20.096 79.36 24.128z m-136.128-527.36a173.44 173.44 0 0 1 107.904-37.44c7.936 0 16 0.32 23.552 0.64l2.944 0.192c6.656 0.32 12.928 0.64 19.2 0.704 14.592 0.32 26.24-0.384 35.52-2.88a39.104 39.104 0 0 0 27.712-27.648c2.496-9.344 3.2-20.992 2.88-35.52a737.152 737.152 0 0 0-0.768-19.2l-0.128-2.944a512.64 512.64 0 0 1-0.64-23.552c0-40.32 13.568-77.312 36.48-106.816-29.568 2.432-51.904 6.592-71.936 13.568-77.952 27.392-138.688 84.992-167.296 157.056-8.256 20.864-12.928 45.568-15.36 81.92l-0.064 1.92z"></path>
    <path d="M522.688 743.616a178.304 178.304 0 1 1 324.928 101.376l71.04 71.04a32 32 0 0 1-45.312 45.248l-71.04-71.04a178.304 178.304 0 0 1-279.68-146.688z m178.24-114.304a114.304 114.304 0 1 0 0 228.608 114.304 114.304 0 0 0 0-228.608z"></path>
    </symbol>`},iconSearchSettingExcludeNotebook:{id:"iconSearchSettingExcludeNotebook",source:`<symbol id="iconSearchSettingExcludeNotebook" viewBox="0 0 1024 1024">
        <path
        d="M905.837714 270.774857h-29.513143v-29.549714a118.308571 118.308571 0 0 0-118.162285-118.125714h-199.862857a117.833143 117.833143 0 0 0-95.524572-49.261715H118.125714A118.308571 118.308571 0 0 0 0 192v640a118.308571 118.308571 0 0 0 118.162286 118.162286H905.874286A118.308571 118.308571 0 0 0 1024 832V388.937143a118.308571 118.308571 0 0 0-118.162286-118.162286z m-147.675428-108.251428a78.848 78.848 0 0 1 78.738285 78.738285v29.513143h-255.963428V192a116.589714 116.589714 0 0 0-4.205714-29.513143z m226.413714 669.476571a78.848 78.848 0 0 1-78.738286 78.738286H118.125714a78.848 78.848 0 0 1-78.738285-78.738286V310.198857h866.377142a78.848 78.848 0 0 1 78.774858 78.738286z m-318.72-438.162286H358.144a62.683429 62.683429 0 0 0-49.993143 100.461715l119.661714 158.134857v111.981714a19.748571 19.748571 0 0 0 13.458286 18.688l128.950857 42.971429a20.041143 20.041143 0 0 0 6.217143 1.024 19.821714 19.821714 0 0 0 19.748572-19.748572V652.434286l119.588571-158.061715a62.646857 62.646857 0 0 0-49.92-100.534857z m18.541714 76.726857l-123.648 163.401143a19.931429 19.931429 0 0 0-4.022857 11.885715v134.217142l-89.490286-29.878857V645.851429a19.931429 19.931429 0 0 0-3.986285-11.885715l-123.684572-163.474285a23.259429 23.259429 0 0 1 18.578286-37.229715h307.712a23.259429 23.259429 0 0 1 18.541714 37.302857z"
        ></path>
    </symbol>`},iconSearchSettingOther:{id:"iconSearchSettingOther",source:`<symbol id="iconSearchSettingOther" viewBox="0 0 1024 1024">
        <path
        d="M736.1792 456.704c-19.92704-11.52512-44.48256-11.52512-64.40448 0s-32.19968 32.82432-32.19968 55.87456 12.27264 44.34944 32.19968 55.86944c19.92704 11.52512 44.48256 11.52512 64.40448 0 19.93216-11.52 32.19968-32.8192 32.19968-55.86944S756.11136 468.22912 736.1792 456.704z">
    </path>
    <path
        d="M997.71904 357.7088c-10.9312-34.4064-25.1904-67.37408-43.18208-98.6624-12.16512-21.15584-40.35072-22.93248-54.0416-3.39968-8.56064 12.20096-7.19872 24.61184-0.19968 37.36064 59.61216 108.55424 74.09152 223.05792 40.13056 342.07744-68.73088 240.91648-318.67904 377.15456-558.4128 305.82784-175.66208-52.25472-303.3344-211.02592-316.88192-394.368-5.53984-74.97728 6.90688-146.90816 36.8896-215.91552 82.54976-189.9776 293.2224-299.58656 495.7696-257.8176 46.5664 9.6 90.61888 25.79968 131.99872 49.2544 7.08608 4.00896 14.40768 6.69184 22.68672 5.41184 13.91104-2.15552 24.73472-12.30336 27.22816-25.43104 2.7392-14.39232-3.70176-27.47392-17.72544-35.25632C647.23456 3.03616 525.46048-15.55456 397.50656 13.0816 165.39136 65.02912 0.05632 273.18272 0 511.65184c-0.00512 38.14912 4.0192 75.87328 12.42112 113.06496 65.00864 287.8208 359.52128 461.42976 642.048 378.55232 199.6288-58.56256 343.83872-232.51456 364.79488-440.70912C1026.2784 492.88704 1018.94144 424.51456 997.71904 357.7088z">
    </path>
    <path
        d="M478.62784 456.704c-19.92704 11.52512-32.2048 32.82432-32.2048 55.87456 0 35.63008 28.83584 64.51712 64.40448 64.51712s64.40448-28.88704 64.40448-64.51712c0-23.05024-12.27264-44.34944-32.2048-55.87456C523.10528 445.17888 498.55488 445.17888 478.62784 456.704z">
    </path>
    <path
        d="M285.60896 456.704c-19.92704 11.52512-32.2048 32.82432-32.2048 55.87456s12.27264 44.34944 32.2048 55.86944c19.92704 11.52512 44.47744 11.52512 64.40448 0 19.92704-11.52 32.19968-32.8192 32.19968-55.86944s-12.27264-44.34944-32.19968-55.87456C330.0864 445.17888 305.53088 445.17888 285.60896 456.704z">
    </path>
    </symbol>`}};function Sn(n){return n?n.includes(".")?`<img class="" src="/emojis/${n}">`:String.fromCodePoint(parseInt(n,16)):null}function Xn(n){const e=n.match(/\w+="[^"]*"/g);if(!e)return{};const t={};return e.forEach(l=>{const[o,a]=l.split("=");t[o]=a.replace(/"/g,"")}),t}function Pt(n,e){let t="";return n&&(n==="d"?t="#iconFile":n==="h"?e==="h1"?t="#iconH1":e==="h2"?t="#iconH2":e==="h3"?t="#iconH3":e==="h4"?t="#iconH4":e==="h5"?t="#iconH5":e==="h6"&&(t="#iconH6"):n==="c"?t="#iconCode":n==="html"?t="#iconHTML5":n==="p"?t="#iconParagraph":n==="m"?t="#iconMath":n==="t"?t="#iconTable":n==="b"?t="#iconQuote":n==="l"?e==="o"?t="#iconOrderedList":e==="u"?t="#iconList":e==="t"&&(t="#iconCheck"):n==="i"?t="#iconListItem":n==="av"?t="#iconDatabase":n==="s"?t="#iconSuper":n==="audio"?t="#iconRecord":n==="query_embed"?t="#iconSQL":n==="tb"?t="#iconLine":n==="widget"&&(t="#iconBoth")),t}function qt(n,e,t){const l=n.slice();return l[7]=e[t],l}function Ot(n,e,t){const l=n.slice();return l[10]=e[t],l}function Qn(n){let e;return{c(){e=ge("📄")},m(t,l){Z(t,e,l)},p:Te,d(t){t&&J(e)}}}function Un(n){let e,t=n[7].icon+"",l;return{c(){e=new an(!1),l=cn(),e.a=l},m(o,a){e.m(t,o,a),Z(o,l,a)},p(o,a){a&1&&t!==(t=o[7].icon+"")&&e.p(t)},d(o){o&&J(l),o&&e.d()}}}function Rt(n){let e,t,l,o,a=n[10].block.name+"";return{c(){e=r("span"),t=q("svg"),l=q("use"),o=r("span"),fe(l,"xlink:href","#iconN"),i(t,"class","b3-list-item__hinticon"),i(o,"class","b3-list-item__hinttext"),i(e,"class","b3-list-item__meta fn__flex"),Me(e,"max-width","30%")},m(c,u){Z(c,e,u),s(e,t),s(t,l),s(e,o),o.innerHTML=a},p(c,u){u&1&&a!==(a=c[10].block.name+"")&&(o.innerHTML=a)},d(c){c&&J(e)}}}function zt(n){let e,t,l,o,a=n[10].block.alias+"";return{c(){e=r("span"),t=q("svg"),l=q("use"),o=r("span"),fe(l,"xlink:href","#iconA"),i(t,"class","b3-list-item__hinticon"),i(o,"class","b3-list-item__hinttext"),i(e,"class","b3-list-item__meta fn__flex"),Me(e,"max-width","30%")},m(c,u){Z(c,e,u),s(e,t),s(t,l),s(e,o),o.innerHTML=a},p(c,u){u&1&&a!==(a=c[10].block.alias+"")&&(o.innerHTML=a)},d(c){c&&J(e)}}}function jt(n){let e,t,l,o,a=n[10].block.memo+"";return{c(){e=r("span"),t=q("svg"),l=q("use"),o=r("span"),fe(l,"xlink:href","#iconM"),i(t,"class","b3-list-item__hinticon"),i(o,"class","b3-list-item__hinttext"),i(e,"class","b3-list-item__meta fn__flex"),Me(e,"max-width","30%")},m(c,u){Z(c,e,u),s(e,t),s(t,l),s(e,o),o.innerHTML=a},p(c,u){u&1&&a!==(a=c[10].block.memo+"")&&(o.innerHTML=a)},d(c){c&&J(e)}}}function $t(n,e){let t,l,o,a,c,u,p=e[10].block.content+"",h,_,k,b,g,m,D,O,S=e[10].block.name&&Rt(e),C=e[10].block.alias&&zt(e),x=e[10].block.memo&&jt(e);function $(){return e[6](e[10])}return{key:n,first:null,c(){t=r("div"),l=q("svg"),o=q("use"),c=f(),u=r("span"),h=f(),S&&S.c(),_=f(),C&&C.c(),k=f(),x&&x.c(),fe(o,"xlink:href",a=Pt(e[10].block.type,e[10].block.subtype)),i(l,"class","b3-list-item__graphic"),i(u,"class","b3-list-item__text"),Me(t,"padding-left","36px"),i(t,"data-type","search-item"),i(t,"class",b="b3-list-item "+(e[7].isCollapsed?"fn__none":"")+" "+(e[10].index===e[1]?"b3-list-item--focus":"")),i(t,"data-node-id",g=e[10].block.id),i(t,"data-root-id",m=e[10].block.root_id),this.first=t},m(N,E){Z(N,t,E),s(t,l),s(l,o),s(t,c),s(t,u),u.innerHTML=p,s(t,h),S&&S.m(t,null),s(t,_),C&&C.m(t,null),s(t,k),x&&x.m(t,null),D||(O=[A(t,"click",$),A(t,"keydown",Cn)],D=!0)},p(N,E){e=N,E&1&&a!==(a=Pt(e[10].block.type,e[10].block.subtype))&&fe(o,"xlink:href",a),E&1&&p!==(p=e[10].block.content+"")&&(u.innerHTML=p),e[10].block.name?S?S.p(e,E):(S=Rt(e),S.c(),S.m(t,_)):S&&(S.d(1),S=null),e[10].block.alias?C?C.p(e,E):(C=zt(e),C.c(),C.m(t,k)):C&&(C.d(1),C=null),e[10].block.memo?x?x.p(e,E):(x=jt(e),x.c(),x.m(t,null)):x&&(x.d(1),x=null),E&3&&b!==(b="b3-list-item "+(e[7].isCollapsed?"fn__none":"")+" "+(e[10].index===e[1]?"b3-list-item--focus":""))&&i(t,"class",b),E&1&&g!==(g=e[10].block.id)&&i(t,"data-node-id",g),E&1&&m!==(m=e[10].block.root_id)&&i(t,"data-root-id",m)},d(N){N&&J(t),S&&S.d(),C&&C.d(),x&&x.d(),D=!1,Oe(O)}}}function Gt(n){let e,t,l,o,a,c,u,p,h,_,k=n[7].block.content+"",b,g,m,D=n[7].subItems.length+"",O,S,C,x,$,N,E=[],w=new Map,R,te,X;function Ae(G,z){return G[7].icon?Un:Qn}let me=Ae(n),oe=me(n);function be(){return n[5](n[7])}let Ne=n[7].subItems;const Ee=G=>G[10].block.id;for(let G=0;G<Ne.length;G+=1){let z=Ot(n,Ne,G),ke=Ee(z);w.set(ke,E[G]=$t(ke,z))}return{c(){e=r("div"),t=r("span"),l=q("svg"),o=q("use"),u=f(),p=r("span"),oe.c(),h=f(),_=r("span"),g=f(),m=r("div"),O=ge(D),$=f(),N=r("div");for(let G=0;G<E.length;G+=1)E[G].c();R=f(),fe(o,"xlink:href","#iconRight"),i(l,"class",a="b3-list-item__arrow "+(n[7].isCollapsed?"":"b3-list-item__arrow--open")+" "+(n[7].subItems&&n[7].subItems.length>0?"":"disabled")+" svelte-1omi3im"),i(t,"class",c="b3-list-item__toggle b3-list-item__toggle--hl "+(n[7].subItems&&n[7].subItems.length>0?"":"disabled")+" svelte-1omi3im"),i(p,"class","b3-list-item__graphic"),i(_,"class","b3-list-item__text ariaLabel"),Me(_,"color","var(--b3-theme-on-surface)"),i(_,"aria-label",b=n[7].path),i(m,"class","protyle-attr--refcount"),Me(m,"right","0px"),Me(m,"top","6px"),i(e,"class",S="b3-list-item "+(n[7].index===n[1]?"b3-list-item--focus":"")),i(e,"data-node-id",C=n[7].block.id),i(e,"data-root-id",x=n[7].block.root_id)},m(G,z){Z(G,e,z),s(e,t),s(t,l),s(l,o),s(e,u),s(e,p),oe.m(p,null),s(e,h),s(e,_),_.innerHTML=k,s(e,g),s(e,m),s(m,O),Z(G,$,z),Z(G,N,z);for(let ke=0;ke<E.length;ke+=1)E[ke]&&E[ke].m(N,null);s(N,R),te||(X=[A(e,"click",Mt(be)),A(e,"keydown",Cn)],te=!0)},p(G,z){n=G,z&1&&a!==(a="b3-list-item__arrow "+(n[7].isCollapsed?"":"b3-list-item__arrow--open")+" "+(n[7].subItems&&n[7].subItems.length>0?"":"disabled")+" svelte-1omi3im")&&i(l,"class",a),z&1&&c!==(c="b3-list-item__toggle b3-list-item__toggle--hl "+(n[7].subItems&&n[7].subItems.length>0?"":"disabled")+" svelte-1omi3im")&&i(t,"class",c),me===(me=Ae(n))&&oe?oe.p(n,z):(oe.d(1),oe=me(n),oe&&(oe.c(),oe.m(p,null))),z&1&&k!==(k=n[7].block.content+"")&&(_.innerHTML=k),z&1&&b!==(b=n[7].path)&&i(_,"aria-label",b),z&1&&D!==(D=n[7].subItems.length+"")&&mt(O,D),z&3&&S!==(S="b3-list-item "+(n[7].index===n[1]?"b3-list-item--focus":""))&&i(e,"class",S),z&1&&C!==(C=n[7].block.id)&&i(e,"data-node-id",C),z&1&&x!==(x=n[7].block.root_id)&&i(e,"data-root-id",x),z&7&&(Ne=n[7].subItems,E=hn(E,z,Ee,1,n,Ne,w,N,dn,$t,R,Ot))},d(G){G&&J(e),oe.d(),G&&J($),G&&J(N);for(let z=0;z<E.length;z+=1)E[z].d();te=!1,Oe(X)}}}function Yn(n){let e,t=n[0],l=[];for(let o=0;o<t.length;o+=1)l[o]=Gt(qt(n,t,o));return{c(){e=r("div");for(let o=0;o<l.length;o+=1)l[o].c();i(e,"id","documentSearchList"),i(e,"class","fn__flex-1 search__list b3-list b3-list--background")},m(o,a){Z(o,e,a);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null)},p(o,[a]){if(a&15){t=o[0];let c;for(c=0;c<t.length;c+=1){const u=qt(o,t,c);l[c]?l[c].p(u,a):(l[c]=Gt(u),l[c].c(),l[c].m(e,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=t.length}},i:Te,o:Te,d(o){o&&J(e),St(l,o)}}}function Cn(n){console.log(n.key)}function Jn(n,e,t){let{searchResults:l}=e,{clickCallback:o}=e,{selectedIndex:a=0}=e;function c(_){o&&o(_)}function u(_){if(!(!_||!_.id)){for(const k of l)if(!(!k||!k.block)&&k.block.id===_.id){k.subItems&&k.subItems.length>0?(k.isCollapsed=!k.isCollapsed,t(0,l)):Y.showMessage(`${k.block.content} 下不存在符合条件的内容`,5e3,"error");break}}}const p=_=>u(_.block),h=_=>c(_);return n.$$set=_=>{"searchResults"in _&&t(0,l=_.searchResults),"clickCallback"in _&&t(4,o=_.clickCallback),"selectedIndex"in _&&t(1,a=_.selectedIndex)},[l,a,c,u,o,p,h]}class Zn extends dt{constructor(e){super(),ft(this,e,Jn,Yn,ut,{searchResults:0,clickCallback:4,selectedIndex:1})}}class el{static get(e,...t){return e.__Instance__==null&&(e.__Instance__=new e(...t)),e.__Instance__}}const It="search-setting.json";class L{constructor(){ae(this,"defaultSettings",{defaultConentFields:["content","tag"]});ae(this,"settings",{pageSize:10,includeTypes:["d","h","c","m","t","p","html","av"],includeAttrFields:["name","alias","memo"],excludeNotebookIds:[],maxExpandCount:100,showChildDocument:!0,documentSortMethod:"rankDesc",contentBlockSortMethod:"type",doubleClickTimeout:190,refreshPreviewHighlightTimeout:200});ae(this,"plugin")}static get ins(){return el.get(L)}async load(e){if(e&&(this.plugin=e),!this.plugin){console.info("插件为空，无法加载数据。");return}let t=await this.plugin.loadData(It);if(t==null||t==null||t=="")console.info("没有配置文件，使用默认配置"),this.save();else{console.info(`读入配置文件: ${It}`),typeof t=="string"&&(t=JSON.parse(t));try{for(let l in t)this.set(l,t[l])}catch(l){console.log(`Setting load error: ${l}`)}this.save()}}async save(){if(!this.plugin)return;let e=JSON.stringify(this.settings);console.log(`写入配置文件: ${e}`),this.plugin.saveData(It,e)}set(e,t){if(!(e in this.settings)){console.error(`"${e}" is not a setting`);return}this.settings[e]=t}get pageSize(){return this.settings.pageSize}get includeTypes(){return this.settings.includeTypes}get includeAttrFields(){return this.settings.includeAttrFields}get includeQueryFields(){return[...this.defaultSettings.defaultConentFields,...this.settings.includeAttrFields]}get excludeNotebookIds(){return this.settings.excludeNotebookIds}get maxExpandCount(){return this.settings.maxExpandCount}get showChildDocument(){return this.settings.showChildDocument}get documentSortMethod(){return this.settings.documentSortMethod}get contentBlockSortMethod(){return this.settings.contentBlockSortMethod}get doubleClickTimeout(){return this.settings.doubleClickTimeout}get refreshPreviewHighlightTimeout(){return this.settings.refreshPreviewHighlightTimeout}updatePageSize(e){this.settings.pageSize=e,this.save()}updateIncludeTypes(e){this.settings.includeTypes=e,this.save()}updateIncludeAttrFields(e){this.settings.includeAttrFields=e,this.save()}updateExcludeNotebookIds(e){this.settings.excludeNotebookIds=e,this.save()}updateMaxExpandCount(e){this.settings.maxExpandCount=e,this.save()}updateShowChildDocument(e){this.settings.showChildDocument=e,this.save()}updateDocumentSortMethod(e){this.settings.documentSortMethod=e,this.save()}updateContentBlockSortMethod(e){this.settings.contentBlockSortMethod=e,this.save()}updateDoubleClickTimeout(e){this.settings.doubleClickTimeout=e,this.save()}updateRefreshPreviewHighlightTimeout(e){this.settings.refreshPreviewHighlightTimeout=e,this.save()}}function Kt(n,e,t){const l=n.slice();return l[3]=e[t],l}function Vt(n){let e,t,l,o,a,c,u,p=n[3].text+"",h,_,k,b,g,m,D,O,S;return{c(){e=r("label"),t=q("svg"),l=q("use"),o=f(),a=r("span"),c=f(),u=r("div"),h=ge(p),_=f(),k=r("span"),b=f(),g=r("input"),D=f(),fe(l,"xlink:href",n[3].icon),i(t,"class","ft__on-surface svg fn__flex-center"),i(a,"class","fn__space"),i(u,"class","fn__flex-1 fn__flex-center"),i(k,"class","fn__space"),i(g,"class","b3-switch fn__flex-center"),i(g,"data-type",n[3].dataType),i(g,"type","checkbox"),g.value=n[3].value,g.checked=m=n[0].includes(n[3].value),i(e,"class","fn__flex b3-label")},m(C,x){Z(C,e,x),s(e,t),s(t,l),s(e,o),s(e,a),s(e,c),s(e,u),s(u,h),s(e,_),s(e,k),s(e,b),s(e,g),s(e,D),O||(S=A(g,"change",n[2]),O=!0)},p(C,x){x&1&&m!==(m=C[0].includes(C[3].value))&&(g.checked=m)},d(C){C&&J(e),O=!1,S()}}}function tl(n){let e,t=n[1],l=[];for(let o=0;o<t.length;o+=1)l[o]=Vt(Kt(n,t,o));return{c(){e=r("div");for(let o=0;o<l.length;o+=1)l[o].c();i(e,"id","document-search-setting-type")},m(o,a){Z(o,e,a);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null)},p(o,[a]){if(a&7){t=o[1];let c;for(c=0;c<t.length;c+=1){const u=Kt(o,t,c);l[c]?l[c].p(u,a):(l[c]=Vt(u),l[c].c(),l[c].m(e,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=t.length}},i:Te,o:Te,d(o){o&&J(e),St(l,o)}}}function nl(n,e,t){let l=L.ins.includeTypes,o=[{icon:"#iconMath",text:"公式块",dataType:"mathBlock",value:"m"},{icon:"#iconTable",text:"表格",dataType:"table",value:"t"},{icon:"#iconQuote",text:"引述",dataType:"blockquote",value:"b"},{icon:"#iconSuper",text:"超级块",dataType:"superBlock",value:"s"},{icon:"#iconParagraph",text:"段落",dataType:"paragraph",value:"p"},{icon:"#iconFile",text:"文档",dataType:"document",value:"d"},{icon:"#iconHeadings",text:"标题",dataType:"heading",value:"h"},{icon:"#iconList",text:"列表",dataType:"checkbox",value:"l"},{icon:"#iconListItem",text:"列表项",dataType:"listItem",value:"i"},{icon:"#iconCode",text:"代码块",dataType:"codeBlock",value:"c"},{icon:"#iconHTML5",text:"HTML",dataType:"htmlBlock",value:"html"},{icon:"#iconSQL",text:"嵌入块",dataType:"embedBlock",value:"query_embed"},{icon:"#iconDatabase",text:"数据库",dataType:"databaseBlock",value:"av"}];function a(c){const u=c.target.value;let p=[];c.target.checked?p=[...l,u]:p=l.filter(h=>h!==u),L.ins.updateIncludeTypes(p),t(0,l=L.ins.includeTypes)}return[l,o,a]}class ll extends dt{constructor(e){super(),ft(this,e,nl,tl,ut,{})}}const{Map:sl}=Mn;function Wt(n,e,t){const l=n.slice();return l[4]=e[t][0],l[5]=e[t][1],l}function il(n){let e;return{c(){e=ge("🗃")},m(t,l){Z(t,e,l)},p:Te,d(t){t&&J(e)}}}function ol(n){let e,t=n[5].icon+"",l;return{c(){e=new an(!1),l=cn(),e.a=l},m(o,a){e.m(t,o,a),Z(o,l,a)},p(o,a){a&2&&t!==(t=o[5].icon+"")&&e.p(t)},d(o){o&&J(l),o&&e.d()}}}function Xt(n,e){let t,l,o,a,c,u,p=e[5].name+"",h,_,k,b,g,m,D,O,S,C;function x(E,w){return E[5].icon?ol:il}let $=x(e),N=$(e);return{key:n,first:null,c(){t=r("label"),l=r("span"),N.c(),o=f(),a=r("span"),c=f(),u=r("div"),h=ge(p),_=f(),k=r("span"),b=f(),g=r("input"),O=f(),i(l,"class","b3-list-item__graphic"),i(a,"class","fn__space"),i(u,"class","fn__flex-1 fn__flex-center"),i(k,"class","fn__space"),i(g,"class","b3-switch fn__flex-center"),i(g,"type","checkbox"),g.value=m=e[5].id,g.checked=D=!e[0].includes(e[5].id),i(t,"class","fn__flex b3-label"),this.first=t},m(E,w){Z(E,t,w),s(t,l),N.m(l,null),s(t,o),s(t,a),s(t,c),s(t,u),s(u,h),s(t,_),s(t,k),s(t,b),s(t,g),s(t,O),S||(C=A(g,"change",e[2]),S=!0)},p(E,w){e=E,$===($=x(e))&&N?N.p(e,w):(N.d(1),N=$(e),N&&(N.c(),N.m(l,null))),w&2&&p!==(p=e[5].name+"")&&mt(h,p),w&2&&m!==(m=e[5].id)&&(g.value=m),w&3&&D!==(D=!e[0].includes(e[5].id))&&(g.checked=D)},d(E){E&&J(t),N.d(),S=!1,C()}}}function cl(n){let e,t=[],l=new sl,o=Array.from(n[1].entries());const a=c=>c[4];for(let c=0;c<o.length;c+=1){let u=Wt(n,o,c),p=a(u);l.set(p,t[c]=Xt(p,u))}return{c(){e=r("div");for(let c=0;c<t.length;c+=1)t[c].c();i(e,"id","document-search-setting-notebook")},m(c,u){Z(c,e,u);for(let p=0;p<t.length;p+=1)t[p]&&t[p].m(e,null)},p(c,[u]){u&7&&(o=Array.from(c[1].entries()),t=hn(t,u,a,1,c,o,l,e,dn,Xt,null,Wt))},i:Te,o:Te,d(c){c&&J(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function al(n,e,t){let l=L.ins.excludeNotebookIds,o=new Map;un(async()=>{a()});async function a(){let u=(await gn()).notebooks;for(const h of u)h.icon=Sn(h.icon),o.set(h.id,h);t(1,o);let p=l.filter(h=>o.has(h));p.length!=l.length&&L.ins.updateExcludeNotebookIds(p),t(0,l=L.ins.excludeNotebookIds)}function c(u){const p=u.target.value;let h=[];u.target.checked?h=l.filter(_=>_!==p):h=[...l,p],console.log(`tempExcludeNotebookIds ${h}`),L.ins.updateExcludeNotebookIds(h),t(0,l=L.ins.excludeNotebookIds)}return[l,o,c]}class rl extends dt{constructor(e){super(),ft(this,e,al,cl,ut,{})}}function Qt(n,e,t){const l=n.slice();return l[3]=e[t],l}function Ut(n){let e,t,l,o,a,c,u,p=n[3].text+"",h,_,k,b,g,m,D,O,S;return{c(){e=r("label"),t=q("svg"),l=q("use"),o=f(),a=r("span"),c=f(),u=r("div"),h=ge(p),_=f(),k=r("span"),b=f(),g=r("input"),D=f(),fe(l,"xlink:href",n[3].icon),i(t,"class","ft__on-surface svg fn__flex-center"),i(a,"class","fn__space"),i(u,"class","fn__flex-1 fn__flex-center"),i(k,"class","fn__space"),i(g,"class","b3-switch fn__flex-center"),i(g,"type","checkbox"),g.value=n[3].value,g.checked=m=n[0].includes(n[3].value),i(e,"class","fn__flex b3-label")},m(C,x){Z(C,e,x),s(e,t),s(t,l),s(e,o),s(e,a),s(e,c),s(e,u),s(u,h),s(e,_),s(e,k),s(e,b),s(e,g),s(e,D),O||(S=A(g,"change",n[2]),O=!0)},p(C,x){x&1&&m!==(m=C[0].includes(C[3].value))&&(g.checked=m)},d(C){C&&J(e),O=!1,S()}}}function ul(n){let e,t=n[1],l=[];for(let o=0;o<t.length;o+=1)l[o]=Ut(Qt(n,t,o));return{c(){e=r("div");for(let o=0;o<l.length;o+=1)l[o].c();i(e,"id","document-search-setting-attr")},m(o,a){Z(o,e,a);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null)},p(o,[a]){if(a&7){t=o[1];let c;for(c=0;c<t.length;c+=1){const u=Qt(o,t,c);l[c]?l[c].p(u,a):(l[c]=Ut(u),l[c].c(),l[c].m(e,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=t.length}},i:Te,o:Te,d(o){o&&J(e),St(l,o)}}}function fl(n,e,t){let l=L.ins.includeAttrFields,o=[{icon:"#iconN",text:"命名",value:"name"},{icon:"#iconA",text:"别名",value:"alias"},{icon:"#iconM",text:"备注",value:"memo"},{icon:"#iconAttr",text:"所有属性名和属性值",value:"ial"}];function a(c){const u=c.target.value;let p=[];c.target.checked?p=[...l,u]:p=l.filter(h=>h!==u),L.ins.updateIncludeAttrFields(p),t(0,l=L.ins.includeAttrFields)}return[l,o,a]}class dl extends dt{constructor(e){super(),ft(this,e,fl,ul,ut,{})}}function Yt(n,e,t){const l=n.slice();return l[20]=e[t],l}function Jt(n,e,t){const l=n.slice();return l[20]=e[t],l}function Zt(n){let e,t=n[20].text+"",l,o,a;return{c(){e=r("option"),l=ge(t),o=f(),e.__value=n[20].value,e.value=e.__value,e.selected=a=n[20].value==n[0]},m(c,u){Z(c,e,u),s(e,l),s(e,o)},p(c,u){u&1&&a!==(a=c[20].value==c[0])&&(e.selected=a)},d(c){c&&J(e)}}}function en(n){let e,t=n[20].text+"",l,o,a;return{c(){e=r("option"),l=ge(t),o=f(),e.__value=n[20].value,e.value=e.__value,e.selected=a=n[20].value==n[1]},m(c,u){Z(c,e,u),s(e,l),s(e,o)},p(c,u){u&2&&a!==(a=c[20].value==c[1])&&(e.selected=a)},d(c){c&&J(e)}}}function hl(n){let e,t,l,o,a,c,u,p,h,_,k,b,g,m,D,O,S,C,x,$,N,E,w,R,te,X,Ae,me,oe,be,Ne,Ee,G,z,ke,ee,Xe,le,Le,ve,Qe,Re,Ue,de,Ye,ze,Je,Se,Ze,ce,Ie,se,je,he,d,v,T,F,j,V,y,I,M,B,Q,_e,U,xe,Ve,ne,De,ie,$e,Ce,ht,re,Ge,et,Ke,He,_t,Pe,pe,tt,pt,W,K,ue,lt=n[7],we=[];for(let H=0;H<lt.length;H+=1)we[H]=Zt(Jt(n,lt,H));let st=n[8],ye=[];for(let H=0;H<st.length;H+=1)ye[H]=en(Yt(n,st,H));return{c(){e=r("div"),t=r("label"),l=q("svg"),o=q("use"),a=f(),c=r("span"),u=f(),p=r("div"),p.textContent="文档排序方式",h=f(),_=r("span"),k=f(),b=r("select");for(let H=0;H<we.length;H+=1)we[H].c();g=f(),m=r("label"),D=q("svg"),O=q("use"),S=f(),C=r("span"),x=f(),$=r("div"),$.textContent="内容块排序方式",N=f(),E=r("span"),w=f(),R=r("select");for(let H=0;H<ye.length;H+=1)ye[H].c();te=f(),X=r("label"),Ae=q("svg"),me=q("use"),oe=f(),be=r("span"),Ne=f(),Ee=r("div"),Ee.textContent="每页文档数量",G=f(),z=r("span"),ke=f(),ee=r("input"),Xe=f(),le=r("label"),Le=q("svg"),ve=q("use"),Qe=f(),Re=r("span"),Ue=f(),de=r("div"),de.textContent="默认展开数",Ye=f(),ze=r("div"),Je=f(),Se=r("span"),Ze=f(),ce=r("input"),Ie=f(),se=r("label"),je=q("svg"),he=q("use"),d=f(),v=r("span"),T=f(),F=r("div"),F.textContent="显示文档块",j=f(),V=r("span"),y=f(),I=r("input"),M=f(),B=r("label"),Q=q("svg"),_e=q("use"),U=f(),xe=r("span"),Ve=f(),ne=r("div"),ne.textContent="双击时间阈值(毫秒)",De=f(),ie=r("span"),$e=f(),Ce=r("input"),ht=f(),re=r("label"),Ge=q("svg"),et=q("use"),Ke=f(),He=r("span"),_t=f(),Pe=r("div"),Pe.textContent="刷新预览区高亮延迟(毫秒)",pe=f(),tt=r("span"),pt=f(),W=r("input"),fe(o,"xlink:href","#iconSort"),i(l,"class","ft__on-surface svg fn__flex-center"),i(c,"class","fn__space"),i(p,"class","fn__flex-1 fn__flex-center"),i(_,"class","fn__space"),i(b,"class","b3-select fn__flex-center fn__size200"),i(t,"class","fn__flex b3-label config__item"),fe(O,"xlink:href","#iconSort"),i(D,"class","ft__on-surface svg fn__flex-center"),i(C,"class","fn__space"),i($,"class","fn__flex-1 fn__flex-center"),i(E,"class","fn__space"),i(R,"class","b3-select fn__flex-center fn__size200"),i(m,"class","fn__flex b3-label config__item"),fe(me,"xlink:href","#iconFile"),i(Ae,"class","ft__on-surface svg fn__flex-center"),i(be,"class","fn__space"),i(Ee,"class","fn__flex-1 fn__flex-center"),i(z,"class","fn__space"),i(ee,"class","b3-text-field fn__flex-center fn__size200"),i(ee,"type","number"),i(ee,"min","0"),i(X,"class","fn__flex b3-label config__item"),fe(ve,"xlink:href","#iconExpand"),i(Le,"class","ft__on-surface svg fn__flex-center"),i(Re,"class","fn__space"),i(de,"class","fn__flex-1 fn__flex-center ariaLabel"),i(de,"aria-label","如果查询结果的块数量小于当前值，默认展开全部文档；反之会默认折叠全部文档。"),i(ze,"class","b3-label__text"),i(Se,"class","fn__space"),i(ce,"class","b3-text-field fn__flex-center fn__size200"),i(ce,"type","number"),i(ce,"min","0"),i(le,"class","fn__flex b3-label config__item"),fe(he,"xlink:href","#iconFile"),i(je,"class","ft__on-surface svg fn__flex-center"),i(v,"class","fn__space"),i(F,"class","fn__flex-1 fn__flex-center"),i(V,"class","fn__space"),i(I,"class","b3-switch fn__flex-center"),i(I,"type","checkbox"),I.checked=n[4],i(se,"class","fn__flex b3-label config__item"),fe(_e,"xlink:href","#iconClock"),i(Q,"class","ft__on-surface svg fn__flex-center"),i(xe,"class","fn__space"),i(ne,"class","fn__flex-1 fn__flex-center"),i(ie,"class","fn__space"),i(Ce,"class","b3-text-field fn__flex-center fn__size200"),i(Ce,"type","number"),i(Ce,"min","0"),i(B,"class","fn__flex b3-label config__item"),fe(et,"xlink:href","#iconClock"),i(Ge,"class","ft__on-surface svg fn__flex-center"),i(He,"class","fn__space"),i(Pe,"class","fn__flex-1 fn__flex-center ariaLabel"),i(Pe,"aria-label","用于代码块、数据库这种需要时间渲染的块高亮，太短可能会失败，不需要可以设置为0"),i(tt,"class","fn__space"),i(W,"class","b3-text-field fn__flex-center fn__size200"),i(W,"type","number"),i(W,"min","0"),i(re,"class","fn__flex b3-label config__item"),i(e,"id","document-search-setting-other")},m(H,Fe){Z(H,e,Fe),s(e,t),s(t,l),s(l,o),s(t,a),s(t,c),s(t,u),s(t,p),s(t,h),s(t,_),s(t,k),s(t,b);for(let P=0;P<we.length;P+=1)we[P]&&we[P].m(b,null);s(e,g),s(e,m),s(m,D),s(D,O),s(m,S),s(m,C),s(m,x),s(m,$),s(m,N),s(m,E),s(m,w),s(m,R);for(let P=0;P<ye.length;P+=1)ye[P]&&ye[P].m(R,null);s(e,te),s(e,X),s(X,Ae),s(Ae,me),s(X,oe),s(X,be),s(X,Ne),s(X,Ee),s(X,G),s(X,z),s(X,ke),s(X,ee),qe(ee,n[2]),s(e,Xe),s(e,le),s(le,Le),s(Le,ve),s(le,Qe),s(le,Re),s(le,Ue),s(le,de),s(le,Ye),s(le,ze),s(le,Je),s(le,Se),s(le,Ze),s(le,ce),qe(ce,n[3]),s(e,Ie),s(e,se),s(se,je),s(je,he),s(se,d),s(se,v),s(se,T),s(se,F),s(se,j),s(se,V),s(se,y),s(se,I),s(e,M),s(e,B),s(B,Q),s(Q,_e),s(B,U),s(B,xe),s(B,Ve),s(B,ne),s(B,De),s(B,ie),s(B,$e),s(B,Ce),qe(Ce,n[5]),s(e,ht),s(e,re),s(re,Ge),s(Ge,et),s(re,Ke),s(re,He),s(re,_t),s(re,Pe),s(re,pe),s(re,tt),s(re,pt),s(re,W),qe(W,n[6]),K||(ue=[A(b,"change",n[9]),A(R,"change",n[10]),A(ee,"input",n[16]),A(ee,"change",n[11]),A(ce,"input",n[17]),A(ce,"change",n[12]),A(I,"change",n[13]),A(Ce,"input",n[18]),A(Ce,"change",n[14]),A(W,"input",n[19]),A(W,"change",n[15])],K=!0)},p(H,[Fe]){if(Fe&129){lt=H[7];let P;for(P=0;P<lt.length;P+=1){const gt=Jt(H,lt,P);we[P]?we[P].p(gt,Fe):(we[P]=Zt(gt),we[P].c(),we[P].m(b,null))}for(;P<we.length;P+=1)we[P].d(1);we.length=lt.length}if(Fe&258){st=H[8];let P;for(P=0;P<st.length;P+=1){const gt=Yt(H,st,P);ye[P]?ye[P].p(gt,Fe):(ye[P]=en(gt),ye[P].c(),ye[P].m(R,null))}for(;P<ye.length;P+=1)ye[P].d(1);ye.length=st.length}Fe&4&&We(ee.value)!==H[2]&&qe(ee,H[2]),Fe&8&&We(ce.value)!==H[3]&&qe(ce,H[3]),Fe&16&&(I.checked=H[4]),Fe&32&&We(Ce.value)!==H[5]&&qe(Ce,H[5]),Fe&64&&We(W.value)!==H[6]&&qe(W,H[6])},i:Te,o:Te,d(H){H&&J(e),St(we,H),St(ye,H),K=!1,Oe(ue)}}}function _l(n,e,t){let l=L.ins.documentSortMethod,o=L.ins.contentBlockSortMethod,a=L.ins.pageSize,c=L.ins.maxExpandCount,u=L.ins.showChildDocument,p=L.ins.doubleClickTimeout,h=L.ins.refreshPreviewHighlightTimeout,_=[{text:"相关度升序",value:"rankAsc"},{text:"相关度降序",value:"rankDesc"},{text:"修改时间升序",value:"modifiedAsc"},{text:"修改时间降序",value:"modifiedDesc"},{text:"创建时间升序",value:"createdAsc"},{text:"创建时间降序",value:"createdDesc"}],k=[{text:"类型",value:"type"},..._];function b(w){t(0,l=w.target.value),L.ins.updateDocumentSortMethod(l)}function g(w){t(1,o=w.target.value),L.ins.updateContentBlockSortMethod(o)}function m(w){t(2,a=w.target.value),L.ins.updatePageSize(a)}function D(w){t(3,c=w.target.value),L.ins.updateMaxExpandCount(c)}function O(w){let R=u;w.target.checked?R=!0:R=!1,L.ins.updateShowChildDocument(R),t(4,u=L.ins.showChildDocument)}function S(w){t(5,p=w.target.value),L.ins.updateDoubleClickTimeout(p)}function C(w){t(6,h=w.target.value),L.ins.updateRefreshPreviewHighlightTimeout(h)}function x(){a=We(this.value),t(2,a)}function $(){c=We(this.value),t(3,c)}function N(){p=We(this.value),t(5,p)}function E(){h=We(this.value),t(6,h)}return[l,o,a,c,u,p,h,_,k,b,g,m,D,O,S,C,x,$,N,E]}class pl extends dt{constructor(e){super(),ft(this,e,_l,hl,ut,{})}}function tn(n){let e,t;return e=new Zn({props:{searchResults:n[5],selectedIndex:n[6],clickCallback:n[17]}}),{c(){Pn(e.$$.fragment)},m(l,o){_n(e,l,o),t=!0},p(l,o){const a={};o[0]&32&&(a.searchResults=l[5]),o[0]&64&&(a.selectedIndex=l[6]),e.$set(a)},i(l){t||(rt(e.$$.fragment,l),t=!0)},o(l){At(e.$$.fragment,l),t=!1},d(l){pn(e,l)}}}function gl(n){let e,t,l,o,a,c,u,p,h,_,k,b,g,m,D,O,S,C,x,$,N,E,w,R,te,X,Ae,me,oe,be,Ne,Ee,G,z,ke,ee,Xe,le,Le,ve,Qe,Re,Ue,de,Ye,ze,Je,Se,Ze,ce,Ie,se,je,he,d,v,T,F,j,V,y,I,M,B,Q,_e,U,xe,Ve,ne,De,ie,$e,Ce,ht,re,Ge,et,Ke,He,_t,Pe,pe,tt,pt,W=!n[8]&&tn(n);return{c(){e=r("div"),t=r("div"),l=r("span"),o=q("svg"),a=q("use"),u=f(),p=r("span"),h=f(),_=r("span"),k=q("svg"),b=q("use"),m=f(),D=r("span"),O=f(),S=r("span"),C=ge(n[10]),x=ge("/"),$=ge(n[11]),N=f(),E=r("span"),w=f(),R=r("span"),te=ge("匹配到 "),X=ge(n[9]),Ae=ge(" 个文档"),oe=f(),be=r("span"),Ne=f(),Ee=r("span"),G=f(),z=r("span"),ke=f(),ee=r("span"),ee.innerHTML='<svg class="svelte-i2bg01"><use xlink:href="#iconSearchSettingExcludeNotebook" class="svelte-i2bg01"></use></svg>',Xe=f(),le=r("span"),Le=f(),ve=r("span"),ve.innerHTML='<svg class="svelte-i2bg01"><use xlink:href="#iconFilter" class="svelte-i2bg01"></use></svg>',Qe=f(),Re=r("span"),Ue=f(),de=r("span"),de.innerHTML='<svg class="svelte-i2bg01"><use xlink:href="#iconA" class="svelte-i2bg01"></use></svg>',Ye=f(),ze=r("span"),Je=f(),Se=r("span"),Se.innerHTML='<svg class="svelte-i2bg01"><use xlink:href="#iconSearchSettingOther" class="svelte-i2bg01"></use></svg>',Ze=f(),ce=r("div"),Ie=r("div"),se=r("span"),se.innerHTML=`<svg data-menu="true" class="b3-form__icon-icon svelte-i2bg01"><use xlink:href="#iconSearch" class="svelte-i2bg01"></use></svg> 
                <svg class="search__arrowdown svelte-i2bg01"><use xlink:href="#iconDown" class="svelte-i2bg01"></use></svg>`,je=f(),he=r("input"),d=f(),v=q("svg"),T=q("use"),j=f(),V=r("div"),y=r("span"),y.innerHTML='<svg class="svelte-i2bg01"><use xlink:href="#iconRefresh" class="svelte-i2bg01"></use></svg>',I=f(),M=r("div"),B=r("span"),Q=f(),_e=r("span"),_e.innerHTML='<svg class="svelte-i2bg01"><use xlink:href="#iconExpand" class="svelte-i2bg01"></use></svg>',U=f(),xe=r("span"),Ve=f(),ne=r("span"),ne.innerHTML='<svg class="svelte-i2bg01"><use xlink:href="#iconContract" class="svelte-i2bg01"></use></svg>',De=f(),ie=r("div"),W&&W.c(),$e=f(),Ce=r("div"),ht=f(),re=r("div"),et=f(),Ke=r("div"),He=r("img"),fe(a,"xlink:href","#iconLeft"),i(a,"class","svelte-i2bg01"),i(o,"class","svelte-i2bg01"),i(l,"data-position","9bottom"),i(l,"data-type","previous"),i(l,"class",c="block__icon block__icon--show ariaLabel "+(n[10]<=1?"disabled":"")+" svelte-i2bg01"),i(l,"aria-label","上一页"),i(p,"class","fn__space svelte-i2bg01"),fe(b,"xlink:href","#iconRight"),i(b,"class","svelte-i2bg01"),i(k,"class","svelte-i2bg01"),i(_,"data-position","9bottom"),i(_,"data-type","next"),i(_,"class",g="block__icon block__icon--show ariaLabel "+(n[10]>=n[11]?"disabled":"")+" svelte-i2bg01"),i(_,"aria-label","下一页"),i(D,"class","fn__space svelte-i2bg01"),i(E,"class","fn__space svelte-i2bg01"),i(R,"class","ft__on-surface svelte-i2bg01"),i(S,"class",me="fn__flex-shrink ft__selectnone "+(n[9]==null||n[9]==0?"fn__none":"")+" svelte-i2bg01"),i(be,"class","fn__space svelte-i2bg01"),i(Ee,"class","fn__flex-1 svelte-i2bg01"),Me(Ee,"min-height","100%"),i(z,"class","fn__space svelte-i2bg01"),i(ee,"id","documentSearchNotebookFilter"),i(ee,"aria-label","笔记本过滤"),i(ee,"class","block__icon block__icon--show ariaLabel svelte-i2bg01"),i(ee,"data-position","9bottom"),i(le,"class","fn__space svelte-i2bg01"),i(ve,"id","documentSearchTypeFilter"),i(ve,"aria-label","类型"),i(ve,"class","block__icon block__icon--show ariaLabel svelte-i2bg01"),i(ve,"data-position","9bottom"),i(Re,"class","fn__space svelte-i2bg01"),i(de,"id","documentSearchAttrFilter"),i(de,"aria-label","属性"),i(de,"class","block__icon block__icon--show ariaLabel svelte-i2bg01"),i(de,"data-position","9bottom"),i(ze,"class","fn__space svelte-i2bg01"),i(Se,"id","documentSearchSettingOther"),i(Se,"aria-label","其他"),i(Se,"class","block__icon block__icon--show ariaLabel svelte-i2bg01"),i(Se,"data-position","9bottom"),i(t,"class","block__icons svelte-i2bg01"),Me(t,"overflow","auto"),i(se,"class","search__history-icon svelte-i2bg01"),i(se,"id","documentSearchHistoryBtn"),i(he,"id","documentSearchInput"),i(he,"class","b3-text-field b3-text-field--text svelte-i2bg01"),Me(he,"padding-right","32px",1),fe(T,"xlink:href","#iconCloseRound"),i(T,"class","svelte-i2bg01"),i(v,"class",F="b3-form__icon-clear ariaLabel "+(n[4]==""?"fn__none":"")+" svelte-i2bg01"),i(v,"aria-label","清空"),Me(v,"right","8px"),Me(v,"height","42px"),Me(Ie,"position","relative"),i(Ie,"class","fn__flex-1 svelte-i2bg01"),i(y,"id","documentSearchRefresh"),i(y,"aria-label","刷新"),i(y,"class","block__icon ariaLabel svelte-i2bg01"),i(y,"data-position","9bottom"),i(B,"class","fn__space svelte-i2bg01"),i(_e,"id","documentSearchExpand"),i(_e,"class","block__icon block__icon--show ariaLabel svelte-i2bg01"),i(_e,"data-position","9bottom"),i(_e,"aria-label","展开"),i(xe,"class","fn__space svelte-i2bg01"),i(ne,"id","documentSearchCollapse"),i(ne,"class","block__icon block__icon--show ariaLabel svelte-i2bg01"),i(ne,"data-position","9bottom"),i(ne,"aria-label","折叠"),i(M,"class","fn__flex svelte-i2bg01"),i(V,"class","block__icons svelte-i2bg01"),i(ce,"class","b3-form__icon search__header svelte-i2bg01"),i(Ce,"class","search__drag svelte-i2bg01"),i(re,"id","documentSearchPreview"),i(re,"class",Ge="search__preview "+(n[0]?"":"fn__none")+" svelte-i2bg01"),i(ie,"class","search__layout search__layout--row svelte-i2bg01"),i(e,"class","fn__flex-column svelte-i2bg01"),Me(e,"height","100%"),i(He,"width","120px"),En(He.src,_t="/stage/loading-pure.svg")||i(He,"src",_t),i(He,"class","svelte-i2bg01"),i(Ke,"class",Pe="fn__loading fn__loading--top "+(n[7]>0?"":"fn__none")+" svelte-i2bg01")},m(K,ue){Z(K,e,ue),s(e,t),s(t,l),s(l,o),s(o,a),s(t,u),s(t,p),s(t,h),s(t,_),s(_,k),s(k,b),s(t,m),s(t,D),s(t,O),s(t,S),s(S,C),s(S,x),s(S,$),s(S,N),s(S,E),s(S,w),s(S,R),s(R,te),s(R,X),s(R,Ae),s(t,oe),s(t,be),s(t,Ne),s(t,Ee),s(t,G),s(t,z),s(t,ke),s(t,ee),s(t,Xe),s(t,le),s(t,Le),s(t,ve),s(t,Qe),s(t,Re),s(t,Ue),s(t,de),s(t,Ye),s(t,ze),s(t,Je),s(t,Se),s(e,Ze),s(e,ce),s(ce,Ie),s(Ie,se),s(Ie,je),s(Ie,he),n[27](he),qe(he,n[4]),s(Ie,d),s(Ie,v),s(v,T),s(ce,j),s(ce,V),s(V,y),s(V,I),s(V,M),s(M,B),s(M,Q),s(M,_e),s(M,U),s(M,xe),s(M,Ve),s(M,ne),s(e,De),s(e,ie),W&&W.m(ie,null),s(ie,$e),s(ie,Ce),s(ie,ht),s(ie,re),n[33](re),n[34](e),Z(K,et,ue),Z(K,Ke,ue),s(Ke,He),pe=!0,tt||(pt=[A(l,"click",n[25]),A(l,"keydown",Be),A(_,"click",n[26]),A(_,"keydown",Be),A(ee,"click",n[19]),A(ee,"keydown",Be),A(ve,"click",n[20]),A(ve,"keydown",Be),A(de,"click",n[21]),A(de,"keydown",Be),A(Se,"click",n[22]),A(Se,"keydown",Be),A(se,"click",ml),A(se,"keydown",Be),A(he,"input",n[14]),A(he,"input",n[28]),A(v,"click",Mt(n[29])),A(v,"keydown",Be),A(y,"click",Mt(n[30])),A(y,"keydown",Be),A(_e,"click",n[31]),A(_e,"keydown",Be),A(ne,"click",n[32]),A(ne,"keydown",Be),A(ce,"keydown",n[13]),A(Ce,"mousedown",n[12])],tt=!0)},p(K,ue){(!pe||ue[0]&1024&&c!==(c="block__icon block__icon--show ariaLabel "+(K[10]<=1?"disabled":"")+" svelte-i2bg01"))&&i(l,"class",c),(!pe||ue[0]&3072&&g!==(g="block__icon block__icon--show ariaLabel "+(K[10]>=K[11]?"disabled":"")+" svelte-i2bg01"))&&i(_,"class",g),(!pe||ue[0]&1024)&&mt(C,K[10]),(!pe||ue[0]&2048)&&mt($,K[11]),(!pe||ue[0]&512)&&mt(X,K[9]),(!pe||ue[0]&512&&me!==(me="fn__flex-shrink ft__selectnone "+(K[9]==null||K[9]==0?"fn__none":"")+" svelte-i2bg01"))&&i(S,"class",me),ue[0]&16&&he.value!==K[4]&&qe(he,K[4]),(!pe||ue[0]&16&&F!==(F="b3-form__icon-clear ariaLabel "+(K[4]==""?"fn__none":"")+" svelte-i2bg01"))&&i(v,"class",F),K[8]?W&&(Bn(),At(W,1,1,()=>{W=null}),Hn()):W?(W.p(K,ue),ue[0]&256&&rt(W,1)):(W=tn(K),W.c(),rt(W,1),W.m(ie,$e)),(!pe||ue[0]&1&&Ge!==(Ge="search__preview "+(K[0]?"":"fn__none")+" svelte-i2bg01"))&&i(re,"class",Ge),(!pe||ue[0]&128&&Pe!==(Pe="fn__loading fn__loading--top "+(K[7]>0?"":"fn__none")+" svelte-i2bg01"))&&i(Ke,"class",Pe)},i(K){pe||(rt(W),pe=!0)},o(K){At(W),pe=!1},d(K){K&&J(e),n[27](null),W&&W.d(),n[33](null),n[34](null),K&&J(et),K&&J(Ke),tt=!1,Oe(pt)}}}function ml(){console.log("点击搜索历史按钮")}function Be(){}function bl(n,e){if(!n)return;let t=yt(n.content,e),l=yt(n.name,e),o=yt(n.alias,e),a=yt(n.memo,e);n.content=t,n.name=l,n.alias=o,n.memo=a}function yt(n,e){if(!n)return n;let t=vl(n);return e&&(t=kl(t,e)),t}function kl(n,e){if(!e.length||!n)return n;const t=new RegExp(`(${e.join("|")})`,"gi");return n.replace(t,"<mark>$1</mark>")}function vl(n){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return n.replace(/[&<>"']/g,t=>e[t])}function wn(n){if(!n)return null;if(n instanceof Element){const e=n.getAttribute("data-node-id");if(e)return e}return wn(n.parentNode)}function Sl(n,e){if(e){const t=n.protyle.contentElement,l=t.getBoundingClientRect();t.scrollTop=t.scrollTop+e.getBoundingClientRect().top-l.top-l.height/2,CSS.highlights.set("search-result-focus",new Highlight(e))}}function Cl(n,e,t){let{app:l}=e,{showPreview:o}=e,a;const c=Y.getFrontend();a=c==="mobile"||c==="browser-mobile";let u,p,h,_,k,b="",g=[],m=-1,D=0,O,S=0,C=!1,x,$=null,N=0,E=0,w=new Map;un(async()=>{_=new Y.Protyle(l,h,{blockId:"",render:{gutter:!0,breadcrumbDocName:!0}}),te()});function R(d){const v=u.querySelector(".search__drag"),T=document,F=v.nextElementSibling,j=v.previousElementSibling,V=d.clientX,y=j.clientWidth,I=F.clientWidth;F.classList.remove("fn__flex-1"),F.style.width=I+"px",T.onmousemove=M=>{M.preventDefault(),M.stopPropagation();const B=y+(M.clientX-V),Q=I-(M.clientX-V);B<120||Q<120||(F.style.width=Q+"px")},T.onmouseup=()=>{T.onmousemove=null,T.onmouseup=null,T.ondragstart=null,T.onselectstart=null,T.onselect=null}}Dn(()=>{_.destroy()});function te(d){document&&(_&&u.offsetWidth&&(_.protyle.element.style.width=u.offsetWidth/2+"px"),X(),d&&(d==0?t(8,C=!0):t(8,C=!1)))}function X(){p&&p.focus()}function Ae(d){if(!d||!d.key)return;let v=d.key;if(v!=="ArrowUp"&&v!=="ArrowDown"&&v!=="Enter")return;d.stopPropagation();let T=null;if(d.key==="ArrowUp")m>0&&t(6,m-=1);else if(d.key==="ArrowDown"){let F=g[g.length-1].subItems,j=g[g.length-1].index;F&&F.length>0&&(j=F[F.length-1].index),m<j&&t(6,m+=1)}for(const F of g){if(m==F.index){T=F;break}for(const j of F.subItems)if(m==j.index){T=j;break}}T&&(X(),d.key==="Enter"&&ee(T.block.id))}function me(d){let v=d.target.value;b!=v&&(t(4,b=v),clearTimeout(O),O=setTimeout(()=>{be(v,1)},450))}function oe(d){d<1||d>E||be(b,d)}function be(d,v){const T=d.trim().replace(/\s+/g," ").split(" "),F=new Set(T.filter(V=>V.length>0));let j=Array.from(F);Ne(j,v)}async function Ne(d,v){if(x=d,!d||d.length<=0){t(9,$=0),t(10,N=0),t(11,E=0),t(5,g=[]);return}ve(),Ee();let T=L.ins.pageSize,F=L.ins.includeTypes,j=L.ins.includeQueryFields,V=L.ins.excludeNotebookIds,y=[v,T],I=L.ins.documentSortMethod,M=L.ins.contentBlockSortMethod;t(6,m=-1);let B=new Rn(d,y,I,M,F,j,V);t(7,S++,S);let Q=zn(B);On(Q).then(U=>{z(U,d);let xe;U&&U[0]&&(xe=U[0].documentCount,G(xe,v,T))}).catch(U=>{console.error("Error:",U)})}function Ee(){t(9,$=0),t(10,N=0),t(11,E=0)}function G(d,v,T){t(7,S=Math.max(0,S-1)),d&&d>0&&(t(9,$=d),t(10,N=v),t(11,E=Math.ceil($/T)))}function z(d,v){if(t(5,g=[]),t(7,S=Math.max(0,S-1)),!d){d=[];return}const T=new Map;for(const y of d){if(!y)continue;bl(y,v);let I=y.root_id,M=new Ht;M.block=y,M.subItems=[],M.isCollapsed=!0;let B=null;if(T.has(I)?B=T.get(I):(B=new Ht,B.subItems=[],T.set(I,B)),B.subItems.push(M),y.type==="d"){if(B.subItems&&(M.subItems=B.subItems),d.length>L.ins.maxExpandCount?M.isCollapsed=!0:M.isCollapsed=!1,y.ial){let Q=Xn(y.ial);M.icon=Sn(Q.icon)}M.path=w.get(y.box).name+y.hpath,g.push(M),T.set(I,M)}}let F=L.ins.documentSortMethod,j;F=="modifiedAsc"?j=function(y,I){return Number(y.block.updated)-Number(I.block.updated)}:F=="modifiedDesc"?j=function(y,I){return Number(I.block.updated)-Number(y.block.updated)}:F=="createdAsc"?j=function(y,I){return Number(y.block.created)-Number(I.block.created)}:F=="createdDesc"?j=function(y,I){return Number(I.block.created)-Number(y.block.created)}:F=="rankAsc"?j=function(y,I){let M=y.block.content.split("<mark>").length-1,B=I.block.content.split("<mark>").length-1,Q=M-B;return Q=Q==0?Number(I.block.updated)-Number(y.block.updated):Q,Q}:j=function(y,I){let M=y.block.content.split("<mark>").length-1,Q=I.block.content.split("<mark>").length-1-M;return Q=Q==0?Number(I.block.updated)-Number(y.block.updated):Q,Q},g.sort(j);let V=0;for(const y of g){if(!L.ins.showChildDocument&&y.subItems.length>1){let I=0;for(let M=0;M<y.subItems.length;M++)if(y.subItems[M].block.type==="d"){I=M;break}y.subItems.splice(I,1)}y.index=V;for(const I of y.subItems)y.block.id!==I.block.id&&(V++,I.index=V);V++}t(5,g)}function ke(d){let T=d.block.id;t(6,m=d.index);let F=L.ins.doubleClickTimeout;X(),o?(D++,D===1?setTimeout(()=>{D===1&&Xe(T),D=0},F):D===2&&(ee(T),D=0)):ee(T)}function ee(d){Bt(d).then(v=>{let T=v?[Y.Constants.CB_GET_HL,Y.Constants.CB_GET_FOCUS,Y.Constants.CB_GET_ALL]:[Y.Constants.CB_GET_HL,Y.Constants.CB_GET_FOCUS,Y.Constants.CB_GET_CONTEXT,Y.Constants.CB_GET_ROOTSCROLL];a===!0?Y.openMobileFileById(l,d,T):Y.openTab({app:l,doc:{id:d,action:T}})}).catch(v=>{console.error("Error:",v)})}function Xe(d){if(o&&d){if(_.protyle.block.id==d){k++,le(_.protyle.contentElement,x,d,k);return}k=0,Bt(d).then(v=>{let T=v?[Y.Constants.CB_GET_HL,Y.Constants.CB_GET_ALL]:[Y.Constants.CB_GET_HL,Y.Constants.CB_GET_CONTEXT,Y.Constants.CB_GET_ROOTSCROLL];_=new Y.Protyle(l,h,{blockId:d,render:{gutter:!0,breadcrumbDocName:!0},action:T,after:F=>{let j=F.protyle.contentElement;le(j,x,d,k);let V=L.ins.refreshPreviewHighlightTimeout;V&&V>0&&setTimeout(()=>{le(j,x,d,k)},V)}})}).catch(v=>{console.error("Error:",v)})}}async function le(d,v,T,F){if(!d||!v)return;if(!CSS.highlights){console.log("CSS Custom Highlight API not supported.");return}const j=document.createTreeWalker(d,NodeFilter.SHOW_TEXT),V=[];let y=j.nextNode();for(;y;)V.push(y),y=j.nextNode();CSS.highlights.clear();let I=[],M=[];if(V.map(U=>({el:U,text:U.textContent.toLowerCase()})).map(({el:U,text:xe})=>{const Ve=[];for(const ne of v){if(!ne)continue;let De=0;for(;De<xe.length;){const ie=xe.indexOf(ne.toLowerCase(),De);if(ie===-1)break;let $e=ne.length;Ve.push({index:ie,length:$e}),De=ie+$e}}Ve.sort((ne,De)=>ne.index-De.index).map(({index:ne,length:De})=>{const ie=new Range;ie.setStart(U,ne),ie.setEnd(U,ne+De),I.push(ie),wn(U)==T&&M.push(ie)})}),I=I.flat(),!I||I.length<=0)return;let B,Q=F%M.length;for(let U=0;U<M.length;U++)if(U==Q){B=M[U];break}B||(k=0,B=M[0]),I=I.filter(U=>U!==B);const _e=new Highlight(...I);CSS.highlights.set("search-result-mark",_e),Sl(_,B)}function Le(d){for(const v of g)!v||!v.block||!v.subItems||v.subItems.length<=0||(v.isCollapsed=d);t(5,g)}async function ve(){let d=(await gn()).notebooks;for(const v of d)w.set(v.id,v)}function Qe(){let d=new Y.Dialog({title:"笔记本过滤",content:'<div id="settingNotebook" class="b3-dialog__content" ></div>',width:this.isMobile?"92vw":"520px",height:"70vh",destroyCallback:T=>{console.log("destroyCallback",T),v.$destroy()}}),v=new rl({target:d.element.querySelector("#settingNotebook")})}function Re(){let d=new Y.Dialog({title:"类型",content:'<div id="settingType" class="b3-dialog__content" ></div>',width:this.isMobile?"92vw":"520px",height:"70vh",destroyCallback:T=>{console.log("destroyCallback",T),v.$destroy()}}),v=new ll({target:d.element.querySelector("#settingType")})}function Ue(){let d=new Y.Dialog({title:"属性",content:'<div id="settingAttr" class="b3-dialog__content" ></div>',width:this.isMobile?"92vw":"520px",height:"70vh",destroyCallback:T=>{console.log("destroyCallback",T),v.$destroy()}}),v=new dl({target:d.element.querySelector("#settingAttr")})}function de(){let d=new Y.Dialog({title:"其他设置",content:'<div id="settingOther" class="b3-dialog__content" ></div>',width:this.isMobile?"92vw":"520px",height:"70vh",destroyCallback:T=>{console.log("destroyCallback",T),v.$destroy()}}),v=new pl({target:d.element.querySelector("#settingOther")})}const Ye=()=>{oe(N-1)},ze=()=>{oe(N+1)};function Je(d){kt[d?"unshift":"push"](()=>{p=d,t(2,p)})}function Se(){b=this.value,t(4,b)}const Ze=()=>{t(4,b=""),be(b,1)},ce=()=>{be(b,N)},Ie=()=>{Le(!1)},se=()=>{Le(!0)};function je(d){kt[d?"unshift":"push"](()=>{h=d,t(3,h)})}function he(d){kt[d?"unshift":"push"](()=>{u=d,t(1,u)})}return n.$$set=d=>{"app"in d&&t(23,l=d.app),"showPreview"in d&&t(0,o=d.showPreview)},[o,u,p,h,b,g,m,S,C,$,N,E,R,Ae,me,oe,be,ke,Le,Qe,Re,Ue,de,l,te,Ye,ze,Je,Se,Ze,ce,Ie,se,je,he]}class nn extends dt{constructor(e){super(),ft(this,e,Cl,gl,ut,{app:23,showPreview:0,resize:24},null,[-1,-1])}get resize(){return this.$$.ctx[24]}}const ln="search_home_tab",wl="search_dock_tab";class yl extends Y.Plugin{constructor(){super(...arguments);ae(this,"isMobile");ae(this,"documentSearchTab")}async onload(){L.ins.load(this);const t=Y.getFrontend();this.isMobile=t==="mobile"||t==="browser-mobile";for(const a in ot)if(Object.prototype.hasOwnProperty.call(ot,a)){const c=ot[a];this.addIcons(c.source)}this.isMobile||this.addTopBar({icon:ot.iconDocumentSearch.id,title:this.i18n.documentSearchIconTip,position:"right",callback:()=>{this.openDocumentSearchTab()}});let l=this.app,o;this.addDock({config:{position:"LeftTop",size:{width:400,height:0},icon:ot.iconDocumentSearch.id,title:this.i18n.documentSearchIconTip,hotkey:"⌥Q",show:!1},data:{},type:wl,resize(){o&&o.resize(this.element.clientWidth)},update(){},init(){o=new nn({target:this.element,props:{app:l,showPreview:!1}})},destroy(){}}),this.addCommand({langKey:"打开文档搜索页签",hotkey:"⇧⌘Q",callback:()=>{this.openDocumentSearchTab()}})}onLayoutReady(){let t=this;this.addTab({type:ln,init(){t.documentSearchTab=new nn({target:this.element,props:{app:this.app,showPreview:!0}})},beforeDestroy(){},destroy(){},resize(){t.documentSearchTab&&t.documentSearchTab.resize()}})}async onunload(){}openDocumentSearchTab(){let t=this.documentSearchTab;Y.openTab({app:this.app,custom:{id:this.name+ln,icon:ot.iconDocumentSearch.id,title:"Document Search"},afterOpen(){t&&t.resize()}})}hiddenElement(t){t&&(t.classList.contains("fn__none")||t.classList.add("fn__none"))}showElement(t){t&&t.classList.contains("fn__none")&&t.classList.remove("fn__none")}}module.exports=yl;
